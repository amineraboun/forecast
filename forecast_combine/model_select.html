<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.4.0"/>
    <title>forecast_combine.model_select API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../forecast_combine.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;forecast_combine</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="function" href="#fetch_errors">fetch_errors</a>
            </li>
            <li>
                    <a class="class" href="#ForecastModelSelect">ForecastModelSelect</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ForecastModelSelect.__init__">ForecastModelSelect</a>
                        </li>
                        <li>
                                <a class="variable" href="#ForecastModelSelect.LF_d">LF_d</a>
                        </li>
                        <li>
                                <a class="variable" href="#ForecastModelSelect.summary_horizon">summary_horizon</a>
                        </li>
                        <li>
                                <a class="variable" href="#ForecastModelSelect.summary_results">summary_results</a>
                        </li>
                        <li>
                                <a class="variable" href="#ForecastModelSelect.model_rank_perhorizon">model_rank_perhorizon</a>
                        </li>
                        <li>
                                <a class="variable" href="#ForecastModelSelect.summary_cutoff">summary_cutoff</a>
                        </li>
                        <li>
                                <a class="function" href="#ForecastModelSelect.split_procedure_summary">split_procedure_summary</a>
                        </li>
                        <li>
                                <a class="function" href="#ForecastModelSelect.add_forecaster">add_forecaster</a>
                        </li>
                        <li>
                                <a class="function" href="#ForecastModelSelect.fit">fit</a>
                        </li>
                        <li>
                                <a class="function" href="#ForecastModelSelect.evaluate">evaluate</a>
                        </li>
                        <li>
                                <a class="function" href="#ForecastModelSelect.select_best">select_best</a>
                        </li>
                        <li>
                                <a class="function" href="#ForecastModelSelect.summary_per_cutoff">summary_per_cutoff</a>
                        </li>
                        <li>
                                <a class="function" href="#ForecastModelSelect.predict">predict</a>
                        </li>
                        <li>
                                <a class="function" href="#ForecastModelSelect.update">update</a>
                        </li>
                        <li>
                                <a class="function" href="#ForecastModelSelect.save">save</a>
                        </li>
                        <li>
                                <a class="function" href="#ForecastModelSelect.get_pred_errors">get_pred_errors</a>
                        </li>
                        <li>
                                <a class="function" href="#ForecastModelSelect.plot_model_compare">plot_model_compare</a>
                        </li>
                        <li>
                                <a class="function" href="#ForecastModelSelect.plot_prediction">plot_prediction</a>
                        </li>
                        <li>
                                <a class="function" href="#ForecastModelSelect.plot_train_test">plot_train_test</a>
                        </li>
                        <li>
                                <a class="function" href="#ForecastModelSelect.plot_cv_procedure">plot_cv_procedure</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../forecast_combine.html">forecast_combine</a><wbr>.model_select    </h1>

                        <div class="docstring"><p>Combination of timeseries Forecasts</p>
</div>

                        <input id="mod-model_select-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-model_select-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="sd">&quot;&quot;&quot; Combination of timeseries Forecasts&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="n">__description__</span> <span class="o">=</span> <span class="s2">&quot;Time Series Forecast Combination&quot;</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Amine Raboun - amineraboun@github.io&quot;</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="kn">import</span> <span class="nn">warnings</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="c1">##############################################################################</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="c1"># Import Libraries &amp; default configuration </span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="c1">##############################################################################</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="kn">from</span> <span class="nn">.forecast</span> <span class="kn">import</span> <span class="n">Forecast</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="kn">from</span> <span class="nn">.forecast</span> <span class="kn">import</span> <span class="n">CommonForecastingModels</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="kn">from</span> <span class="nn">.utils.plotting</span> <span class="kn">import</span> <span class="n">plot_series</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="kn">from</span> <span class="nn">sktime.forecasting.base</span> <span class="kn">import</span> <span class="n">ForecastingHorizon</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;axes&#39;</span><span class="p">,</span> <span class="n">titlesize</span><span class="o">=</span><span class="s1">&#39;x-large&#39;</span><span class="p">)</span>    
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;axes&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>   
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;xtick&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>   
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;ytick&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>   
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;legend&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>   
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;figure&#39;</span><span class="p">,</span> <span class="n">titlesize</span><span class="o">=</span><span class="s1">&#39;x-large&#39;</span><span class="p">)</span> 
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="n">sns</span><span class="o">.</span><span class="n">set_theme</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">font_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">ProcessPoolExecutor</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="k">def</span> <span class="nf">fetch_errors</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a>    <span class="n">_fname</span><span class="p">,</span> <span class="n">_lf</span> <span class="o">=</span> <span class="n">item</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>    <span class="k">return</span> <span class="n">_fname</span><span class="p">,</span> <span class="n">_lf</span><span class="o">.</span><span class="n">get_pred_errors</span><span class="p">()</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="k">class</span> <span class="nc">ForecastModelSelect</span><span class="p">:</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">    Class for model selection and comparison based on out-of-sample performance.</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">    Evaluate how to best combine the different models based on their oos performance.</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="sd">    The class can be initialized in 2 ways. </span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="sd">    - **Method 1**: Requires a dictionary of forecasting models. A dictionary where the keys are names of forecasts and the values are sktime recognized forecast_models.</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="sd">    All the arguments taken by Forecast object must be passed to the initialization of the ForecastModelSelect object.</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="sd">    - **Method 2**: Requires a dictionary of trained models. The training and evalutiaon of the models are assumed to be done.</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="sd">    There is the possibility to combine the two methods by providing both dictionaries. </span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="sd">    In this case, the trained models will be used for evaluation and the non-trained models will be trained and evaluated.</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="sd">    Parameters:</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="sd">    -----------    </span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a><span class="sd">    - forecasters_d (dict): A dictionary containing various forecasting models for comparison. </span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="sd">    Default is None and assess the most common forecasting models.</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="sd">        - **Naive:** NaiveForecaster - Keep the latest value</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="sd">        - **SeasonalNaive:** NaiveForecaster - Keep the value of the same season</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a><span class="sd">        - **AutoARIMA:** StatsForecastAutoARIMA - Auto ARIMA model</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="sd">        - **AutoETS:** StatsForecastAutoETS - Auto ETS model</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="sd">        - **AutoCES:** StatsForecastAutoCES - Auto CES model</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="sd">        - **AutoTheta:** StatsForecastAutoTheta - Auto Theta model</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a><span class="sd">        - **AutoTBATS:** StatsForecastAutoTBATS - Auto TBATS model</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="sd">        - **Prophet:** Prophet - Prophet model</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a><span class="sd">    - trained_forecasters_d (dict): A dictionary containing trained Forecast objects. Default is None.</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a><span class="sd">    - model_exog_d (dict): A dictionary containing exogenous variables for each model. Default is None.</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a><span class="sd">    - mode (str): The aggregation mode. Default is &#39;nbest_average_horizon&#39;. Available values are:</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a><span class="sd">        - best: The prediction is based on the best model.</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="sd">        - best_horizon: The prediction is based on the best model for each horizon.</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a><span class="sd">        - average: The average of the prediction of all models.</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a><span class="sd">        - inverse_score: The weighted average prediction, where weights are inversely proportional to the model performance score.</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a><span class="sd">        - nbest_average: Average of the n best models. The n is given by the parameter nbest.</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a><span class="sd">        - nbest_average_horizon: Average of the n best models for each horizon. The n is given by the parameter nbest.</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a><span class="sd">        - model: Returns the prediction of a specific model. The model name must be provided in the model_name parameter.</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a><span class="sd">    - score (str): The performance score. Default is &#39;RMSE&#39;. Available values are:</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a><span class="sd">        - RMSE: Root Mean Squared Error.</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a><span class="sd">        - MAE: Mean Absolute Error.</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a><span class="sd">        - MAPE: Mean Absolute Percentage Error.</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a><span class="sd">        - MedianAE: Median Absolute Error.</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="sd">        - R2: R-squared.       </span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="sd">    - nbest (int): Number of best models to aggregate. Default is 2.    </span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a><span class="sd">    - data (pd.DataFrame): A DataFrame containing the input data for forecasting.</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a><span class="sd">    - depvar_str (str): The column name representing the dependent variable for forecasting.</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a><span class="sd">    - fh (int): The forecast horizon, i.e., the number of periods ahead to forecast.</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a><span class="sd">    - pct_initial_window (float): The percentage of data used as the initial training window.</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a><span class="sd">    - step_length (int): The step size for expanding window cross-validation.    </span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="sd">    - exog_l (list, optional): List of exogenous variables for forecasting. Default is None.</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a><span class="sd">    - freq (str, optional): The frequency of the time series data. Default is &#39;B&#39; (business days).</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="sd">    Attributes:</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a><span class="sd">    -----------</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a><span class="sd">    - LF_d (dict): A dictionary containing the Forecast objects.</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a><span class="sd">    - summary_horizon (pd.DataFrame): Summary of out-of-sample performance per horizon and per model.</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a><span class="sd">    - summary_results (pd.DataFrame): Summary of out-of-sample performance per model.</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="sd">    - summary_cutoff (pd.DataFrame): Out-of-sample performance based on cutoffs.</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a><span class="sd">    - model_rank_perhorizon (pd.DataFrame): Rank of models per horizon based on performance.</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a><span class="sd">    - _mode (str): The aggregation mode.</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="sd">    - _score (str): The performance score.</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="sd">    - _nbest (int): Number of best models to aggregate.</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a><span class="sd">    - _eval_models (list): A list of evaluated models.    </span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a><span class="sd">    - _best_x_overall (dict): The best models based on overall performance.</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a><span class="sd">    - _avg_oos_horizon (dict): The average out-of-sample performance per horizon.</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="sd">    Methods:</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a><span class="sd">    --------</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a><span class="sd">    - split_procedure_summary(): Print the summary of the split procedure for each model.</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a><span class="sd">    - add_forecaster(forecaster_name, lf): Add a Forecast Object to the list of models to evaluate.</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a><span class="sd">    - fit(on, fh, force, verbose): Fit the forecasting models for all the underlying Forecast objects.</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a><span class="sd">    - evaluate(force): Evaluate the underlying Forecast models out of sample.</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a><span class="sd">    - select_best(score, reestimate): Select the best model based on horizon and overall performance.</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a><span class="sd">    - summary_per_cutoff(score): Calculate and return the out-of-sample performance based on cutoffs.</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a><span class="sd">    - predict(X, fh, coverage, mode, score, model_name, ret_underlying): Make forecasts using the specified aggregation mode.</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a><span class="sd">    - update(new_y, new_X, refit, reevaluate, fh, coverage, mode, score, model_name, ret_underlying): Update the prediction for all the models and aggregate them based on the specific mode.</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a><span class="sd">    - save(path): Save the model to a file.</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a><span class="sd">    - get_pred_errors(mode, score, model_name): Get the prediction errors.</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a><span class="sd">    - plot_model_compare(score, view, model_subset, xlabel, ylabel, title, ax, figsize): Plot a comparison of models based on their out-of-sample performance.</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a><span class="sd">    - plot_prediction(y_pred, models_preds, y_pred_interval, interval_label, aggregation_label, xlabel, ylabel, title, ax): Plot the prediction.</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a><span class="sd">    </span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a><span class="sd">    Raises:</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a><span class="sd">    -------    </span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a><span class="sd">    - AssertionError: If the trained models are not instances of Forecast.</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a><span class="sd">    - AssertionError: If there is an overlap between the trained and non-trained dictionaries.</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a><span class="sd">    - AssertionError: If the mode function is not implemented.</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a><span class="sd">    - AssertionError: If the performance score is not implemented.</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a><span class="sd">    - AssertionError: If the number of best models is not an integer.</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a><span class="sd">    - AssertionError: If the exogenous variables are missing for a model.</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a><span class="sd">    - ValueError: If the view mode is not &#39;horizon&#39; or &#39;cutoff&#39;.</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a><span class="sd">    - ValueError: If the mode is not &#39;best&#39;, &#39;best_horizon&#39;, &#39;average&#39;, &#39;inverse_score&#39;, &#39;nbest_average&#39;, &#39;nbest_average_horizon&#39;, or &#39;model&#39;.</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>                 <span class="n">forecasters_d</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>                 <span class="n">trained_forecasters_d</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>                 <span class="n">model_exog_d</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>                 <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;best_horizon&#39;</span><span class="p">,</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>                 <span class="n">score</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">,</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>                 <span class="n">nbest</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>                 <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>                <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the ForecastModelSelect object.&quot;&quot;&quot;</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>        <span class="n">lf_d</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">trained_forecasters_d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>            <span class="c1"># Trained Models must be istance of Forecast object</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">forecasters_d</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">trained_forecasters_d</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;There is an overlap between the two trained and non trainded dictionaries&#39;</span> 
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">forecasters_d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>                <span class="c1"># There must be no overlap between the two dictionaries</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>                <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_lf</span><span class="p">,</span> <span class="n">Forecast</span><span class="p">)</span> <span class="k">for</span> <span class="n">_lf</span> <span class="ow">in</span> <span class="n">trained_forecasters_d</span><span class="o">.</span><span class="n">values</span><span class="p">()]),</span> <span class="s1">&#39;Trained models must be instances of Forecast object&#39;</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>            <span class="k">for</span> <span class="n">forecaster_name</span><span class="p">,</span> <span class="n">_lf</span> <span class="ow">in</span> <span class="n">trained_forecasters_d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>                <span class="n">lf_d</span><span class="p">[</span><span class="n">forecaster_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">_lf</span>        
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">forecasters_d</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>                <span class="n">forecasters_d</span> <span class="o">=</span> <span class="n">CommonForecastingModels</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>        
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>        <span class="c1"># Define the Forecasters exogenous variables</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>        <span class="n">exog_l</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;exog_l&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>        <span class="k">if</span> <span class="n">model_exog_d</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>            <span class="n">model_exog_d</span> <span class="o">=</span> <span class="p">{</span><span class="n">forecaster_name</span><span class="p">:</span> <span class="n">exog_l</span> <span class="k">for</span> <span class="n">forecaster_name</span> <span class="ow">in</span> <span class="n">forecasters_d</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>            <span class="n">exog_l</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">exog_l</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">exog_l</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>            <span class="k">for</span> <span class="n">forecaster_name</span> <span class="ow">in</span> <span class="n">forecasters_d</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>                <span class="n">model_exog_d</span><span class="p">[</span><span class="n">forecaster_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">exog_l</span> <span class="o">+</span> <span class="n">model_exog_d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">forecaster_name</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>        
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>        <span class="k">if</span> <span class="n">forecasters_d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>            <span class="k">for</span> <span class="n">forecaster_name</span><span class="p">,</span> <span class="n">forecaster</span> <span class="ow">in</span> <span class="n">forecasters_d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>            
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>                <span class="n">_lf</span> <span class="o">=</span>  <span class="n">Forecast</span><span class="p">(</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>                    <span class="n">forecaster_name</span> <span class="o">=</span> <span class="n">forecaster_name</span><span class="p">,</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>                    <span class="n">forecaster</span> <span class="o">=</span> <span class="n">forecaster</span><span class="p">,</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>                    <span class="n">exog_l</span> <span class="o">=</span> <span class="n">model_exog_d</span><span class="p">[</span><span class="n">forecaster_name</span><span class="p">],</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>                    <span class="o">**</span><span class="n">kwargs</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>                <span class="p">)</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>                <span class="n">lf_d</span><span class="p">[</span><span class="n">forecaster_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">_lf</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>                           
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span> <span class="o">=</span> <span class="n">lf_d</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="s1">&#39;mode must be a sting&#39;</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>        <span class="n">recog_modes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="s1">&#39;best_horizon&#39;</span><span class="p">,</span> <span class="s1">&#39;average&#39;</span><span class="p">,</span> <span class="s1">&#39;inverse_score&#39;</span><span class="p">,</span> 
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>                           <span class="s1">&#39;nbest_average&#39;</span><span class="p">,</span> <span class="s1">&#39;nbest_average_horizon&#39;</span><span class="p">]</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>        <span class="k">assert</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">recog_modes</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;mode function not implemented!. Recognized modes are </span><span class="si">{</span><span class="n">recog_modes</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">=</span> <span class="n">mode</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>        <span class="n">recog_scores</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="s1">&#39;MAE&#39;</span><span class="p">,</span> <span class="s1">&#39;MAPE&#39;</span><span class="p">,</span> <span class="s1">&#39;R2&#39;</span><span class="p">,</span> <span class="s1">&#39;MedianAE&#39;</span><span class="p">]</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>        <span class="k">assert</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">recog_scores</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;performance score not implemented!. Recognized scores are </span><span class="si">{</span><span class="n">recog_scores</span><span class="si">}</span><span class="s1">&#39;</span>		
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_score</span> <span class="o">=</span> <span class="n">score</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>        <span class="k">if</span> <span class="n">nbest</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>            <span class="n">nbest</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nbest</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="s1">&#39;n best must be an integer&#39;</span>		
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_nbest</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">nbest</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="p">))</span>	
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_eval_models</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">summary_horizon</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">summary_results</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model_rank_perhorizon</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_best_x_overall</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_avg_oos_horizon</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">summary_cutoff</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>    <span class="k">def</span> <span class="nf">split_procedure_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a><span class="sd">        Print the summary of the split procedure for each model.</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a><span class="sd">        Returns:</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a><span class="sd">        --------        </span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a><span class="sd">            dict:</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a><span class="sd">                A dictionary containing details of the cross-validation procedure, including:</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a><span class="sd">                the number of folds, initial window size, step length, and forecast period.</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>        <span class="n">_lf</span>  <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>        <span class="k">return</span> <span class="n">_lf</span><span class="o">.</span><span class="n">split_procedure_summary</span><span class="p">()</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>    
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>    <span class="k">def</span> <span class="nf">add_forecaster</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>                       <span class="n">forecaster_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>                       <span class="n">lf</span><span class="p">:</span> <span class="n">Forecast</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a><span class="sd">        Add a Forecast Object to the list of models to evaluate.</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a><span class="sd">        Parameters:</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a><span class="sd">        -----------</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a><span class="sd">            lf : Forecast</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a><span class="sd">                The Forecast object to be added.</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>        <span class="k">assert</span> <span class="n">forecaster_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="s1">&#39;Forecaster name already exists in the considered list of model&#39;</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="p">[</span><span class="n">forecaster_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">lf</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>            <span class="n">on</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span> 
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>            <span class="n">fh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ForecastingHorizon</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>            <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>            <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>           <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a><span class="sd">        Fit the forecasting models for all the underlying Forecast objects.</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a><span class="sd">        Parameters:</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a><span class="sd">        -----------        </span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a><span class="sd">            on : str, optional</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a><span class="sd">                The period for the in-sample fitting. Default is &#39;all&#39;.</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a><span class="sd">            fh : ForecastingHorizon, optional</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a><span class="sd">                The forecasting horizon. Default is None and it takes the value entered at initialization..</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a><span class="sd">            force : bool, optional</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a><span class="sd">                If True, force fitting even if the models are already fitted. Default is False.</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a><span class="sd">        Returns:</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a><span class="sd">        --------        </span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a><span class="sd">            None</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>        <span class="k">for</span> <span class="n">_lfname</span><span class="p">,</span> <span class="n">_lf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Fitting </span><span class="si">{</span><span class="n">_lfname</span><span class="si">}</span><span class="s1"> ...&#39;</span><span class="p">)</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">_lf</span><span class="o">.</span><span class="n">is_fitted</span><span class="p">)</span> <span class="ow">and</span> <span class="n">force</span> <span class="o">==</span><span class="kc">False</span><span class="p">:</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>                <span class="k">pass</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>                <span class="n">_lf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">on</span><span class="o">=</span><span class="n">on</span><span class="p">,</span> <span class="n">fh</span><span class="o">=</span><span class="n">fh</span><span class="p">)</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>                 <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>                <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">:</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a><span class="sd">        Evaluate the underlying Forecast models out of sample.</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a><span class="sd">        Parameters:</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a><span class="sd">        -----------</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a><span class="sd">            force : bool, optional</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a><span class="sd">                If True, force the evaluation even if the models are already evaluated. Default is False.</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a><span class="sd">        Returns:</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a><span class="sd">        --------</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a><span class="sd">            tuple</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a><span class="sd">                A tuple containing the summary of out-of-sample performance per horizon and per model.</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>        <span class="c1">#Step 1: Loop on all models and evaluate them</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>        <span class="n">_model_evals</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>        <span class="n">_todrop_evals</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>        <span class="k">for</span> <span class="n">_fname</span><span class="p">,</span> <span class="n">_lf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">_lf</span><span class="o">.</span><span class="n">is_evaluated</span><span class="p">)</span> <span class="ow">and</span> <span class="n">force</span> <span class="o">==</span><span class="kc">False</span><span class="p">:</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>                <span class="n">_model_evals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_lf</span><span class="o">.</span><span class="n">eval</span><span class="p">)</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>                    <span class="n">_eval</span> <span class="o">=</span> <span class="n">_lf</span><span class="o">.</span><span class="n">evaluate</span><span class="p">()</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>                    <span class="n">_model_evals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_eval</span><span class="p">)</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error evaluating </span><span class="si">{</span><span class="n">_fname</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">model </span><span class="si">{</span><span class="n">_fname</span><span class="si">}</span><span class="s1"> cannot be evaluated. It will be removed from the list of models&#39;</span><span class="p">)</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>                    <span class="n">_todrop_evals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_fname</span><span class="p">)</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>                    <span class="k">continue</span>                
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_todrop_evals</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>            <span class="k">for</span> <span class="n">_fname</span> <span class="ow">in</span> <span class="n">_todrop_evals</span><span class="p">:</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">_fname</span><span class="p">)</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_eval_models</span> <span class="o">=</span> <span class="n">_model_evals</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>        <span class="c1"># Step 2: Get the OOS Summary of Performance </span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>        <span class="c1">#per horizon and per model</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>        <span class="n">_sum_h</span> <span class="o">=</span> <span class="p">{};</span> <span class="n">_sum_T</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>        <span class="k">for</span> <span class="n">_lf_eval</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_models</span><span class="p">:</span>            
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>            <span class="n">_sum_T</span><span class="p">[</span><span class="n">_lf_eval</span><span class="o">.</span><span class="n">forecaster_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">_lf_eval</span><span class="o">.</span><span class="n">summary_results</span><span class="p">()</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>            <span class="n">_sum_h</span><span class="p">[</span><span class="n">_lf_eval</span><span class="o">.</span><span class="n">forecaster_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">_lf_eval</span><span class="o">.</span><span class="n">summary_horizon</span><span class="p">()</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">summary_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">_sum_T</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keys</span> <span class="o">=</span> <span class="n">_sum_T</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">summary_horizon</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">_sum_h</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keys</span> <span class="o">=</span> <span class="n">_sum_h</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>        
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary_horizon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary_results</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>    <span class="k">def</span> <span class="nf">select_best</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>                    <span class="n">score</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>                    <span class="n">reestimate</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>                   <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a><span class="sd">        Select the best model based on horizon and overall performance.</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a><span class="sd">        Parameters:</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a><span class="sd">        -----------        </span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a><span class="sd">            score : str, optional</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a><span class="sd">                The performance metric to use for model comparison. Default is None and it takes the value entered at initialization.</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a><span class="sd">            nbest : int, optional</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a><span class="sd">                The number of best models to select based on horizon performance. Default is None and it takes the value entered at initialization.</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a><span class="sd">        Returns:</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a><span class="sd">        --------        </span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a><span class="sd">            pd.DataFrame</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a><span class="sd">                model_rank_perhorizon. Rank of models per horizon based on performance.</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>        <span class="k">if</span> <span class="n">score</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>            <span class="n">score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_rank_perhorizon</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_avg_oos_horizon</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="n">reestimate</span><span class="p">:</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>            <span class="c1"># if models are not evaluated yet, run evaluate</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>            <span class="n">cond1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_models</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>            <span class="n">cond2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary_horizon</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>            <span class="k">if</span> <span class="n">cond1</span> <span class="ow">or</span> <span class="n">cond2</span><span class="p">:</span>	
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Run evaluate ...&#39;</span><span class="p">)</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">()</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>            <span class="n">nevals</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="p">)</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>            <span class="n">nbest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nbest</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>            <span class="k">if</span> <span class="n">nbest</span> <span class="o">&gt;</span> <span class="n">nevals</span><span class="p">:</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">nbest =</span><span class="si">{</span><span class="n">nbest</span><span class="si">}</span><span class="s1"> is higher than the number of models evaluated </span><span class="si">{</span><span class="n">nevals</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;All models will be considered. The average best models will be equal to the simple average&#39;</span><span class="p">)</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>                <span class="n">nbest</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">nbest</span><span class="p">,</span> <span class="n">nevals</span><span class="p">)</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>            <span class="n">best_x_overall</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>            <span class="n">model_rank_perhorizon</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>            <span class="n">avg_oos_horizon</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>            <span class="n">_perf_metrics</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">summary_horizon</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>            <span class="k">for</span> <span class="n">_s</span> <span class="ow">in</span> <span class="n">_perf_metrics</span><span class="p">:</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>                <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary_horizon</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="n">_s</span><span class="p">]</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>                <span class="c1"># Select best x models based on their average performance on all horizons </span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>                <span class="n">overall_score</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>                <span class="n">best_overall</span> <span class="o">=</span> <span class="n">overall_score</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>                <span class="n">_s_best_x_overall</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">overall_score</span><span class="o">.</span><span class="n">index</span><span class="p">[:</span><span class="n">nbest</span><span class="p">])</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>                <span class="c1"># Summary Model average</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>                <span class="n">_avg_oos_horizon</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">r</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">best_overall</span><span class="p">],</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>                                            <span class="n">r</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>                                            <span class="n">r</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">_s_best_x_overall</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>                                            <span class="n">r</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">nsmallest</span><span class="p">(</span><span class="n">nbest</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>                                            <span class="n">r</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> 
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>                                            <span class="p">],</span> 
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>                                            <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>                                            <span class="s1">&#39;Best Model (over all)&#39;</span><span class="p">,</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>                                            <span class="s1">&#39;Best Model (per horizon)&#39;</span><span class="p">,</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>                                            <span class="sa">f</span><span class="s1">&#39;Best </span><span class="si">{</span><span class="n">nbest</span><span class="si">}</span><span class="s1"> Models (over all)&#39;</span><span class="p">,</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>                                            <span class="sa">f</span><span class="s1">&#39;Best </span><span class="si">{</span><span class="n">nbest</span><span class="si">}</span><span class="s1"> Models (per horizon)&#39;</span><span class="p">,</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>                                            <span class="s1">&#39;Model Avg (all models)&#39;</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>                                            <span class="p">],</span> 
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>                                            <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>                <span class="n">avg_oos_horizon</span><span class="p">[</span><span class="n">_s</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">r</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">_avg_oos_horizon</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>                <span class="c1"># Compute the rank of the models per horizon</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>                <span class="n">_rank_perhorizon</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">nsmallest</span><span class="p">(</span><span class="n">nevals</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>\
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>                    <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Best_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nevals</span><span class="p">)})</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>                <span class="n">model_rank_perhorizon</span><span class="p">[</span><span class="n">_s</span><span class="p">]</span> <span class="o">=</span> <span class="n">_rank_perhorizon</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>                <span class="n">best_x_overall</span><span class="p">[</span><span class="n">_s</span><span class="p">]</span> <span class="o">=</span> <span class="n">_s_best_x_overall</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>            
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_best_x_overall</span> <span class="o">=</span> <span class="n">best_x_overall</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">model_rank_perhorizon</span> <span class="o">=</span> <span class="n">model_rank_perhorizon</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_avg_oos_horizon</span> <span class="o">=</span> <span class="n">avg_oos_horizon</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_rank_perhorizon</span><span class="p">[</span><span class="n">score</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_avg_oos_horizon</span><span class="p">[</span><span class="n">score</span><span class="p">]</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>    <span class="k">def</span> <span class="nf">summary_per_cutoff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>                       <span class="n">score</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>                      <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a><span class="sd">        Calculate and return the out-of-sample performance based on cutoffs.</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a><span class="sd">        Parameters:</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a><span class="sd">        -----------        </span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a><span class="sd">            score : str, optional</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a><span class="sd">                The performance metric to use for model comparison. Should be either &#39;RMSE&#39; or &#39;MAPE&#39;. Default is None and it takes the value entered at initialization.</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a><span class="sd">            nbest : int, optional</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a><span class="sd">                The number of best models to select based on horizon performance. Default is None and it takes the value entered at initialization.</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a><span class="sd">        Returns:</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a><span class="sd">        --------        </span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a><span class="sd">            pd.DataFrame</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a><span class="sd">                A DataFrame containing the out-of-sample performance per horizon and per model based on the specified score and nbest values.</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a><span class="sd">        &quot;&quot;&quot;</span>    
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>        <span class="k">if</span> <span class="n">score</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>            <span class="n">score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>        
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary_cutoff</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>            <span class="n">nbest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nbest</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>            <span class="n">nevals</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="p">)</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>            <span class="k">if</span> <span class="n">nbest</span> <span class="o">&gt;</span> <span class="n">nevals</span><span class="p">:</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">nbest =</span><span class="si">{</span><span class="n">nbest</span><span class="si">}</span><span class="s1"> is higher than the number of models evaluated </span><span class="si">{</span><span class="n">nevals</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The average performance of best models will be computed on </span><span class="si">{</span><span class="n">nevals</span><span class="si">}</span><span class="s1"> models instead&#39;</span><span class="p">)</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>                <span class="n">nbest</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">nbest</span><span class="p">,</span> <span class="n">nevals</span><span class="p">)</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_models</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Run evaluate ...&#39;</span><span class="p">)</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">()</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>            <span class="n">avg_oos_hist</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>            <span class="n">_perf_metrics</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">summary_horizon</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>            <span class="k">for</span> <span class="n">_s</span> <span class="ow">in</span> <span class="n">_perf_metrics</span><span class="p">:</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>                <span class="n">_oos</span> <span class="o">=</span> <span class="p">{</span><span class="n">_lf_eval</span><span class="o">.</span><span class="n">forecaster_name</span><span class="p">:</span> <span class="n">_lf_eval</span><span class="o">.</span><span class="n">_oos_cutoff_perf</span><span class="p">[</span><span class="n">_s</span><span class="p">]</span> <span class="k">for</span> <span class="n">_lf_eval</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_models</span><span class="p">}</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>                <span class="n">_oos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">_oos</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span>  <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span> <span class="n">_oos</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>                <span class="n">best_mod</span> <span class="o">=</span> <span class="n">_oos</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>                <span class="n">nbest_mods</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">_oos</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">nsmallest</span><span class="p">(</span><span class="n">nbest</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>                <span class="n">_aggs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">_oos</span><span class="p">[</span><span class="n">best_mod</span><span class="p">],</span> <span class="n">_oos</span><span class="p">[</span><span class="n">nbest_mods</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">_oos</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>                                  <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Best Model (over all)&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Best </span><span class="si">{</span><span class="n">nbest</span><span class="si">}</span><span class="s1"> Models (over all)&#39;</span><span class="p">,</span><span class="s1">&#39;Model Avg (all models)&#39;</span><span class="p">])</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>                <span class="n">avg_oos_hist</span><span class="p">[</span><span class="n">_s</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">_oos</span><span class="p">,</span> <span class="n">_aggs</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">summary_cutoff</span> <span class="o">=</span> <span class="n">avg_oos_hist</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>        
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>        <span class="k">return</span> <span class="n">avg_oos_hist</span><span class="p">[</span><span class="n">score</span><span class="p">]</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>    <span class="k">def</span> <span class="nf">__stage_X</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>                  <span class="n">LF</span><span class="p">:</span><span class="n">Forecast</span><span class="p">,</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>                  <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>                  <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>        <span class="k">if</span> <span class="n">LF</span><span class="o">.</span><span class="n">_X</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>            <span class="n">_lf_exogs</span> <span class="o">=</span> <span class="n">LF</span><span class="o">.</span><span class="n">_X</span><span class="o">.</span><span class="n">columns</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>            <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="n">_ex</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">_ex</span> <span class="ow">in</span> <span class="n">_lf_exogs</span><span class="p">]),</span> <span class="sa">f</span><span class="s1">&#39;Some exogenous variables are missing for model </span><span class="si">{</span><span class="n">LF</span><span class="o">.</span><span class="n">forecaster_name</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>            <span class="n">_lf_X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">_lf_exogs</span><span class="p">]</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a>            <span class="n">_lf_X</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>        <span class="k">return</span> <span class="n">_lf_X</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>        
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>                <span class="n">X</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a>                <span class="n">fh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ForecastingHorizon</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a>                <span class="n">coverage</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a>                <span class="n">mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a>                <span class="n">score</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a>                <span class="n">model_name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a>                <span class="n">ret_underlying</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a>               <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a><span class="sd">        Make forecasts using the specified aggregation mode.</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a><span class="sd">        Parameters:</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a><span class="sd">        -----------        </span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a><span class="sd">            X : pd.DataFrame, optional</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a><span class="sd">                The exogenous variables used for prediction. Default is None and it takes the value entered at initialization..</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a><span class="sd">            fh : ForecastingHorizon, optional</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a><span class="sd">                The forecasting horizon. Default is None and it takes the value entered at initialization..</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a><span class="sd">            coverage : float, optional</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a><span class="sd">                The prediction interval coverage. Default is 0.9.</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a><span class="sd">            mode : str, optional</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a><span class="sd">                The aggregation mode for predictions. Default is None and it takes the value entered at initialization.. </span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a><span class="sd">                Available values:</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a><span class="sd">                * &#39;best&#39;: The prediction is based on the best model.</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a><span class="sd">                * &#39;best_horizon&#39;: The prediction is based on the best model for each horizon.</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a><span class="sd">                * &#39;average&#39;: The average of the prediction of all models.</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a><span class="sd">                * &#39;inverse_score&#39;: The weighted average prediction, where weights are inversely proportional to the model performance score.</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a><span class="sd">                * &#39;nbest_average&#39;: Average of the n best models. The n is given by the parameter nbest.</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a><span class="sd">                * &#39;nbest_average_horizon&#39;: Average of the n best models for each horizon. The n is given by the parameter nbest.</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a><span class="sd">                * &#39;model&#39;: Returns the prediction of a specific model. The model name must be provided in the model_name parameter.</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a><span class="sd">            score : str, optional</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a><span class="sd">                The performance metric to use for model comparison. Should be either &#39;RMSE&#39; or &#39;MAPE&#39;. Default is None and it takes the value entered at initialization..</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a><span class="sd">            nbest : int, optional</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a><span class="sd">                The number of best models to select based on horizon performance. Default is None and it takes the value entered at initialization..</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a><span class="sd">            model_name: str, optional</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a><span class="sd">                The model name to use for prediction if mode=&#39;model&#39;. Default is None.</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a><span class="sd">            ret_underlying : bool, optional</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a><span class="sd">                If True, return the underlying predictions and prediction intervals for each model. Default is False.</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a><span class="sd">        Returns:</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a><span class="sd">        --------        </span>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a><span class="sd">            tuple</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a><span class="sd">                A tuple containing the aggregated prediction and prediction intervals.</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a>            <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;model&#39;</span><span class="p">:</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a>            <span class="k">assert</span> <span class="n">model_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="s1">&#39;Model name not in the list of models&#39;</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a>            <span class="n">_lf_X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__stage_X</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="p">[</span><span class="n">model_name</span><span class="p">],</span> <span class="n">X</span><span class="p">)</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a>            <span class="n">pred</span><span class="p">,</span> <span class="n">pred_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">_lf_X</span><span class="p">,</span> <span class="n">fh</span><span class="o">=</span><span class="n">fh</span><span class="p">,</span> <span class="n">coverage</span><span class="o">=</span><span class="n">coverage</span><span class="p">)</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>            <span class="k">if</span> <span class="n">ret_underlying</span><span class="p">:</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>                <span class="k">return</span> <span class="n">pred</span><span class="p">,</span> <span class="n">pred_int</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a>            <span class="k">else</span><span class="p">:</span> 
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a>                <span class="k">return</span> <span class="n">pred</span><span class="p">,</span> <span class="n">pred_int</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a>            <span class="n">preds</span> <span class="o">=</span> <span class="p">{};</span> <span class="n">pred_ints</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a>            <span class="k">for</span> <span class="n">_fname</span><span class="p">,</span> <span class="n">_lf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>                <span class="n">_lf_X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__stage_X</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="p">[</span><span class="n">_fname</span><span class="p">],</span> <span class="n">X</span><span class="p">)</span>                
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>                <span class="n">_y_pred</span><span class="p">,</span> <span class="n">_y_pred_ints</span> <span class="o">=</span> <span class="n">_lf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">_lf_X</span><span class="p">,</span> <span class="n">fh</span><span class="o">=</span><span class="n">fh</span><span class="p">,</span> <span class="n">coverage</span><span class="o">=</span><span class="n">coverage</span><span class="p">)</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>                <span class="n">preds</span><span class="p">[</span><span class="n">_fname</span><span class="p">]</span> <span class="o">=</span> <span class="n">_y_pred</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>                <span class="n">pred_ints</span><span class="p">[</span><span class="n">_fname</span><span class="p">]</span> <span class="o">=</span><span class="n">_y_pred_ints</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a>            <span class="n">preds</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">preds</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">keys</span> <span class="o">=</span> <span class="n">preds</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>            <span class="n">pred_ints</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">pred_ints</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">keys</span> <span class="o">=</span> <span class="n">pred_ints</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__aggregate_pred</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">preds</span><span class="o">=</span><span class="n">preds</span><span class="p">,</span> <span class="n">pred_ints</span><span class="o">=</span><span class="n">pred_ints</span><span class="p">,</span> <span class="n">score</span><span class="o">=</span><span class="n">score</span><span class="p">,</span> <span class="n">ret_underlying</span><span class="o">=</span><span class="n">ret_underlying</span><span class="p">)</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a>               <span class="n">new_y</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a>               <span class="n">new_X</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a>               <span class="n">refit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a>               <span class="n">reevaluate</span><span class="p">:</span><span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a>               <span class="n">fh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ForecastingHorizon</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a>               <span class="n">coverage</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span> 
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a>               <span class="n">mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a>               <span class="n">score</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a>               <span class="n">model_name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a>               <span class="n">ret_underlying</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a>              <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a><span class="sd">        Function to update the prediction for all the models and aggregate them based on the specific mode.</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a><span class="sd">        Parameters:</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a><span class="sd">        -----------        </span>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a><span class="sd">            newdata : pd.DataFrame</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a><span class="sd">                The new data for updating the predictions.</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a><span class="sd">            refit : bool, optional</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a><span class="sd">                If False, generate the prediction without fitting the model. If True, fits the underlying models again on the entire sample</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a><span class="sd">                Default is False</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a><span class="sd">            reevaluate: bool, optional    </span>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a><span class="sd">                Reapply the cross-validateion, evaluate the models out of sample, select the best models, then aggregate the predictions according the setup.</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a><span class="sd">                Default is False.</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a><span class="sd">            fh : ForecastingHorizon, optional</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a><span class="sd">                The forecasting horizon. Default is None and it takes the value entered at initialization..</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a><span class="sd">            coverage : float, optional</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a><span class="sd">                The prediction interval coverage. Default is 0.9.</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a><span class="sd">            mode : str, optional</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a><span class="sd">                The aggregation mode for predictions. Default is None and it takes the value entered at initialization..</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a><span class="sd">                Available values:</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a><span class="sd">                * &#39;best&#39;: The prediction is based on the best model.</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a><span class="sd">                * &#39;best_horizon&#39;: The prediction is based on the best model for each horizon.</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a><span class="sd">                * &#39;average&#39;: The average of the prediction of all models.</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a><span class="sd">                * &#39;inverse_score&#39;: The weighted average prediction, where weights are inversely proportional to the model performance score.</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a><span class="sd">                * &#39;nbest_average&#39;: Average of the n best models. The n is given by the parameter nbest.</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a><span class="sd">                * &#39;nbest_average_horizon&#39;: Average of the n best models for each horizon. The n is given by the parameter nbest.</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a><span class="sd">                * &#39;model&#39;: Returns the prediction of a specific model. The model name must be provided in the model_name parameter.</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a><span class="sd">            score : str, optional</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a><span class="sd">                The performance metric to use for model comparison. Should be either &#39;RMSE&#39; or &#39;MAPE&#39;. Default is None and it takes the value entered at initialization..</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a><span class="sd">            nbest : int, optional</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a><span class="sd">                The number of best models to select based on horizon performance. Default is None and it takes the value entered at initialization. and it takes the value entered at initialization..</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a><span class="sd">            model_name: str, optional</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a><span class="sd">                The model name to use for prediction if mode=&#39;model&#39;. Default is None.</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a><span class="sd">            ret_underlying : bool, optional</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a><span class="sd">                If True, return the underlying predictions and prediction intervals for each model. Default is False.</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a><span class="sd">        Returns:</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a><span class="sd">        -------</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a><span class="sd">            tuple</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a><span class="sd">                A tuple containing the aggregated prediction and prediction intervals.</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a>            <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a>
</span><span id="L-565"><a href="#L-565"><span class="linenos">565</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;model&#39;</span><span class="p">:</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos">566</span></a>            <span class="k">assert</span> <span class="n">model_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="s1">&#39;Model name not in the list of models&#39;</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos">567</span></a>            <span class="n">_lf_X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__stage_X</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="p">[</span><span class="n">model_name</span><span class="p">],</span> <span class="n">new_X</span><span class="p">)</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos">568</span></a>            <span class="n">pred</span><span class="p">,</span> <span class="n">pred_int</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">new_y</span><span class="o">=</span><span class="n">new_y</span><span class="p">,</span> <span class="n">new_X</span><span class="o">=</span><span class="n">_lf_X</span><span class="p">,</span> <span class="n">fh</span><span class="o">=</span><span class="n">fh</span><span class="p">,</span> <span class="n">coverage</span><span class="o">=</span><span class="n">coverage</span><span class="p">,</span> <span class="n">refit</span><span class="o">=</span><span class="n">refit</span><span class="p">)</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos">569</span></a>            <span class="k">if</span> <span class="n">ret_underlying</span><span class="p">:</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos">570</span></a>                <span class="k">return</span> <span class="n">pred</span><span class="p">,</span> <span class="n">pred_int</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos">571</span></a>            <span class="k">else</span><span class="p">:</span> 
</span><span id="L-572"><a href="#L-572"><span class="linenos">572</span></a>                <span class="k">return</span> <span class="n">pred</span><span class="p">,</span> <span class="n">pred_int</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos">573</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos">574</span></a>            <span class="k">if</span> <span class="n">reevaluate</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>            
</span><span id="L-575"><a href="#L-575"><span class="linenos">575</span></a>                <span class="n">preds</span> <span class="o">=</span> <span class="p">{};</span> <span class="n">pred_ints</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos">576</span></a>                <span class="k">for</span> <span class="n">_lf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos">577</span></a>                    <span class="n">_lf_X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__stage_X</span><span class="p">(</span><span class="n">_lf</span><span class="p">,</span> <span class="n">new_X</span><span class="p">)</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos">578</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos">579</span></a>                        <span class="n">_y_pred</span><span class="p">,</span> <span class="n">_y_pred_ints</span> <span class="o">=</span> <span class="n">_lf</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">new_y</span><span class="o">=</span><span class="n">new_y</span><span class="p">,</span> <span class="n">new_X</span><span class="o">=</span><span class="n">_lf_X</span><span class="p">,</span> 
</span><span id="L-580"><a href="#L-580"><span class="linenos">580</span></a>                                                           <span class="n">fh</span><span class="o">=</span><span class="n">fh</span><span class="p">,</span> <span class="n">coverage</span><span class="o">=</span><span class="n">coverage</span><span class="p">,</span> <span class="n">refit</span><span class="o">=</span><span class="n">refit</span><span class="p">)</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos">581</span></a>                        <span class="n">preds</span><span class="p">[</span><span class="n">_lf</span><span class="o">.</span><span class="n">forecaster_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">_y_pred</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos">582</span></a>                        <span class="n">pred_ints</span><span class="p">[</span><span class="n">_lf</span><span class="o">.</span><span class="n">forecaster_name</span><span class="p">]</span> <span class="o">=</span><span class="n">_y_pred_ints</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos">583</span></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos">584</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error updating </span><span class="si">{</span><span class="n">_lf</span><span class="o">.</span><span class="n">forecaster_name</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos">585</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;model </span><span class="si">{</span><span class="n">_lf</span><span class="o">.</span><span class="n">forecaster_name</span><span class="si">}</span><span class="s2"> cannot be updated. It won&#39;t be considered for forecasts&quot;</span><span class="p">)</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos">586</span></a>                        <span class="k">continue</span>                   
</span><span id="L-587"><a href="#L-587"><span class="linenos">587</span></a>
</span><span id="L-588"><a href="#L-588"><span class="linenos">588</span></a>                <span class="n">preds</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">preds</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">keys</span> <span class="o">=</span> <span class="n">preds</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos">589</span></a>                <span class="n">pred_ints</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">pred_ints</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">keys</span> <span class="o">=</span> <span class="n">pred_ints</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos">590</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__aggregate_pred</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">preds</span><span class="o">=</span><span class="n">preds</span><span class="p">,</span> <span class="n">pred_ints</span><span class="o">=</span><span class="n">pred_ints</span><span class="p">,</span> <span class="n">score</span><span class="o">=</span><span class="n">score</span><span class="p">,</span> <span class="n">ret_underlying</span><span class="o">=</span><span class="n">ret_underlying</span><span class="p">)</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos">591</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos">592</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos">593</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">select_best</span><span class="p">(</span><span class="n">score</span> <span class="o">=</span> <span class="n">score</span><span class="p">,</span> <span class="n">reestimate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos">594</span></a>                <span class="n">preds</span> <span class="o">=</span> <span class="p">{};</span> <span class="n">pred_ints</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos">595</span></a>                <span class="k">for</span> <span class="n">_lf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos">596</span></a>                    <span class="n">_lf_X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__stage_X</span><span class="p">(</span><span class="n">_lf</span><span class="p">,</span> <span class="n">new_X</span><span class="p">)</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos">597</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos">598</span></a>                        <span class="n">_y_pred</span><span class="p">,</span> <span class="n">_y_pred_ints</span> <span class="o">=</span> <span class="n">_lf</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">new_y</span><span class="o">=</span><span class="n">new_y</span><span class="p">,</span> <span class="n">new_X</span><span class="o">=</span><span class="n">_lf_X</span><span class="p">,</span> <span class="n">fh</span><span class="o">=</span><span class="n">fh</span><span class="p">,</span> <span class="n">coverage</span><span class="o">=</span><span class="n">coverage</span><span class="p">,</span> <span class="n">refit</span><span class="o">=</span><span class="n">refit</span><span class="p">)</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos">599</span></a>                        <span class="n">preds</span><span class="p">[</span><span class="n">_lf</span><span class="o">.</span><span class="n">forecaster_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">_y_pred</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos">600</span></a>                        <span class="n">pred_ints</span><span class="p">[</span><span class="n">_lf</span><span class="o">.</span><span class="n">forecaster_name</span><span class="p">]</span> <span class="o">=</span><span class="n">_y_pred_ints</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos">601</span></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos">602</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error updating </span><span class="si">{</span><span class="n">_lf</span><span class="o">.</span><span class="n">forecaster_name</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos">603</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;model </span><span class="si">{</span><span class="n">_lf</span><span class="o">.</span><span class="n">forecaster_name</span><span class="si">}</span><span class="s1"> cannot be updated. It will be considered for forecasts&#39;</span><span class="p">)</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos">604</span></a>                        <span class="k">continue</span>                   
</span><span id="L-605"><a href="#L-605"><span class="linenos">605</span></a>                <span class="n">preds</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">preds</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">keys</span> <span class="o">=</span> <span class="n">preds</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos">606</span></a>                <span class="n">pred_ints</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">pred_ints</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">keys</span> <span class="o">=</span> <span class="n">pred_ints</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos">607</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__aggregate_pred</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">preds</span><span class="o">=</span><span class="n">preds</span><span class="p">,</span> <span class="n">pred_ints</span><span class="o">=</span><span class="n">pred_ints</span><span class="p">,</span> <span class="n">score</span><span class="o">=</span><span class="n">score</span><span class="p">,</span> <span class="n">ret_underlying</span><span class="o">=</span><span class="n">ret_underlying</span><span class="p">)</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos">608</span></a>
</span><span id="L-609"><a href="#L-609"><span class="linenos">609</span></a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos">610</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos">611</span></a><span class="sd">        Save the model to a file.</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos">612</span></a><span class="sd">        Parameters:</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos">613</span></a><span class="sd">        -----------</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos">614</span></a><span class="sd">            path : str</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos">615</span></a><span class="sd">                The path to save the model.</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos">616</span></a><span class="sd">        Returns:</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos">617</span></a><span class="sd">        --------</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos">618</span></a><span class="sd">            None</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos">619</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos">620</span></a>        <span class="kn">import</span> <span class="nn">pickle</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos">621</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos">622</span></a>            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos">623</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos">624</span></a>    
</span><span id="L-625"><a href="#L-625"><span class="linenos">625</span></a>    <span class="k">def</span> <span class="nf">get_pred_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="L-626"><a href="#L-626"><span class="linenos">626</span></a>                        <span class="n">mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos">627</span></a>                        <span class="n">score</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos">628</span></a>                        <span class="n">model_name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
</span><span id="L-629"><a href="#L-629"><span class="linenos">629</span></a>                        <span class="p">):</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos">630</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos">631</span></a><span class="sd">        Get the prediction errors.</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos">632</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos">633</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos">634</span></a>            <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos">635</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;model&#39;</span><span class="p">:</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos">636</span></a>            <span class="k">assert</span> <span class="n">model_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="s1">&#39;Model name not in the list of models&#39;</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos">637</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span><span class="o">.</span><span class="n">get_pred_errors</span><span class="p">()</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos">638</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos">639</span></a>            <span class="k">if</span> <span class="n">score</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos">640</span></a>                <span class="n">score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos">641</span></a>            
</span><span id="L-642"><a href="#L-642"><span class="linenos">642</span></a>            <span class="c1"># Using ProcessPoolExecutor to execute computation-heavy tasks in parallel</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos">643</span></a>            <span class="k">with</span> <span class="n">ProcessPoolExecutor</span><span class="p">()</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos">644</span></a>                <span class="n">results</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">fetch_errors</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos">645</span></a>            <span class="n">errors</span> <span class="o">=</span> <span class="p">{</span><span class="n">fname</span><span class="p">:</span> <span class="n">err</span> <span class="k">for</span> <span class="n">fname</span><span class="p">,</span> <span class="n">err</span> <span class="ow">in</span> <span class="n">results</span><span class="p">}</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos">646</span></a>            <span class="k">for</span> <span class="n">_fname</span><span class="p">,</span> <span class="n">_lf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos">647</span></a>                <span class="n">_lf</span><span class="o">.</span><span class="n">_fitted</span><span class="o">.</span><span class="n">insample_result_df</span> <span class="o">=</span> <span class="n">errors</span><span class="p">[</span><span class="n">_fname</span><span class="p">]</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos">648</span></a>
</span><span id="L-649"><a href="#L-649"><span class="linenos">649</span></a>            <span class="c1"># Convert results to dictionary            </span>
</span><span id="L-650"><a href="#L-650"><span class="linenos">650</span></a>            <span class="n">errors_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">errors</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">keys</span> <span class="o">=</span> <span class="n">errors</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos">651</span></a>            <span class="n">errors_df</span> <span class="o">=</span> <span class="n">errors_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;level_0&#39;</span><span class="p">:</span> <span class="s1">&#39;forecaster&#39;</span><span class="p">})</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos">652</span></a>
</span><span id="L-653"><a href="#L-653"><span class="linenos">653</span></a>
</span><span id="L-654"><a href="#L-654"><span class="linenos">654</span></a>            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span><span class="s1">&#39;best&#39;</span><span class="p">:</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos">655</span></a>                <span class="k">return</span> <span class="n">errors</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_best_x_overall</span><span class="p">[</span><span class="n">score</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos">656</span></a>            
</span><span id="L-657"><a href="#L-657"><span class="linenos">657</span></a>            <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span><span class="s1">&#39;best_horizon&#39;</span><span class="p">:</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos">658</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_rank_perhorizon</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos">659</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">select_best</span><span class="p">()</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos">660</span></a>                <span class="n">best_horizon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_rank_perhorizon</span><span class="p">[</span><span class="n">score</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Best_1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos">661</span></a>                <span class="n">error_horizon_l</span> <span class="o">=</span> <span class="p">[</span><span class="n">errors</span><span class="p">[</span><span class="n">best_mod_h</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">errors</span><span class="p">[</span><span class="n">best_mod_h</span><span class="p">][</span><span class="s1">&#39;horizon&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">h</span><span class="p">]</span> <span class="k">for</span> <span class="n">h</span><span class="p">,</span> <span class="n">best_mod_h</span> <span class="ow">in</span> <span class="n">best_horizon</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos">662</span></a>                <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">error_horizon_l</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos">663</span></a>            
</span><span id="L-664"><a href="#L-664"><span class="linenos">664</span></a>            <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span><span class="s1">&#39;average&#39;</span><span class="p">:</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos">665</span></a>                <span class="k">return</span> <span class="n">errors_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;cutoff&#39;</span><span class="p">,</span> <span class="s1">&#39;horizon&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>               
</span><span id="L-666"><a href="#L-666"><span class="linenos">666</span></a>            
</span><span id="L-667"><a href="#L-667"><span class="linenos">667</span></a>            <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span><span class="s1">&#39;inverse_score&#39;</span><span class="p">:</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos">668</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary_results</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos">669</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">()</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos">670</span></a>                <span class="n">_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;Avg </span><span class="si">{</span><span class="n">score</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos">671</span></a>                <span class="n">_score</span> <span class="o">=</span> <span class="n">_score</span><span class="o">/</span><span class="n">_score</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos">672</span></a>                <span class="n">errors_df</span><span class="p">[</span><span class="s1">&#39;_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">errors_df</span><span class="p">[</span><span class="s1">&#39;forecaster&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">_score</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos">673</span></a>                <span class="n">errors_df</span><span class="p">[</span><span class="s1">&#39;weighted_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">errors_df</span><span class="p">[</span><span class="s1">&#39;_score&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">errors_df</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos">674</span></a>                <span class="k">return</span> <span class="n">errors_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;cutoff&#39;</span><span class="p">,</span> <span class="s1">&#39;horizon&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">weighted_error</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos">675</span></a>            
</span><span id="L-676"><a href="#L-676"><span class="linenos">676</span></a>            <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span><span class="s1">&#39;nbest_average&#39;</span><span class="p">:</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos">677</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_best_x_overall</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos">678</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">select_best</span><span class="p">()</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos">679</span></a>                <span class="k">return</span> <span class="n">errors_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">errors_df</span><span class="o">.</span><span class="n">forecaster</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_best_x_overall</span><span class="p">[</span><span class="n">score</span><span class="p">])]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;cutoff&#39;</span><span class="p">,</span> <span class="s1">&#39;horizon&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos">680</span></a>            
</span><span id="L-681"><a href="#L-681"><span class="linenos">681</span></a>            <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span><span class="s1">&#39;nbest_average_horizon&#39;</span><span class="p">:</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos">682</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_rank_perhorizon</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos">683</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">select_best</span><span class="p">()</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos">684</span></a>                <span class="n">best_horizon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_rank_perhorizon</span><span class="p">[</span><span class="n">score</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">_nbest</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos">685</span></a>                <span class="n">best_horizon</span> <span class="o">=</span> <span class="n">best_horizon</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos">686</span></a>                <span class="n">errors_best_horizon</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos">687</span></a>                <span class="k">for</span> <span class="n">h</span><span class="p">,</span> <span class="n">best_mod_h</span> <span class="ow">in</span> <span class="n">best_horizon</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos">688</span></a>                    <span class="n">errors_best_horizon</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">errors_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">errors_df</span><span class="o">.</span><span class="n">horizon</span><span class="o">==</span><span class="n">h</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">errors_df</span><span class="o">.</span><span class="n">forecaster</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">best_mod_h</span><span class="p">)]</span>\
</span><span id="L-689"><a href="#L-689"><span class="linenos">689</span></a>                        <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;cutoff&#39;</span><span class="p">,</span> <span class="s1">&#39;horizon&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">())</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos">690</span></a>                <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">errors_best_horizon</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>            
</span><span id="L-691"><a href="#L-691"><span class="linenos">691</span></a>            
</span><span id="L-692"><a href="#L-692"><span class="linenos">692</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos">693</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;mode can take the foloowing values: best, best_horizon, average, inverse_score, nbest_average, nbest_average_horizon, model&#39;</span><span class="p">)</span>        
</span><span id="L-694"><a href="#L-694"><span class="linenos">694</span></a>    
</span><span id="L-695"><a href="#L-695"><span class="linenos">695</span></a>    <span class="k">def</span> <span class="nf">plot_model_compare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="L-696"><a href="#L-696"><span class="linenos">696</span></a>                           <span class="n">score</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> 
</span><span id="L-697"><a href="#L-697"><span class="linenos">697</span></a>                           <span class="n">view</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;horizon&#39;</span><span class="p">,</span> 
</span><span id="L-698"><a href="#L-698"><span class="linenos">698</span></a>                           <span class="n">model_subset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos">699</span></a>                           <span class="n">xlabel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
</span><span id="L-700"><a href="#L-700"><span class="linenos">700</span></a>                           <span class="n">ylabel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos">701</span></a>                           <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Out of Sample Performance&#39;</span><span class="p">,</span> 
</span><span id="L-702"><a href="#L-702"><span class="linenos">702</span></a>                           <span class="n">ax</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
</span><span id="L-703"><a href="#L-703"><span class="linenos">703</span></a>                           <span class="n">figsize</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos">704</span></a>                          <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]:</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos">705</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos">706</span></a><span class="sd">        Plot a comparison of models based on their out-of-sample performance.</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos">707</span></a>
</span><span id="L-708"><a href="#L-708"><span class="linenos">708</span></a><span class="sd">        Parameters:</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos">709</span></a><span class="sd">        -----------        </span>
</span><span id="L-710"><a href="#L-710"><span class="linenos">710</span></a><span class="sd">            score : str, optional</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos">711</span></a><span class="sd">                The performance metric for comparison. Should be either &#39;RMSE&#39; or &#39;MAPE&#39;. Default is &#39;RMSE&#39;.</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos">712</span></a><span class="sd">            view : str, optional</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos">713</span></a><span class="sd">                The view mode for comparison, either &#39;horizon&#39; or &#39;cutoff&#39;. Default is &#39;horizon&#39;.</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos">714</span></a><span class="sd">            xlabel : str, optional</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos">715</span></a><span class="sd">                The label for the x-axis. Default is an empty string.</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos">716</span></a><span class="sd">            ylabel : str, optional</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos">717</span></a><span class="sd">                The label for the y-axis. Default is an empty string.</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos">718</span></a><span class="sd">            title : str, optional</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos">719</span></a><span class="sd">                The title of the plot. Default is &#39;Out of Sample Performance&#39;.</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos">720</span></a><span class="sd">            ax : matplotlib.axes._subplots.AxesSubplot, optional</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos">721</span></a><span class="sd">                The matplotlib axes to use for plotting. Default is None.</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos">722</span></a><span class="sd">            figsize : tuple, optional</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos">723</span></a><span class="sd">                The size of the figure in inches (width, height). Default is (15, 6).</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos">724</span></a>
</span><span id="L-725"><a href="#L-725"><span class="linenos">725</span></a><span class="sd">        Returns:</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos">726</span></a><span class="sd">        --------        </span>
</span><span id="L-727"><a href="#L-727"><span class="linenos">727</span></a><span class="sd">            matplotlib.figure.Figure or matplotlib.axes._subplots.AxesSubplot</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos">728</span></a><span class="sd">                The figure and axes of the plot.</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos">729</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos">730</span></a>        
</span><span id="L-731"><a href="#L-731"><span class="linenos">731</span></a>        <span class="k">if</span> <span class="n">view</span> <span class="o">==</span><span class="s1">&#39;horizon&#39;</span><span class="p">:</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos">732</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_avg_oos_horizon</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos">733</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">select_best</span><span class="p">()</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos">734</span></a>            <span class="n">toplot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_avg_oos_horizon</span><span class="p">[</span><span class="n">score</span><span class="p">]</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos">735</span></a>
</span><span id="L-736"><a href="#L-736"><span class="linenos">736</span></a>        <span class="k">elif</span> <span class="n">view</span><span class="o">==</span><span class="s1">&#39;cutoff&#39;</span><span class="p">:</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos">737</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary_cutoff</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos">738</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">summary_per_cutoff</span><span class="p">()</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos">739</span></a>            <span class="n">toplot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary_cutoff</span><span class="p">[</span><span class="n">score</span><span class="p">]</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos">740</span></a>
</span><span id="L-741"><a href="#L-741"><span class="linenos">741</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos">742</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;view can take only 2 values: horizon or cutoff&#39;</span><span class="p">)</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos">743</span></a>
</span><span id="L-744"><a href="#L-744"><span class="linenos">744</span></a>        <span class="k">if</span> <span class="n">model_subset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos">745</span></a>            <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="n">m</span> <span class="ow">in</span> <span class="n">toplot</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">model_subset</span><span class="p">]),</span> <span class="s1">&#39;Some models are not in the list of models&#39;</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos">746</span></a>            <span class="n">toplot</span> <span class="o">=</span> <span class="n">toplot</span><span class="p">[</span><span class="n">model_subset</span><span class="p">]</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos">747</span></a>        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos">748</span></a>            <span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos">749</span></a>        <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos">750</span></a>            <span class="n">ylabel</span> <span class="o">=</span> <span class="n">score</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos">751</span></a>        <span class="k">if</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos">752</span></a>            <span class="n">xlabel</span> <span class="o">=</span> <span class="n">view</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos">753</span></a>        
</span><span id="L-754"><a href="#L-754"><span class="linenos">754</span></a>        <span class="n">nseries</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">toplot</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos">755</span></a>        <span class="k">def</span> <span class="nf">expand_color_palette</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">n_colors_needed</span><span class="p">):</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos">756</span></a>            <span class="n">base_array</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">n_colors</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">))</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos">757</span></a>            <span class="n">color_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">base_array</span><span class="p">)</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos">758</span></a>            
</span><span id="L-759"><a href="#L-759"><span class="linenos">759</span></a>            <span class="c1"># Interpolating colors</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos">760</span></a>            <span class="n">new_colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">color_array</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">n_colors_needed</span><span class="p">),</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos">761</span></a>                                            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">color_array</span><span class="p">)),</span> <span class="n">color_array</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos">762</span></a>                                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">color_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])])</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos">763</span></a>            <span class="k">return</span> <span class="n">new_colors</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos">764</span></a>
</span><span id="L-765"><a href="#L-765"><span class="linenos">765</span></a>        <span class="c1"># Get the initial colorblind palette</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos">766</span></a>        <span class="n">initial_palette</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;colorblind&quot;</span><span class="p">)</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos">767</span></a>
</span><span id="L-768"><a href="#L-768"><span class="linenos">768</span></a>        <span class="c1"># Expand the palette if more colors are needed</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos">769</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">initial_palette</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">nseries</span><span class="p">:</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos">770</span></a>            <span class="n">expanded_colors</span> <span class="o">=</span> <span class="n">expand_color_palette</span><span class="p">(</span><span class="s2">&quot;colorblind&quot;</span><span class="p">,</span> <span class="n">n_colors_needed</span><span class="o">=</span><span class="n">nseries</span><span class="p">)</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos">771</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos">772</span></a>            <span class="n">expanded_colors</span> <span class="o">=</span> <span class="n">initial_palette</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos">773</span></a>
</span><span id="L-774"><a href="#L-774"><span class="linenos">774</span></a>        <span class="n">toplot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span> <span class="n">expanded_colors</span><span class="p">)</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos">775</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span> <span class="o">=</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos">776</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;xx-large&quot;</span><span class="p">)</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos">777</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos">778</span></a>        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos">779</span></a>            <span class="k">return</span> <span class="n">f</span><span class="p">,</span> <span class="n">ax</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos">780</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos">781</span></a>            <span class="k">return</span> <span class="n">ax</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos">782</span></a>
</span><span id="L-783"><a href="#L-783"><span class="linenos">783</span></a>    <span class="k">def</span> <span class="nf">plot_prediction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="L-784"><a href="#L-784"><span class="linenos">784</span></a>                        <span class="n">y_pred</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> 
</span><span id="L-785"><a href="#L-785"><span class="linenos">785</span></a>                        <span class="n">models_preds</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
</span><span id="L-786"><a href="#L-786"><span class="linenos">786</span></a>                        <span class="n">y_pred_interval</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
</span><span id="L-787"><a href="#L-787"><span class="linenos">787</span></a>                        <span class="n">interval_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;CI&#39;</span><span class="p">,</span> 
</span><span id="L-788"><a href="#L-788"><span class="linenos">788</span></a>                        <span class="n">aggregation_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Model Agg&#39;</span><span class="p">,</span> 
</span><span id="L-789"><a href="#L-789"><span class="linenos">789</span></a>                        <span class="n">xlabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> 
</span><span id="L-790"><a href="#L-790"><span class="linenos">790</span></a>                        <span class="n">ylabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> 
</span><span id="L-791"><a href="#L-791"><span class="linenos">791</span></a>                        <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Prediction&#39;</span><span class="p">,</span> 
</span><span id="L-792"><a href="#L-792"><span class="linenos">792</span></a>                        <span class="n">ax</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
</span><span id="L-793"><a href="#L-793"><span class="linenos">793</span></a>                        <span class="n">figsize</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos">794</span></a>
</span><span id="L-795"><a href="#L-795"><span class="linenos">795</span></a>                       <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]:</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos">796</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos">797</span></a><span class="sd">        Plot forecast predictions and aggregated prediction.</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos">798</span></a>
</span><span id="L-799"><a href="#L-799"><span class="linenos">799</span></a><span class="sd">        Parameters:</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos">800</span></a><span class="sd">        -----------        </span>
</span><span id="L-801"><a href="#L-801"><span class="linenos">801</span></a><span class="sd">            y_pred : pd.Series</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos">802</span></a><span class="sd">                The aggregated prediction.</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos">803</span></a><span class="sd">            models_preds : pd.DataFrame, optional</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos">804</span></a><span class="sd">                The DataFrame containing predictions from different models. Default is None.</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos">805</span></a><span class="sd">            y_pred_interval : tuple, optional</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos">806</span></a><span class="sd">                Prediction interval for the aggregated prediction. Default is None.</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos">807</span></a><span class="sd">            interval_label : str, optional</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos">808</span></a><span class="sd">                Label for the prediction interval. Default is &#39;prediction interval&#39;.</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos">809</span></a><span class="sd">            aggregation_label : str, optional</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos">810</span></a><span class="sd">                Label for the aggregated prediction. Default is &#39;Model Agg&#39;.</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos">811</span></a><span class="sd">            xlabel : str, optional</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos">812</span></a><span class="sd">                Label for the x-axis. Default is an empty string.</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos">813</span></a><span class="sd">            ylabel : str, optional</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos">814</span></a><span class="sd">                Label for the y-axis. Default is an empty string.</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos">815</span></a><span class="sd">            title : str, optional</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos">816</span></a><span class="sd">                Title of the plot. Default is &#39;Prediction&#39;.</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos">817</span></a><span class="sd">            ax : matplotlib.axes._subplots.AxesSubplot, optional</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos">818</span></a><span class="sd">                Matplotlib axes to use for plotting. Default is None.</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos">819</span></a><span class="sd">            figsize : tuple, optional</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos">820</span></a><span class="sd">                Size of the figure in inches (width, height). Default is (15, 6).</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos">821</span></a>
</span><span id="L-822"><a href="#L-822"><span class="linenos">822</span></a><span class="sd">        Returns:</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos">823</span></a><span class="sd">        --------        </span>
</span><span id="L-824"><a href="#L-824"><span class="linenos">824</span></a><span class="sd">            matplotlib.figure.Figure or matplotlib.axes._subplots.AxesSubplot</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos">825</span></a><span class="sd">                The figure and axes of the plot.</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos">826</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos">827</span></a>
</span><span id="L-828"><a href="#L-828"><span class="linenos">828</span></a>        <span class="n">y</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_y</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos">829</span></a>        <span class="n">y_train</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">y</span><span class="o">.</span><span class="n">index</span><span class="o">&lt;</span><span class="n">y_pred</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos">830</span></a>        <span class="n">zoom_y_train</span> <span class="o">=</span> <span class="n">y_train</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">y_pred</span><span class="p">):]</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos">831</span></a>    
</span><span id="L-832"><a href="#L-832"><span class="linenos">832</span></a>        <span class="k">if</span> <span class="n">models_preds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos">833</span></a>            <span class="n">model_names</span> <span class="o">=</span> <span class="n">models_preds</span><span class="o">.</span><span class="n">columns</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos">834</span></a>            <span class="n">models_preds</span> <span class="o">=</span> <span class="p">[</span><span class="n">models_preds</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">model_names</span><span class="p">]</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos">835</span></a>            <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">model_names</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">aggregation_label</span><span class="p">]</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos">836</span></a>
</span><span id="L-837"><a href="#L-837"><span class="linenos">837</span></a>            <span class="n">plt_res</span> <span class="o">=</span> <span class="n">plot_series</span><span class="p">(</span><span class="n">zoom_y_train</span><span class="p">,</span> <span class="o">*</span><span class="n">models_preds</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos">838</span></a>                               <span class="n">labels</span> <span class="o">=</span><span class="n">labels</span><span class="p">,</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos">839</span></a>                               <span class="n">xlabel</span> <span class="o">=</span><span class="n">xlabel</span><span class="p">,</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos">840</span></a>                               <span class="n">ylabel</span> <span class="o">=</span><span class="n">ylabel</span><span class="p">,</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos">841</span></a>                               <span class="n">title</span> <span class="o">=</span><span class="n">title</span><span class="p">,</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos">842</span></a>                               <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> 
</span><span id="L-843"><a href="#L-843"><span class="linenos">843</span></a>                               <span class="n">figsize</span> <span class="o">=</span><span class="n">figsize</span><span class="p">,</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos">844</span></a>                               <span class="n">pred_interval</span> <span class="o">=</span> <span class="n">y_pred_interval</span><span class="p">,</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos">845</span></a>                               <span class="n">interval_label</span> <span class="o">=</span><span class="n">interval_label</span><span class="p">)</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos">846</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos">847</span></a>            <span class="n">plt_res</span> <span class="o">=</span> <span class="n">plot_series</span><span class="p">(</span><span class="n">zoom_y_train</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos">848</span></a>                               <span class="n">labels</span> <span class="o">=</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">aggregation_label</span><span class="p">],</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos">849</span></a>                               <span class="n">xlabel</span> <span class="o">=</span><span class="n">xlabel</span><span class="p">,</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos">850</span></a>                               <span class="n">ylabel</span> <span class="o">=</span><span class="n">ylabel</span><span class="p">,</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos">851</span></a>                               <span class="n">title</span> <span class="o">=</span><span class="n">title</span><span class="p">,</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos">852</span></a>                               <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> 
</span><span id="L-853"><a href="#L-853"><span class="linenos">853</span></a>                               <span class="n">figsize</span> <span class="o">=</span><span class="n">figsize</span><span class="p">,</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos">854</span></a>                               <span class="n">pred_interval</span> <span class="o">=</span> <span class="n">y_pred_interval</span><span class="p">,</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos">855</span></a>                              <span class="n">interval_label</span> <span class="o">=</span><span class="n">interval_label</span><span class="p">)</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos">856</span></a>        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos">857</span></a>            <span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt_res</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos">858</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos">859</span></a>            <span class="k">return</span> <span class="n">f</span><span class="p">,</span> <span class="n">ax</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos">860</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos">861</span></a>            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt_res</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos">862</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos">863</span></a>            <span class="k">return</span> <span class="n">ax</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos">864</span></a>
</span><span id="L-865"><a href="#L-865"><span class="linenos">865</span></a>    <span class="k">def</span> <span class="nf">plot_train_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos">866</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos">867</span></a><span class="sd">        Plot the training and test windows for each model.</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos">868</span></a>
</span><span id="L-869"><a href="#L-869"><span class="linenos">869</span></a><span class="sd">        Parameters:</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos">870</span></a><span class="sd">        -----------        </span>
</span><span id="L-871"><a href="#L-871"><span class="linenos">871</span></a><span class="sd">            kwargs</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos">872</span></a><span class="sd">                Additional keyword arguments to be passed to the plot function.</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos">873</span></a>
</span><span id="L-874"><a href="#L-874"><span class="linenos">874</span></a><span class="sd">        Returns:</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos">875</span></a><span class="sd">        --------        </span>
</span><span id="L-876"><a href="#L-876"><span class="linenos">876</span></a><span class="sd">            fig : plt.Figure</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos">877</span></a><span class="sd">                If ax was None, a new figure is created and returned</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos">878</span></a><span class="sd">                If ax was not None, the same ax is returned with plot added</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos">879</span></a><span class="sd">            ax : plt.Axis             </span>
</span><span id="L-880"><a href="#L-880"><span class="linenos">880</span></a><span class="sd">                Axes containing the plot             </span>
</span><span id="L-881"><a href="#L-881"><span class="linenos">881</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos">882</span></a>        <span class="n">_lf</span>  <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos">883</span></a>        <span class="k">return</span> <span class="n">_lf</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">plot_train_test</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos">884</span></a>    
</span><span id="L-885"><a href="#L-885"><span class="linenos">885</span></a>    <span class="k">def</span> <span class="nf">plot_cv_procedure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos">886</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos">887</span></a><span class="sd">        Plot the cross-validation procedure for each model.</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos">888</span></a>
</span><span id="L-889"><a href="#L-889"><span class="linenos">889</span></a><span class="sd">        Parameters:</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos">890</span></a><span class="sd">        -----------        </span>
</span><span id="L-891"><a href="#L-891"><span class="linenos">891</span></a><span class="sd">            kwargs</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos">892</span></a><span class="sd">                Additional keyword arguments to be passed to the plot function.</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos">893</span></a>
</span><span id="L-894"><a href="#L-894"><span class="linenos">894</span></a><span class="sd">        Returns:</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos">895</span></a><span class="sd">        --------</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos">896</span></a><span class="sd">            fig : plt.Figure</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos">897</span></a><span class="sd">                If ax was None, a new figure is created and returned</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos">898</span></a><span class="sd">                If ax was not None, the same ax is returned with plot added</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos">899</span></a><span class="sd">            ax : plt.Axis             </span>
</span><span id="L-900"><a href="#L-900"><span class="linenos">900</span></a><span class="sd">                Axes containing the plot             </span>
</span><span id="L-901"><a href="#L-901"><span class="linenos">901</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos">902</span></a>        <span class="n">_lf</span>  <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos">903</span></a>        <span class="k">return</span> <span class="n">_lf</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">plot_cv_procedure</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos">904</span></a>    
</span><span id="L-905"><a href="#L-905"><span class="linenos">905</span></a>    <span class="k">def</span> <span class="nf">__aggregate_pred</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">preds</span><span class="p">,</span> <span class="n">pred_ints</span><span class="p">,</span> <span class="n">score</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ret_underlying</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos">906</span></a>
</span><span id="L-907"><a href="#L-907"><span class="linenos">907</span></a>        <span class="k">if</span> <span class="n">score</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos">908</span></a>            <span class="n">score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos">909</span></a> 
</span><span id="L-910"><a href="#L-910"><span class="linenos">910</span></a>        <span class="n">nbest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nbest</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos">911</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos">912</span></a>            <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos">913</span></a>
</span><span id="L-914"><a href="#L-914"><span class="linenos">914</span></a>        <span class="k">if</span>  <span class="p">(</span><span class="n">mode</span> <span class="o">!=</span><span class="s1">&#39;average&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_best_x_overall</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos">915</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">select_best</span><span class="p">(</span><span class="n">score</span> <span class="o">=</span> <span class="n">score</span><span class="p">)</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos">916</span></a>
</span><span id="L-917"><a href="#L-917"><span class="linenos">917</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span><span class="s1">&#39;best&#39;</span><span class="p">:</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos">918</span></a>            <span class="c1"># returns the prediction of the best model</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos">919</span></a>            <span class="n">_best_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_best_x_overall</span><span class="p">[</span><span class="n">score</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos">920</span></a>            <span class="n">y_pred</span> <span class="o">=</span> <span class="n">preds</span><span class="p">[</span><span class="n">_best_model</span><span class="p">]</span>            
</span><span id="L-921"><a href="#L-921"><span class="linenos">921</span></a>            <span class="k">if</span> <span class="n">_best_model</span> <span class="ow">in</span> <span class="n">pred_ints</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos">922</span></a>                <span class="n">y_pred_int</span> <span class="o">=</span> <span class="n">pred_ints</span><span class="p">[</span><span class="n">_best_model</span><span class="p">]</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos">923</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos">924</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Prediction intervals for </span><span class="si">{</span><span class="n">_best_model</span><span class="si">}</span><span class="s1"> are not available&#39;</span><span class="p">)</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos">925</span></a>                <span class="n">y_pred_int</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos">926</span></a>
</span><span id="L-927"><a href="#L-927"><span class="linenos">927</span></a>        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;average&#39;</span><span class="p">:</span>
</span><span id="L-928"><a href="#L-928"><span class="linenos">928</span></a>            <span class="c1"># returns the average prediction of all models</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos">929</span></a>            <span class="n">y_pred</span> <span class="o">=</span> <span class="n">preds</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos">930</span></a>            <span class="n">y_pred_int</span> <span class="o">=</span> <span class="n">pred_ints</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos">931</span></a>
</span><span id="L-932"><a href="#L-932"><span class="linenos">932</span></a>        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;inverse_score&#39;</span><span class="p">:</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos">933</span></a>            <span class="c1"># returns the Average models proportionals to performance score</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos">934</span></a>            <span class="n">_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;Avg </span><span class="si">{</span><span class="n">score</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos">935</span></a>            <span class="n">_score</span> <span class="o">=</span> <span class="n">_score</span><span class="o">/</span><span class="n">_score</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos">936</span></a>
</span><span id="L-937"><a href="#L-937"><span class="linenos">937</span></a>            <span class="n">_weigh_preds</span> <span class="o">=</span>  <span class="n">preds</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">_score</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos">938</span></a>            <span class="n">y_pred</span> <span class="o">=</span> <span class="n">_weigh_preds</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos">939</span></a>
</span><span id="L-940"><a href="#L-940"><span class="linenos">940</span></a>            <span class="n">_weigh_preds_ints</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos">941</span></a>            <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">_score</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos">942</span></a>                <span class="k">if</span> <span class="n">m</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pred_ints</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos">943</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Prediction intervals for model </span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s1"> are not available.&#39;</span><span class="p">)</span> 
</span><span id="L-944"><a href="#L-944"><span class="linenos">944</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;It will be droped in the aggregation of prediction intervals&#39;</span><span class="p">)</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos">945</span></a>                    <span class="k">continue</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos">946</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos">947</span></a>                    <span class="n">_weigh_preds_ints</span> <span class="o">=</span> <span class="n">_weigh_preds_ints</span><span class="o">+</span> <span class="n">pred_ints</span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="o">*</span><span class="n">w</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos">948</span></a>            <span class="n">y_pred_int</span> <span class="o">=</span> <span class="n">_weigh_preds_ints</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos">949</span></a>
</span><span id="L-950"><a href="#L-950"><span class="linenos">950</span></a>        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;nbest_average&#39;</span><span class="p">:</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos">951</span></a>            <span class="c1"># return the average prediction of nbest models</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos">952</span></a>            <span class="n">y_pred</span> <span class="o">=</span> <span class="n">preds</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_best_x_overall</span><span class="p">[</span><span class="n">score</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos">953</span></a>            <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">v</span> <span class="ow">in</span> <span class="n">pred_ints</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_best_x_overall</span><span class="p">[</span><span class="n">score</span><span class="p">]]):</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos">954</span></a>                <span class="n">y_pred_int</span> <span class="o">=</span> <span class="n">pred_ints</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_best_x_overall</span><span class="p">[</span><span class="n">score</span><span class="p">]]</span>\
</span><span id="L-955"><a href="#L-955"><span class="linenos">955</span></a>            <span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-956"><a href="#L-956"><span class="linenos">956</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos">957</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Prediction intervals for </span><span class="si">{</span><span class="n">nbest</span><span class="si">}</span><span class="s1"> best models are not available&#39;</span><span class="p">)</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos">958</span></a>                <span class="n">y_pred_int</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos">959</span></a>        
</span><span id="L-960"><a href="#L-960"><span class="linenos">960</span></a>        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span><span class="s1">&#39;best_horizon&#39;</span><span class="p">:</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos">961</span></a>            <span class="c1"># returns the prediction of the best model for each forecast horizon</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos">962</span></a>            <span class="n">best_horizon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_rank_perhorizon</span><span class="p">[</span><span class="n">score</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Best_1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos">963</span></a>            <span class="n">y_pred</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">preds</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">best_horizon</span><span class="o">.</span><span class="n">items</span><span class="p">()],</span> 
</span><span id="L-964"><a href="#L-964"><span class="linenos">964</span></a>                   <span class="n">index</span><span class="o">=</span><span class="n">preds</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos">965</span></a>            <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">v</span> <span class="ow">in</span> <span class="n">pred_ints</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">best_horizon</span><span class="o">.</span><span class="n">values</span><span class="p">()]):</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos">966</span></a>                <span class="n">y_pred_int</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pred_ints</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">best_horizon</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos">967</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos">968</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;One or several model that are best in their respective horizon are not available&#39;</span><span class="p">)</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos">969</span></a>                <span class="n">y_pred_int</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span> 
</span><span id="L-970"><a href="#L-970"><span class="linenos">970</span></a>
</span><span id="L-971"><a href="#L-971"><span class="linenos">971</span></a>        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;nbest_average_horizon&#39;</span><span class="p">:</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos">972</span></a>            <span class="c1"># return the average prediction on the nbest models per horizon</span>
</span><span id="L-973"><a href="#L-973"><span class="linenos">973</span></a>            <span class="n">best_horizon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_rank_perhorizon</span><span class="p">[</span><span class="s1">&#39;RMSE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos">974</span></a>            <span class="n">_uniq_best_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_rank_perhorizon</span><span class="p">[</span><span class="s1">&#39;RMSE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos">975</span></a>            <span class="n">best_horizon</span> <span class="o">=</span> <span class="n">best_horizon</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos">976</span></a>
</span><span id="L-977"><a href="#L-977"><span class="linenos">977</span></a>            <span class="n">y_pred</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">preds</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">best_horizon</span><span class="o">.</span><span class="n">items</span><span class="p">()],</span> 
</span><span id="L-978"><a href="#L-978"><span class="linenos">978</span></a>                               <span class="n">index</span><span class="o">=</span><span class="n">preds</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos">979</span></a>            <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">v</span> <span class="ow">in</span> <span class="n">pred_ints</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">_uniq_best_model</span><span class="p">]):</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos">980</span></a>                <span class="n">y_pred_int</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pred_ints</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">best_horizon</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos">981</span></a>                <span class="n">y_pred_int</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">y_pred</span><span class="o">.</span><span class="n">index</span>        
</span><span id="L-982"><a href="#L-982"><span class="linenos">982</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-983"><a href="#L-983"><span class="linenos">983</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Prediction intervals for </span><span class="si">{</span><span class="n">nbest</span><span class="si">}</span><span class="s1"> best models are not available&#39;</span><span class="p">)</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos">984</span></a>                <span class="n">y_pred_int</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos">985</span></a>                
</span><span id="L-986"><a href="#L-986"><span class="linenos">986</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos">987</span></a>            <span class="n">recog_modes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="s1">&#39;best_horizon&#39;</span><span class="p">,</span> <span class="s1">&#39;average&#39;</span><span class="p">,</span> <span class="s1">&#39;inverse_score&#39;</span><span class="p">,</span> 
</span><span id="L-988"><a href="#L-988"><span class="linenos">988</span></a>                           <span class="s1">&#39;nbest_average&#39;</span><span class="p">,</span> <span class="s1">&#39;nbest_average_horizon&#39;</span><span class="p">]</span>
</span><span id="L-989"><a href="#L-989"><span class="linenos">989</span></a>            <span class="n">_error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Aggregation mode not recognized. Recognized prediction aggregation are </span><span class="si">{</span><span class="n">recog_modes</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos">990</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">_error_msg</span><span class="p">)</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos">991</span></a>
</span><span id="L-992"><a href="#L-992"><span class="linenos">992</span></a>        <span class="k">if</span> <span class="n">ret_underlying</span><span class="p">:</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos">993</span></a>            <span class="k">return</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">y_pred_int</span><span class="p">,</span> <span class="n">preds</span><span class="p">,</span> <span class="n">pred_ints</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos">994</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos">995</span></a>            <span class="k">return</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">y_pred_int</span>
</span></pre></div>


            </section>
                <section id="fetch_errors">
                            <input id="fetch_errors-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">fetch_errors</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">item</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="fetch_errors-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#fetch_errors"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="fetch_errors-32"><a href="#fetch_errors-32"><span class="linenos">32</span></a><span class="k">def</span> <span class="nf">fetch_errors</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
</span><span id="fetch_errors-33"><a href="#fetch_errors-33"><span class="linenos">33</span></a>    <span class="n">_fname</span><span class="p">,</span> <span class="n">_lf</span> <span class="o">=</span> <span class="n">item</span>
</span><span id="fetch_errors-34"><a href="#fetch_errors-34"><span class="linenos">34</span></a>    <span class="k">return</span> <span class="n">_fname</span><span class="p">,</span> <span class="n">_lf</span><span class="o">.</span><span class="n">get_pred_errors</span><span class="p">()</span>
</span></pre></div>


    

                </section>
                <section id="ForecastModelSelect">
                            <input id="ForecastModelSelect-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ForecastModelSelect</span>:

                <label class="view-source-button" for="ForecastModelSelect-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ForecastModelSelect"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ForecastModelSelect-37"><a href="#ForecastModelSelect-37"><span class="linenos"> 37</span></a><span class="k">class</span> <span class="nc">ForecastModelSelect</span><span class="p">:</span>
</span><span id="ForecastModelSelect-38"><a href="#ForecastModelSelect-38"><span class="linenos"> 38</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect-39"><a href="#ForecastModelSelect-39"><span class="linenos"> 39</span></a><span class="sd">    Class for model selection and comparison based on out-of-sample performance.</span>
</span><span id="ForecastModelSelect-40"><a href="#ForecastModelSelect-40"><span class="linenos"> 40</span></a><span class="sd">    Evaluate how to best combine the different models based on their oos performance.</span>
</span><span id="ForecastModelSelect-41"><a href="#ForecastModelSelect-41"><span class="linenos"> 41</span></a>
</span><span id="ForecastModelSelect-42"><a href="#ForecastModelSelect-42"><span class="linenos"> 42</span></a><span class="sd">    The class can be initialized in 2 ways. </span>
</span><span id="ForecastModelSelect-43"><a href="#ForecastModelSelect-43"><span class="linenos"> 43</span></a><span class="sd">    - **Method 1**: Requires a dictionary of forecasting models. A dictionary where the keys are names of forecasts and the values are sktime recognized forecast_models.</span>
</span><span id="ForecastModelSelect-44"><a href="#ForecastModelSelect-44"><span class="linenos"> 44</span></a><span class="sd">    All the arguments taken by Forecast object must be passed to the initialization of the ForecastModelSelect object.</span>
</span><span id="ForecastModelSelect-45"><a href="#ForecastModelSelect-45"><span class="linenos"> 45</span></a><span class="sd">    - **Method 2**: Requires a dictionary of trained models. The training and evalutiaon of the models are assumed to be done.</span>
</span><span id="ForecastModelSelect-46"><a href="#ForecastModelSelect-46"><span class="linenos"> 46</span></a>
</span><span id="ForecastModelSelect-47"><a href="#ForecastModelSelect-47"><span class="linenos"> 47</span></a><span class="sd">    There is the possibility to combine the two methods by providing both dictionaries. </span>
</span><span id="ForecastModelSelect-48"><a href="#ForecastModelSelect-48"><span class="linenos"> 48</span></a><span class="sd">    In this case, the trained models will be used for evaluation and the non-trained models will be trained and evaluated.</span>
</span><span id="ForecastModelSelect-49"><a href="#ForecastModelSelect-49"><span class="linenos"> 49</span></a>
</span><span id="ForecastModelSelect-50"><a href="#ForecastModelSelect-50"><span class="linenos"> 50</span></a><span class="sd">    Parameters:</span>
</span><span id="ForecastModelSelect-51"><a href="#ForecastModelSelect-51"><span class="linenos"> 51</span></a><span class="sd">    -----------    </span>
</span><span id="ForecastModelSelect-52"><a href="#ForecastModelSelect-52"><span class="linenos"> 52</span></a><span class="sd">    - forecasters_d (dict): A dictionary containing various forecasting models for comparison. </span>
</span><span id="ForecastModelSelect-53"><a href="#ForecastModelSelect-53"><span class="linenos"> 53</span></a><span class="sd">    Default is None and assess the most common forecasting models.</span>
</span><span id="ForecastModelSelect-54"><a href="#ForecastModelSelect-54"><span class="linenos"> 54</span></a><span class="sd">        - **Naive:** NaiveForecaster - Keep the latest value</span>
</span><span id="ForecastModelSelect-55"><a href="#ForecastModelSelect-55"><span class="linenos"> 55</span></a><span class="sd">        - **SeasonalNaive:** NaiveForecaster - Keep the value of the same season</span>
</span><span id="ForecastModelSelect-56"><a href="#ForecastModelSelect-56"><span class="linenos"> 56</span></a><span class="sd">        - **AutoARIMA:** StatsForecastAutoARIMA - Auto ARIMA model</span>
</span><span id="ForecastModelSelect-57"><a href="#ForecastModelSelect-57"><span class="linenos"> 57</span></a><span class="sd">        - **AutoETS:** StatsForecastAutoETS - Auto ETS model</span>
</span><span id="ForecastModelSelect-58"><a href="#ForecastModelSelect-58"><span class="linenos"> 58</span></a><span class="sd">        - **AutoCES:** StatsForecastAutoCES - Auto CES model</span>
</span><span id="ForecastModelSelect-59"><a href="#ForecastModelSelect-59"><span class="linenos"> 59</span></a><span class="sd">        - **AutoTheta:** StatsForecastAutoTheta - Auto Theta model</span>
</span><span id="ForecastModelSelect-60"><a href="#ForecastModelSelect-60"><span class="linenos"> 60</span></a><span class="sd">        - **AutoTBATS:** StatsForecastAutoTBATS - Auto TBATS model</span>
</span><span id="ForecastModelSelect-61"><a href="#ForecastModelSelect-61"><span class="linenos"> 61</span></a><span class="sd">        - **Prophet:** Prophet - Prophet model</span>
</span><span id="ForecastModelSelect-62"><a href="#ForecastModelSelect-62"><span class="linenos"> 62</span></a><span class="sd">    - trained_forecasters_d (dict): A dictionary containing trained Forecast objects. Default is None.</span>
</span><span id="ForecastModelSelect-63"><a href="#ForecastModelSelect-63"><span class="linenos"> 63</span></a><span class="sd">    - model_exog_d (dict): A dictionary containing exogenous variables for each model. Default is None.</span>
</span><span id="ForecastModelSelect-64"><a href="#ForecastModelSelect-64"><span class="linenos"> 64</span></a><span class="sd">    - mode (str): The aggregation mode. Default is &#39;nbest_average_horizon&#39;. Available values are:</span>
</span><span id="ForecastModelSelect-65"><a href="#ForecastModelSelect-65"><span class="linenos"> 65</span></a><span class="sd">        - best: The prediction is based on the best model.</span>
</span><span id="ForecastModelSelect-66"><a href="#ForecastModelSelect-66"><span class="linenos"> 66</span></a><span class="sd">        - best_horizon: The prediction is based on the best model for each horizon.</span>
</span><span id="ForecastModelSelect-67"><a href="#ForecastModelSelect-67"><span class="linenos"> 67</span></a><span class="sd">        - average: The average of the prediction of all models.</span>
</span><span id="ForecastModelSelect-68"><a href="#ForecastModelSelect-68"><span class="linenos"> 68</span></a><span class="sd">        - inverse_score: The weighted average prediction, where weights are inversely proportional to the model performance score.</span>
</span><span id="ForecastModelSelect-69"><a href="#ForecastModelSelect-69"><span class="linenos"> 69</span></a><span class="sd">        - nbest_average: Average of the n best models. The n is given by the parameter nbest.</span>
</span><span id="ForecastModelSelect-70"><a href="#ForecastModelSelect-70"><span class="linenos"> 70</span></a><span class="sd">        - nbest_average_horizon: Average of the n best models for each horizon. The n is given by the parameter nbest.</span>
</span><span id="ForecastModelSelect-71"><a href="#ForecastModelSelect-71"><span class="linenos"> 71</span></a><span class="sd">        - model: Returns the prediction of a specific model. The model name must be provided in the model_name parameter.</span>
</span><span id="ForecastModelSelect-72"><a href="#ForecastModelSelect-72"><span class="linenos"> 72</span></a><span class="sd">    - score (str): The performance score. Default is &#39;RMSE&#39;. Available values are:</span>
</span><span id="ForecastModelSelect-73"><a href="#ForecastModelSelect-73"><span class="linenos"> 73</span></a><span class="sd">        - RMSE: Root Mean Squared Error.</span>
</span><span id="ForecastModelSelect-74"><a href="#ForecastModelSelect-74"><span class="linenos"> 74</span></a><span class="sd">        - MAE: Mean Absolute Error.</span>
</span><span id="ForecastModelSelect-75"><a href="#ForecastModelSelect-75"><span class="linenos"> 75</span></a><span class="sd">        - MAPE: Mean Absolute Percentage Error.</span>
</span><span id="ForecastModelSelect-76"><a href="#ForecastModelSelect-76"><span class="linenos"> 76</span></a><span class="sd">        - MedianAE: Median Absolute Error.</span>
</span><span id="ForecastModelSelect-77"><a href="#ForecastModelSelect-77"><span class="linenos"> 77</span></a><span class="sd">        - R2: R-squared.       </span>
</span><span id="ForecastModelSelect-78"><a href="#ForecastModelSelect-78"><span class="linenos"> 78</span></a><span class="sd">    - nbest (int): Number of best models to aggregate. Default is 2.    </span>
</span><span id="ForecastModelSelect-79"><a href="#ForecastModelSelect-79"><span class="linenos"> 79</span></a><span class="sd">    - data (pd.DataFrame): A DataFrame containing the input data for forecasting.</span>
</span><span id="ForecastModelSelect-80"><a href="#ForecastModelSelect-80"><span class="linenos"> 80</span></a><span class="sd">    - depvar_str (str): The column name representing the dependent variable for forecasting.</span>
</span><span id="ForecastModelSelect-81"><a href="#ForecastModelSelect-81"><span class="linenos"> 81</span></a><span class="sd">    - fh (int): The forecast horizon, i.e., the number of periods ahead to forecast.</span>
</span><span id="ForecastModelSelect-82"><a href="#ForecastModelSelect-82"><span class="linenos"> 82</span></a><span class="sd">    - pct_initial_window (float): The percentage of data used as the initial training window.</span>
</span><span id="ForecastModelSelect-83"><a href="#ForecastModelSelect-83"><span class="linenos"> 83</span></a><span class="sd">    - step_length (int): The step size for expanding window cross-validation.    </span>
</span><span id="ForecastModelSelect-84"><a href="#ForecastModelSelect-84"><span class="linenos"> 84</span></a><span class="sd">    - exog_l (list, optional): List of exogenous variables for forecasting. Default is None.</span>
</span><span id="ForecastModelSelect-85"><a href="#ForecastModelSelect-85"><span class="linenos"> 85</span></a><span class="sd">    - freq (str, optional): The frequency of the time series data. Default is &#39;B&#39; (business days).</span>
</span><span id="ForecastModelSelect-86"><a href="#ForecastModelSelect-86"><span class="linenos"> 86</span></a>
</span><span id="ForecastModelSelect-87"><a href="#ForecastModelSelect-87"><span class="linenos"> 87</span></a><span class="sd">    Attributes:</span>
</span><span id="ForecastModelSelect-88"><a href="#ForecastModelSelect-88"><span class="linenos"> 88</span></a><span class="sd">    -----------</span>
</span><span id="ForecastModelSelect-89"><a href="#ForecastModelSelect-89"><span class="linenos"> 89</span></a><span class="sd">    - LF_d (dict): A dictionary containing the Forecast objects.</span>
</span><span id="ForecastModelSelect-90"><a href="#ForecastModelSelect-90"><span class="linenos"> 90</span></a><span class="sd">    - summary_horizon (pd.DataFrame): Summary of out-of-sample performance per horizon and per model.</span>
</span><span id="ForecastModelSelect-91"><a href="#ForecastModelSelect-91"><span class="linenos"> 91</span></a><span class="sd">    - summary_results (pd.DataFrame): Summary of out-of-sample performance per model.</span>
</span><span id="ForecastModelSelect-92"><a href="#ForecastModelSelect-92"><span class="linenos"> 92</span></a><span class="sd">    - summary_cutoff (pd.DataFrame): Out-of-sample performance based on cutoffs.</span>
</span><span id="ForecastModelSelect-93"><a href="#ForecastModelSelect-93"><span class="linenos"> 93</span></a><span class="sd">    - model_rank_perhorizon (pd.DataFrame): Rank of models per horizon based on performance.</span>
</span><span id="ForecastModelSelect-94"><a href="#ForecastModelSelect-94"><span class="linenos"> 94</span></a><span class="sd">    - _mode (str): The aggregation mode.</span>
</span><span id="ForecastModelSelect-95"><a href="#ForecastModelSelect-95"><span class="linenos"> 95</span></a><span class="sd">    - _score (str): The performance score.</span>
</span><span id="ForecastModelSelect-96"><a href="#ForecastModelSelect-96"><span class="linenos"> 96</span></a><span class="sd">    - _nbest (int): Number of best models to aggregate.</span>
</span><span id="ForecastModelSelect-97"><a href="#ForecastModelSelect-97"><span class="linenos"> 97</span></a><span class="sd">    - _eval_models (list): A list of evaluated models.    </span>
</span><span id="ForecastModelSelect-98"><a href="#ForecastModelSelect-98"><span class="linenos"> 98</span></a><span class="sd">    - _best_x_overall (dict): The best models based on overall performance.</span>
</span><span id="ForecastModelSelect-99"><a href="#ForecastModelSelect-99"><span class="linenos"> 99</span></a><span class="sd">    - _avg_oos_horizon (dict): The average out-of-sample performance per horizon.</span>
</span><span id="ForecastModelSelect-100"><a href="#ForecastModelSelect-100"><span class="linenos">100</span></a>
</span><span id="ForecastModelSelect-101"><a href="#ForecastModelSelect-101"><span class="linenos">101</span></a><span class="sd">    Methods:</span>
</span><span id="ForecastModelSelect-102"><a href="#ForecastModelSelect-102"><span class="linenos">102</span></a><span class="sd">    --------</span>
</span><span id="ForecastModelSelect-103"><a href="#ForecastModelSelect-103"><span class="linenos">103</span></a><span class="sd">    - split_procedure_summary(): Print the summary of the split procedure for each model.</span>
</span><span id="ForecastModelSelect-104"><a href="#ForecastModelSelect-104"><span class="linenos">104</span></a><span class="sd">    - add_forecaster(forecaster_name, lf): Add a Forecast Object to the list of models to evaluate.</span>
</span><span id="ForecastModelSelect-105"><a href="#ForecastModelSelect-105"><span class="linenos">105</span></a><span class="sd">    - fit(on, fh, force, verbose): Fit the forecasting models for all the underlying Forecast objects.</span>
</span><span id="ForecastModelSelect-106"><a href="#ForecastModelSelect-106"><span class="linenos">106</span></a><span class="sd">    - evaluate(force): Evaluate the underlying Forecast models out of sample.</span>
</span><span id="ForecastModelSelect-107"><a href="#ForecastModelSelect-107"><span class="linenos">107</span></a><span class="sd">    - select_best(score, reestimate): Select the best model based on horizon and overall performance.</span>
</span><span id="ForecastModelSelect-108"><a href="#ForecastModelSelect-108"><span class="linenos">108</span></a><span class="sd">    - summary_per_cutoff(score): Calculate and return the out-of-sample performance based on cutoffs.</span>
</span><span id="ForecastModelSelect-109"><a href="#ForecastModelSelect-109"><span class="linenos">109</span></a><span class="sd">    - predict(X, fh, coverage, mode, score, model_name, ret_underlying): Make forecasts using the specified aggregation mode.</span>
</span><span id="ForecastModelSelect-110"><a href="#ForecastModelSelect-110"><span class="linenos">110</span></a><span class="sd">    - update(new_y, new_X, refit, reevaluate, fh, coverage, mode, score, model_name, ret_underlying): Update the prediction for all the models and aggregate them based on the specific mode.</span>
</span><span id="ForecastModelSelect-111"><a href="#ForecastModelSelect-111"><span class="linenos">111</span></a><span class="sd">    - save(path): Save the model to a file.</span>
</span><span id="ForecastModelSelect-112"><a href="#ForecastModelSelect-112"><span class="linenos">112</span></a><span class="sd">    - get_pred_errors(mode, score, model_name): Get the prediction errors.</span>
</span><span id="ForecastModelSelect-113"><a href="#ForecastModelSelect-113"><span class="linenos">113</span></a><span class="sd">    - plot_model_compare(score, view, model_subset, xlabel, ylabel, title, ax, figsize): Plot a comparison of models based on their out-of-sample performance.</span>
</span><span id="ForecastModelSelect-114"><a href="#ForecastModelSelect-114"><span class="linenos">114</span></a><span class="sd">    - plot_prediction(y_pred, models_preds, y_pred_interval, interval_label, aggregation_label, xlabel, ylabel, title, ax): Plot the prediction.</span>
</span><span id="ForecastModelSelect-115"><a href="#ForecastModelSelect-115"><span class="linenos">115</span></a><span class="sd">    </span>
</span><span id="ForecastModelSelect-116"><a href="#ForecastModelSelect-116"><span class="linenos">116</span></a><span class="sd">    Raises:</span>
</span><span id="ForecastModelSelect-117"><a href="#ForecastModelSelect-117"><span class="linenos">117</span></a><span class="sd">    -------    </span>
</span><span id="ForecastModelSelect-118"><a href="#ForecastModelSelect-118"><span class="linenos">118</span></a><span class="sd">    - AssertionError: If the trained models are not instances of Forecast.</span>
</span><span id="ForecastModelSelect-119"><a href="#ForecastModelSelect-119"><span class="linenos">119</span></a><span class="sd">    - AssertionError: If there is an overlap between the trained and non-trained dictionaries.</span>
</span><span id="ForecastModelSelect-120"><a href="#ForecastModelSelect-120"><span class="linenos">120</span></a><span class="sd">    - AssertionError: If the mode function is not implemented.</span>
</span><span id="ForecastModelSelect-121"><a href="#ForecastModelSelect-121"><span class="linenos">121</span></a><span class="sd">    - AssertionError: If the performance score is not implemented.</span>
</span><span id="ForecastModelSelect-122"><a href="#ForecastModelSelect-122"><span class="linenos">122</span></a><span class="sd">    - AssertionError: If the number of best models is not an integer.</span>
</span><span id="ForecastModelSelect-123"><a href="#ForecastModelSelect-123"><span class="linenos">123</span></a><span class="sd">    - AssertionError: If the exogenous variables are missing for a model.</span>
</span><span id="ForecastModelSelect-124"><a href="#ForecastModelSelect-124"><span class="linenos">124</span></a><span class="sd">    - ValueError: If the view mode is not &#39;horizon&#39; or &#39;cutoff&#39;.</span>
</span><span id="ForecastModelSelect-125"><a href="#ForecastModelSelect-125"><span class="linenos">125</span></a><span class="sd">    - ValueError: If the mode is not &#39;best&#39;, &#39;best_horizon&#39;, &#39;average&#39;, &#39;inverse_score&#39;, &#39;nbest_average&#39;, &#39;nbest_average_horizon&#39;, or &#39;model&#39;.</span>
</span><span id="ForecastModelSelect-126"><a href="#ForecastModelSelect-126"><span class="linenos">126</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect-127"><a href="#ForecastModelSelect-127"><span class="linenos">127</span></a>
</span><span id="ForecastModelSelect-128"><a href="#ForecastModelSelect-128"><span class="linenos">128</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="ForecastModelSelect-129"><a href="#ForecastModelSelect-129"><span class="linenos">129</span></a>                 <span class="n">forecasters_d</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ForecastModelSelect-130"><a href="#ForecastModelSelect-130"><span class="linenos">130</span></a>                 <span class="n">trained_forecasters_d</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ForecastModelSelect-131"><a href="#ForecastModelSelect-131"><span class="linenos">131</span></a>                 <span class="n">model_exog_d</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ForecastModelSelect-132"><a href="#ForecastModelSelect-132"><span class="linenos">132</span></a>                 <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;best_horizon&#39;</span><span class="p">,</span>
</span><span id="ForecastModelSelect-133"><a href="#ForecastModelSelect-133"><span class="linenos">133</span></a>                 <span class="n">score</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">,</span>
</span><span id="ForecastModelSelect-134"><a href="#ForecastModelSelect-134"><span class="linenos">134</span></a>                 <span class="n">nbest</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ForecastModelSelect-135"><a href="#ForecastModelSelect-135"><span class="linenos">135</span></a>                 <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="ForecastModelSelect-136"><a href="#ForecastModelSelect-136"><span class="linenos">136</span></a>                <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect-137"><a href="#ForecastModelSelect-137"><span class="linenos">137</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the ForecastModelSelect object.&quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect-138"><a href="#ForecastModelSelect-138"><span class="linenos">138</span></a>        <span class="n">lf_d</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ForecastModelSelect-139"><a href="#ForecastModelSelect-139"><span class="linenos">139</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">trained_forecasters_d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="ForecastModelSelect-140"><a href="#ForecastModelSelect-140"><span class="linenos">140</span></a>            <span class="c1"># Trained Models must be istance of Forecast object</span>
</span><span id="ForecastModelSelect-141"><a href="#ForecastModelSelect-141"><span class="linenos">141</span></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">forecasters_d</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">trained_forecasters_d</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;There is an overlap between the two trained and non trainded dictionaries&#39;</span> 
</span><span id="ForecastModelSelect-142"><a href="#ForecastModelSelect-142"><span class="linenos">142</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">forecasters_d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="ForecastModelSelect-143"><a href="#ForecastModelSelect-143"><span class="linenos">143</span></a>                <span class="c1"># There must be no overlap between the two dictionaries</span>
</span><span id="ForecastModelSelect-144"><a href="#ForecastModelSelect-144"><span class="linenos">144</span></a>                <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_lf</span><span class="p">,</span> <span class="n">Forecast</span><span class="p">)</span> <span class="k">for</span> <span class="n">_lf</span> <span class="ow">in</span> <span class="n">trained_forecasters_d</span><span class="o">.</span><span class="n">values</span><span class="p">()]),</span> <span class="s1">&#39;Trained models must be instances of Forecast object&#39;</span>
</span><span id="ForecastModelSelect-145"><a href="#ForecastModelSelect-145"><span class="linenos">145</span></a>            <span class="k">for</span> <span class="n">forecaster_name</span><span class="p">,</span> <span class="n">_lf</span> <span class="ow">in</span> <span class="n">trained_forecasters_d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ForecastModelSelect-146"><a href="#ForecastModelSelect-146"><span class="linenos">146</span></a>                <span class="n">lf_d</span><span class="p">[</span><span class="n">forecaster_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">_lf</span>        
</span><span id="ForecastModelSelect-147"><a href="#ForecastModelSelect-147"><span class="linenos">147</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ForecastModelSelect-148"><a href="#ForecastModelSelect-148"><span class="linenos">148</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">forecasters_d</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="ForecastModelSelect-149"><a href="#ForecastModelSelect-149"><span class="linenos">149</span></a>                <span class="n">forecasters_d</span> <span class="o">=</span> <span class="n">CommonForecastingModels</span>
</span><span id="ForecastModelSelect-150"><a href="#ForecastModelSelect-150"><span class="linenos">150</span></a>        
</span><span id="ForecastModelSelect-151"><a href="#ForecastModelSelect-151"><span class="linenos">151</span></a>        <span class="c1"># Define the Forecasters exogenous variables</span>
</span><span id="ForecastModelSelect-152"><a href="#ForecastModelSelect-152"><span class="linenos">152</span></a>        <span class="n">exog_l</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;exog_l&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="ForecastModelSelect-153"><a href="#ForecastModelSelect-153"><span class="linenos">153</span></a>        <span class="k">if</span> <span class="n">model_exog_d</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect-154"><a href="#ForecastModelSelect-154"><span class="linenos">154</span></a>            <span class="n">model_exog_d</span> <span class="o">=</span> <span class="p">{</span><span class="n">forecaster_name</span><span class="p">:</span> <span class="n">exog_l</span> <span class="k">for</span> <span class="n">forecaster_name</span> <span class="ow">in</span> <span class="n">forecasters_d</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
</span><span id="ForecastModelSelect-155"><a href="#ForecastModelSelect-155"><span class="linenos">155</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ForecastModelSelect-156"><a href="#ForecastModelSelect-156"><span class="linenos">156</span></a>            <span class="n">exog_l</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">exog_l</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">exog_l</span>
</span><span id="ForecastModelSelect-157"><a href="#ForecastModelSelect-157"><span class="linenos">157</span></a>            <span class="k">for</span> <span class="n">forecaster_name</span> <span class="ow">in</span> <span class="n">forecasters_d</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="ForecastModelSelect-158"><a href="#ForecastModelSelect-158"><span class="linenos">158</span></a>                <span class="n">model_exog_d</span><span class="p">[</span><span class="n">forecaster_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">exog_l</span> <span class="o">+</span> <span class="n">model_exog_d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">forecaster_name</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="ForecastModelSelect-159"><a href="#ForecastModelSelect-159"><span class="linenos">159</span></a>        
</span><span id="ForecastModelSelect-160"><a href="#ForecastModelSelect-160"><span class="linenos">160</span></a>        <span class="k">if</span> <span class="n">forecasters_d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect-161"><a href="#ForecastModelSelect-161"><span class="linenos">161</span></a>            <span class="k">for</span> <span class="n">forecaster_name</span><span class="p">,</span> <span class="n">forecaster</span> <span class="ow">in</span> <span class="n">forecasters_d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>            
</span><span id="ForecastModelSelect-162"><a href="#ForecastModelSelect-162"><span class="linenos">162</span></a>                <span class="n">_lf</span> <span class="o">=</span>  <span class="n">Forecast</span><span class="p">(</span>
</span><span id="ForecastModelSelect-163"><a href="#ForecastModelSelect-163"><span class="linenos">163</span></a>                    <span class="n">forecaster_name</span> <span class="o">=</span> <span class="n">forecaster_name</span><span class="p">,</span>
</span><span id="ForecastModelSelect-164"><a href="#ForecastModelSelect-164"><span class="linenos">164</span></a>                    <span class="n">forecaster</span> <span class="o">=</span> <span class="n">forecaster</span><span class="p">,</span>
</span><span id="ForecastModelSelect-165"><a href="#ForecastModelSelect-165"><span class="linenos">165</span></a>                    <span class="n">exog_l</span> <span class="o">=</span> <span class="n">model_exog_d</span><span class="p">[</span><span class="n">forecaster_name</span><span class="p">],</span>
</span><span id="ForecastModelSelect-166"><a href="#ForecastModelSelect-166"><span class="linenos">166</span></a>                    <span class="o">**</span><span class="n">kwargs</span>
</span><span id="ForecastModelSelect-167"><a href="#ForecastModelSelect-167"><span class="linenos">167</span></a>                <span class="p">)</span>
</span><span id="ForecastModelSelect-168"><a href="#ForecastModelSelect-168"><span class="linenos">168</span></a>                <span class="n">lf_d</span><span class="p">[</span><span class="n">forecaster_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">_lf</span>
</span><span id="ForecastModelSelect-169"><a href="#ForecastModelSelect-169"><span class="linenos">169</span></a>                           
</span><span id="ForecastModelSelect-170"><a href="#ForecastModelSelect-170"><span class="linenos">170</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span> <span class="o">=</span> <span class="n">lf_d</span>
</span><span id="ForecastModelSelect-171"><a href="#ForecastModelSelect-171"><span class="linenos">171</span></a>
</span><span id="ForecastModelSelect-172"><a href="#ForecastModelSelect-172"><span class="linenos">172</span></a>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="s1">&#39;mode must be a sting&#39;</span>
</span><span id="ForecastModelSelect-173"><a href="#ForecastModelSelect-173"><span class="linenos">173</span></a>        <span class="n">recog_modes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="s1">&#39;best_horizon&#39;</span><span class="p">,</span> <span class="s1">&#39;average&#39;</span><span class="p">,</span> <span class="s1">&#39;inverse_score&#39;</span><span class="p">,</span> 
</span><span id="ForecastModelSelect-174"><a href="#ForecastModelSelect-174"><span class="linenos">174</span></a>                           <span class="s1">&#39;nbest_average&#39;</span><span class="p">,</span> <span class="s1">&#39;nbest_average_horizon&#39;</span><span class="p">]</span>
</span><span id="ForecastModelSelect-175"><a href="#ForecastModelSelect-175"><span class="linenos">175</span></a>        <span class="k">assert</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">recog_modes</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;mode function not implemented!. Recognized modes are </span><span class="si">{</span><span class="n">recog_modes</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="ForecastModelSelect-176"><a href="#ForecastModelSelect-176"><span class="linenos">176</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">=</span> <span class="n">mode</span>
</span><span id="ForecastModelSelect-177"><a href="#ForecastModelSelect-177"><span class="linenos">177</span></a>
</span><span id="ForecastModelSelect-178"><a href="#ForecastModelSelect-178"><span class="linenos">178</span></a>        <span class="n">recog_scores</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="s1">&#39;MAE&#39;</span><span class="p">,</span> <span class="s1">&#39;MAPE&#39;</span><span class="p">,</span> <span class="s1">&#39;R2&#39;</span><span class="p">,</span> <span class="s1">&#39;MedianAE&#39;</span><span class="p">]</span>
</span><span id="ForecastModelSelect-179"><a href="#ForecastModelSelect-179"><span class="linenos">179</span></a>        <span class="k">assert</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">recog_scores</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;performance score not implemented!. Recognized scores are </span><span class="si">{</span><span class="n">recog_scores</span><span class="si">}</span><span class="s1">&#39;</span>		
</span><span id="ForecastModelSelect-180"><a href="#ForecastModelSelect-180"><span class="linenos">180</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_score</span> <span class="o">=</span> <span class="n">score</span>
</span><span id="ForecastModelSelect-181"><a href="#ForecastModelSelect-181"><span class="linenos">181</span></a>
</span><span id="ForecastModelSelect-182"><a href="#ForecastModelSelect-182"><span class="linenos">182</span></a>        <span class="k">if</span> <span class="n">nbest</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect-183"><a href="#ForecastModelSelect-183"><span class="linenos">183</span></a>            <span class="n">nbest</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="ForecastModelSelect-184"><a href="#ForecastModelSelect-184"><span class="linenos">184</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ForecastModelSelect-185"><a href="#ForecastModelSelect-185"><span class="linenos">185</span></a>            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nbest</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="s1">&#39;n best must be an integer&#39;</span>		
</span><span id="ForecastModelSelect-186"><a href="#ForecastModelSelect-186"><span class="linenos">186</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_nbest</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">nbest</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="p">))</span>	
</span><span id="ForecastModelSelect-187"><a href="#ForecastModelSelect-187"><span class="linenos">187</span></a>
</span><span id="ForecastModelSelect-188"><a href="#ForecastModelSelect-188"><span class="linenos">188</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_eval_models</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ForecastModelSelect-189"><a href="#ForecastModelSelect-189"><span class="linenos">189</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">summary_horizon</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ForecastModelSelect-190"><a href="#ForecastModelSelect-190"><span class="linenos">190</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">summary_results</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ForecastModelSelect-191"><a href="#ForecastModelSelect-191"><span class="linenos">191</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model_rank_perhorizon</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ForecastModelSelect-192"><a href="#ForecastModelSelect-192"><span class="linenos">192</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_best_x_overall</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ForecastModelSelect-193"><a href="#ForecastModelSelect-193"><span class="linenos">193</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_avg_oos_horizon</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ForecastModelSelect-194"><a href="#ForecastModelSelect-194"><span class="linenos">194</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">summary_cutoff</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ForecastModelSelect-195"><a href="#ForecastModelSelect-195"><span class="linenos">195</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="ForecastModelSelect-196"><a href="#ForecastModelSelect-196"><span class="linenos">196</span></a>
</span><span id="ForecastModelSelect-197"><a href="#ForecastModelSelect-197"><span class="linenos">197</span></a>    <span class="k">def</span> <span class="nf">split_procedure_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ForecastModelSelect-198"><a href="#ForecastModelSelect-198"><span class="linenos">198</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect-199"><a href="#ForecastModelSelect-199"><span class="linenos">199</span></a><span class="sd">        Print the summary of the split procedure for each model.</span>
</span><span id="ForecastModelSelect-200"><a href="#ForecastModelSelect-200"><span class="linenos">200</span></a>
</span><span id="ForecastModelSelect-201"><a href="#ForecastModelSelect-201"><span class="linenos">201</span></a><span class="sd">        Returns:</span>
</span><span id="ForecastModelSelect-202"><a href="#ForecastModelSelect-202"><span class="linenos">202</span></a><span class="sd">        --------        </span>
</span><span id="ForecastModelSelect-203"><a href="#ForecastModelSelect-203"><span class="linenos">203</span></a><span class="sd">            dict:</span>
</span><span id="ForecastModelSelect-204"><a href="#ForecastModelSelect-204"><span class="linenos">204</span></a><span class="sd">                A dictionary containing details of the cross-validation procedure, including:</span>
</span><span id="ForecastModelSelect-205"><a href="#ForecastModelSelect-205"><span class="linenos">205</span></a><span class="sd">                the number of folds, initial window size, step length, and forecast period.</span>
</span><span id="ForecastModelSelect-206"><a href="#ForecastModelSelect-206"><span class="linenos">206</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect-207"><a href="#ForecastModelSelect-207"><span class="linenos">207</span></a>        <span class="n">_lf</span>  <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ForecastModelSelect-208"><a href="#ForecastModelSelect-208"><span class="linenos">208</span></a>        <span class="k">return</span> <span class="n">_lf</span><span class="o">.</span><span class="n">split_procedure_summary</span><span class="p">()</span>
</span><span id="ForecastModelSelect-209"><a href="#ForecastModelSelect-209"><span class="linenos">209</span></a>    
</span><span id="ForecastModelSelect-210"><a href="#ForecastModelSelect-210"><span class="linenos">210</span></a>    <span class="k">def</span> <span class="nf">add_forecaster</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="ForecastModelSelect-211"><a href="#ForecastModelSelect-211"><span class="linenos">211</span></a>                       <span class="n">forecaster_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ForecastModelSelect-212"><a href="#ForecastModelSelect-212"><span class="linenos">212</span></a>                       <span class="n">lf</span><span class="p">:</span> <span class="n">Forecast</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect-213"><a href="#ForecastModelSelect-213"><span class="linenos">213</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect-214"><a href="#ForecastModelSelect-214"><span class="linenos">214</span></a><span class="sd">        Add a Forecast Object to the list of models to evaluate.</span>
</span><span id="ForecastModelSelect-215"><a href="#ForecastModelSelect-215"><span class="linenos">215</span></a>
</span><span id="ForecastModelSelect-216"><a href="#ForecastModelSelect-216"><span class="linenos">216</span></a><span class="sd">        Parameters:</span>
</span><span id="ForecastModelSelect-217"><a href="#ForecastModelSelect-217"><span class="linenos">217</span></a><span class="sd">        -----------</span>
</span><span id="ForecastModelSelect-218"><a href="#ForecastModelSelect-218"><span class="linenos">218</span></a><span class="sd">            lf : Forecast</span>
</span><span id="ForecastModelSelect-219"><a href="#ForecastModelSelect-219"><span class="linenos">219</span></a><span class="sd">                The Forecast object to be added.</span>
</span><span id="ForecastModelSelect-220"><a href="#ForecastModelSelect-220"><span class="linenos">220</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect-221"><a href="#ForecastModelSelect-221"><span class="linenos">221</span></a>        <span class="k">assert</span> <span class="n">forecaster_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="s1">&#39;Forecaster name already exists in the considered list of model&#39;</span>
</span><span id="ForecastModelSelect-222"><a href="#ForecastModelSelect-222"><span class="linenos">222</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="p">[</span><span class="n">forecaster_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">lf</span>
</span><span id="ForecastModelSelect-223"><a href="#ForecastModelSelect-223"><span class="linenos">223</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span>
</span><span id="ForecastModelSelect-224"><a href="#ForecastModelSelect-224"><span class="linenos">224</span></a>
</span><span id="ForecastModelSelect-225"><a href="#ForecastModelSelect-225"><span class="linenos">225</span></a>    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="ForecastModelSelect-226"><a href="#ForecastModelSelect-226"><span class="linenos">226</span></a>            <span class="n">on</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span> 
</span><span id="ForecastModelSelect-227"><a href="#ForecastModelSelect-227"><span class="linenos">227</span></a>            <span class="n">fh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ForecastingHorizon</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
</span><span id="ForecastModelSelect-228"><a href="#ForecastModelSelect-228"><span class="linenos">228</span></a>            <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ForecastModelSelect-229"><a href="#ForecastModelSelect-229"><span class="linenos">229</span></a>            <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ForecastModelSelect-230"><a href="#ForecastModelSelect-230"><span class="linenos">230</span></a>           <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect-231"><a href="#ForecastModelSelect-231"><span class="linenos">231</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect-232"><a href="#ForecastModelSelect-232"><span class="linenos">232</span></a><span class="sd">        Fit the forecasting models for all the underlying Forecast objects.</span>
</span><span id="ForecastModelSelect-233"><a href="#ForecastModelSelect-233"><span class="linenos">233</span></a>
</span><span id="ForecastModelSelect-234"><a href="#ForecastModelSelect-234"><span class="linenos">234</span></a><span class="sd">        Parameters:</span>
</span><span id="ForecastModelSelect-235"><a href="#ForecastModelSelect-235"><span class="linenos">235</span></a><span class="sd">        -----------        </span>
</span><span id="ForecastModelSelect-236"><a href="#ForecastModelSelect-236"><span class="linenos">236</span></a><span class="sd">            on : str, optional</span>
</span><span id="ForecastModelSelect-237"><a href="#ForecastModelSelect-237"><span class="linenos">237</span></a><span class="sd">                The period for the in-sample fitting. Default is &#39;all&#39;.</span>
</span><span id="ForecastModelSelect-238"><a href="#ForecastModelSelect-238"><span class="linenos">238</span></a><span class="sd">            fh : ForecastingHorizon, optional</span>
</span><span id="ForecastModelSelect-239"><a href="#ForecastModelSelect-239"><span class="linenos">239</span></a><span class="sd">                The forecasting horizon. Default is None and it takes the value entered at initialization..</span>
</span><span id="ForecastModelSelect-240"><a href="#ForecastModelSelect-240"><span class="linenos">240</span></a><span class="sd">            force : bool, optional</span>
</span><span id="ForecastModelSelect-241"><a href="#ForecastModelSelect-241"><span class="linenos">241</span></a><span class="sd">                If True, force fitting even if the models are already fitted. Default is False.</span>
</span><span id="ForecastModelSelect-242"><a href="#ForecastModelSelect-242"><span class="linenos">242</span></a>
</span><span id="ForecastModelSelect-243"><a href="#ForecastModelSelect-243"><span class="linenos">243</span></a><span class="sd">        Returns:</span>
</span><span id="ForecastModelSelect-244"><a href="#ForecastModelSelect-244"><span class="linenos">244</span></a><span class="sd">        --------        </span>
</span><span id="ForecastModelSelect-245"><a href="#ForecastModelSelect-245"><span class="linenos">245</span></a><span class="sd">            None</span>
</span><span id="ForecastModelSelect-246"><a href="#ForecastModelSelect-246"><span class="linenos">246</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect-247"><a href="#ForecastModelSelect-247"><span class="linenos">247</span></a>        <span class="k">for</span> <span class="n">_lfname</span><span class="p">,</span> <span class="n">_lf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ForecastModelSelect-248"><a href="#ForecastModelSelect-248"><span class="linenos">248</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="ForecastModelSelect-249"><a href="#ForecastModelSelect-249"><span class="linenos">249</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Fitting </span><span class="si">{</span><span class="n">_lfname</span><span class="si">}</span><span class="s1"> ...&#39;</span><span class="p">)</span>
</span><span id="ForecastModelSelect-250"><a href="#ForecastModelSelect-250"><span class="linenos">250</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">_lf</span><span class="o">.</span><span class="n">is_fitted</span><span class="p">)</span> <span class="ow">and</span> <span class="n">force</span> <span class="o">==</span><span class="kc">False</span><span class="p">:</span>
</span><span id="ForecastModelSelect-251"><a href="#ForecastModelSelect-251"><span class="linenos">251</span></a>                <span class="k">pass</span>
</span><span id="ForecastModelSelect-252"><a href="#ForecastModelSelect-252"><span class="linenos">252</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ForecastModelSelect-253"><a href="#ForecastModelSelect-253"><span class="linenos">253</span></a>                <span class="n">_lf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">on</span><span class="o">=</span><span class="n">on</span><span class="p">,</span> <span class="n">fh</span><span class="o">=</span><span class="n">fh</span><span class="p">)</span>
</span><span id="ForecastModelSelect-254"><a href="#ForecastModelSelect-254"><span class="linenos">254</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="ForecastModelSelect-255"><a href="#ForecastModelSelect-255"><span class="linenos">255</span></a>
</span><span id="ForecastModelSelect-256"><a href="#ForecastModelSelect-256"><span class="linenos">256</span></a>    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="ForecastModelSelect-257"><a href="#ForecastModelSelect-257"><span class="linenos">257</span></a>                 <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ForecastModelSelect-258"><a href="#ForecastModelSelect-258"><span class="linenos">258</span></a>                <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">:</span>
</span><span id="ForecastModelSelect-259"><a href="#ForecastModelSelect-259"><span class="linenos">259</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect-260"><a href="#ForecastModelSelect-260"><span class="linenos">260</span></a><span class="sd">        Evaluate the underlying Forecast models out of sample.</span>
</span><span id="ForecastModelSelect-261"><a href="#ForecastModelSelect-261"><span class="linenos">261</span></a>
</span><span id="ForecastModelSelect-262"><a href="#ForecastModelSelect-262"><span class="linenos">262</span></a><span class="sd">        Parameters:</span>
</span><span id="ForecastModelSelect-263"><a href="#ForecastModelSelect-263"><span class="linenos">263</span></a><span class="sd">        -----------</span>
</span><span id="ForecastModelSelect-264"><a href="#ForecastModelSelect-264"><span class="linenos">264</span></a><span class="sd">            force : bool, optional</span>
</span><span id="ForecastModelSelect-265"><a href="#ForecastModelSelect-265"><span class="linenos">265</span></a><span class="sd">                If True, force the evaluation even if the models are already evaluated. Default is False.</span>
</span><span id="ForecastModelSelect-266"><a href="#ForecastModelSelect-266"><span class="linenos">266</span></a>
</span><span id="ForecastModelSelect-267"><a href="#ForecastModelSelect-267"><span class="linenos">267</span></a><span class="sd">        Returns:</span>
</span><span id="ForecastModelSelect-268"><a href="#ForecastModelSelect-268"><span class="linenos">268</span></a><span class="sd">        --------</span>
</span><span id="ForecastModelSelect-269"><a href="#ForecastModelSelect-269"><span class="linenos">269</span></a><span class="sd">            tuple</span>
</span><span id="ForecastModelSelect-270"><a href="#ForecastModelSelect-270"><span class="linenos">270</span></a><span class="sd">                A tuple containing the summary of out-of-sample performance per horizon and per model.</span>
</span><span id="ForecastModelSelect-271"><a href="#ForecastModelSelect-271"><span class="linenos">271</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect-272"><a href="#ForecastModelSelect-272"><span class="linenos">272</span></a>        <span class="c1">#Step 1: Loop on all models and evaluate them</span>
</span><span id="ForecastModelSelect-273"><a href="#ForecastModelSelect-273"><span class="linenos">273</span></a>        <span class="n">_model_evals</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ForecastModelSelect-274"><a href="#ForecastModelSelect-274"><span class="linenos">274</span></a>        <span class="n">_todrop_evals</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ForecastModelSelect-275"><a href="#ForecastModelSelect-275"><span class="linenos">275</span></a>        <span class="k">for</span> <span class="n">_fname</span><span class="p">,</span> <span class="n">_lf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ForecastModelSelect-276"><a href="#ForecastModelSelect-276"><span class="linenos">276</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">_lf</span><span class="o">.</span><span class="n">is_evaluated</span><span class="p">)</span> <span class="ow">and</span> <span class="n">force</span> <span class="o">==</span><span class="kc">False</span><span class="p">:</span>
</span><span id="ForecastModelSelect-277"><a href="#ForecastModelSelect-277"><span class="linenos">277</span></a>                <span class="n">_model_evals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_lf</span><span class="o">.</span><span class="n">eval</span><span class="p">)</span>
</span><span id="ForecastModelSelect-278"><a href="#ForecastModelSelect-278"><span class="linenos">278</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ForecastModelSelect-279"><a href="#ForecastModelSelect-279"><span class="linenos">279</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="ForecastModelSelect-280"><a href="#ForecastModelSelect-280"><span class="linenos">280</span></a>                    <span class="n">_eval</span> <span class="o">=</span> <span class="n">_lf</span><span class="o">.</span><span class="n">evaluate</span><span class="p">()</span>
</span><span id="ForecastModelSelect-281"><a href="#ForecastModelSelect-281"><span class="linenos">281</span></a>                    <span class="n">_model_evals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_eval</span><span class="p">)</span>
</span><span id="ForecastModelSelect-282"><a href="#ForecastModelSelect-282"><span class="linenos">282</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="ForecastModelSelect-283"><a href="#ForecastModelSelect-283"><span class="linenos">283</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error evaluating </span><span class="si">{</span><span class="n">_fname</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ForecastModelSelect-284"><a href="#ForecastModelSelect-284"><span class="linenos">284</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">model </span><span class="si">{</span><span class="n">_fname</span><span class="si">}</span><span class="s1"> cannot be evaluated. It will be removed from the list of models&#39;</span><span class="p">)</span>
</span><span id="ForecastModelSelect-285"><a href="#ForecastModelSelect-285"><span class="linenos">285</span></a>                    <span class="n">_todrop_evals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_fname</span><span class="p">)</span>
</span><span id="ForecastModelSelect-286"><a href="#ForecastModelSelect-286"><span class="linenos">286</span></a>                    <span class="k">continue</span>                
</span><span id="ForecastModelSelect-287"><a href="#ForecastModelSelect-287"><span class="linenos">287</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_todrop_evals</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
</span><span id="ForecastModelSelect-288"><a href="#ForecastModelSelect-288"><span class="linenos">288</span></a>            <span class="k">for</span> <span class="n">_fname</span> <span class="ow">in</span> <span class="n">_todrop_evals</span><span class="p">:</span>
</span><span id="ForecastModelSelect-289"><a href="#ForecastModelSelect-289"><span class="linenos">289</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">_fname</span><span class="p">)</span>
</span><span id="ForecastModelSelect-290"><a href="#ForecastModelSelect-290"><span class="linenos">290</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_eval_models</span> <span class="o">=</span> <span class="n">_model_evals</span>
</span><span id="ForecastModelSelect-291"><a href="#ForecastModelSelect-291"><span class="linenos">291</span></a>
</span><span id="ForecastModelSelect-292"><a href="#ForecastModelSelect-292"><span class="linenos">292</span></a>        <span class="c1"># Step 2: Get the OOS Summary of Performance </span>
</span><span id="ForecastModelSelect-293"><a href="#ForecastModelSelect-293"><span class="linenos">293</span></a>        <span class="c1">#per horizon and per model</span>
</span><span id="ForecastModelSelect-294"><a href="#ForecastModelSelect-294"><span class="linenos">294</span></a>        <span class="n">_sum_h</span> <span class="o">=</span> <span class="p">{};</span> <span class="n">_sum_T</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ForecastModelSelect-295"><a href="#ForecastModelSelect-295"><span class="linenos">295</span></a>        <span class="k">for</span> <span class="n">_lf_eval</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_models</span><span class="p">:</span>            
</span><span id="ForecastModelSelect-296"><a href="#ForecastModelSelect-296"><span class="linenos">296</span></a>            <span class="n">_sum_T</span><span class="p">[</span><span class="n">_lf_eval</span><span class="o">.</span><span class="n">forecaster_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">_lf_eval</span><span class="o">.</span><span class="n">summary_results</span><span class="p">()</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
</span><span id="ForecastModelSelect-297"><a href="#ForecastModelSelect-297"><span class="linenos">297</span></a>            <span class="n">_sum_h</span><span class="p">[</span><span class="n">_lf_eval</span><span class="o">.</span><span class="n">forecaster_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">_lf_eval</span><span class="o">.</span><span class="n">summary_horizon</span><span class="p">()</span>
</span><span id="ForecastModelSelect-298"><a href="#ForecastModelSelect-298"><span class="linenos">298</span></a>
</span><span id="ForecastModelSelect-299"><a href="#ForecastModelSelect-299"><span class="linenos">299</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">summary_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">_sum_T</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keys</span> <span class="o">=</span> <span class="n">_sum_T</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="ForecastModelSelect-300"><a href="#ForecastModelSelect-300"><span class="linenos">300</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">summary_horizon</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">_sum_h</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keys</span> <span class="o">=</span> <span class="n">_sum_h</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>        
</span><span id="ForecastModelSelect-301"><a href="#ForecastModelSelect-301"><span class="linenos">301</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary_horizon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary_results</span>
</span><span id="ForecastModelSelect-302"><a href="#ForecastModelSelect-302"><span class="linenos">302</span></a>
</span><span id="ForecastModelSelect-303"><a href="#ForecastModelSelect-303"><span class="linenos">303</span></a>    <span class="k">def</span> <span class="nf">select_best</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="ForecastModelSelect-304"><a href="#ForecastModelSelect-304"><span class="linenos">304</span></a>                    <span class="n">score</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ForecastModelSelect-305"><a href="#ForecastModelSelect-305"><span class="linenos">305</span></a>                    <span class="n">reestimate</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ForecastModelSelect-306"><a href="#ForecastModelSelect-306"><span class="linenos">306</span></a>                   <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="ForecastModelSelect-307"><a href="#ForecastModelSelect-307"><span class="linenos">307</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect-308"><a href="#ForecastModelSelect-308"><span class="linenos">308</span></a><span class="sd">        Select the best model based on horizon and overall performance.</span>
</span><span id="ForecastModelSelect-309"><a href="#ForecastModelSelect-309"><span class="linenos">309</span></a>
</span><span id="ForecastModelSelect-310"><a href="#ForecastModelSelect-310"><span class="linenos">310</span></a><span class="sd">        Parameters:</span>
</span><span id="ForecastModelSelect-311"><a href="#ForecastModelSelect-311"><span class="linenos">311</span></a><span class="sd">        -----------        </span>
</span><span id="ForecastModelSelect-312"><a href="#ForecastModelSelect-312"><span class="linenos">312</span></a><span class="sd">            score : str, optional</span>
</span><span id="ForecastModelSelect-313"><a href="#ForecastModelSelect-313"><span class="linenos">313</span></a><span class="sd">                The performance metric to use for model comparison. Default is None and it takes the value entered at initialization.</span>
</span><span id="ForecastModelSelect-314"><a href="#ForecastModelSelect-314"><span class="linenos">314</span></a><span class="sd">            nbest : int, optional</span>
</span><span id="ForecastModelSelect-315"><a href="#ForecastModelSelect-315"><span class="linenos">315</span></a><span class="sd">                The number of best models to select based on horizon performance. Default is None and it takes the value entered at initialization.</span>
</span><span id="ForecastModelSelect-316"><a href="#ForecastModelSelect-316"><span class="linenos">316</span></a>
</span><span id="ForecastModelSelect-317"><a href="#ForecastModelSelect-317"><span class="linenos">317</span></a><span class="sd">        Returns:</span>
</span><span id="ForecastModelSelect-318"><a href="#ForecastModelSelect-318"><span class="linenos">318</span></a><span class="sd">        --------        </span>
</span><span id="ForecastModelSelect-319"><a href="#ForecastModelSelect-319"><span class="linenos">319</span></a><span class="sd">            pd.DataFrame</span>
</span><span id="ForecastModelSelect-320"><a href="#ForecastModelSelect-320"><span class="linenos">320</span></a><span class="sd">                model_rank_perhorizon. Rank of models per horizon based on performance.</span>
</span><span id="ForecastModelSelect-321"><a href="#ForecastModelSelect-321"><span class="linenos">321</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect-322"><a href="#ForecastModelSelect-322"><span class="linenos">322</span></a>        <span class="k">if</span> <span class="n">score</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect-323"><a href="#ForecastModelSelect-323"><span class="linenos">323</span></a>            <span class="n">score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score</span>
</span><span id="ForecastModelSelect-324"><a href="#ForecastModelSelect-324"><span class="linenos">324</span></a>
</span><span id="ForecastModelSelect-325"><a href="#ForecastModelSelect-325"><span class="linenos">325</span></a>        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_rank_perhorizon</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_avg_oos_horizon</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="n">reestimate</span><span class="p">:</span>
</span><span id="ForecastModelSelect-326"><a href="#ForecastModelSelect-326"><span class="linenos">326</span></a>
</span><span id="ForecastModelSelect-327"><a href="#ForecastModelSelect-327"><span class="linenos">327</span></a>            <span class="c1"># if models are not evaluated yet, run evaluate</span>
</span><span id="ForecastModelSelect-328"><a href="#ForecastModelSelect-328"><span class="linenos">328</span></a>            <span class="n">cond1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_models</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="ForecastModelSelect-329"><a href="#ForecastModelSelect-329"><span class="linenos">329</span></a>            <span class="n">cond2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary_horizon</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="ForecastModelSelect-330"><a href="#ForecastModelSelect-330"><span class="linenos">330</span></a>            <span class="k">if</span> <span class="n">cond1</span> <span class="ow">or</span> <span class="n">cond2</span><span class="p">:</span>	
</span><span id="ForecastModelSelect-331"><a href="#ForecastModelSelect-331"><span class="linenos">331</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Run evaluate ...&#39;</span><span class="p">)</span>
</span><span id="ForecastModelSelect-332"><a href="#ForecastModelSelect-332"><span class="linenos">332</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">()</span>
</span><span id="ForecastModelSelect-333"><a href="#ForecastModelSelect-333"><span class="linenos">333</span></a>
</span><span id="ForecastModelSelect-334"><a href="#ForecastModelSelect-334"><span class="linenos">334</span></a>            <span class="n">nevals</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="p">)</span>
</span><span id="ForecastModelSelect-335"><a href="#ForecastModelSelect-335"><span class="linenos">335</span></a>            <span class="n">nbest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nbest</span>
</span><span id="ForecastModelSelect-336"><a href="#ForecastModelSelect-336"><span class="linenos">336</span></a>            <span class="k">if</span> <span class="n">nbest</span> <span class="o">&gt;</span> <span class="n">nevals</span><span class="p">:</span>
</span><span id="ForecastModelSelect-337"><a href="#ForecastModelSelect-337"><span class="linenos">337</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">nbest =</span><span class="si">{</span><span class="n">nbest</span><span class="si">}</span><span class="s1"> is higher than the number of models evaluated </span><span class="si">{</span><span class="n">nevals</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ForecastModelSelect-338"><a href="#ForecastModelSelect-338"><span class="linenos">338</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;All models will be considered. The average best models will be equal to the simple average&#39;</span><span class="p">)</span>
</span><span id="ForecastModelSelect-339"><a href="#ForecastModelSelect-339"><span class="linenos">339</span></a>                <span class="n">nbest</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">nbest</span><span class="p">,</span> <span class="n">nevals</span><span class="p">)</span>
</span><span id="ForecastModelSelect-340"><a href="#ForecastModelSelect-340"><span class="linenos">340</span></a>
</span><span id="ForecastModelSelect-341"><a href="#ForecastModelSelect-341"><span class="linenos">341</span></a>            <span class="n">best_x_overall</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ForecastModelSelect-342"><a href="#ForecastModelSelect-342"><span class="linenos">342</span></a>            <span class="n">model_rank_perhorizon</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ForecastModelSelect-343"><a href="#ForecastModelSelect-343"><span class="linenos">343</span></a>            <span class="n">avg_oos_horizon</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ForecastModelSelect-344"><a href="#ForecastModelSelect-344"><span class="linenos">344</span></a>            <span class="n">_perf_metrics</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">summary_horizon</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="ForecastModelSelect-345"><a href="#ForecastModelSelect-345"><span class="linenos">345</span></a>            <span class="k">for</span> <span class="n">_s</span> <span class="ow">in</span> <span class="n">_perf_metrics</span><span class="p">:</span>
</span><span id="ForecastModelSelect-346"><a href="#ForecastModelSelect-346"><span class="linenos">346</span></a>                <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary_horizon</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="n">_s</span><span class="p">]</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span>
</span><span id="ForecastModelSelect-347"><a href="#ForecastModelSelect-347"><span class="linenos">347</span></a>
</span><span id="ForecastModelSelect-348"><a href="#ForecastModelSelect-348"><span class="linenos">348</span></a>                <span class="c1"># Select best x models based on their average performance on all horizons </span>
</span><span id="ForecastModelSelect-349"><a href="#ForecastModelSelect-349"><span class="linenos">349</span></a>                <span class="n">overall_score</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ForecastModelSelect-350"><a href="#ForecastModelSelect-350"><span class="linenos">350</span></a>                <span class="n">best_overall</span> <span class="o">=</span> <span class="n">overall_score</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ForecastModelSelect-351"><a href="#ForecastModelSelect-351"><span class="linenos">351</span></a>                <span class="n">_s_best_x_overall</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">overall_score</span><span class="o">.</span><span class="n">index</span><span class="p">[:</span><span class="n">nbest</span><span class="p">])</span>
</span><span id="ForecastModelSelect-352"><a href="#ForecastModelSelect-352"><span class="linenos">352</span></a>
</span><span id="ForecastModelSelect-353"><a href="#ForecastModelSelect-353"><span class="linenos">353</span></a>                <span class="c1"># Summary Model average</span>
</span><span id="ForecastModelSelect-354"><a href="#ForecastModelSelect-354"><span class="linenos">354</span></a>                <span class="n">_avg_oos_horizon</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">r</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">best_overall</span><span class="p">],</span>
</span><span id="ForecastModelSelect-355"><a href="#ForecastModelSelect-355"><span class="linenos">355</span></a>                                            <span class="n">r</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
</span><span id="ForecastModelSelect-356"><a href="#ForecastModelSelect-356"><span class="linenos">356</span></a>                                            <span class="n">r</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">_s_best_x_overall</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
</span><span id="ForecastModelSelect-357"><a href="#ForecastModelSelect-357"><span class="linenos">357</span></a>                                            <span class="n">r</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">nsmallest</span><span class="p">(</span><span class="n">nbest</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
</span><span id="ForecastModelSelect-358"><a href="#ForecastModelSelect-358"><span class="linenos">358</span></a>                                            <span class="n">r</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> 
</span><span id="ForecastModelSelect-359"><a href="#ForecastModelSelect-359"><span class="linenos">359</span></a>                                            <span class="p">],</span> 
</span><span id="ForecastModelSelect-360"><a href="#ForecastModelSelect-360"><span class="linenos">360</span></a>                                            <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ForecastModelSelect-361"><a href="#ForecastModelSelect-361"><span class="linenos">361</span></a>                                            <span class="s1">&#39;Best Model (over all)&#39;</span><span class="p">,</span>
</span><span id="ForecastModelSelect-362"><a href="#ForecastModelSelect-362"><span class="linenos">362</span></a>                                            <span class="s1">&#39;Best Model (per horizon)&#39;</span><span class="p">,</span>
</span><span id="ForecastModelSelect-363"><a href="#ForecastModelSelect-363"><span class="linenos">363</span></a>                                            <span class="sa">f</span><span class="s1">&#39;Best </span><span class="si">{</span><span class="n">nbest</span><span class="si">}</span><span class="s1"> Models (over all)&#39;</span><span class="p">,</span>
</span><span id="ForecastModelSelect-364"><a href="#ForecastModelSelect-364"><span class="linenos">364</span></a>                                            <span class="sa">f</span><span class="s1">&#39;Best </span><span class="si">{</span><span class="n">nbest</span><span class="si">}</span><span class="s1"> Models (per horizon)&#39;</span><span class="p">,</span>
</span><span id="ForecastModelSelect-365"><a href="#ForecastModelSelect-365"><span class="linenos">365</span></a>                                            <span class="s1">&#39;Model Avg (all models)&#39;</span>
</span><span id="ForecastModelSelect-366"><a href="#ForecastModelSelect-366"><span class="linenos">366</span></a>                                            <span class="p">],</span> 
</span><span id="ForecastModelSelect-367"><a href="#ForecastModelSelect-367"><span class="linenos">367</span></a>                                            <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="ForecastModelSelect-368"><a href="#ForecastModelSelect-368"><span class="linenos">368</span></a>
</span><span id="ForecastModelSelect-369"><a href="#ForecastModelSelect-369"><span class="linenos">369</span></a>                <span class="n">avg_oos_horizon</span><span class="p">[</span><span class="n">_s</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">r</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">_avg_oos_horizon</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ForecastModelSelect-370"><a href="#ForecastModelSelect-370"><span class="linenos">370</span></a>
</span><span id="ForecastModelSelect-371"><a href="#ForecastModelSelect-371"><span class="linenos">371</span></a>                <span class="c1"># Compute the rank of the models per horizon</span>
</span><span id="ForecastModelSelect-372"><a href="#ForecastModelSelect-372"><span class="linenos">372</span></a>                <span class="n">_rank_perhorizon</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">nsmallest</span><span class="p">(</span><span class="n">nevals</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>\
</span><span id="ForecastModelSelect-373"><a href="#ForecastModelSelect-373"><span class="linenos">373</span></a>                    <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Best_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nevals</span><span class="p">)})</span>
</span><span id="ForecastModelSelect-374"><a href="#ForecastModelSelect-374"><span class="linenos">374</span></a>                <span class="n">model_rank_perhorizon</span><span class="p">[</span><span class="n">_s</span><span class="p">]</span> <span class="o">=</span> <span class="n">_rank_perhorizon</span>
</span><span id="ForecastModelSelect-375"><a href="#ForecastModelSelect-375"><span class="linenos">375</span></a>                <span class="n">best_x_overall</span><span class="p">[</span><span class="n">_s</span><span class="p">]</span> <span class="o">=</span> <span class="n">_s_best_x_overall</span>
</span><span id="ForecastModelSelect-376"><a href="#ForecastModelSelect-376"><span class="linenos">376</span></a>            
</span><span id="ForecastModelSelect-377"><a href="#ForecastModelSelect-377"><span class="linenos">377</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_best_x_overall</span> <span class="o">=</span> <span class="n">best_x_overall</span>
</span><span id="ForecastModelSelect-378"><a href="#ForecastModelSelect-378"><span class="linenos">378</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">model_rank_perhorizon</span> <span class="o">=</span> <span class="n">model_rank_perhorizon</span>
</span><span id="ForecastModelSelect-379"><a href="#ForecastModelSelect-379"><span class="linenos">379</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_avg_oos_horizon</span> <span class="o">=</span> <span class="n">avg_oos_horizon</span>
</span><span id="ForecastModelSelect-380"><a href="#ForecastModelSelect-380"><span class="linenos">380</span></a>
</span><span id="ForecastModelSelect-381"><a href="#ForecastModelSelect-381"><span class="linenos">381</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_rank_perhorizon</span><span class="p">[</span><span class="n">score</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_avg_oos_horizon</span><span class="p">[</span><span class="n">score</span><span class="p">]</span>
</span><span id="ForecastModelSelect-382"><a href="#ForecastModelSelect-382"><span class="linenos">382</span></a>
</span><span id="ForecastModelSelect-383"><a href="#ForecastModelSelect-383"><span class="linenos">383</span></a>    <span class="k">def</span> <span class="nf">summary_per_cutoff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="ForecastModelSelect-384"><a href="#ForecastModelSelect-384"><span class="linenos">384</span></a>                       <span class="n">score</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ForecastModelSelect-385"><a href="#ForecastModelSelect-385"><span class="linenos">385</span></a>                      <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="ForecastModelSelect-386"><a href="#ForecastModelSelect-386"><span class="linenos">386</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect-387"><a href="#ForecastModelSelect-387"><span class="linenos">387</span></a><span class="sd">        Calculate and return the out-of-sample performance based on cutoffs.</span>
</span><span id="ForecastModelSelect-388"><a href="#ForecastModelSelect-388"><span class="linenos">388</span></a>
</span><span id="ForecastModelSelect-389"><a href="#ForecastModelSelect-389"><span class="linenos">389</span></a><span class="sd">        Parameters:</span>
</span><span id="ForecastModelSelect-390"><a href="#ForecastModelSelect-390"><span class="linenos">390</span></a><span class="sd">        -----------        </span>
</span><span id="ForecastModelSelect-391"><a href="#ForecastModelSelect-391"><span class="linenos">391</span></a><span class="sd">            score : str, optional</span>
</span><span id="ForecastModelSelect-392"><a href="#ForecastModelSelect-392"><span class="linenos">392</span></a><span class="sd">                The performance metric to use for model comparison. Should be either &#39;RMSE&#39; or &#39;MAPE&#39;. Default is None and it takes the value entered at initialization.</span>
</span><span id="ForecastModelSelect-393"><a href="#ForecastModelSelect-393"><span class="linenos">393</span></a><span class="sd">            nbest : int, optional</span>
</span><span id="ForecastModelSelect-394"><a href="#ForecastModelSelect-394"><span class="linenos">394</span></a><span class="sd">                The number of best models to select based on horizon performance. Default is None and it takes the value entered at initialization.</span>
</span><span id="ForecastModelSelect-395"><a href="#ForecastModelSelect-395"><span class="linenos">395</span></a>
</span><span id="ForecastModelSelect-396"><a href="#ForecastModelSelect-396"><span class="linenos">396</span></a><span class="sd">        Returns:</span>
</span><span id="ForecastModelSelect-397"><a href="#ForecastModelSelect-397"><span class="linenos">397</span></a><span class="sd">        --------        </span>
</span><span id="ForecastModelSelect-398"><a href="#ForecastModelSelect-398"><span class="linenos">398</span></a><span class="sd">            pd.DataFrame</span>
</span><span id="ForecastModelSelect-399"><a href="#ForecastModelSelect-399"><span class="linenos">399</span></a><span class="sd">                A DataFrame containing the out-of-sample performance per horizon and per model based on the specified score and nbest values.</span>
</span><span id="ForecastModelSelect-400"><a href="#ForecastModelSelect-400"><span class="linenos">400</span></a><span class="sd">        &quot;&quot;&quot;</span>    
</span><span id="ForecastModelSelect-401"><a href="#ForecastModelSelect-401"><span class="linenos">401</span></a>        <span class="k">if</span> <span class="n">score</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect-402"><a href="#ForecastModelSelect-402"><span class="linenos">402</span></a>            <span class="n">score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score</span>
</span><span id="ForecastModelSelect-403"><a href="#ForecastModelSelect-403"><span class="linenos">403</span></a>        
</span><span id="ForecastModelSelect-404"><a href="#ForecastModelSelect-404"><span class="linenos">404</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary_cutoff</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect-405"><a href="#ForecastModelSelect-405"><span class="linenos">405</span></a>            <span class="n">nbest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nbest</span>
</span><span id="ForecastModelSelect-406"><a href="#ForecastModelSelect-406"><span class="linenos">406</span></a>            <span class="n">nevals</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="p">)</span>
</span><span id="ForecastModelSelect-407"><a href="#ForecastModelSelect-407"><span class="linenos">407</span></a>            <span class="k">if</span> <span class="n">nbest</span> <span class="o">&gt;</span> <span class="n">nevals</span><span class="p">:</span>
</span><span id="ForecastModelSelect-408"><a href="#ForecastModelSelect-408"><span class="linenos">408</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">nbest =</span><span class="si">{</span><span class="n">nbest</span><span class="si">}</span><span class="s1"> is higher than the number of models evaluated </span><span class="si">{</span><span class="n">nevals</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ForecastModelSelect-409"><a href="#ForecastModelSelect-409"><span class="linenos">409</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The average performance of best models will be computed on </span><span class="si">{</span><span class="n">nevals</span><span class="si">}</span><span class="s1"> models instead&#39;</span><span class="p">)</span>
</span><span id="ForecastModelSelect-410"><a href="#ForecastModelSelect-410"><span class="linenos">410</span></a>                <span class="n">nbest</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">nbest</span><span class="p">,</span> <span class="n">nevals</span><span class="p">)</span>
</span><span id="ForecastModelSelect-411"><a href="#ForecastModelSelect-411"><span class="linenos">411</span></a>
</span><span id="ForecastModelSelect-412"><a href="#ForecastModelSelect-412"><span class="linenos">412</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_models</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect-413"><a href="#ForecastModelSelect-413"><span class="linenos">413</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Run evaluate ...&#39;</span><span class="p">)</span>
</span><span id="ForecastModelSelect-414"><a href="#ForecastModelSelect-414"><span class="linenos">414</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">()</span>
</span><span id="ForecastModelSelect-415"><a href="#ForecastModelSelect-415"><span class="linenos">415</span></a>
</span><span id="ForecastModelSelect-416"><a href="#ForecastModelSelect-416"><span class="linenos">416</span></a>            <span class="n">avg_oos_hist</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ForecastModelSelect-417"><a href="#ForecastModelSelect-417"><span class="linenos">417</span></a>            <span class="n">_perf_metrics</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">summary_horizon</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="ForecastModelSelect-418"><a href="#ForecastModelSelect-418"><span class="linenos">418</span></a>            <span class="k">for</span> <span class="n">_s</span> <span class="ow">in</span> <span class="n">_perf_metrics</span><span class="p">:</span>
</span><span id="ForecastModelSelect-419"><a href="#ForecastModelSelect-419"><span class="linenos">419</span></a>                <span class="n">_oos</span> <span class="o">=</span> <span class="p">{</span><span class="n">_lf_eval</span><span class="o">.</span><span class="n">forecaster_name</span><span class="p">:</span> <span class="n">_lf_eval</span><span class="o">.</span><span class="n">_oos_cutoff_perf</span><span class="p">[</span><span class="n">_s</span><span class="p">]</span> <span class="k">for</span> <span class="n">_lf_eval</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_models</span><span class="p">}</span>
</span><span id="ForecastModelSelect-420"><a href="#ForecastModelSelect-420"><span class="linenos">420</span></a>                <span class="n">_oos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">_oos</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span>  <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span> <span class="n">_oos</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="ForecastModelSelect-421"><a href="#ForecastModelSelect-421"><span class="linenos">421</span></a>
</span><span id="ForecastModelSelect-422"><a href="#ForecastModelSelect-422"><span class="linenos">422</span></a>                <span class="n">best_mod</span> <span class="o">=</span> <span class="n">_oos</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
</span><span id="ForecastModelSelect-423"><a href="#ForecastModelSelect-423"><span class="linenos">423</span></a>                <span class="n">nbest_mods</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">_oos</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">nsmallest</span><span class="p">(</span><span class="n">nbest</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</span><span id="ForecastModelSelect-424"><a href="#ForecastModelSelect-424"><span class="linenos">424</span></a>                <span class="n">_aggs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">_oos</span><span class="p">[</span><span class="n">best_mod</span><span class="p">],</span> <span class="n">_oos</span><span class="p">[</span><span class="n">nbest_mods</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">_oos</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="ForecastModelSelect-425"><a href="#ForecastModelSelect-425"><span class="linenos">425</span></a>                                  <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Best Model (over all)&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Best </span><span class="si">{</span><span class="n">nbest</span><span class="si">}</span><span class="s1"> Models (over all)&#39;</span><span class="p">,</span><span class="s1">&#39;Model Avg (all models)&#39;</span><span class="p">])</span>
</span><span id="ForecastModelSelect-426"><a href="#ForecastModelSelect-426"><span class="linenos">426</span></a>                <span class="n">avg_oos_hist</span><span class="p">[</span><span class="n">_s</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">_oos</span><span class="p">,</span> <span class="n">_aggs</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ForecastModelSelect-427"><a href="#ForecastModelSelect-427"><span class="linenos">427</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">summary_cutoff</span> <span class="o">=</span> <span class="n">avg_oos_hist</span>
</span><span id="ForecastModelSelect-428"><a href="#ForecastModelSelect-428"><span class="linenos">428</span></a>        
</span><span id="ForecastModelSelect-429"><a href="#ForecastModelSelect-429"><span class="linenos">429</span></a>        <span class="k">return</span> <span class="n">avg_oos_hist</span><span class="p">[</span><span class="n">score</span><span class="p">]</span>
</span><span id="ForecastModelSelect-430"><a href="#ForecastModelSelect-430"><span class="linenos">430</span></a>
</span><span id="ForecastModelSelect-431"><a href="#ForecastModelSelect-431"><span class="linenos">431</span></a>    <span class="k">def</span> <span class="nf">__stage_X</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="ForecastModelSelect-432"><a href="#ForecastModelSelect-432"><span class="linenos">432</span></a>                  <span class="n">LF</span><span class="p">:</span><span class="n">Forecast</span><span class="p">,</span>
</span><span id="ForecastModelSelect-433"><a href="#ForecastModelSelect-433"><span class="linenos">433</span></a>                  <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>
</span><span id="ForecastModelSelect-434"><a href="#ForecastModelSelect-434"><span class="linenos">434</span></a>                  <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect-435"><a href="#ForecastModelSelect-435"><span class="linenos">435</span></a>        <span class="k">if</span> <span class="n">LF</span><span class="o">.</span><span class="n">_X</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect-436"><a href="#ForecastModelSelect-436"><span class="linenos">436</span></a>            <span class="n">_lf_exogs</span> <span class="o">=</span> <span class="n">LF</span><span class="o">.</span><span class="n">_X</span><span class="o">.</span><span class="n">columns</span>
</span><span id="ForecastModelSelect-437"><a href="#ForecastModelSelect-437"><span class="linenos">437</span></a>            <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="n">_ex</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">_ex</span> <span class="ow">in</span> <span class="n">_lf_exogs</span><span class="p">]),</span> <span class="sa">f</span><span class="s1">&#39;Some exogenous variables are missing for model </span><span class="si">{</span><span class="n">LF</span><span class="o">.</span><span class="n">forecaster_name</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="ForecastModelSelect-438"><a href="#ForecastModelSelect-438"><span class="linenos">438</span></a>            <span class="n">_lf_X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">_lf_exogs</span><span class="p">]</span>
</span><span id="ForecastModelSelect-439"><a href="#ForecastModelSelect-439"><span class="linenos">439</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ForecastModelSelect-440"><a href="#ForecastModelSelect-440"><span class="linenos">440</span></a>            <span class="n">_lf_X</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ForecastModelSelect-441"><a href="#ForecastModelSelect-441"><span class="linenos">441</span></a>        <span class="k">return</span> <span class="n">_lf_X</span>
</span><span id="ForecastModelSelect-442"><a href="#ForecastModelSelect-442"><span class="linenos">442</span></a>        
</span><span id="ForecastModelSelect-443"><a href="#ForecastModelSelect-443"><span class="linenos">443</span></a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="ForecastModelSelect-444"><a href="#ForecastModelSelect-444"><span class="linenos">444</span></a>                <span class="n">X</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
</span><span id="ForecastModelSelect-445"><a href="#ForecastModelSelect-445"><span class="linenos">445</span></a>                <span class="n">fh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ForecastingHorizon</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ForecastModelSelect-446"><a href="#ForecastModelSelect-446"><span class="linenos">446</span></a>                <span class="n">coverage</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span>
</span><span id="ForecastModelSelect-447"><a href="#ForecastModelSelect-447"><span class="linenos">447</span></a>                <span class="n">mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ForecastModelSelect-448"><a href="#ForecastModelSelect-448"><span class="linenos">448</span></a>                <span class="n">score</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ForecastModelSelect-449"><a href="#ForecastModelSelect-449"><span class="linenos">449</span></a>                <span class="n">model_name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ForecastModelSelect-450"><a href="#ForecastModelSelect-450"><span class="linenos">450</span></a>                <span class="n">ret_underlying</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ForecastModelSelect-451"><a href="#ForecastModelSelect-451"><span class="linenos">451</span></a>               <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
</span><span id="ForecastModelSelect-452"><a href="#ForecastModelSelect-452"><span class="linenos">452</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect-453"><a href="#ForecastModelSelect-453"><span class="linenos">453</span></a><span class="sd">        Make forecasts using the specified aggregation mode.</span>
</span><span id="ForecastModelSelect-454"><a href="#ForecastModelSelect-454"><span class="linenos">454</span></a>
</span><span id="ForecastModelSelect-455"><a href="#ForecastModelSelect-455"><span class="linenos">455</span></a><span class="sd">        Parameters:</span>
</span><span id="ForecastModelSelect-456"><a href="#ForecastModelSelect-456"><span class="linenos">456</span></a><span class="sd">        -----------        </span>
</span><span id="ForecastModelSelect-457"><a href="#ForecastModelSelect-457"><span class="linenos">457</span></a><span class="sd">            X : pd.DataFrame, optional</span>
</span><span id="ForecastModelSelect-458"><a href="#ForecastModelSelect-458"><span class="linenos">458</span></a><span class="sd">                The exogenous variables used for prediction. Default is None and it takes the value entered at initialization..</span>
</span><span id="ForecastModelSelect-459"><a href="#ForecastModelSelect-459"><span class="linenos">459</span></a><span class="sd">            fh : ForecastingHorizon, optional</span>
</span><span id="ForecastModelSelect-460"><a href="#ForecastModelSelect-460"><span class="linenos">460</span></a><span class="sd">                The forecasting horizon. Default is None and it takes the value entered at initialization..</span>
</span><span id="ForecastModelSelect-461"><a href="#ForecastModelSelect-461"><span class="linenos">461</span></a><span class="sd">            coverage : float, optional</span>
</span><span id="ForecastModelSelect-462"><a href="#ForecastModelSelect-462"><span class="linenos">462</span></a><span class="sd">                The prediction interval coverage. Default is 0.9.</span>
</span><span id="ForecastModelSelect-463"><a href="#ForecastModelSelect-463"><span class="linenos">463</span></a><span class="sd">            mode : str, optional</span>
</span><span id="ForecastModelSelect-464"><a href="#ForecastModelSelect-464"><span class="linenos">464</span></a><span class="sd">                The aggregation mode for predictions. Default is None and it takes the value entered at initialization.. </span>
</span><span id="ForecastModelSelect-465"><a href="#ForecastModelSelect-465"><span class="linenos">465</span></a><span class="sd">                Available values:</span>
</span><span id="ForecastModelSelect-466"><a href="#ForecastModelSelect-466"><span class="linenos">466</span></a><span class="sd">                * &#39;best&#39;: The prediction is based on the best model.</span>
</span><span id="ForecastModelSelect-467"><a href="#ForecastModelSelect-467"><span class="linenos">467</span></a><span class="sd">                * &#39;best_horizon&#39;: The prediction is based on the best model for each horizon.</span>
</span><span id="ForecastModelSelect-468"><a href="#ForecastModelSelect-468"><span class="linenos">468</span></a><span class="sd">                * &#39;average&#39;: The average of the prediction of all models.</span>
</span><span id="ForecastModelSelect-469"><a href="#ForecastModelSelect-469"><span class="linenos">469</span></a><span class="sd">                * &#39;inverse_score&#39;: The weighted average prediction, where weights are inversely proportional to the model performance score.</span>
</span><span id="ForecastModelSelect-470"><a href="#ForecastModelSelect-470"><span class="linenos">470</span></a><span class="sd">                * &#39;nbest_average&#39;: Average of the n best models. The n is given by the parameter nbest.</span>
</span><span id="ForecastModelSelect-471"><a href="#ForecastModelSelect-471"><span class="linenos">471</span></a><span class="sd">                * &#39;nbest_average_horizon&#39;: Average of the n best models for each horizon. The n is given by the parameter nbest.</span>
</span><span id="ForecastModelSelect-472"><a href="#ForecastModelSelect-472"><span class="linenos">472</span></a><span class="sd">                * &#39;model&#39;: Returns the prediction of a specific model. The model name must be provided in the model_name parameter.</span>
</span><span id="ForecastModelSelect-473"><a href="#ForecastModelSelect-473"><span class="linenos">473</span></a><span class="sd">            score : str, optional</span>
</span><span id="ForecastModelSelect-474"><a href="#ForecastModelSelect-474"><span class="linenos">474</span></a><span class="sd">                The performance metric to use for model comparison. Should be either &#39;RMSE&#39; or &#39;MAPE&#39;. Default is None and it takes the value entered at initialization..</span>
</span><span id="ForecastModelSelect-475"><a href="#ForecastModelSelect-475"><span class="linenos">475</span></a><span class="sd">            nbest : int, optional</span>
</span><span id="ForecastModelSelect-476"><a href="#ForecastModelSelect-476"><span class="linenos">476</span></a><span class="sd">                The number of best models to select based on horizon performance. Default is None and it takes the value entered at initialization..</span>
</span><span id="ForecastModelSelect-477"><a href="#ForecastModelSelect-477"><span class="linenos">477</span></a><span class="sd">            model_name: str, optional</span>
</span><span id="ForecastModelSelect-478"><a href="#ForecastModelSelect-478"><span class="linenos">478</span></a><span class="sd">                The model name to use for prediction if mode=&#39;model&#39;. Default is None.</span>
</span><span id="ForecastModelSelect-479"><a href="#ForecastModelSelect-479"><span class="linenos">479</span></a><span class="sd">            ret_underlying : bool, optional</span>
</span><span id="ForecastModelSelect-480"><a href="#ForecastModelSelect-480"><span class="linenos">480</span></a><span class="sd">                If True, return the underlying predictions and prediction intervals for each model. Default is False.</span>
</span><span id="ForecastModelSelect-481"><a href="#ForecastModelSelect-481"><span class="linenos">481</span></a>
</span><span id="ForecastModelSelect-482"><a href="#ForecastModelSelect-482"><span class="linenos">482</span></a><span class="sd">        Returns:</span>
</span><span id="ForecastModelSelect-483"><a href="#ForecastModelSelect-483"><span class="linenos">483</span></a><span class="sd">        --------        </span>
</span><span id="ForecastModelSelect-484"><a href="#ForecastModelSelect-484"><span class="linenos">484</span></a><span class="sd">            tuple</span>
</span><span id="ForecastModelSelect-485"><a href="#ForecastModelSelect-485"><span class="linenos">485</span></a><span class="sd">                A tuple containing the aggregated prediction and prediction intervals.</span>
</span><span id="ForecastModelSelect-486"><a href="#ForecastModelSelect-486"><span class="linenos">486</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect-487"><a href="#ForecastModelSelect-487"><span class="linenos">487</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect-488"><a href="#ForecastModelSelect-488"><span class="linenos">488</span></a>            <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span>
</span><span id="ForecastModelSelect-489"><a href="#ForecastModelSelect-489"><span class="linenos">489</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;model&#39;</span><span class="p">:</span>
</span><span id="ForecastModelSelect-490"><a href="#ForecastModelSelect-490"><span class="linenos">490</span></a>            <span class="k">assert</span> <span class="n">model_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="s1">&#39;Model name not in the list of models&#39;</span>
</span><span id="ForecastModelSelect-491"><a href="#ForecastModelSelect-491"><span class="linenos">491</span></a>            <span class="n">_lf_X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__stage_X</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="p">[</span><span class="n">model_name</span><span class="p">],</span> <span class="n">X</span><span class="p">)</span>
</span><span id="ForecastModelSelect-492"><a href="#ForecastModelSelect-492"><span class="linenos">492</span></a>            <span class="n">pred</span><span class="p">,</span> <span class="n">pred_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">_lf_X</span><span class="p">,</span> <span class="n">fh</span><span class="o">=</span><span class="n">fh</span><span class="p">,</span> <span class="n">coverage</span><span class="o">=</span><span class="n">coverage</span><span class="p">)</span>
</span><span id="ForecastModelSelect-493"><a href="#ForecastModelSelect-493"><span class="linenos">493</span></a>            <span class="k">if</span> <span class="n">ret_underlying</span><span class="p">:</span>
</span><span id="ForecastModelSelect-494"><a href="#ForecastModelSelect-494"><span class="linenos">494</span></a>                <span class="k">return</span> <span class="n">pred</span><span class="p">,</span> <span class="n">pred_int</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="ForecastModelSelect-495"><a href="#ForecastModelSelect-495"><span class="linenos">495</span></a>            <span class="k">else</span><span class="p">:</span> 
</span><span id="ForecastModelSelect-496"><a href="#ForecastModelSelect-496"><span class="linenos">496</span></a>                <span class="k">return</span> <span class="n">pred</span><span class="p">,</span> <span class="n">pred_int</span>
</span><span id="ForecastModelSelect-497"><a href="#ForecastModelSelect-497"><span class="linenos">497</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ForecastModelSelect-498"><a href="#ForecastModelSelect-498"><span class="linenos">498</span></a>            <span class="n">preds</span> <span class="o">=</span> <span class="p">{};</span> <span class="n">pred_ints</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ForecastModelSelect-499"><a href="#ForecastModelSelect-499"><span class="linenos">499</span></a>            <span class="k">for</span> <span class="n">_fname</span><span class="p">,</span> <span class="n">_lf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ForecastModelSelect-500"><a href="#ForecastModelSelect-500"><span class="linenos">500</span></a>                <span class="n">_lf_X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__stage_X</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="p">[</span><span class="n">_fname</span><span class="p">],</span> <span class="n">X</span><span class="p">)</span>                
</span><span id="ForecastModelSelect-501"><a href="#ForecastModelSelect-501"><span class="linenos">501</span></a>                <span class="n">_y_pred</span><span class="p">,</span> <span class="n">_y_pred_ints</span> <span class="o">=</span> <span class="n">_lf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">_lf_X</span><span class="p">,</span> <span class="n">fh</span><span class="o">=</span><span class="n">fh</span><span class="p">,</span> <span class="n">coverage</span><span class="o">=</span><span class="n">coverage</span><span class="p">)</span>
</span><span id="ForecastModelSelect-502"><a href="#ForecastModelSelect-502"><span class="linenos">502</span></a>                <span class="n">preds</span><span class="p">[</span><span class="n">_fname</span><span class="p">]</span> <span class="o">=</span> <span class="n">_y_pred</span>
</span><span id="ForecastModelSelect-503"><a href="#ForecastModelSelect-503"><span class="linenos">503</span></a>                <span class="n">pred_ints</span><span class="p">[</span><span class="n">_fname</span><span class="p">]</span> <span class="o">=</span><span class="n">_y_pred_ints</span>
</span><span id="ForecastModelSelect-504"><a href="#ForecastModelSelect-504"><span class="linenos">504</span></a>
</span><span id="ForecastModelSelect-505"><a href="#ForecastModelSelect-505"><span class="linenos">505</span></a>            <span class="n">preds</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">preds</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">keys</span> <span class="o">=</span> <span class="n">preds</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ForecastModelSelect-506"><a href="#ForecastModelSelect-506"><span class="linenos">506</span></a>            <span class="n">pred_ints</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">pred_ints</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">keys</span> <span class="o">=</span> <span class="n">pred_ints</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ForecastModelSelect-507"><a href="#ForecastModelSelect-507"><span class="linenos">507</span></a>
</span><span id="ForecastModelSelect-508"><a href="#ForecastModelSelect-508"><span class="linenos">508</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__aggregate_pred</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">preds</span><span class="o">=</span><span class="n">preds</span><span class="p">,</span> <span class="n">pred_ints</span><span class="o">=</span><span class="n">pred_ints</span><span class="p">,</span> <span class="n">score</span><span class="o">=</span><span class="n">score</span><span class="p">,</span> <span class="n">ret_underlying</span><span class="o">=</span><span class="n">ret_underlying</span><span class="p">)</span>
</span><span id="ForecastModelSelect-509"><a href="#ForecastModelSelect-509"><span class="linenos">509</span></a>
</span><span id="ForecastModelSelect-510"><a href="#ForecastModelSelect-510"><span class="linenos">510</span></a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="ForecastModelSelect-511"><a href="#ForecastModelSelect-511"><span class="linenos">511</span></a>               <span class="n">new_y</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
</span><span id="ForecastModelSelect-512"><a href="#ForecastModelSelect-512"><span class="linenos">512</span></a>               <span class="n">new_X</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ForecastModelSelect-513"><a href="#ForecastModelSelect-513"><span class="linenos">513</span></a>               <span class="n">refit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
</span><span id="ForecastModelSelect-514"><a href="#ForecastModelSelect-514"><span class="linenos">514</span></a>               <span class="n">reevaluate</span><span class="p">:</span><span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
</span><span id="ForecastModelSelect-515"><a href="#ForecastModelSelect-515"><span class="linenos">515</span></a>               <span class="n">fh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ForecastingHorizon</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
</span><span id="ForecastModelSelect-516"><a href="#ForecastModelSelect-516"><span class="linenos">516</span></a>               <span class="n">coverage</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span> 
</span><span id="ForecastModelSelect-517"><a href="#ForecastModelSelect-517"><span class="linenos">517</span></a>               <span class="n">mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ForecastModelSelect-518"><a href="#ForecastModelSelect-518"><span class="linenos">518</span></a>               <span class="n">score</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ForecastModelSelect-519"><a href="#ForecastModelSelect-519"><span class="linenos">519</span></a>               <span class="n">model_name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ForecastModelSelect-520"><a href="#ForecastModelSelect-520"><span class="linenos">520</span></a>               <span class="n">ret_underlying</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ForecastModelSelect-521"><a href="#ForecastModelSelect-521"><span class="linenos">521</span></a>              <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
</span><span id="ForecastModelSelect-522"><a href="#ForecastModelSelect-522"><span class="linenos">522</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect-523"><a href="#ForecastModelSelect-523"><span class="linenos">523</span></a><span class="sd">        Function to update the prediction for all the models and aggregate them based on the specific mode.</span>
</span><span id="ForecastModelSelect-524"><a href="#ForecastModelSelect-524"><span class="linenos">524</span></a>
</span><span id="ForecastModelSelect-525"><a href="#ForecastModelSelect-525"><span class="linenos">525</span></a><span class="sd">        Parameters:</span>
</span><span id="ForecastModelSelect-526"><a href="#ForecastModelSelect-526"><span class="linenos">526</span></a><span class="sd">        -----------        </span>
</span><span id="ForecastModelSelect-527"><a href="#ForecastModelSelect-527"><span class="linenos">527</span></a><span class="sd">            newdata : pd.DataFrame</span>
</span><span id="ForecastModelSelect-528"><a href="#ForecastModelSelect-528"><span class="linenos">528</span></a><span class="sd">                The new data for updating the predictions.</span>
</span><span id="ForecastModelSelect-529"><a href="#ForecastModelSelect-529"><span class="linenos">529</span></a><span class="sd">            refit : bool, optional</span>
</span><span id="ForecastModelSelect-530"><a href="#ForecastModelSelect-530"><span class="linenos">530</span></a><span class="sd">                If False, generate the prediction without fitting the model. If True, fits the underlying models again on the entire sample</span>
</span><span id="ForecastModelSelect-531"><a href="#ForecastModelSelect-531"><span class="linenos">531</span></a><span class="sd">                Default is False</span>
</span><span id="ForecastModelSelect-532"><a href="#ForecastModelSelect-532"><span class="linenos">532</span></a><span class="sd">            reevaluate: bool, optional    </span>
</span><span id="ForecastModelSelect-533"><a href="#ForecastModelSelect-533"><span class="linenos">533</span></a><span class="sd">                Reapply the cross-validateion, evaluate the models out of sample, select the best models, then aggregate the predictions according the setup.</span>
</span><span id="ForecastModelSelect-534"><a href="#ForecastModelSelect-534"><span class="linenos">534</span></a><span class="sd">                Default is False.</span>
</span><span id="ForecastModelSelect-535"><a href="#ForecastModelSelect-535"><span class="linenos">535</span></a><span class="sd">            fh : ForecastingHorizon, optional</span>
</span><span id="ForecastModelSelect-536"><a href="#ForecastModelSelect-536"><span class="linenos">536</span></a><span class="sd">                The forecasting horizon. Default is None and it takes the value entered at initialization..</span>
</span><span id="ForecastModelSelect-537"><a href="#ForecastModelSelect-537"><span class="linenos">537</span></a><span class="sd">            coverage : float, optional</span>
</span><span id="ForecastModelSelect-538"><a href="#ForecastModelSelect-538"><span class="linenos">538</span></a><span class="sd">                The prediction interval coverage. Default is 0.9.</span>
</span><span id="ForecastModelSelect-539"><a href="#ForecastModelSelect-539"><span class="linenos">539</span></a><span class="sd">            mode : str, optional</span>
</span><span id="ForecastModelSelect-540"><a href="#ForecastModelSelect-540"><span class="linenos">540</span></a><span class="sd">                The aggregation mode for predictions. Default is None and it takes the value entered at initialization..</span>
</span><span id="ForecastModelSelect-541"><a href="#ForecastModelSelect-541"><span class="linenos">541</span></a><span class="sd">                Available values:</span>
</span><span id="ForecastModelSelect-542"><a href="#ForecastModelSelect-542"><span class="linenos">542</span></a><span class="sd">                * &#39;best&#39;: The prediction is based on the best model.</span>
</span><span id="ForecastModelSelect-543"><a href="#ForecastModelSelect-543"><span class="linenos">543</span></a><span class="sd">                * &#39;best_horizon&#39;: The prediction is based on the best model for each horizon.</span>
</span><span id="ForecastModelSelect-544"><a href="#ForecastModelSelect-544"><span class="linenos">544</span></a><span class="sd">                * &#39;average&#39;: The average of the prediction of all models.</span>
</span><span id="ForecastModelSelect-545"><a href="#ForecastModelSelect-545"><span class="linenos">545</span></a><span class="sd">                * &#39;inverse_score&#39;: The weighted average prediction, where weights are inversely proportional to the model performance score.</span>
</span><span id="ForecastModelSelect-546"><a href="#ForecastModelSelect-546"><span class="linenos">546</span></a><span class="sd">                * &#39;nbest_average&#39;: Average of the n best models. The n is given by the parameter nbest.</span>
</span><span id="ForecastModelSelect-547"><a href="#ForecastModelSelect-547"><span class="linenos">547</span></a><span class="sd">                * &#39;nbest_average_horizon&#39;: Average of the n best models for each horizon. The n is given by the parameter nbest.</span>
</span><span id="ForecastModelSelect-548"><a href="#ForecastModelSelect-548"><span class="linenos">548</span></a><span class="sd">                * &#39;model&#39;: Returns the prediction of a specific model. The model name must be provided in the model_name parameter.</span>
</span><span id="ForecastModelSelect-549"><a href="#ForecastModelSelect-549"><span class="linenos">549</span></a><span class="sd">            score : str, optional</span>
</span><span id="ForecastModelSelect-550"><a href="#ForecastModelSelect-550"><span class="linenos">550</span></a><span class="sd">                The performance metric to use for model comparison. Should be either &#39;RMSE&#39; or &#39;MAPE&#39;. Default is None and it takes the value entered at initialization..</span>
</span><span id="ForecastModelSelect-551"><a href="#ForecastModelSelect-551"><span class="linenos">551</span></a><span class="sd">            nbest : int, optional</span>
</span><span id="ForecastModelSelect-552"><a href="#ForecastModelSelect-552"><span class="linenos">552</span></a><span class="sd">                The number of best models to select based on horizon performance. Default is None and it takes the value entered at initialization. and it takes the value entered at initialization..</span>
</span><span id="ForecastModelSelect-553"><a href="#ForecastModelSelect-553"><span class="linenos">553</span></a><span class="sd">            model_name: str, optional</span>
</span><span id="ForecastModelSelect-554"><a href="#ForecastModelSelect-554"><span class="linenos">554</span></a><span class="sd">                The model name to use for prediction if mode=&#39;model&#39;. Default is None.</span>
</span><span id="ForecastModelSelect-555"><a href="#ForecastModelSelect-555"><span class="linenos">555</span></a><span class="sd">            ret_underlying : bool, optional</span>
</span><span id="ForecastModelSelect-556"><a href="#ForecastModelSelect-556"><span class="linenos">556</span></a><span class="sd">                If True, return the underlying predictions and prediction intervals for each model. Default is False.</span>
</span><span id="ForecastModelSelect-557"><a href="#ForecastModelSelect-557"><span class="linenos">557</span></a>
</span><span id="ForecastModelSelect-558"><a href="#ForecastModelSelect-558"><span class="linenos">558</span></a><span class="sd">        Returns:</span>
</span><span id="ForecastModelSelect-559"><a href="#ForecastModelSelect-559"><span class="linenos">559</span></a><span class="sd">        -------</span>
</span><span id="ForecastModelSelect-560"><a href="#ForecastModelSelect-560"><span class="linenos">560</span></a><span class="sd">            tuple</span>
</span><span id="ForecastModelSelect-561"><a href="#ForecastModelSelect-561"><span class="linenos">561</span></a><span class="sd">                A tuple containing the aggregated prediction and prediction intervals.</span>
</span><span id="ForecastModelSelect-562"><a href="#ForecastModelSelect-562"><span class="linenos">562</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect-563"><a href="#ForecastModelSelect-563"><span class="linenos">563</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect-564"><a href="#ForecastModelSelect-564"><span class="linenos">564</span></a>            <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span>
</span><span id="ForecastModelSelect-565"><a href="#ForecastModelSelect-565"><span class="linenos">565</span></a>
</span><span id="ForecastModelSelect-566"><a href="#ForecastModelSelect-566"><span class="linenos">566</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;model&#39;</span><span class="p">:</span>
</span><span id="ForecastModelSelect-567"><a href="#ForecastModelSelect-567"><span class="linenos">567</span></a>            <span class="k">assert</span> <span class="n">model_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="s1">&#39;Model name not in the list of models&#39;</span>
</span><span id="ForecastModelSelect-568"><a href="#ForecastModelSelect-568"><span class="linenos">568</span></a>            <span class="n">_lf_X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__stage_X</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="p">[</span><span class="n">model_name</span><span class="p">],</span> <span class="n">new_X</span><span class="p">)</span>
</span><span id="ForecastModelSelect-569"><a href="#ForecastModelSelect-569"><span class="linenos">569</span></a>            <span class="n">pred</span><span class="p">,</span> <span class="n">pred_int</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">new_y</span><span class="o">=</span><span class="n">new_y</span><span class="p">,</span> <span class="n">new_X</span><span class="o">=</span><span class="n">_lf_X</span><span class="p">,</span> <span class="n">fh</span><span class="o">=</span><span class="n">fh</span><span class="p">,</span> <span class="n">coverage</span><span class="o">=</span><span class="n">coverage</span><span class="p">,</span> <span class="n">refit</span><span class="o">=</span><span class="n">refit</span><span class="p">)</span>
</span><span id="ForecastModelSelect-570"><a href="#ForecastModelSelect-570"><span class="linenos">570</span></a>            <span class="k">if</span> <span class="n">ret_underlying</span><span class="p">:</span>
</span><span id="ForecastModelSelect-571"><a href="#ForecastModelSelect-571"><span class="linenos">571</span></a>                <span class="k">return</span> <span class="n">pred</span><span class="p">,</span> <span class="n">pred_int</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="ForecastModelSelect-572"><a href="#ForecastModelSelect-572"><span class="linenos">572</span></a>            <span class="k">else</span><span class="p">:</span> 
</span><span id="ForecastModelSelect-573"><a href="#ForecastModelSelect-573"><span class="linenos">573</span></a>                <span class="k">return</span> <span class="n">pred</span><span class="p">,</span> <span class="n">pred_int</span>
</span><span id="ForecastModelSelect-574"><a href="#ForecastModelSelect-574"><span class="linenos">574</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ForecastModelSelect-575"><a href="#ForecastModelSelect-575"><span class="linenos">575</span></a>            <span class="k">if</span> <span class="n">reevaluate</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>            
</span><span id="ForecastModelSelect-576"><a href="#ForecastModelSelect-576"><span class="linenos">576</span></a>                <span class="n">preds</span> <span class="o">=</span> <span class="p">{};</span> <span class="n">pred_ints</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ForecastModelSelect-577"><a href="#ForecastModelSelect-577"><span class="linenos">577</span></a>                <span class="k">for</span> <span class="n">_lf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="ForecastModelSelect-578"><a href="#ForecastModelSelect-578"><span class="linenos">578</span></a>                    <span class="n">_lf_X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__stage_X</span><span class="p">(</span><span class="n">_lf</span><span class="p">,</span> <span class="n">new_X</span><span class="p">)</span>
</span><span id="ForecastModelSelect-579"><a href="#ForecastModelSelect-579"><span class="linenos">579</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="ForecastModelSelect-580"><a href="#ForecastModelSelect-580"><span class="linenos">580</span></a>                        <span class="n">_y_pred</span><span class="p">,</span> <span class="n">_y_pred_ints</span> <span class="o">=</span> <span class="n">_lf</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">new_y</span><span class="o">=</span><span class="n">new_y</span><span class="p">,</span> <span class="n">new_X</span><span class="o">=</span><span class="n">_lf_X</span><span class="p">,</span> 
</span><span id="ForecastModelSelect-581"><a href="#ForecastModelSelect-581"><span class="linenos">581</span></a>                                                           <span class="n">fh</span><span class="o">=</span><span class="n">fh</span><span class="p">,</span> <span class="n">coverage</span><span class="o">=</span><span class="n">coverage</span><span class="p">,</span> <span class="n">refit</span><span class="o">=</span><span class="n">refit</span><span class="p">)</span>
</span><span id="ForecastModelSelect-582"><a href="#ForecastModelSelect-582"><span class="linenos">582</span></a>                        <span class="n">preds</span><span class="p">[</span><span class="n">_lf</span><span class="o">.</span><span class="n">forecaster_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">_y_pred</span>
</span><span id="ForecastModelSelect-583"><a href="#ForecastModelSelect-583"><span class="linenos">583</span></a>                        <span class="n">pred_ints</span><span class="p">[</span><span class="n">_lf</span><span class="o">.</span><span class="n">forecaster_name</span><span class="p">]</span> <span class="o">=</span><span class="n">_y_pred_ints</span>
</span><span id="ForecastModelSelect-584"><a href="#ForecastModelSelect-584"><span class="linenos">584</span></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="ForecastModelSelect-585"><a href="#ForecastModelSelect-585"><span class="linenos">585</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error updating </span><span class="si">{</span><span class="n">_lf</span><span class="o">.</span><span class="n">forecaster_name</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ForecastModelSelect-586"><a href="#ForecastModelSelect-586"><span class="linenos">586</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;model </span><span class="si">{</span><span class="n">_lf</span><span class="o">.</span><span class="n">forecaster_name</span><span class="si">}</span><span class="s2"> cannot be updated. It won&#39;t be considered for forecasts&quot;</span><span class="p">)</span>
</span><span id="ForecastModelSelect-587"><a href="#ForecastModelSelect-587"><span class="linenos">587</span></a>                        <span class="k">continue</span>                   
</span><span id="ForecastModelSelect-588"><a href="#ForecastModelSelect-588"><span class="linenos">588</span></a>
</span><span id="ForecastModelSelect-589"><a href="#ForecastModelSelect-589"><span class="linenos">589</span></a>                <span class="n">preds</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">preds</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">keys</span> <span class="o">=</span> <span class="n">preds</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ForecastModelSelect-590"><a href="#ForecastModelSelect-590"><span class="linenos">590</span></a>                <span class="n">pred_ints</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">pred_ints</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">keys</span> <span class="o">=</span> <span class="n">pred_ints</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ForecastModelSelect-591"><a href="#ForecastModelSelect-591"><span class="linenos">591</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__aggregate_pred</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">preds</span><span class="o">=</span><span class="n">preds</span><span class="p">,</span> <span class="n">pred_ints</span><span class="o">=</span><span class="n">pred_ints</span><span class="p">,</span> <span class="n">score</span><span class="o">=</span><span class="n">score</span><span class="p">,</span> <span class="n">ret_underlying</span><span class="o">=</span><span class="n">ret_underlying</span><span class="p">)</span>
</span><span id="ForecastModelSelect-592"><a href="#ForecastModelSelect-592"><span class="linenos">592</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ForecastModelSelect-593"><a href="#ForecastModelSelect-593"><span class="linenos">593</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ForecastModelSelect-594"><a href="#ForecastModelSelect-594"><span class="linenos">594</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">select_best</span><span class="p">(</span><span class="n">score</span> <span class="o">=</span> <span class="n">score</span><span class="p">,</span> <span class="n">reestimate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ForecastModelSelect-595"><a href="#ForecastModelSelect-595"><span class="linenos">595</span></a>                <span class="n">preds</span> <span class="o">=</span> <span class="p">{};</span> <span class="n">pred_ints</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ForecastModelSelect-596"><a href="#ForecastModelSelect-596"><span class="linenos">596</span></a>                <span class="k">for</span> <span class="n">_lf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="ForecastModelSelect-597"><a href="#ForecastModelSelect-597"><span class="linenos">597</span></a>                    <span class="n">_lf_X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__stage_X</span><span class="p">(</span><span class="n">_lf</span><span class="p">,</span> <span class="n">new_X</span><span class="p">)</span>
</span><span id="ForecastModelSelect-598"><a href="#ForecastModelSelect-598"><span class="linenos">598</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="ForecastModelSelect-599"><a href="#ForecastModelSelect-599"><span class="linenos">599</span></a>                        <span class="n">_y_pred</span><span class="p">,</span> <span class="n">_y_pred_ints</span> <span class="o">=</span> <span class="n">_lf</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">new_y</span><span class="o">=</span><span class="n">new_y</span><span class="p">,</span> <span class="n">new_X</span><span class="o">=</span><span class="n">_lf_X</span><span class="p">,</span> <span class="n">fh</span><span class="o">=</span><span class="n">fh</span><span class="p">,</span> <span class="n">coverage</span><span class="o">=</span><span class="n">coverage</span><span class="p">,</span> <span class="n">refit</span><span class="o">=</span><span class="n">refit</span><span class="p">)</span>
</span><span id="ForecastModelSelect-600"><a href="#ForecastModelSelect-600"><span class="linenos">600</span></a>                        <span class="n">preds</span><span class="p">[</span><span class="n">_lf</span><span class="o">.</span><span class="n">forecaster_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">_y_pred</span>
</span><span id="ForecastModelSelect-601"><a href="#ForecastModelSelect-601"><span class="linenos">601</span></a>                        <span class="n">pred_ints</span><span class="p">[</span><span class="n">_lf</span><span class="o">.</span><span class="n">forecaster_name</span><span class="p">]</span> <span class="o">=</span><span class="n">_y_pred_ints</span>
</span><span id="ForecastModelSelect-602"><a href="#ForecastModelSelect-602"><span class="linenos">602</span></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="ForecastModelSelect-603"><a href="#ForecastModelSelect-603"><span class="linenos">603</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error updating </span><span class="si">{</span><span class="n">_lf</span><span class="o">.</span><span class="n">forecaster_name</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ForecastModelSelect-604"><a href="#ForecastModelSelect-604"><span class="linenos">604</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;model </span><span class="si">{</span><span class="n">_lf</span><span class="o">.</span><span class="n">forecaster_name</span><span class="si">}</span><span class="s1"> cannot be updated. It will be considered for forecasts&#39;</span><span class="p">)</span>
</span><span id="ForecastModelSelect-605"><a href="#ForecastModelSelect-605"><span class="linenos">605</span></a>                        <span class="k">continue</span>                   
</span><span id="ForecastModelSelect-606"><a href="#ForecastModelSelect-606"><span class="linenos">606</span></a>                <span class="n">preds</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">preds</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">keys</span> <span class="o">=</span> <span class="n">preds</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ForecastModelSelect-607"><a href="#ForecastModelSelect-607"><span class="linenos">607</span></a>                <span class="n">pred_ints</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">pred_ints</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">keys</span> <span class="o">=</span> <span class="n">pred_ints</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ForecastModelSelect-608"><a href="#ForecastModelSelect-608"><span class="linenos">608</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__aggregate_pred</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">preds</span><span class="o">=</span><span class="n">preds</span><span class="p">,</span> <span class="n">pred_ints</span><span class="o">=</span><span class="n">pred_ints</span><span class="p">,</span> <span class="n">score</span><span class="o">=</span><span class="n">score</span><span class="p">,</span> <span class="n">ret_underlying</span><span class="o">=</span><span class="n">ret_underlying</span><span class="p">)</span>
</span><span id="ForecastModelSelect-609"><a href="#ForecastModelSelect-609"><span class="linenos">609</span></a>
</span><span id="ForecastModelSelect-610"><a href="#ForecastModelSelect-610"><span class="linenos">610</span></a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="ForecastModelSelect-611"><a href="#ForecastModelSelect-611"><span class="linenos">611</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect-612"><a href="#ForecastModelSelect-612"><span class="linenos">612</span></a><span class="sd">        Save the model to a file.</span>
</span><span id="ForecastModelSelect-613"><a href="#ForecastModelSelect-613"><span class="linenos">613</span></a><span class="sd">        Parameters:</span>
</span><span id="ForecastModelSelect-614"><a href="#ForecastModelSelect-614"><span class="linenos">614</span></a><span class="sd">        -----------</span>
</span><span id="ForecastModelSelect-615"><a href="#ForecastModelSelect-615"><span class="linenos">615</span></a><span class="sd">            path : str</span>
</span><span id="ForecastModelSelect-616"><a href="#ForecastModelSelect-616"><span class="linenos">616</span></a><span class="sd">                The path to save the model.</span>
</span><span id="ForecastModelSelect-617"><a href="#ForecastModelSelect-617"><span class="linenos">617</span></a><span class="sd">        Returns:</span>
</span><span id="ForecastModelSelect-618"><a href="#ForecastModelSelect-618"><span class="linenos">618</span></a><span class="sd">        --------</span>
</span><span id="ForecastModelSelect-619"><a href="#ForecastModelSelect-619"><span class="linenos">619</span></a><span class="sd">            None</span>
</span><span id="ForecastModelSelect-620"><a href="#ForecastModelSelect-620"><span class="linenos">620</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect-621"><a href="#ForecastModelSelect-621"><span class="linenos">621</span></a>        <span class="kn">import</span> <span class="nn">pickle</span>
</span><span id="ForecastModelSelect-622"><a href="#ForecastModelSelect-622"><span class="linenos">622</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="ForecastModelSelect-623"><a href="#ForecastModelSelect-623"><span class="linenos">623</span></a>            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="ForecastModelSelect-624"><a href="#ForecastModelSelect-624"><span class="linenos">624</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="ForecastModelSelect-625"><a href="#ForecastModelSelect-625"><span class="linenos">625</span></a>    
</span><span id="ForecastModelSelect-626"><a href="#ForecastModelSelect-626"><span class="linenos">626</span></a>    <span class="k">def</span> <span class="nf">get_pred_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="ForecastModelSelect-627"><a href="#ForecastModelSelect-627"><span class="linenos">627</span></a>                        <span class="n">mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ForecastModelSelect-628"><a href="#ForecastModelSelect-628"><span class="linenos">628</span></a>                        <span class="n">score</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ForecastModelSelect-629"><a href="#ForecastModelSelect-629"><span class="linenos">629</span></a>                        <span class="n">model_name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
</span><span id="ForecastModelSelect-630"><a href="#ForecastModelSelect-630"><span class="linenos">630</span></a>                        <span class="p">):</span>
</span><span id="ForecastModelSelect-631"><a href="#ForecastModelSelect-631"><span class="linenos">631</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect-632"><a href="#ForecastModelSelect-632"><span class="linenos">632</span></a><span class="sd">        Get the prediction errors.</span>
</span><span id="ForecastModelSelect-633"><a href="#ForecastModelSelect-633"><span class="linenos">633</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect-634"><a href="#ForecastModelSelect-634"><span class="linenos">634</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect-635"><a href="#ForecastModelSelect-635"><span class="linenos">635</span></a>            <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span>
</span><span id="ForecastModelSelect-636"><a href="#ForecastModelSelect-636"><span class="linenos">636</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;model&#39;</span><span class="p">:</span>
</span><span id="ForecastModelSelect-637"><a href="#ForecastModelSelect-637"><span class="linenos">637</span></a>            <span class="k">assert</span> <span class="n">model_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="s1">&#39;Model name not in the list of models&#39;</span>
</span><span id="ForecastModelSelect-638"><a href="#ForecastModelSelect-638"><span class="linenos">638</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span><span class="o">.</span><span class="n">get_pred_errors</span><span class="p">()</span>
</span><span id="ForecastModelSelect-639"><a href="#ForecastModelSelect-639"><span class="linenos">639</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ForecastModelSelect-640"><a href="#ForecastModelSelect-640"><span class="linenos">640</span></a>            <span class="k">if</span> <span class="n">score</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect-641"><a href="#ForecastModelSelect-641"><span class="linenos">641</span></a>                <span class="n">score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score</span>
</span><span id="ForecastModelSelect-642"><a href="#ForecastModelSelect-642"><span class="linenos">642</span></a>            
</span><span id="ForecastModelSelect-643"><a href="#ForecastModelSelect-643"><span class="linenos">643</span></a>            <span class="c1"># Using ProcessPoolExecutor to execute computation-heavy tasks in parallel</span>
</span><span id="ForecastModelSelect-644"><a href="#ForecastModelSelect-644"><span class="linenos">644</span></a>            <span class="k">with</span> <span class="n">ProcessPoolExecutor</span><span class="p">()</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
</span><span id="ForecastModelSelect-645"><a href="#ForecastModelSelect-645"><span class="linenos">645</span></a>                <span class="n">results</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">fetch_errors</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</span><span id="ForecastModelSelect-646"><a href="#ForecastModelSelect-646"><span class="linenos">646</span></a>            <span class="n">errors</span> <span class="o">=</span> <span class="p">{</span><span class="n">fname</span><span class="p">:</span> <span class="n">err</span> <span class="k">for</span> <span class="n">fname</span><span class="p">,</span> <span class="n">err</span> <span class="ow">in</span> <span class="n">results</span><span class="p">}</span>
</span><span id="ForecastModelSelect-647"><a href="#ForecastModelSelect-647"><span class="linenos">647</span></a>            <span class="k">for</span> <span class="n">_fname</span><span class="p">,</span> <span class="n">_lf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ForecastModelSelect-648"><a href="#ForecastModelSelect-648"><span class="linenos">648</span></a>                <span class="n">_lf</span><span class="o">.</span><span class="n">_fitted</span><span class="o">.</span><span class="n">insample_result_df</span> <span class="o">=</span> <span class="n">errors</span><span class="p">[</span><span class="n">_fname</span><span class="p">]</span>
</span><span id="ForecastModelSelect-649"><a href="#ForecastModelSelect-649"><span class="linenos">649</span></a>
</span><span id="ForecastModelSelect-650"><a href="#ForecastModelSelect-650"><span class="linenos">650</span></a>            <span class="c1"># Convert results to dictionary            </span>
</span><span id="ForecastModelSelect-651"><a href="#ForecastModelSelect-651"><span class="linenos">651</span></a>            <span class="n">errors_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">errors</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">keys</span> <span class="o">=</span> <span class="n">errors</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="ForecastModelSelect-652"><a href="#ForecastModelSelect-652"><span class="linenos">652</span></a>            <span class="n">errors_df</span> <span class="o">=</span> <span class="n">errors_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;level_0&#39;</span><span class="p">:</span> <span class="s1">&#39;forecaster&#39;</span><span class="p">})</span>
</span><span id="ForecastModelSelect-653"><a href="#ForecastModelSelect-653"><span class="linenos">653</span></a>
</span><span id="ForecastModelSelect-654"><a href="#ForecastModelSelect-654"><span class="linenos">654</span></a>
</span><span id="ForecastModelSelect-655"><a href="#ForecastModelSelect-655"><span class="linenos">655</span></a>            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span><span class="s1">&#39;best&#39;</span><span class="p">:</span>
</span><span id="ForecastModelSelect-656"><a href="#ForecastModelSelect-656"><span class="linenos">656</span></a>                <span class="k">return</span> <span class="n">errors</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_best_x_overall</span><span class="p">[</span><span class="n">score</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ForecastModelSelect-657"><a href="#ForecastModelSelect-657"><span class="linenos">657</span></a>            
</span><span id="ForecastModelSelect-658"><a href="#ForecastModelSelect-658"><span class="linenos">658</span></a>            <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span><span class="s1">&#39;best_horizon&#39;</span><span class="p">:</span>
</span><span id="ForecastModelSelect-659"><a href="#ForecastModelSelect-659"><span class="linenos">659</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_rank_perhorizon</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect-660"><a href="#ForecastModelSelect-660"><span class="linenos">660</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">select_best</span><span class="p">()</span>
</span><span id="ForecastModelSelect-661"><a href="#ForecastModelSelect-661"><span class="linenos">661</span></a>                <span class="n">best_horizon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_rank_perhorizon</span><span class="p">[</span><span class="n">score</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Best_1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span><span id="ForecastModelSelect-662"><a href="#ForecastModelSelect-662"><span class="linenos">662</span></a>                <span class="n">error_horizon_l</span> <span class="o">=</span> <span class="p">[</span><span class="n">errors</span><span class="p">[</span><span class="n">best_mod_h</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">errors</span><span class="p">[</span><span class="n">best_mod_h</span><span class="p">][</span><span class="s1">&#39;horizon&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">h</span><span class="p">]</span> <span class="k">for</span> <span class="n">h</span><span class="p">,</span> <span class="n">best_mod_h</span> <span class="ow">in</span> <span class="n">best_horizon</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
</span><span id="ForecastModelSelect-663"><a href="#ForecastModelSelect-663"><span class="linenos">663</span></a>                <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">error_horizon_l</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ForecastModelSelect-664"><a href="#ForecastModelSelect-664"><span class="linenos">664</span></a>            
</span><span id="ForecastModelSelect-665"><a href="#ForecastModelSelect-665"><span class="linenos">665</span></a>            <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span><span class="s1">&#39;average&#39;</span><span class="p">:</span>
</span><span id="ForecastModelSelect-666"><a href="#ForecastModelSelect-666"><span class="linenos">666</span></a>                <span class="k">return</span> <span class="n">errors_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;cutoff&#39;</span><span class="p">,</span> <span class="s1">&#39;horizon&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>               
</span><span id="ForecastModelSelect-667"><a href="#ForecastModelSelect-667"><span class="linenos">667</span></a>            
</span><span id="ForecastModelSelect-668"><a href="#ForecastModelSelect-668"><span class="linenos">668</span></a>            <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span><span class="s1">&#39;inverse_score&#39;</span><span class="p">:</span>
</span><span id="ForecastModelSelect-669"><a href="#ForecastModelSelect-669"><span class="linenos">669</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary_results</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect-670"><a href="#ForecastModelSelect-670"><span class="linenos">670</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">()</span>
</span><span id="ForecastModelSelect-671"><a href="#ForecastModelSelect-671"><span class="linenos">671</span></a>                <span class="n">_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;Avg </span><span class="si">{</span><span class="n">score</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>
</span><span id="ForecastModelSelect-672"><a href="#ForecastModelSelect-672"><span class="linenos">672</span></a>                <span class="n">_score</span> <span class="o">=</span> <span class="n">_score</span><span class="o">/</span><span class="n">_score</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="ForecastModelSelect-673"><a href="#ForecastModelSelect-673"><span class="linenos">673</span></a>                <span class="n">errors_df</span><span class="p">[</span><span class="s1">&#39;_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">errors_df</span><span class="p">[</span><span class="s1">&#39;forecaster&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">_score</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>
</span><span id="ForecastModelSelect-674"><a href="#ForecastModelSelect-674"><span class="linenos">674</span></a>                <span class="n">errors_df</span><span class="p">[</span><span class="s1">&#39;weighted_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">errors_df</span><span class="p">[</span><span class="s1">&#39;_score&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">errors_df</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span>
</span><span id="ForecastModelSelect-675"><a href="#ForecastModelSelect-675"><span class="linenos">675</span></a>                <span class="k">return</span> <span class="n">errors_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;cutoff&#39;</span><span class="p">,</span> <span class="s1">&#39;horizon&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">weighted_error</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="ForecastModelSelect-676"><a href="#ForecastModelSelect-676"><span class="linenos">676</span></a>            
</span><span id="ForecastModelSelect-677"><a href="#ForecastModelSelect-677"><span class="linenos">677</span></a>            <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span><span class="s1">&#39;nbest_average&#39;</span><span class="p">:</span>
</span><span id="ForecastModelSelect-678"><a href="#ForecastModelSelect-678"><span class="linenos">678</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_best_x_overall</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect-679"><a href="#ForecastModelSelect-679"><span class="linenos">679</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">select_best</span><span class="p">()</span>
</span><span id="ForecastModelSelect-680"><a href="#ForecastModelSelect-680"><span class="linenos">680</span></a>                <span class="k">return</span> <span class="n">errors_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">errors_df</span><span class="o">.</span><span class="n">forecaster</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_best_x_overall</span><span class="p">[</span><span class="n">score</span><span class="p">])]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;cutoff&#39;</span><span class="p">,</span> <span class="s1">&#39;horizon&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="ForecastModelSelect-681"><a href="#ForecastModelSelect-681"><span class="linenos">681</span></a>            
</span><span id="ForecastModelSelect-682"><a href="#ForecastModelSelect-682"><span class="linenos">682</span></a>            <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span><span class="s1">&#39;nbest_average_horizon&#39;</span><span class="p">:</span>
</span><span id="ForecastModelSelect-683"><a href="#ForecastModelSelect-683"><span class="linenos">683</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_rank_perhorizon</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect-684"><a href="#ForecastModelSelect-684"><span class="linenos">684</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">select_best</span><span class="p">()</span>
</span><span id="ForecastModelSelect-685"><a href="#ForecastModelSelect-685"><span class="linenos">685</span></a>                <span class="n">best_horizon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_rank_perhorizon</span><span class="p">[</span><span class="n">score</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">_nbest</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
</span><span id="ForecastModelSelect-686"><a href="#ForecastModelSelect-686"><span class="linenos">686</span></a>                <span class="n">best_horizon</span> <span class="o">=</span> <span class="n">best_horizon</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span><span id="ForecastModelSelect-687"><a href="#ForecastModelSelect-687"><span class="linenos">687</span></a>                <span class="n">errors_best_horizon</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ForecastModelSelect-688"><a href="#ForecastModelSelect-688"><span class="linenos">688</span></a>                <span class="k">for</span> <span class="n">h</span><span class="p">,</span> <span class="n">best_mod_h</span> <span class="ow">in</span> <span class="n">best_horizon</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ForecastModelSelect-689"><a href="#ForecastModelSelect-689"><span class="linenos">689</span></a>                    <span class="n">errors_best_horizon</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">errors_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">errors_df</span><span class="o">.</span><span class="n">horizon</span><span class="o">==</span><span class="n">h</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">errors_df</span><span class="o">.</span><span class="n">forecaster</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">best_mod_h</span><span class="p">)]</span>\
</span><span id="ForecastModelSelect-690"><a href="#ForecastModelSelect-690"><span class="linenos">690</span></a>                        <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;cutoff&#39;</span><span class="p">,</span> <span class="s1">&#39;horizon&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">())</span>
</span><span id="ForecastModelSelect-691"><a href="#ForecastModelSelect-691"><span class="linenos">691</span></a>                <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">errors_best_horizon</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>            
</span><span id="ForecastModelSelect-692"><a href="#ForecastModelSelect-692"><span class="linenos">692</span></a>            
</span><span id="ForecastModelSelect-693"><a href="#ForecastModelSelect-693"><span class="linenos">693</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ForecastModelSelect-694"><a href="#ForecastModelSelect-694"><span class="linenos">694</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;mode can take the foloowing values: best, best_horizon, average, inverse_score, nbest_average, nbest_average_horizon, model&#39;</span><span class="p">)</span>        
</span><span id="ForecastModelSelect-695"><a href="#ForecastModelSelect-695"><span class="linenos">695</span></a>    
</span><span id="ForecastModelSelect-696"><a href="#ForecastModelSelect-696"><span class="linenos">696</span></a>    <span class="k">def</span> <span class="nf">plot_model_compare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="ForecastModelSelect-697"><a href="#ForecastModelSelect-697"><span class="linenos">697</span></a>                           <span class="n">score</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> 
</span><span id="ForecastModelSelect-698"><a href="#ForecastModelSelect-698"><span class="linenos">698</span></a>                           <span class="n">view</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;horizon&#39;</span><span class="p">,</span> 
</span><span id="ForecastModelSelect-699"><a href="#ForecastModelSelect-699"><span class="linenos">699</span></a>                           <span class="n">model_subset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ForecastModelSelect-700"><a href="#ForecastModelSelect-700"><span class="linenos">700</span></a>                           <span class="n">xlabel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
</span><span id="ForecastModelSelect-701"><a href="#ForecastModelSelect-701"><span class="linenos">701</span></a>                           <span class="n">ylabel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ForecastModelSelect-702"><a href="#ForecastModelSelect-702"><span class="linenos">702</span></a>                           <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Out of Sample Performance&#39;</span><span class="p">,</span> 
</span><span id="ForecastModelSelect-703"><a href="#ForecastModelSelect-703"><span class="linenos">703</span></a>                           <span class="n">ax</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
</span><span id="ForecastModelSelect-704"><a href="#ForecastModelSelect-704"><span class="linenos">704</span></a>                           <span class="n">figsize</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</span><span id="ForecastModelSelect-705"><a href="#ForecastModelSelect-705"><span class="linenos">705</span></a>                          <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]:</span>
</span><span id="ForecastModelSelect-706"><a href="#ForecastModelSelect-706"><span class="linenos">706</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect-707"><a href="#ForecastModelSelect-707"><span class="linenos">707</span></a><span class="sd">        Plot a comparison of models based on their out-of-sample performance.</span>
</span><span id="ForecastModelSelect-708"><a href="#ForecastModelSelect-708"><span class="linenos">708</span></a>
</span><span id="ForecastModelSelect-709"><a href="#ForecastModelSelect-709"><span class="linenos">709</span></a><span class="sd">        Parameters:</span>
</span><span id="ForecastModelSelect-710"><a href="#ForecastModelSelect-710"><span class="linenos">710</span></a><span class="sd">        -----------        </span>
</span><span id="ForecastModelSelect-711"><a href="#ForecastModelSelect-711"><span class="linenos">711</span></a><span class="sd">            score : str, optional</span>
</span><span id="ForecastModelSelect-712"><a href="#ForecastModelSelect-712"><span class="linenos">712</span></a><span class="sd">                The performance metric for comparison. Should be either &#39;RMSE&#39; or &#39;MAPE&#39;. Default is &#39;RMSE&#39;.</span>
</span><span id="ForecastModelSelect-713"><a href="#ForecastModelSelect-713"><span class="linenos">713</span></a><span class="sd">            view : str, optional</span>
</span><span id="ForecastModelSelect-714"><a href="#ForecastModelSelect-714"><span class="linenos">714</span></a><span class="sd">                The view mode for comparison, either &#39;horizon&#39; or &#39;cutoff&#39;. Default is &#39;horizon&#39;.</span>
</span><span id="ForecastModelSelect-715"><a href="#ForecastModelSelect-715"><span class="linenos">715</span></a><span class="sd">            xlabel : str, optional</span>
</span><span id="ForecastModelSelect-716"><a href="#ForecastModelSelect-716"><span class="linenos">716</span></a><span class="sd">                The label for the x-axis. Default is an empty string.</span>
</span><span id="ForecastModelSelect-717"><a href="#ForecastModelSelect-717"><span class="linenos">717</span></a><span class="sd">            ylabel : str, optional</span>
</span><span id="ForecastModelSelect-718"><a href="#ForecastModelSelect-718"><span class="linenos">718</span></a><span class="sd">                The label for the y-axis. Default is an empty string.</span>
</span><span id="ForecastModelSelect-719"><a href="#ForecastModelSelect-719"><span class="linenos">719</span></a><span class="sd">            title : str, optional</span>
</span><span id="ForecastModelSelect-720"><a href="#ForecastModelSelect-720"><span class="linenos">720</span></a><span class="sd">                The title of the plot. Default is &#39;Out of Sample Performance&#39;.</span>
</span><span id="ForecastModelSelect-721"><a href="#ForecastModelSelect-721"><span class="linenos">721</span></a><span class="sd">            ax : matplotlib.axes._subplots.AxesSubplot, optional</span>
</span><span id="ForecastModelSelect-722"><a href="#ForecastModelSelect-722"><span class="linenos">722</span></a><span class="sd">                The matplotlib axes to use for plotting. Default is None.</span>
</span><span id="ForecastModelSelect-723"><a href="#ForecastModelSelect-723"><span class="linenos">723</span></a><span class="sd">            figsize : tuple, optional</span>
</span><span id="ForecastModelSelect-724"><a href="#ForecastModelSelect-724"><span class="linenos">724</span></a><span class="sd">                The size of the figure in inches (width, height). Default is (15, 6).</span>
</span><span id="ForecastModelSelect-725"><a href="#ForecastModelSelect-725"><span class="linenos">725</span></a>
</span><span id="ForecastModelSelect-726"><a href="#ForecastModelSelect-726"><span class="linenos">726</span></a><span class="sd">        Returns:</span>
</span><span id="ForecastModelSelect-727"><a href="#ForecastModelSelect-727"><span class="linenos">727</span></a><span class="sd">        --------        </span>
</span><span id="ForecastModelSelect-728"><a href="#ForecastModelSelect-728"><span class="linenos">728</span></a><span class="sd">            matplotlib.figure.Figure or matplotlib.axes._subplots.AxesSubplot</span>
</span><span id="ForecastModelSelect-729"><a href="#ForecastModelSelect-729"><span class="linenos">729</span></a><span class="sd">                The figure and axes of the plot.</span>
</span><span id="ForecastModelSelect-730"><a href="#ForecastModelSelect-730"><span class="linenos">730</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect-731"><a href="#ForecastModelSelect-731"><span class="linenos">731</span></a>        
</span><span id="ForecastModelSelect-732"><a href="#ForecastModelSelect-732"><span class="linenos">732</span></a>        <span class="k">if</span> <span class="n">view</span> <span class="o">==</span><span class="s1">&#39;horizon&#39;</span><span class="p">:</span>
</span><span id="ForecastModelSelect-733"><a href="#ForecastModelSelect-733"><span class="linenos">733</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_avg_oos_horizon</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect-734"><a href="#ForecastModelSelect-734"><span class="linenos">734</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">select_best</span><span class="p">()</span>
</span><span id="ForecastModelSelect-735"><a href="#ForecastModelSelect-735"><span class="linenos">735</span></a>            <span class="n">toplot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_avg_oos_horizon</span><span class="p">[</span><span class="n">score</span><span class="p">]</span>
</span><span id="ForecastModelSelect-736"><a href="#ForecastModelSelect-736"><span class="linenos">736</span></a>
</span><span id="ForecastModelSelect-737"><a href="#ForecastModelSelect-737"><span class="linenos">737</span></a>        <span class="k">elif</span> <span class="n">view</span><span class="o">==</span><span class="s1">&#39;cutoff&#39;</span><span class="p">:</span>
</span><span id="ForecastModelSelect-738"><a href="#ForecastModelSelect-738"><span class="linenos">738</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary_cutoff</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect-739"><a href="#ForecastModelSelect-739"><span class="linenos">739</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">summary_per_cutoff</span><span class="p">()</span>
</span><span id="ForecastModelSelect-740"><a href="#ForecastModelSelect-740"><span class="linenos">740</span></a>            <span class="n">toplot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary_cutoff</span><span class="p">[</span><span class="n">score</span><span class="p">]</span>
</span><span id="ForecastModelSelect-741"><a href="#ForecastModelSelect-741"><span class="linenos">741</span></a>
</span><span id="ForecastModelSelect-742"><a href="#ForecastModelSelect-742"><span class="linenos">742</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ForecastModelSelect-743"><a href="#ForecastModelSelect-743"><span class="linenos">743</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;view can take only 2 values: horizon or cutoff&#39;</span><span class="p">)</span>
</span><span id="ForecastModelSelect-744"><a href="#ForecastModelSelect-744"><span class="linenos">744</span></a>
</span><span id="ForecastModelSelect-745"><a href="#ForecastModelSelect-745"><span class="linenos">745</span></a>        <span class="k">if</span> <span class="n">model_subset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect-746"><a href="#ForecastModelSelect-746"><span class="linenos">746</span></a>            <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="n">m</span> <span class="ow">in</span> <span class="n">toplot</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">model_subset</span><span class="p">]),</span> <span class="s1">&#39;Some models are not in the list of models&#39;</span>
</span><span id="ForecastModelSelect-747"><a href="#ForecastModelSelect-747"><span class="linenos">747</span></a>            <span class="n">toplot</span> <span class="o">=</span> <span class="n">toplot</span><span class="p">[</span><span class="n">model_subset</span><span class="p">]</span>
</span><span id="ForecastModelSelect-748"><a href="#ForecastModelSelect-748"><span class="linenos">748</span></a>        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect-749"><a href="#ForecastModelSelect-749"><span class="linenos">749</span></a>            <span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
</span><span id="ForecastModelSelect-750"><a href="#ForecastModelSelect-750"><span class="linenos">750</span></a>        <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect-751"><a href="#ForecastModelSelect-751"><span class="linenos">751</span></a>            <span class="n">ylabel</span> <span class="o">=</span> <span class="n">score</span>
</span><span id="ForecastModelSelect-752"><a href="#ForecastModelSelect-752"><span class="linenos">752</span></a>        <span class="k">if</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect-753"><a href="#ForecastModelSelect-753"><span class="linenos">753</span></a>            <span class="n">xlabel</span> <span class="o">=</span> <span class="n">view</span>
</span><span id="ForecastModelSelect-754"><a href="#ForecastModelSelect-754"><span class="linenos">754</span></a>        
</span><span id="ForecastModelSelect-755"><a href="#ForecastModelSelect-755"><span class="linenos">755</span></a>        <span class="n">nseries</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">toplot</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</span><span id="ForecastModelSelect-756"><a href="#ForecastModelSelect-756"><span class="linenos">756</span></a>        <span class="k">def</span> <span class="nf">expand_color_palette</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">n_colors_needed</span><span class="p">):</span>
</span><span id="ForecastModelSelect-757"><a href="#ForecastModelSelect-757"><span class="linenos">757</span></a>            <span class="n">base_array</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">n_colors</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">))</span>
</span><span id="ForecastModelSelect-758"><a href="#ForecastModelSelect-758"><span class="linenos">758</span></a>            <span class="n">color_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">base_array</span><span class="p">)</span>
</span><span id="ForecastModelSelect-759"><a href="#ForecastModelSelect-759"><span class="linenos">759</span></a>            
</span><span id="ForecastModelSelect-760"><a href="#ForecastModelSelect-760"><span class="linenos">760</span></a>            <span class="c1"># Interpolating colors</span>
</span><span id="ForecastModelSelect-761"><a href="#ForecastModelSelect-761"><span class="linenos">761</span></a>            <span class="n">new_colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">color_array</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">n_colors_needed</span><span class="p">),</span>
</span><span id="ForecastModelSelect-762"><a href="#ForecastModelSelect-762"><span class="linenos">762</span></a>                                            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">color_array</span><span class="p">)),</span> <span class="n">color_array</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span>
</span><span id="ForecastModelSelect-763"><a href="#ForecastModelSelect-763"><span class="linenos">763</span></a>                                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">color_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])])</span><span class="o">.</span><span class="n">T</span>
</span><span id="ForecastModelSelect-764"><a href="#ForecastModelSelect-764"><span class="linenos">764</span></a>            <span class="k">return</span> <span class="n">new_colors</span>
</span><span id="ForecastModelSelect-765"><a href="#ForecastModelSelect-765"><span class="linenos">765</span></a>
</span><span id="ForecastModelSelect-766"><a href="#ForecastModelSelect-766"><span class="linenos">766</span></a>        <span class="c1"># Get the initial colorblind palette</span>
</span><span id="ForecastModelSelect-767"><a href="#ForecastModelSelect-767"><span class="linenos">767</span></a>        <span class="n">initial_palette</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;colorblind&quot;</span><span class="p">)</span>
</span><span id="ForecastModelSelect-768"><a href="#ForecastModelSelect-768"><span class="linenos">768</span></a>
</span><span id="ForecastModelSelect-769"><a href="#ForecastModelSelect-769"><span class="linenos">769</span></a>        <span class="c1"># Expand the palette if more colors are needed</span>
</span><span id="ForecastModelSelect-770"><a href="#ForecastModelSelect-770"><span class="linenos">770</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">initial_palette</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">nseries</span><span class="p">:</span>
</span><span id="ForecastModelSelect-771"><a href="#ForecastModelSelect-771"><span class="linenos">771</span></a>            <span class="n">expanded_colors</span> <span class="o">=</span> <span class="n">expand_color_palette</span><span class="p">(</span><span class="s2">&quot;colorblind&quot;</span><span class="p">,</span> <span class="n">n_colors_needed</span><span class="o">=</span><span class="n">nseries</span><span class="p">)</span>
</span><span id="ForecastModelSelect-772"><a href="#ForecastModelSelect-772"><span class="linenos">772</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ForecastModelSelect-773"><a href="#ForecastModelSelect-773"><span class="linenos">773</span></a>            <span class="n">expanded_colors</span> <span class="o">=</span> <span class="n">initial_palette</span>
</span><span id="ForecastModelSelect-774"><a href="#ForecastModelSelect-774"><span class="linenos">774</span></a>
</span><span id="ForecastModelSelect-775"><a href="#ForecastModelSelect-775"><span class="linenos">775</span></a>        <span class="n">toplot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span> <span class="n">expanded_colors</span><span class="p">)</span>
</span><span id="ForecastModelSelect-776"><a href="#ForecastModelSelect-776"><span class="linenos">776</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span> <span class="o">=</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>
</span><span id="ForecastModelSelect-777"><a href="#ForecastModelSelect-777"><span class="linenos">777</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;xx-large&quot;</span><span class="p">)</span>
</span><span id="ForecastModelSelect-778"><a href="#ForecastModelSelect-778"><span class="linenos">778</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="ForecastModelSelect-779"><a href="#ForecastModelSelect-779"><span class="linenos">779</span></a>        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect-780"><a href="#ForecastModelSelect-780"><span class="linenos">780</span></a>            <span class="k">return</span> <span class="n">f</span><span class="p">,</span> <span class="n">ax</span>
</span><span id="ForecastModelSelect-781"><a href="#ForecastModelSelect-781"><span class="linenos">781</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ForecastModelSelect-782"><a href="#ForecastModelSelect-782"><span class="linenos">782</span></a>            <span class="k">return</span> <span class="n">ax</span>
</span><span id="ForecastModelSelect-783"><a href="#ForecastModelSelect-783"><span class="linenos">783</span></a>
</span><span id="ForecastModelSelect-784"><a href="#ForecastModelSelect-784"><span class="linenos">784</span></a>    <span class="k">def</span> <span class="nf">plot_prediction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="ForecastModelSelect-785"><a href="#ForecastModelSelect-785"><span class="linenos">785</span></a>                        <span class="n">y_pred</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> 
</span><span id="ForecastModelSelect-786"><a href="#ForecastModelSelect-786"><span class="linenos">786</span></a>                        <span class="n">models_preds</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
</span><span id="ForecastModelSelect-787"><a href="#ForecastModelSelect-787"><span class="linenos">787</span></a>                        <span class="n">y_pred_interval</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
</span><span id="ForecastModelSelect-788"><a href="#ForecastModelSelect-788"><span class="linenos">788</span></a>                        <span class="n">interval_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;CI&#39;</span><span class="p">,</span> 
</span><span id="ForecastModelSelect-789"><a href="#ForecastModelSelect-789"><span class="linenos">789</span></a>                        <span class="n">aggregation_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Model Agg&#39;</span><span class="p">,</span> 
</span><span id="ForecastModelSelect-790"><a href="#ForecastModelSelect-790"><span class="linenos">790</span></a>                        <span class="n">xlabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> 
</span><span id="ForecastModelSelect-791"><a href="#ForecastModelSelect-791"><span class="linenos">791</span></a>                        <span class="n">ylabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> 
</span><span id="ForecastModelSelect-792"><a href="#ForecastModelSelect-792"><span class="linenos">792</span></a>                        <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Prediction&#39;</span><span class="p">,</span> 
</span><span id="ForecastModelSelect-793"><a href="#ForecastModelSelect-793"><span class="linenos">793</span></a>                        <span class="n">ax</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
</span><span id="ForecastModelSelect-794"><a href="#ForecastModelSelect-794"><span class="linenos">794</span></a>                        <span class="n">figsize</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</span><span id="ForecastModelSelect-795"><a href="#ForecastModelSelect-795"><span class="linenos">795</span></a>
</span><span id="ForecastModelSelect-796"><a href="#ForecastModelSelect-796"><span class="linenos">796</span></a>                       <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]:</span>
</span><span id="ForecastModelSelect-797"><a href="#ForecastModelSelect-797"><span class="linenos">797</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect-798"><a href="#ForecastModelSelect-798"><span class="linenos">798</span></a><span class="sd">        Plot forecast predictions and aggregated prediction.</span>
</span><span id="ForecastModelSelect-799"><a href="#ForecastModelSelect-799"><span class="linenos">799</span></a>
</span><span id="ForecastModelSelect-800"><a href="#ForecastModelSelect-800"><span class="linenos">800</span></a><span class="sd">        Parameters:</span>
</span><span id="ForecastModelSelect-801"><a href="#ForecastModelSelect-801"><span class="linenos">801</span></a><span class="sd">        -----------        </span>
</span><span id="ForecastModelSelect-802"><a href="#ForecastModelSelect-802"><span class="linenos">802</span></a><span class="sd">            y_pred : pd.Series</span>
</span><span id="ForecastModelSelect-803"><a href="#ForecastModelSelect-803"><span class="linenos">803</span></a><span class="sd">                The aggregated prediction.</span>
</span><span id="ForecastModelSelect-804"><a href="#ForecastModelSelect-804"><span class="linenos">804</span></a><span class="sd">            models_preds : pd.DataFrame, optional</span>
</span><span id="ForecastModelSelect-805"><a href="#ForecastModelSelect-805"><span class="linenos">805</span></a><span class="sd">                The DataFrame containing predictions from different models. Default is None.</span>
</span><span id="ForecastModelSelect-806"><a href="#ForecastModelSelect-806"><span class="linenos">806</span></a><span class="sd">            y_pred_interval : tuple, optional</span>
</span><span id="ForecastModelSelect-807"><a href="#ForecastModelSelect-807"><span class="linenos">807</span></a><span class="sd">                Prediction interval for the aggregated prediction. Default is None.</span>
</span><span id="ForecastModelSelect-808"><a href="#ForecastModelSelect-808"><span class="linenos">808</span></a><span class="sd">            interval_label : str, optional</span>
</span><span id="ForecastModelSelect-809"><a href="#ForecastModelSelect-809"><span class="linenos">809</span></a><span class="sd">                Label for the prediction interval. Default is &#39;prediction interval&#39;.</span>
</span><span id="ForecastModelSelect-810"><a href="#ForecastModelSelect-810"><span class="linenos">810</span></a><span class="sd">            aggregation_label : str, optional</span>
</span><span id="ForecastModelSelect-811"><a href="#ForecastModelSelect-811"><span class="linenos">811</span></a><span class="sd">                Label for the aggregated prediction. Default is &#39;Model Agg&#39;.</span>
</span><span id="ForecastModelSelect-812"><a href="#ForecastModelSelect-812"><span class="linenos">812</span></a><span class="sd">            xlabel : str, optional</span>
</span><span id="ForecastModelSelect-813"><a href="#ForecastModelSelect-813"><span class="linenos">813</span></a><span class="sd">                Label for the x-axis. Default is an empty string.</span>
</span><span id="ForecastModelSelect-814"><a href="#ForecastModelSelect-814"><span class="linenos">814</span></a><span class="sd">            ylabel : str, optional</span>
</span><span id="ForecastModelSelect-815"><a href="#ForecastModelSelect-815"><span class="linenos">815</span></a><span class="sd">                Label for the y-axis. Default is an empty string.</span>
</span><span id="ForecastModelSelect-816"><a href="#ForecastModelSelect-816"><span class="linenos">816</span></a><span class="sd">            title : str, optional</span>
</span><span id="ForecastModelSelect-817"><a href="#ForecastModelSelect-817"><span class="linenos">817</span></a><span class="sd">                Title of the plot. Default is &#39;Prediction&#39;.</span>
</span><span id="ForecastModelSelect-818"><a href="#ForecastModelSelect-818"><span class="linenos">818</span></a><span class="sd">            ax : matplotlib.axes._subplots.AxesSubplot, optional</span>
</span><span id="ForecastModelSelect-819"><a href="#ForecastModelSelect-819"><span class="linenos">819</span></a><span class="sd">                Matplotlib axes to use for plotting. Default is None.</span>
</span><span id="ForecastModelSelect-820"><a href="#ForecastModelSelect-820"><span class="linenos">820</span></a><span class="sd">            figsize : tuple, optional</span>
</span><span id="ForecastModelSelect-821"><a href="#ForecastModelSelect-821"><span class="linenos">821</span></a><span class="sd">                Size of the figure in inches (width, height). Default is (15, 6).</span>
</span><span id="ForecastModelSelect-822"><a href="#ForecastModelSelect-822"><span class="linenos">822</span></a>
</span><span id="ForecastModelSelect-823"><a href="#ForecastModelSelect-823"><span class="linenos">823</span></a><span class="sd">        Returns:</span>
</span><span id="ForecastModelSelect-824"><a href="#ForecastModelSelect-824"><span class="linenos">824</span></a><span class="sd">        --------        </span>
</span><span id="ForecastModelSelect-825"><a href="#ForecastModelSelect-825"><span class="linenos">825</span></a><span class="sd">            matplotlib.figure.Figure or matplotlib.axes._subplots.AxesSubplot</span>
</span><span id="ForecastModelSelect-826"><a href="#ForecastModelSelect-826"><span class="linenos">826</span></a><span class="sd">                The figure and axes of the plot.</span>
</span><span id="ForecastModelSelect-827"><a href="#ForecastModelSelect-827"><span class="linenos">827</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect-828"><a href="#ForecastModelSelect-828"><span class="linenos">828</span></a>
</span><span id="ForecastModelSelect-829"><a href="#ForecastModelSelect-829"><span class="linenos">829</span></a>        <span class="n">y</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_y</span>
</span><span id="ForecastModelSelect-830"><a href="#ForecastModelSelect-830"><span class="linenos">830</span></a>        <span class="n">y_train</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">y</span><span class="o">.</span><span class="n">index</span><span class="o">&lt;</span><span class="n">y_pred</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="ForecastModelSelect-831"><a href="#ForecastModelSelect-831"><span class="linenos">831</span></a>        <span class="n">zoom_y_train</span> <span class="o">=</span> <span class="n">y_train</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">y_pred</span><span class="p">):]</span>
</span><span id="ForecastModelSelect-832"><a href="#ForecastModelSelect-832"><span class="linenos">832</span></a>    
</span><span id="ForecastModelSelect-833"><a href="#ForecastModelSelect-833"><span class="linenos">833</span></a>        <span class="k">if</span> <span class="n">models_preds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect-834"><a href="#ForecastModelSelect-834"><span class="linenos">834</span></a>            <span class="n">model_names</span> <span class="o">=</span> <span class="n">models_preds</span><span class="o">.</span><span class="n">columns</span>
</span><span id="ForecastModelSelect-835"><a href="#ForecastModelSelect-835"><span class="linenos">835</span></a>            <span class="n">models_preds</span> <span class="o">=</span> <span class="p">[</span><span class="n">models_preds</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">model_names</span><span class="p">]</span>
</span><span id="ForecastModelSelect-836"><a href="#ForecastModelSelect-836"><span class="linenos">836</span></a>            <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">model_names</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">aggregation_label</span><span class="p">]</span>
</span><span id="ForecastModelSelect-837"><a href="#ForecastModelSelect-837"><span class="linenos">837</span></a>
</span><span id="ForecastModelSelect-838"><a href="#ForecastModelSelect-838"><span class="linenos">838</span></a>            <span class="n">plt_res</span> <span class="o">=</span> <span class="n">plot_series</span><span class="p">(</span><span class="n">zoom_y_train</span><span class="p">,</span> <span class="o">*</span><span class="n">models_preds</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span>
</span><span id="ForecastModelSelect-839"><a href="#ForecastModelSelect-839"><span class="linenos">839</span></a>                               <span class="n">labels</span> <span class="o">=</span><span class="n">labels</span><span class="p">,</span>
</span><span id="ForecastModelSelect-840"><a href="#ForecastModelSelect-840"><span class="linenos">840</span></a>                               <span class="n">xlabel</span> <span class="o">=</span><span class="n">xlabel</span><span class="p">,</span>
</span><span id="ForecastModelSelect-841"><a href="#ForecastModelSelect-841"><span class="linenos">841</span></a>                               <span class="n">ylabel</span> <span class="o">=</span><span class="n">ylabel</span><span class="p">,</span>
</span><span id="ForecastModelSelect-842"><a href="#ForecastModelSelect-842"><span class="linenos">842</span></a>                               <span class="n">title</span> <span class="o">=</span><span class="n">title</span><span class="p">,</span>
</span><span id="ForecastModelSelect-843"><a href="#ForecastModelSelect-843"><span class="linenos">843</span></a>                               <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> 
</span><span id="ForecastModelSelect-844"><a href="#ForecastModelSelect-844"><span class="linenos">844</span></a>                               <span class="n">figsize</span> <span class="o">=</span><span class="n">figsize</span><span class="p">,</span>
</span><span id="ForecastModelSelect-845"><a href="#ForecastModelSelect-845"><span class="linenos">845</span></a>                               <span class="n">pred_interval</span> <span class="o">=</span> <span class="n">y_pred_interval</span><span class="p">,</span>
</span><span id="ForecastModelSelect-846"><a href="#ForecastModelSelect-846"><span class="linenos">846</span></a>                               <span class="n">interval_label</span> <span class="o">=</span><span class="n">interval_label</span><span class="p">)</span>
</span><span id="ForecastModelSelect-847"><a href="#ForecastModelSelect-847"><span class="linenos">847</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ForecastModelSelect-848"><a href="#ForecastModelSelect-848"><span class="linenos">848</span></a>            <span class="n">plt_res</span> <span class="o">=</span> <span class="n">plot_series</span><span class="p">(</span><span class="n">zoom_y_train</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span>
</span><span id="ForecastModelSelect-849"><a href="#ForecastModelSelect-849"><span class="linenos">849</span></a>                               <span class="n">labels</span> <span class="o">=</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">aggregation_label</span><span class="p">],</span>
</span><span id="ForecastModelSelect-850"><a href="#ForecastModelSelect-850"><span class="linenos">850</span></a>                               <span class="n">xlabel</span> <span class="o">=</span><span class="n">xlabel</span><span class="p">,</span>
</span><span id="ForecastModelSelect-851"><a href="#ForecastModelSelect-851"><span class="linenos">851</span></a>                               <span class="n">ylabel</span> <span class="o">=</span><span class="n">ylabel</span><span class="p">,</span>
</span><span id="ForecastModelSelect-852"><a href="#ForecastModelSelect-852"><span class="linenos">852</span></a>                               <span class="n">title</span> <span class="o">=</span><span class="n">title</span><span class="p">,</span>
</span><span id="ForecastModelSelect-853"><a href="#ForecastModelSelect-853"><span class="linenos">853</span></a>                               <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> 
</span><span id="ForecastModelSelect-854"><a href="#ForecastModelSelect-854"><span class="linenos">854</span></a>                               <span class="n">figsize</span> <span class="o">=</span><span class="n">figsize</span><span class="p">,</span>
</span><span id="ForecastModelSelect-855"><a href="#ForecastModelSelect-855"><span class="linenos">855</span></a>                               <span class="n">pred_interval</span> <span class="o">=</span> <span class="n">y_pred_interval</span><span class="p">,</span>
</span><span id="ForecastModelSelect-856"><a href="#ForecastModelSelect-856"><span class="linenos">856</span></a>                              <span class="n">interval_label</span> <span class="o">=</span><span class="n">interval_label</span><span class="p">)</span>
</span><span id="ForecastModelSelect-857"><a href="#ForecastModelSelect-857"><span class="linenos">857</span></a>        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect-858"><a href="#ForecastModelSelect-858"><span class="linenos">858</span></a>            <span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt_res</span>
</span><span id="ForecastModelSelect-859"><a href="#ForecastModelSelect-859"><span class="linenos">859</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="ForecastModelSelect-860"><a href="#ForecastModelSelect-860"><span class="linenos">860</span></a>            <span class="k">return</span> <span class="n">f</span><span class="p">,</span> <span class="n">ax</span>
</span><span id="ForecastModelSelect-861"><a href="#ForecastModelSelect-861"><span class="linenos">861</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ForecastModelSelect-862"><a href="#ForecastModelSelect-862"><span class="linenos">862</span></a>            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt_res</span>
</span><span id="ForecastModelSelect-863"><a href="#ForecastModelSelect-863"><span class="linenos">863</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="ForecastModelSelect-864"><a href="#ForecastModelSelect-864"><span class="linenos">864</span></a>            <span class="k">return</span> <span class="n">ax</span>
</span><span id="ForecastModelSelect-865"><a href="#ForecastModelSelect-865"><span class="linenos">865</span></a>
</span><span id="ForecastModelSelect-866"><a href="#ForecastModelSelect-866"><span class="linenos">866</span></a>    <span class="k">def</span> <span class="nf">plot_train_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
</span><span id="ForecastModelSelect-867"><a href="#ForecastModelSelect-867"><span class="linenos">867</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect-868"><a href="#ForecastModelSelect-868"><span class="linenos">868</span></a><span class="sd">        Plot the training and test windows for each model.</span>
</span><span id="ForecastModelSelect-869"><a href="#ForecastModelSelect-869"><span class="linenos">869</span></a>
</span><span id="ForecastModelSelect-870"><a href="#ForecastModelSelect-870"><span class="linenos">870</span></a><span class="sd">        Parameters:</span>
</span><span id="ForecastModelSelect-871"><a href="#ForecastModelSelect-871"><span class="linenos">871</span></a><span class="sd">        -----------        </span>
</span><span id="ForecastModelSelect-872"><a href="#ForecastModelSelect-872"><span class="linenos">872</span></a><span class="sd">            kwargs</span>
</span><span id="ForecastModelSelect-873"><a href="#ForecastModelSelect-873"><span class="linenos">873</span></a><span class="sd">                Additional keyword arguments to be passed to the plot function.</span>
</span><span id="ForecastModelSelect-874"><a href="#ForecastModelSelect-874"><span class="linenos">874</span></a>
</span><span id="ForecastModelSelect-875"><a href="#ForecastModelSelect-875"><span class="linenos">875</span></a><span class="sd">        Returns:</span>
</span><span id="ForecastModelSelect-876"><a href="#ForecastModelSelect-876"><span class="linenos">876</span></a><span class="sd">        --------        </span>
</span><span id="ForecastModelSelect-877"><a href="#ForecastModelSelect-877"><span class="linenos">877</span></a><span class="sd">            fig : plt.Figure</span>
</span><span id="ForecastModelSelect-878"><a href="#ForecastModelSelect-878"><span class="linenos">878</span></a><span class="sd">                If ax was None, a new figure is created and returned</span>
</span><span id="ForecastModelSelect-879"><a href="#ForecastModelSelect-879"><span class="linenos">879</span></a><span class="sd">                If ax was not None, the same ax is returned with plot added</span>
</span><span id="ForecastModelSelect-880"><a href="#ForecastModelSelect-880"><span class="linenos">880</span></a><span class="sd">            ax : plt.Axis             </span>
</span><span id="ForecastModelSelect-881"><a href="#ForecastModelSelect-881"><span class="linenos">881</span></a><span class="sd">                Axes containing the plot             </span>
</span><span id="ForecastModelSelect-882"><a href="#ForecastModelSelect-882"><span class="linenos">882</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect-883"><a href="#ForecastModelSelect-883"><span class="linenos">883</span></a>        <span class="n">_lf</span>  <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ForecastModelSelect-884"><a href="#ForecastModelSelect-884"><span class="linenos">884</span></a>        <span class="k">return</span> <span class="n">_lf</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">plot_train_test</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="ForecastModelSelect-885"><a href="#ForecastModelSelect-885"><span class="linenos">885</span></a>    
</span><span id="ForecastModelSelect-886"><a href="#ForecastModelSelect-886"><span class="linenos">886</span></a>    <span class="k">def</span> <span class="nf">plot_cv_procedure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
</span><span id="ForecastModelSelect-887"><a href="#ForecastModelSelect-887"><span class="linenos">887</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect-888"><a href="#ForecastModelSelect-888"><span class="linenos">888</span></a><span class="sd">        Plot the cross-validation procedure for each model.</span>
</span><span id="ForecastModelSelect-889"><a href="#ForecastModelSelect-889"><span class="linenos">889</span></a>
</span><span id="ForecastModelSelect-890"><a href="#ForecastModelSelect-890"><span class="linenos">890</span></a><span class="sd">        Parameters:</span>
</span><span id="ForecastModelSelect-891"><a href="#ForecastModelSelect-891"><span class="linenos">891</span></a><span class="sd">        -----------        </span>
</span><span id="ForecastModelSelect-892"><a href="#ForecastModelSelect-892"><span class="linenos">892</span></a><span class="sd">            kwargs</span>
</span><span id="ForecastModelSelect-893"><a href="#ForecastModelSelect-893"><span class="linenos">893</span></a><span class="sd">                Additional keyword arguments to be passed to the plot function.</span>
</span><span id="ForecastModelSelect-894"><a href="#ForecastModelSelect-894"><span class="linenos">894</span></a>
</span><span id="ForecastModelSelect-895"><a href="#ForecastModelSelect-895"><span class="linenos">895</span></a><span class="sd">        Returns:</span>
</span><span id="ForecastModelSelect-896"><a href="#ForecastModelSelect-896"><span class="linenos">896</span></a><span class="sd">        --------</span>
</span><span id="ForecastModelSelect-897"><a href="#ForecastModelSelect-897"><span class="linenos">897</span></a><span class="sd">            fig : plt.Figure</span>
</span><span id="ForecastModelSelect-898"><a href="#ForecastModelSelect-898"><span class="linenos">898</span></a><span class="sd">                If ax was None, a new figure is created and returned</span>
</span><span id="ForecastModelSelect-899"><a href="#ForecastModelSelect-899"><span class="linenos">899</span></a><span class="sd">                If ax was not None, the same ax is returned with plot added</span>
</span><span id="ForecastModelSelect-900"><a href="#ForecastModelSelect-900"><span class="linenos">900</span></a><span class="sd">            ax : plt.Axis             </span>
</span><span id="ForecastModelSelect-901"><a href="#ForecastModelSelect-901"><span class="linenos">901</span></a><span class="sd">                Axes containing the plot             </span>
</span><span id="ForecastModelSelect-902"><a href="#ForecastModelSelect-902"><span class="linenos">902</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect-903"><a href="#ForecastModelSelect-903"><span class="linenos">903</span></a>        <span class="n">_lf</span>  <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ForecastModelSelect-904"><a href="#ForecastModelSelect-904"><span class="linenos">904</span></a>        <span class="k">return</span> <span class="n">_lf</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">plot_cv_procedure</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="ForecastModelSelect-905"><a href="#ForecastModelSelect-905"><span class="linenos">905</span></a>    
</span><span id="ForecastModelSelect-906"><a href="#ForecastModelSelect-906"><span class="linenos">906</span></a>    <span class="k">def</span> <span class="nf">__aggregate_pred</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">preds</span><span class="p">,</span> <span class="n">pred_ints</span><span class="p">,</span> <span class="n">score</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ret_underlying</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="ForecastModelSelect-907"><a href="#ForecastModelSelect-907"><span class="linenos">907</span></a>
</span><span id="ForecastModelSelect-908"><a href="#ForecastModelSelect-908"><span class="linenos">908</span></a>        <span class="k">if</span> <span class="n">score</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect-909"><a href="#ForecastModelSelect-909"><span class="linenos">909</span></a>            <span class="n">score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score</span>
</span><span id="ForecastModelSelect-910"><a href="#ForecastModelSelect-910"><span class="linenos">910</span></a> 
</span><span id="ForecastModelSelect-911"><a href="#ForecastModelSelect-911"><span class="linenos">911</span></a>        <span class="n">nbest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nbest</span>
</span><span id="ForecastModelSelect-912"><a href="#ForecastModelSelect-912"><span class="linenos">912</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect-913"><a href="#ForecastModelSelect-913"><span class="linenos">913</span></a>            <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span>
</span><span id="ForecastModelSelect-914"><a href="#ForecastModelSelect-914"><span class="linenos">914</span></a>
</span><span id="ForecastModelSelect-915"><a href="#ForecastModelSelect-915"><span class="linenos">915</span></a>        <span class="k">if</span>  <span class="p">(</span><span class="n">mode</span> <span class="o">!=</span><span class="s1">&#39;average&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_best_x_overall</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="ForecastModelSelect-916"><a href="#ForecastModelSelect-916"><span class="linenos">916</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">select_best</span><span class="p">(</span><span class="n">score</span> <span class="o">=</span> <span class="n">score</span><span class="p">)</span>
</span><span id="ForecastModelSelect-917"><a href="#ForecastModelSelect-917"><span class="linenos">917</span></a>
</span><span id="ForecastModelSelect-918"><a href="#ForecastModelSelect-918"><span class="linenos">918</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span><span class="s1">&#39;best&#39;</span><span class="p">:</span>
</span><span id="ForecastModelSelect-919"><a href="#ForecastModelSelect-919"><span class="linenos">919</span></a>            <span class="c1"># returns the prediction of the best model</span>
</span><span id="ForecastModelSelect-920"><a href="#ForecastModelSelect-920"><span class="linenos">920</span></a>            <span class="n">_best_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_best_x_overall</span><span class="p">[</span><span class="n">score</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ForecastModelSelect-921"><a href="#ForecastModelSelect-921"><span class="linenos">921</span></a>            <span class="n">y_pred</span> <span class="o">=</span> <span class="n">preds</span><span class="p">[</span><span class="n">_best_model</span><span class="p">]</span>            
</span><span id="ForecastModelSelect-922"><a href="#ForecastModelSelect-922"><span class="linenos">922</span></a>            <span class="k">if</span> <span class="n">_best_model</span> <span class="ow">in</span> <span class="n">pred_ints</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="ForecastModelSelect-923"><a href="#ForecastModelSelect-923"><span class="linenos">923</span></a>                <span class="n">y_pred_int</span> <span class="o">=</span> <span class="n">pred_ints</span><span class="p">[</span><span class="n">_best_model</span><span class="p">]</span>
</span><span id="ForecastModelSelect-924"><a href="#ForecastModelSelect-924"><span class="linenos">924</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ForecastModelSelect-925"><a href="#ForecastModelSelect-925"><span class="linenos">925</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Prediction intervals for </span><span class="si">{</span><span class="n">_best_model</span><span class="si">}</span><span class="s1"> are not available&#39;</span><span class="p">)</span>
</span><span id="ForecastModelSelect-926"><a href="#ForecastModelSelect-926"><span class="linenos">926</span></a>                <span class="n">y_pred_int</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="ForecastModelSelect-927"><a href="#ForecastModelSelect-927"><span class="linenos">927</span></a>
</span><span id="ForecastModelSelect-928"><a href="#ForecastModelSelect-928"><span class="linenos">928</span></a>        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;average&#39;</span><span class="p">:</span>
</span><span id="ForecastModelSelect-929"><a href="#ForecastModelSelect-929"><span class="linenos">929</span></a>            <span class="c1"># returns the average prediction of all models</span>
</span><span id="ForecastModelSelect-930"><a href="#ForecastModelSelect-930"><span class="linenos">930</span></a>            <span class="n">y_pred</span> <span class="o">=</span> <span class="n">preds</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ForecastModelSelect-931"><a href="#ForecastModelSelect-931"><span class="linenos">931</span></a>            <span class="n">y_pred_int</span> <span class="o">=</span> <span class="n">pred_ints</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="ForecastModelSelect-932"><a href="#ForecastModelSelect-932"><span class="linenos">932</span></a>
</span><span id="ForecastModelSelect-933"><a href="#ForecastModelSelect-933"><span class="linenos">933</span></a>        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;inverse_score&#39;</span><span class="p">:</span>
</span><span id="ForecastModelSelect-934"><a href="#ForecastModelSelect-934"><span class="linenos">934</span></a>            <span class="c1"># returns the Average models proportionals to performance score</span>
</span><span id="ForecastModelSelect-935"><a href="#ForecastModelSelect-935"><span class="linenos">935</span></a>            <span class="n">_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;Avg </span><span class="si">{</span><span class="n">score</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
</span><span id="ForecastModelSelect-936"><a href="#ForecastModelSelect-936"><span class="linenos">936</span></a>            <span class="n">_score</span> <span class="o">=</span> <span class="n">_score</span><span class="o">/</span><span class="n">_score</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="ForecastModelSelect-937"><a href="#ForecastModelSelect-937"><span class="linenos">937</span></a>
</span><span id="ForecastModelSelect-938"><a href="#ForecastModelSelect-938"><span class="linenos">938</span></a>            <span class="n">_weigh_preds</span> <span class="o">=</span>  <span class="n">preds</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">_score</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ForecastModelSelect-939"><a href="#ForecastModelSelect-939"><span class="linenos">939</span></a>            <span class="n">y_pred</span> <span class="o">=</span> <span class="n">_weigh_preds</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
</span><span id="ForecastModelSelect-940"><a href="#ForecastModelSelect-940"><span class="linenos">940</span></a>
</span><span id="ForecastModelSelect-941"><a href="#ForecastModelSelect-941"><span class="linenos">941</span></a>            <span class="n">_weigh_preds_ints</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ForecastModelSelect-942"><a href="#ForecastModelSelect-942"><span class="linenos">942</span></a>            <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">_score</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ForecastModelSelect-943"><a href="#ForecastModelSelect-943"><span class="linenos">943</span></a>                <span class="k">if</span> <span class="n">m</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pred_ints</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="ForecastModelSelect-944"><a href="#ForecastModelSelect-944"><span class="linenos">944</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Prediction intervals for model </span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s1"> are not available.&#39;</span><span class="p">)</span> 
</span><span id="ForecastModelSelect-945"><a href="#ForecastModelSelect-945"><span class="linenos">945</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;It will be droped in the aggregation of prediction intervals&#39;</span><span class="p">)</span>
</span><span id="ForecastModelSelect-946"><a href="#ForecastModelSelect-946"><span class="linenos">946</span></a>                    <span class="k">continue</span>
</span><span id="ForecastModelSelect-947"><a href="#ForecastModelSelect-947"><span class="linenos">947</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="ForecastModelSelect-948"><a href="#ForecastModelSelect-948"><span class="linenos">948</span></a>                    <span class="n">_weigh_preds_ints</span> <span class="o">=</span> <span class="n">_weigh_preds_ints</span><span class="o">+</span> <span class="n">pred_ints</span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="o">*</span><span class="n">w</span>
</span><span id="ForecastModelSelect-949"><a href="#ForecastModelSelect-949"><span class="linenos">949</span></a>            <span class="n">y_pred_int</span> <span class="o">=</span> <span class="n">_weigh_preds_ints</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
</span><span id="ForecastModelSelect-950"><a href="#ForecastModelSelect-950"><span class="linenos">950</span></a>
</span><span id="ForecastModelSelect-951"><a href="#ForecastModelSelect-951"><span class="linenos">951</span></a>        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;nbest_average&#39;</span><span class="p">:</span>
</span><span id="ForecastModelSelect-952"><a href="#ForecastModelSelect-952"><span class="linenos">952</span></a>            <span class="c1"># return the average prediction of nbest models</span>
</span><span id="ForecastModelSelect-953"><a href="#ForecastModelSelect-953"><span class="linenos">953</span></a>            <span class="n">y_pred</span> <span class="o">=</span> <span class="n">preds</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_best_x_overall</span><span class="p">[</span><span class="n">score</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ForecastModelSelect-954"><a href="#ForecastModelSelect-954"><span class="linenos">954</span></a>            <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">v</span> <span class="ow">in</span> <span class="n">pred_ints</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_best_x_overall</span><span class="p">[</span><span class="n">score</span><span class="p">]]):</span>
</span><span id="ForecastModelSelect-955"><a href="#ForecastModelSelect-955"><span class="linenos">955</span></a>                <span class="n">y_pred_int</span> <span class="o">=</span> <span class="n">pred_ints</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_best_x_overall</span><span class="p">[</span><span class="n">score</span><span class="p">]]</span>\
</span><span id="ForecastModelSelect-956"><a href="#ForecastModelSelect-956"><span class="linenos">956</span></a>            <span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="ForecastModelSelect-957"><a href="#ForecastModelSelect-957"><span class="linenos">957</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ForecastModelSelect-958"><a href="#ForecastModelSelect-958"><span class="linenos">958</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Prediction intervals for </span><span class="si">{</span><span class="n">nbest</span><span class="si">}</span><span class="s1"> best models are not available&#39;</span><span class="p">)</span>
</span><span id="ForecastModelSelect-959"><a href="#ForecastModelSelect-959"><span class="linenos">959</span></a>                <span class="n">y_pred_int</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ForecastModelSelect-960"><a href="#ForecastModelSelect-960"><span class="linenos">960</span></a>        
</span><span id="ForecastModelSelect-961"><a href="#ForecastModelSelect-961"><span class="linenos">961</span></a>        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span><span class="s1">&#39;best_horizon&#39;</span><span class="p">:</span>
</span><span id="ForecastModelSelect-962"><a href="#ForecastModelSelect-962"><span class="linenos">962</span></a>            <span class="c1"># returns the prediction of the best model for each forecast horizon</span>
</span><span id="ForecastModelSelect-963"><a href="#ForecastModelSelect-963"><span class="linenos">963</span></a>            <span class="n">best_horizon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_rank_perhorizon</span><span class="p">[</span><span class="n">score</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Best_1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span><span id="ForecastModelSelect-964"><a href="#ForecastModelSelect-964"><span class="linenos">964</span></a>            <span class="n">y_pred</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">preds</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">best_horizon</span><span class="o">.</span><span class="n">items</span><span class="p">()],</span> 
</span><span id="ForecastModelSelect-965"><a href="#ForecastModelSelect-965"><span class="linenos">965</span></a>                   <span class="n">index</span><span class="o">=</span><span class="n">preds</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</span><span id="ForecastModelSelect-966"><a href="#ForecastModelSelect-966"><span class="linenos">966</span></a>            <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">v</span> <span class="ow">in</span> <span class="n">pred_ints</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">best_horizon</span><span class="o">.</span><span class="n">values</span><span class="p">()]):</span>
</span><span id="ForecastModelSelect-967"><a href="#ForecastModelSelect-967"><span class="linenos">967</span></a>                <span class="n">y_pred_int</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pred_ints</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">best_horizon</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
</span><span id="ForecastModelSelect-968"><a href="#ForecastModelSelect-968"><span class="linenos">968</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ForecastModelSelect-969"><a href="#ForecastModelSelect-969"><span class="linenos">969</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;One or several model that are best in their respective horizon are not available&#39;</span><span class="p">)</span>
</span><span id="ForecastModelSelect-970"><a href="#ForecastModelSelect-970"><span class="linenos">970</span></a>                <span class="n">y_pred_int</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span> 
</span><span id="ForecastModelSelect-971"><a href="#ForecastModelSelect-971"><span class="linenos">971</span></a>
</span><span id="ForecastModelSelect-972"><a href="#ForecastModelSelect-972"><span class="linenos">972</span></a>        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;nbest_average_horizon&#39;</span><span class="p">:</span>
</span><span id="ForecastModelSelect-973"><a href="#ForecastModelSelect-973"><span class="linenos">973</span></a>            <span class="c1"># return the average prediction on the nbest models per horizon</span>
</span><span id="ForecastModelSelect-974"><a href="#ForecastModelSelect-974"><span class="linenos">974</span></a>            <span class="n">best_horizon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_rank_perhorizon</span><span class="p">[</span><span class="s1">&#39;RMSE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
</span><span id="ForecastModelSelect-975"><a href="#ForecastModelSelect-975"><span class="linenos">975</span></a>            <span class="n">_uniq_best_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_rank_perhorizon</span><span class="p">[</span><span class="s1">&#39;RMSE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</span><span id="ForecastModelSelect-976"><a href="#ForecastModelSelect-976"><span class="linenos">976</span></a>            <span class="n">best_horizon</span> <span class="o">=</span> <span class="n">best_horizon</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span><span id="ForecastModelSelect-977"><a href="#ForecastModelSelect-977"><span class="linenos">977</span></a>
</span><span id="ForecastModelSelect-978"><a href="#ForecastModelSelect-978"><span class="linenos">978</span></a>            <span class="n">y_pred</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">preds</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">best_horizon</span><span class="o">.</span><span class="n">items</span><span class="p">()],</span> 
</span><span id="ForecastModelSelect-979"><a href="#ForecastModelSelect-979"><span class="linenos">979</span></a>                               <span class="n">index</span><span class="o">=</span><span class="n">preds</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</span><span id="ForecastModelSelect-980"><a href="#ForecastModelSelect-980"><span class="linenos">980</span></a>            <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">v</span> <span class="ow">in</span> <span class="n">pred_ints</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">_uniq_best_model</span><span class="p">]):</span>
</span><span id="ForecastModelSelect-981"><a href="#ForecastModelSelect-981"><span class="linenos">981</span></a>                <span class="n">y_pred_int</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pred_ints</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">best_horizon</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
</span><span id="ForecastModelSelect-982"><a href="#ForecastModelSelect-982"><span class="linenos">982</span></a>                <span class="n">y_pred_int</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">y_pred</span><span class="o">.</span><span class="n">index</span>        
</span><span id="ForecastModelSelect-983"><a href="#ForecastModelSelect-983"><span class="linenos">983</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ForecastModelSelect-984"><a href="#ForecastModelSelect-984"><span class="linenos">984</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Prediction intervals for </span><span class="si">{</span><span class="n">nbest</span><span class="si">}</span><span class="s1"> best models are not available&#39;</span><span class="p">)</span>
</span><span id="ForecastModelSelect-985"><a href="#ForecastModelSelect-985"><span class="linenos">985</span></a>                <span class="n">y_pred_int</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ForecastModelSelect-986"><a href="#ForecastModelSelect-986"><span class="linenos">986</span></a>                
</span><span id="ForecastModelSelect-987"><a href="#ForecastModelSelect-987"><span class="linenos">987</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ForecastModelSelect-988"><a href="#ForecastModelSelect-988"><span class="linenos">988</span></a>            <span class="n">recog_modes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="s1">&#39;best_horizon&#39;</span><span class="p">,</span> <span class="s1">&#39;average&#39;</span><span class="p">,</span> <span class="s1">&#39;inverse_score&#39;</span><span class="p">,</span> 
</span><span id="ForecastModelSelect-989"><a href="#ForecastModelSelect-989"><span class="linenos">989</span></a>                           <span class="s1">&#39;nbest_average&#39;</span><span class="p">,</span> <span class="s1">&#39;nbest_average_horizon&#39;</span><span class="p">]</span>
</span><span id="ForecastModelSelect-990"><a href="#ForecastModelSelect-990"><span class="linenos">990</span></a>            <span class="n">_error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Aggregation mode not recognized. Recognized prediction aggregation are </span><span class="si">{</span><span class="n">recog_modes</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="ForecastModelSelect-991"><a href="#ForecastModelSelect-991"><span class="linenos">991</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">_error_msg</span><span class="p">)</span>
</span><span id="ForecastModelSelect-992"><a href="#ForecastModelSelect-992"><span class="linenos">992</span></a>
</span><span id="ForecastModelSelect-993"><a href="#ForecastModelSelect-993"><span class="linenos">993</span></a>        <span class="k">if</span> <span class="n">ret_underlying</span><span class="p">:</span>
</span><span id="ForecastModelSelect-994"><a href="#ForecastModelSelect-994"><span class="linenos">994</span></a>            <span class="k">return</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">y_pred_int</span><span class="p">,</span> <span class="n">preds</span><span class="p">,</span> <span class="n">pred_ints</span>
</span><span id="ForecastModelSelect-995"><a href="#ForecastModelSelect-995"><span class="linenos">995</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ForecastModelSelect-996"><a href="#ForecastModelSelect-996"><span class="linenos">996</span></a>            <span class="k">return</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">y_pred_int</span>
</span></pre></div>


            <div class="docstring"><p>Class for model selection and comparison based on out-of-sample performance.
Evaluate how to best combine the different models based on their oos performance.</p>

<p>The class can be initialized in 2 ways. </p>

<ul>
<li><strong>Method 1</strong>: Requires a dictionary of forecasting models. A dictionary where the keys are names of forecasts and the values are sktime recognized forecast_models.
All the arguments taken by Forecast object must be passed to the initialization of the ForecastModelSelect object.</li>
<li><strong>Method 2</strong>: Requires a dictionary of trained models. The training and evalutiaon of the models are assumed to be done.</li>
</ul>

<p>There is the possibility to combine the two methods by providing both dictionaries. 
In this case, the trained models will be used for evaluation and the non-trained models will be trained and evaluated.</p>

<h2 id="parameters">Parameters:</h2>

<ul>
<li>forecasters_d (dict): A dictionary containing various forecasting models for comparison. 
Default is None and assess the most common forecasting models.
<ul>
<li><strong>Naive:</strong> NaiveForecaster - Keep the latest value</li>
<li><strong>SeasonalNaive:</strong> NaiveForecaster - Keep the value of the same season</li>
<li><strong>AutoARIMA:</strong> StatsForecastAutoARIMA - Auto ARIMA model</li>
<li><strong>AutoETS:</strong> StatsForecastAutoETS - Auto ETS model</li>
<li><strong>AutoCES:</strong> StatsForecastAutoCES - Auto CES model</li>
<li><strong>AutoTheta:</strong> StatsForecastAutoTheta - Auto Theta model</li>
<li><strong>AutoTBATS:</strong> StatsForecastAutoTBATS - Auto TBATS model</li>
<li><strong>Prophet:</strong> Prophet - Prophet model</li>
</ul></li>
<li>trained_forecasters_d (dict): A dictionary containing trained Forecast objects. Default is None.</li>
<li>model_exog_d (dict): A dictionary containing exogenous variables for each model. Default is None.</li>
<li>mode (str): The aggregation mode. Default is 'nbest_average_horizon'. Available values are:
<ul>
<li>best: The prediction is based on the best model.</li>
<li>best_horizon: The prediction is based on the best model for each horizon.</li>
<li>average: The average of the prediction of all models.</li>
<li>inverse_score: The weighted average prediction, where weights are inversely proportional to the model performance score.</li>
<li>nbest_average: Average of the n best models. The n is given by the parameter nbest.</li>
<li>nbest_average_horizon: Average of the n best models for each horizon. The n is given by the parameter nbest.</li>
<li>model: Returns the prediction of a specific model. The model name must be provided in the model_name parameter.</li>
</ul></li>
<li>score (str): The performance score. Default is 'RMSE'. Available values are:
<ul>
<li>RMSE: Root Mean Squared Error.</li>
<li>MAE: Mean Absolute Error.</li>
<li>MAPE: Mean Absolute Percentage Error.</li>
<li>MedianAE: Median Absolute Error.</li>
<li>R2: R-squared.       </li>
</ul></li>
<li>nbest (int): Number of best models to aggregate. Default is 2.    </li>
<li>data (pd.DataFrame): A DataFrame containing the input data for forecasting.</li>
<li>depvar_str (str): The column name representing the dependent variable for forecasting.</li>
<li>fh (int): The forecast horizon, i.e., the number of periods ahead to forecast.</li>
<li>pct_initial_window (float): The percentage of data used as the initial training window.</li>
<li>step_length (int): The step size for expanding window cross-validation.    </li>
<li>exog_l (list, optional): List of exogenous variables for forecasting. Default is None.</li>
<li>freq (str, optional): The frequency of the time series data. Default is 'B' (business days).</li>
</ul>

<h2 id="attributes">Attributes:</h2>

<ul>
<li>LF_d (dict): A dictionary containing the Forecast objects.</li>
<li>summary_horizon (pd.DataFrame): Summary of out-of-sample performance per horizon and per model.</li>
<li>summary_results (pd.DataFrame): Summary of out-of-sample performance per model.</li>
<li>summary_cutoff (pd.DataFrame): Out-of-sample performance based on cutoffs.</li>
<li>model_rank_perhorizon (pd.DataFrame): Rank of models per horizon based on performance.</li>
<li>_mode (str): The aggregation mode.</li>
<li>_score (str): The performance score.</li>
<li>_nbest (int): Number of best models to aggregate.</li>
<li>_eval_models (list): A list of evaluated models.    </li>
<li>_best_x_overall (dict): The best models based on overall performance.</li>
<li>_avg_oos_horizon (dict): The average out-of-sample performance per horizon.</li>
</ul>

<h2 id="methods">Methods:</h2>

<ul>
<li>split_procedure_summary(): Print the summary of the split procedure for each model.</li>
<li>add_forecaster(forecaster_name, lf): Add a Forecast Object to the list of models to evaluate.</li>
<li>fit(on, fh, force, verbose): Fit the forecasting models for all the underlying Forecast objects.</li>
<li>evaluate(force): Evaluate the underlying Forecast models out of sample.</li>
<li>select_best(score, reestimate): Select the best model based on horizon and overall performance.</li>
<li>summary_per_cutoff(score): Calculate and return the out-of-sample performance based on cutoffs.</li>
<li>predict(X, fh, coverage, mode, score, model_name, ret_underlying): Make forecasts using the specified aggregation mode.</li>
<li>update(new_y, new_X, refit, reevaluate, fh, coverage, mode, score, model_name, ret_underlying): Update the prediction for all the models and aggregate them based on the specific mode.</li>
<li>save(path): Save the model to a file.</li>
<li>get_pred_errors(mode, score, model_name): Get the prediction errors.</li>
<li>plot_model_compare(score, view, model_subset, xlabel, ylabel, title, ax, figsize): Plot a comparison of models based on their out-of-sample performance.</li>
<li>plot_prediction(y_pred, models_preds, y_pred_interval, interval_label, aggregation_label, xlabel, ylabel, title, ax): Plot the prediction.</li>
</ul>

<h2 id="raises">Raises:</h2>

<ul>
<li>AssertionError: If the trained models are not instances of Forecast.</li>
<li>AssertionError: If there is an overlap between the trained and non-trained dictionaries.</li>
<li>AssertionError: If the mode function is not implemented.</li>
<li>AssertionError: If the performance score is not implemented.</li>
<li>AssertionError: If the number of best models is not an integer.</li>
<li>AssertionError: If the exogenous variables are missing for a model.</li>
<li>ValueError: If the view mode is not 'horizon' or 'cutoff'.</li>
<li>ValueError: If the mode is not 'best', 'best_horizon', 'average', 'inverse_score', 'nbest_average', 'nbest_average_horizon', or 'model'.</li>
</ul>
</div>


                            <div id="ForecastModelSelect.__init__" class="classattr">
                                        <input id="ForecastModelSelect.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">ForecastModelSelect</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">forecasters_d</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">trained_forecasters_d</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">model_exog_d</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;best_horizon&#39;</span>,</span><span class="param">	<span class="n">score</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;RMSE&#39;</span>,</span><span class="param">	<span class="n">nbest</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span></span>)</span>

                <label class="view-source-button" for="ForecastModelSelect.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ForecastModelSelect.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ForecastModelSelect.__init__-128"><a href="#ForecastModelSelect.__init__-128"><span class="linenos">128</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="ForecastModelSelect.__init__-129"><a href="#ForecastModelSelect.__init__-129"><span class="linenos">129</span></a>                 <span class="n">forecasters_d</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ForecastModelSelect.__init__-130"><a href="#ForecastModelSelect.__init__-130"><span class="linenos">130</span></a>                 <span class="n">trained_forecasters_d</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ForecastModelSelect.__init__-131"><a href="#ForecastModelSelect.__init__-131"><span class="linenos">131</span></a>                 <span class="n">model_exog_d</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ForecastModelSelect.__init__-132"><a href="#ForecastModelSelect.__init__-132"><span class="linenos">132</span></a>                 <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;best_horizon&#39;</span><span class="p">,</span>
</span><span id="ForecastModelSelect.__init__-133"><a href="#ForecastModelSelect.__init__-133"><span class="linenos">133</span></a>                 <span class="n">score</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">,</span>
</span><span id="ForecastModelSelect.__init__-134"><a href="#ForecastModelSelect.__init__-134"><span class="linenos">134</span></a>                 <span class="n">nbest</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ForecastModelSelect.__init__-135"><a href="#ForecastModelSelect.__init__-135"><span class="linenos">135</span></a>                 <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="ForecastModelSelect.__init__-136"><a href="#ForecastModelSelect.__init__-136"><span class="linenos">136</span></a>                <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect.__init__-137"><a href="#ForecastModelSelect.__init__-137"><span class="linenos">137</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the ForecastModelSelect object.&quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect.__init__-138"><a href="#ForecastModelSelect.__init__-138"><span class="linenos">138</span></a>        <span class="n">lf_d</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ForecastModelSelect.__init__-139"><a href="#ForecastModelSelect.__init__-139"><span class="linenos">139</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">trained_forecasters_d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="ForecastModelSelect.__init__-140"><a href="#ForecastModelSelect.__init__-140"><span class="linenos">140</span></a>            <span class="c1"># Trained Models must be istance of Forecast object</span>
</span><span id="ForecastModelSelect.__init__-141"><a href="#ForecastModelSelect.__init__-141"><span class="linenos">141</span></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">forecasters_d</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">trained_forecasters_d</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;There is an overlap between the two trained and non trainded dictionaries&#39;</span> 
</span><span id="ForecastModelSelect.__init__-142"><a href="#ForecastModelSelect.__init__-142"><span class="linenos">142</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">forecasters_d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="ForecastModelSelect.__init__-143"><a href="#ForecastModelSelect.__init__-143"><span class="linenos">143</span></a>                <span class="c1"># There must be no overlap between the two dictionaries</span>
</span><span id="ForecastModelSelect.__init__-144"><a href="#ForecastModelSelect.__init__-144"><span class="linenos">144</span></a>                <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_lf</span><span class="p">,</span> <span class="n">Forecast</span><span class="p">)</span> <span class="k">for</span> <span class="n">_lf</span> <span class="ow">in</span> <span class="n">trained_forecasters_d</span><span class="o">.</span><span class="n">values</span><span class="p">()]),</span> <span class="s1">&#39;Trained models must be instances of Forecast object&#39;</span>
</span><span id="ForecastModelSelect.__init__-145"><a href="#ForecastModelSelect.__init__-145"><span class="linenos">145</span></a>            <span class="k">for</span> <span class="n">forecaster_name</span><span class="p">,</span> <span class="n">_lf</span> <span class="ow">in</span> <span class="n">trained_forecasters_d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ForecastModelSelect.__init__-146"><a href="#ForecastModelSelect.__init__-146"><span class="linenos">146</span></a>                <span class="n">lf_d</span><span class="p">[</span><span class="n">forecaster_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">_lf</span>        
</span><span id="ForecastModelSelect.__init__-147"><a href="#ForecastModelSelect.__init__-147"><span class="linenos">147</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ForecastModelSelect.__init__-148"><a href="#ForecastModelSelect.__init__-148"><span class="linenos">148</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">forecasters_d</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="ForecastModelSelect.__init__-149"><a href="#ForecastModelSelect.__init__-149"><span class="linenos">149</span></a>                <span class="n">forecasters_d</span> <span class="o">=</span> <span class="n">CommonForecastingModels</span>
</span><span id="ForecastModelSelect.__init__-150"><a href="#ForecastModelSelect.__init__-150"><span class="linenos">150</span></a>        
</span><span id="ForecastModelSelect.__init__-151"><a href="#ForecastModelSelect.__init__-151"><span class="linenos">151</span></a>        <span class="c1"># Define the Forecasters exogenous variables</span>
</span><span id="ForecastModelSelect.__init__-152"><a href="#ForecastModelSelect.__init__-152"><span class="linenos">152</span></a>        <span class="n">exog_l</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;exog_l&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="ForecastModelSelect.__init__-153"><a href="#ForecastModelSelect.__init__-153"><span class="linenos">153</span></a>        <span class="k">if</span> <span class="n">model_exog_d</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect.__init__-154"><a href="#ForecastModelSelect.__init__-154"><span class="linenos">154</span></a>            <span class="n">model_exog_d</span> <span class="o">=</span> <span class="p">{</span><span class="n">forecaster_name</span><span class="p">:</span> <span class="n">exog_l</span> <span class="k">for</span> <span class="n">forecaster_name</span> <span class="ow">in</span> <span class="n">forecasters_d</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
</span><span id="ForecastModelSelect.__init__-155"><a href="#ForecastModelSelect.__init__-155"><span class="linenos">155</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ForecastModelSelect.__init__-156"><a href="#ForecastModelSelect.__init__-156"><span class="linenos">156</span></a>            <span class="n">exog_l</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">exog_l</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">exog_l</span>
</span><span id="ForecastModelSelect.__init__-157"><a href="#ForecastModelSelect.__init__-157"><span class="linenos">157</span></a>            <span class="k">for</span> <span class="n">forecaster_name</span> <span class="ow">in</span> <span class="n">forecasters_d</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="ForecastModelSelect.__init__-158"><a href="#ForecastModelSelect.__init__-158"><span class="linenos">158</span></a>                <span class="n">model_exog_d</span><span class="p">[</span><span class="n">forecaster_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">exog_l</span> <span class="o">+</span> <span class="n">model_exog_d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">forecaster_name</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="ForecastModelSelect.__init__-159"><a href="#ForecastModelSelect.__init__-159"><span class="linenos">159</span></a>        
</span><span id="ForecastModelSelect.__init__-160"><a href="#ForecastModelSelect.__init__-160"><span class="linenos">160</span></a>        <span class="k">if</span> <span class="n">forecasters_d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect.__init__-161"><a href="#ForecastModelSelect.__init__-161"><span class="linenos">161</span></a>            <span class="k">for</span> <span class="n">forecaster_name</span><span class="p">,</span> <span class="n">forecaster</span> <span class="ow">in</span> <span class="n">forecasters_d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>            
</span><span id="ForecastModelSelect.__init__-162"><a href="#ForecastModelSelect.__init__-162"><span class="linenos">162</span></a>                <span class="n">_lf</span> <span class="o">=</span>  <span class="n">Forecast</span><span class="p">(</span>
</span><span id="ForecastModelSelect.__init__-163"><a href="#ForecastModelSelect.__init__-163"><span class="linenos">163</span></a>                    <span class="n">forecaster_name</span> <span class="o">=</span> <span class="n">forecaster_name</span><span class="p">,</span>
</span><span id="ForecastModelSelect.__init__-164"><a href="#ForecastModelSelect.__init__-164"><span class="linenos">164</span></a>                    <span class="n">forecaster</span> <span class="o">=</span> <span class="n">forecaster</span><span class="p">,</span>
</span><span id="ForecastModelSelect.__init__-165"><a href="#ForecastModelSelect.__init__-165"><span class="linenos">165</span></a>                    <span class="n">exog_l</span> <span class="o">=</span> <span class="n">model_exog_d</span><span class="p">[</span><span class="n">forecaster_name</span><span class="p">],</span>
</span><span id="ForecastModelSelect.__init__-166"><a href="#ForecastModelSelect.__init__-166"><span class="linenos">166</span></a>                    <span class="o">**</span><span class="n">kwargs</span>
</span><span id="ForecastModelSelect.__init__-167"><a href="#ForecastModelSelect.__init__-167"><span class="linenos">167</span></a>                <span class="p">)</span>
</span><span id="ForecastModelSelect.__init__-168"><a href="#ForecastModelSelect.__init__-168"><span class="linenos">168</span></a>                <span class="n">lf_d</span><span class="p">[</span><span class="n">forecaster_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">_lf</span>
</span><span id="ForecastModelSelect.__init__-169"><a href="#ForecastModelSelect.__init__-169"><span class="linenos">169</span></a>                           
</span><span id="ForecastModelSelect.__init__-170"><a href="#ForecastModelSelect.__init__-170"><span class="linenos">170</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span> <span class="o">=</span> <span class="n">lf_d</span>
</span><span id="ForecastModelSelect.__init__-171"><a href="#ForecastModelSelect.__init__-171"><span class="linenos">171</span></a>
</span><span id="ForecastModelSelect.__init__-172"><a href="#ForecastModelSelect.__init__-172"><span class="linenos">172</span></a>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="s1">&#39;mode must be a sting&#39;</span>
</span><span id="ForecastModelSelect.__init__-173"><a href="#ForecastModelSelect.__init__-173"><span class="linenos">173</span></a>        <span class="n">recog_modes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="s1">&#39;best_horizon&#39;</span><span class="p">,</span> <span class="s1">&#39;average&#39;</span><span class="p">,</span> <span class="s1">&#39;inverse_score&#39;</span><span class="p">,</span> 
</span><span id="ForecastModelSelect.__init__-174"><a href="#ForecastModelSelect.__init__-174"><span class="linenos">174</span></a>                           <span class="s1">&#39;nbest_average&#39;</span><span class="p">,</span> <span class="s1">&#39;nbest_average_horizon&#39;</span><span class="p">]</span>
</span><span id="ForecastModelSelect.__init__-175"><a href="#ForecastModelSelect.__init__-175"><span class="linenos">175</span></a>        <span class="k">assert</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">recog_modes</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;mode function not implemented!. Recognized modes are </span><span class="si">{</span><span class="n">recog_modes</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="ForecastModelSelect.__init__-176"><a href="#ForecastModelSelect.__init__-176"><span class="linenos">176</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">=</span> <span class="n">mode</span>
</span><span id="ForecastModelSelect.__init__-177"><a href="#ForecastModelSelect.__init__-177"><span class="linenos">177</span></a>
</span><span id="ForecastModelSelect.__init__-178"><a href="#ForecastModelSelect.__init__-178"><span class="linenos">178</span></a>        <span class="n">recog_scores</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="s1">&#39;MAE&#39;</span><span class="p">,</span> <span class="s1">&#39;MAPE&#39;</span><span class="p">,</span> <span class="s1">&#39;R2&#39;</span><span class="p">,</span> <span class="s1">&#39;MedianAE&#39;</span><span class="p">]</span>
</span><span id="ForecastModelSelect.__init__-179"><a href="#ForecastModelSelect.__init__-179"><span class="linenos">179</span></a>        <span class="k">assert</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">recog_scores</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;performance score not implemented!. Recognized scores are </span><span class="si">{</span><span class="n">recog_scores</span><span class="si">}</span><span class="s1">&#39;</span>		
</span><span id="ForecastModelSelect.__init__-180"><a href="#ForecastModelSelect.__init__-180"><span class="linenos">180</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_score</span> <span class="o">=</span> <span class="n">score</span>
</span><span id="ForecastModelSelect.__init__-181"><a href="#ForecastModelSelect.__init__-181"><span class="linenos">181</span></a>
</span><span id="ForecastModelSelect.__init__-182"><a href="#ForecastModelSelect.__init__-182"><span class="linenos">182</span></a>        <span class="k">if</span> <span class="n">nbest</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect.__init__-183"><a href="#ForecastModelSelect.__init__-183"><span class="linenos">183</span></a>            <span class="n">nbest</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="ForecastModelSelect.__init__-184"><a href="#ForecastModelSelect.__init__-184"><span class="linenos">184</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ForecastModelSelect.__init__-185"><a href="#ForecastModelSelect.__init__-185"><span class="linenos">185</span></a>            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nbest</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="s1">&#39;n best must be an integer&#39;</span>		
</span><span id="ForecastModelSelect.__init__-186"><a href="#ForecastModelSelect.__init__-186"><span class="linenos">186</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_nbest</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">nbest</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="p">))</span>	
</span><span id="ForecastModelSelect.__init__-187"><a href="#ForecastModelSelect.__init__-187"><span class="linenos">187</span></a>
</span><span id="ForecastModelSelect.__init__-188"><a href="#ForecastModelSelect.__init__-188"><span class="linenos">188</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_eval_models</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ForecastModelSelect.__init__-189"><a href="#ForecastModelSelect.__init__-189"><span class="linenos">189</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">summary_horizon</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ForecastModelSelect.__init__-190"><a href="#ForecastModelSelect.__init__-190"><span class="linenos">190</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">summary_results</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ForecastModelSelect.__init__-191"><a href="#ForecastModelSelect.__init__-191"><span class="linenos">191</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model_rank_perhorizon</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ForecastModelSelect.__init__-192"><a href="#ForecastModelSelect.__init__-192"><span class="linenos">192</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_best_x_overall</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ForecastModelSelect.__init__-193"><a href="#ForecastModelSelect.__init__-193"><span class="linenos">193</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_avg_oos_horizon</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ForecastModelSelect.__init__-194"><a href="#ForecastModelSelect.__init__-194"><span class="linenos">194</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">summary_cutoff</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ForecastModelSelect.__init__-195"><a href="#ForecastModelSelect.__init__-195"><span class="linenos">195</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the ForecastModelSelect object.</p>
</div>


                            </div>
                            <div id="ForecastModelSelect.LF_d" class="classattr">
                                <div class="attr variable">
            <span class="name">LF_d</span>

        
    </div>
    <a class="headerlink" href="#ForecastModelSelect.LF_d"></a>
    
    

                            </div>
                            <div id="ForecastModelSelect.summary_horizon" class="classattr">
                                <div class="attr variable">
            <span class="name">summary_horizon</span>

        
    </div>
    <a class="headerlink" href="#ForecastModelSelect.summary_horizon"></a>
    
    

                            </div>
                            <div id="ForecastModelSelect.summary_results" class="classattr">
                                <div class="attr variable">
            <span class="name">summary_results</span>

        
    </div>
    <a class="headerlink" href="#ForecastModelSelect.summary_results"></a>
    
    

                            </div>
                            <div id="ForecastModelSelect.model_rank_perhorizon" class="classattr">
                                <div class="attr variable">
            <span class="name">model_rank_perhorizon</span>

        
    </div>
    <a class="headerlink" href="#ForecastModelSelect.model_rank_perhorizon"></a>
    
    

                            </div>
                            <div id="ForecastModelSelect.summary_cutoff" class="classattr">
                                <div class="attr variable">
            <span class="name">summary_cutoff</span>

        
    </div>
    <a class="headerlink" href="#ForecastModelSelect.summary_cutoff"></a>
    
    

                            </div>
                            <div id="ForecastModelSelect.split_procedure_summary" class="classattr">
                                        <input id="ForecastModelSelect.split_procedure_summary-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">split_procedure_summary</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ForecastModelSelect.split_procedure_summary-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ForecastModelSelect.split_procedure_summary"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ForecastModelSelect.split_procedure_summary-197"><a href="#ForecastModelSelect.split_procedure_summary-197"><span class="linenos">197</span></a>    <span class="k">def</span> <span class="nf">split_procedure_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ForecastModelSelect.split_procedure_summary-198"><a href="#ForecastModelSelect.split_procedure_summary-198"><span class="linenos">198</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect.split_procedure_summary-199"><a href="#ForecastModelSelect.split_procedure_summary-199"><span class="linenos">199</span></a><span class="sd">        Print the summary of the split procedure for each model.</span>
</span><span id="ForecastModelSelect.split_procedure_summary-200"><a href="#ForecastModelSelect.split_procedure_summary-200"><span class="linenos">200</span></a>
</span><span id="ForecastModelSelect.split_procedure_summary-201"><a href="#ForecastModelSelect.split_procedure_summary-201"><span class="linenos">201</span></a><span class="sd">        Returns:</span>
</span><span id="ForecastModelSelect.split_procedure_summary-202"><a href="#ForecastModelSelect.split_procedure_summary-202"><span class="linenos">202</span></a><span class="sd">        --------        </span>
</span><span id="ForecastModelSelect.split_procedure_summary-203"><a href="#ForecastModelSelect.split_procedure_summary-203"><span class="linenos">203</span></a><span class="sd">            dict:</span>
</span><span id="ForecastModelSelect.split_procedure_summary-204"><a href="#ForecastModelSelect.split_procedure_summary-204"><span class="linenos">204</span></a><span class="sd">                A dictionary containing details of the cross-validation procedure, including:</span>
</span><span id="ForecastModelSelect.split_procedure_summary-205"><a href="#ForecastModelSelect.split_procedure_summary-205"><span class="linenos">205</span></a><span class="sd">                the number of folds, initial window size, step length, and forecast period.</span>
</span><span id="ForecastModelSelect.split_procedure_summary-206"><a href="#ForecastModelSelect.split_procedure_summary-206"><span class="linenos">206</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect.split_procedure_summary-207"><a href="#ForecastModelSelect.split_procedure_summary-207"><span class="linenos">207</span></a>        <span class="n">_lf</span>  <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ForecastModelSelect.split_procedure_summary-208"><a href="#ForecastModelSelect.split_procedure_summary-208"><span class="linenos">208</span></a>        <span class="k">return</span> <span class="n">_lf</span><span class="o">.</span><span class="n">split_procedure_summary</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Print the summary of the split procedure for each model.</p>

<h2 id="returns">Returns:</h2>

<pre><code>dict:
    A dictionary containing details of the cross-validation procedure, including:
    the number of folds, initial window size, step length, and forecast period.
</code></pre>
</div>


                            </div>
                            <div id="ForecastModelSelect.add_forecaster" class="classattr">
                                        <input id="ForecastModelSelect.add_forecaster-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_forecaster</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">forecaster_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">lf</span><span class="p">:</span> <span class="n"><a href="forecast.html#Forecast">forecast_combine.forecast.Forecast</a></span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="ForecastModelSelect.add_forecaster-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ForecastModelSelect.add_forecaster"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ForecastModelSelect.add_forecaster-210"><a href="#ForecastModelSelect.add_forecaster-210"><span class="linenos">210</span></a>    <span class="k">def</span> <span class="nf">add_forecaster</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="ForecastModelSelect.add_forecaster-211"><a href="#ForecastModelSelect.add_forecaster-211"><span class="linenos">211</span></a>                       <span class="n">forecaster_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ForecastModelSelect.add_forecaster-212"><a href="#ForecastModelSelect.add_forecaster-212"><span class="linenos">212</span></a>                       <span class="n">lf</span><span class="p">:</span> <span class="n">Forecast</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect.add_forecaster-213"><a href="#ForecastModelSelect.add_forecaster-213"><span class="linenos">213</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect.add_forecaster-214"><a href="#ForecastModelSelect.add_forecaster-214"><span class="linenos">214</span></a><span class="sd">        Add a Forecast Object to the list of models to evaluate.</span>
</span><span id="ForecastModelSelect.add_forecaster-215"><a href="#ForecastModelSelect.add_forecaster-215"><span class="linenos">215</span></a>
</span><span id="ForecastModelSelect.add_forecaster-216"><a href="#ForecastModelSelect.add_forecaster-216"><span class="linenos">216</span></a><span class="sd">        Parameters:</span>
</span><span id="ForecastModelSelect.add_forecaster-217"><a href="#ForecastModelSelect.add_forecaster-217"><span class="linenos">217</span></a><span class="sd">        -----------</span>
</span><span id="ForecastModelSelect.add_forecaster-218"><a href="#ForecastModelSelect.add_forecaster-218"><span class="linenos">218</span></a><span class="sd">            lf : Forecast</span>
</span><span id="ForecastModelSelect.add_forecaster-219"><a href="#ForecastModelSelect.add_forecaster-219"><span class="linenos">219</span></a><span class="sd">                The Forecast object to be added.</span>
</span><span id="ForecastModelSelect.add_forecaster-220"><a href="#ForecastModelSelect.add_forecaster-220"><span class="linenos">220</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect.add_forecaster-221"><a href="#ForecastModelSelect.add_forecaster-221"><span class="linenos">221</span></a>        <span class="k">assert</span> <span class="n">forecaster_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="s1">&#39;Forecaster name already exists in the considered list of model&#39;</span>
</span><span id="ForecastModelSelect.add_forecaster-222"><a href="#ForecastModelSelect.add_forecaster-222"><span class="linenos">222</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="p">[</span><span class="n">forecaster_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">lf</span>
</span><span id="ForecastModelSelect.add_forecaster-223"><a href="#ForecastModelSelect.add_forecaster-223"><span class="linenos">223</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span>
</span></pre></div>


            <div class="docstring"><p>Add a Forecast Object to the list of models to evaluate.</p>

<h2 id="parameters">Parameters:</h2>

<pre><code>lf : Forecast
    The Forecast object to be added.
</code></pre>
</div>


                            </div>
                            <div id="ForecastModelSelect.fit" class="classattr">
                                        <input id="ForecastModelSelect.fit-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">fit</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">on</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span>,</span><span class="param">	<span class="n">fh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">sktime</span><span class="o">.</span><span class="n">forecasting</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">_fh</span><span class="o">.</span><span class="n">ForecastingHorizon</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="ForecastModelSelect.fit-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ForecastModelSelect.fit"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ForecastModelSelect.fit-225"><a href="#ForecastModelSelect.fit-225"><span class="linenos">225</span></a>    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="ForecastModelSelect.fit-226"><a href="#ForecastModelSelect.fit-226"><span class="linenos">226</span></a>            <span class="n">on</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span> 
</span><span id="ForecastModelSelect.fit-227"><a href="#ForecastModelSelect.fit-227"><span class="linenos">227</span></a>            <span class="n">fh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ForecastingHorizon</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
</span><span id="ForecastModelSelect.fit-228"><a href="#ForecastModelSelect.fit-228"><span class="linenos">228</span></a>            <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ForecastModelSelect.fit-229"><a href="#ForecastModelSelect.fit-229"><span class="linenos">229</span></a>            <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ForecastModelSelect.fit-230"><a href="#ForecastModelSelect.fit-230"><span class="linenos">230</span></a>           <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect.fit-231"><a href="#ForecastModelSelect.fit-231"><span class="linenos">231</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect.fit-232"><a href="#ForecastModelSelect.fit-232"><span class="linenos">232</span></a><span class="sd">        Fit the forecasting models for all the underlying Forecast objects.</span>
</span><span id="ForecastModelSelect.fit-233"><a href="#ForecastModelSelect.fit-233"><span class="linenos">233</span></a>
</span><span id="ForecastModelSelect.fit-234"><a href="#ForecastModelSelect.fit-234"><span class="linenos">234</span></a><span class="sd">        Parameters:</span>
</span><span id="ForecastModelSelect.fit-235"><a href="#ForecastModelSelect.fit-235"><span class="linenos">235</span></a><span class="sd">        -----------        </span>
</span><span id="ForecastModelSelect.fit-236"><a href="#ForecastModelSelect.fit-236"><span class="linenos">236</span></a><span class="sd">            on : str, optional</span>
</span><span id="ForecastModelSelect.fit-237"><a href="#ForecastModelSelect.fit-237"><span class="linenos">237</span></a><span class="sd">                The period for the in-sample fitting. Default is &#39;all&#39;.</span>
</span><span id="ForecastModelSelect.fit-238"><a href="#ForecastModelSelect.fit-238"><span class="linenos">238</span></a><span class="sd">            fh : ForecastingHorizon, optional</span>
</span><span id="ForecastModelSelect.fit-239"><a href="#ForecastModelSelect.fit-239"><span class="linenos">239</span></a><span class="sd">                The forecasting horizon. Default is None and it takes the value entered at initialization..</span>
</span><span id="ForecastModelSelect.fit-240"><a href="#ForecastModelSelect.fit-240"><span class="linenos">240</span></a><span class="sd">            force : bool, optional</span>
</span><span id="ForecastModelSelect.fit-241"><a href="#ForecastModelSelect.fit-241"><span class="linenos">241</span></a><span class="sd">                If True, force fitting even if the models are already fitted. Default is False.</span>
</span><span id="ForecastModelSelect.fit-242"><a href="#ForecastModelSelect.fit-242"><span class="linenos">242</span></a>
</span><span id="ForecastModelSelect.fit-243"><a href="#ForecastModelSelect.fit-243"><span class="linenos">243</span></a><span class="sd">        Returns:</span>
</span><span id="ForecastModelSelect.fit-244"><a href="#ForecastModelSelect.fit-244"><span class="linenos">244</span></a><span class="sd">        --------        </span>
</span><span id="ForecastModelSelect.fit-245"><a href="#ForecastModelSelect.fit-245"><span class="linenos">245</span></a><span class="sd">            None</span>
</span><span id="ForecastModelSelect.fit-246"><a href="#ForecastModelSelect.fit-246"><span class="linenos">246</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect.fit-247"><a href="#ForecastModelSelect.fit-247"><span class="linenos">247</span></a>        <span class="k">for</span> <span class="n">_lfname</span><span class="p">,</span> <span class="n">_lf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ForecastModelSelect.fit-248"><a href="#ForecastModelSelect.fit-248"><span class="linenos">248</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="ForecastModelSelect.fit-249"><a href="#ForecastModelSelect.fit-249"><span class="linenos">249</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Fitting </span><span class="si">{</span><span class="n">_lfname</span><span class="si">}</span><span class="s1"> ...&#39;</span><span class="p">)</span>
</span><span id="ForecastModelSelect.fit-250"><a href="#ForecastModelSelect.fit-250"><span class="linenos">250</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">_lf</span><span class="o">.</span><span class="n">is_fitted</span><span class="p">)</span> <span class="ow">and</span> <span class="n">force</span> <span class="o">==</span><span class="kc">False</span><span class="p">:</span>
</span><span id="ForecastModelSelect.fit-251"><a href="#ForecastModelSelect.fit-251"><span class="linenos">251</span></a>                <span class="k">pass</span>
</span><span id="ForecastModelSelect.fit-252"><a href="#ForecastModelSelect.fit-252"><span class="linenos">252</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ForecastModelSelect.fit-253"><a href="#ForecastModelSelect.fit-253"><span class="linenos">253</span></a>                <span class="n">_lf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">on</span><span class="o">=</span><span class="n">on</span><span class="p">,</span> <span class="n">fh</span><span class="o">=</span><span class="n">fh</span><span class="p">)</span>
</span><span id="ForecastModelSelect.fit-254"><a href="#ForecastModelSelect.fit-254"><span class="linenos">254</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Fit the forecasting models for all the underlying Forecast objects.</p>

<h2 id="parameters">Parameters:</h2>

<pre><code>on : str, optional
    The period for the in-sample fitting. Default is 'all'.
fh : ForecastingHorizon, optional
    The forecasting horizon. Default is None and it takes the value entered at initialization..
force : bool, optional
    If True, force fitting even if the models are already fitted. Default is False.
</code></pre>

<h2 id="returns">Returns:</h2>

<pre><code>None
</code></pre>
</div>


                            </div>
                            <div id="ForecastModelSelect.evaluate" class="classattr">
                                        <input id="ForecastModelSelect.evaluate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">evaluate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">Tuple</span>:</span></span>

                <label class="view-source-button" for="ForecastModelSelect.evaluate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ForecastModelSelect.evaluate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ForecastModelSelect.evaluate-256"><a href="#ForecastModelSelect.evaluate-256"><span class="linenos">256</span></a>    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="ForecastModelSelect.evaluate-257"><a href="#ForecastModelSelect.evaluate-257"><span class="linenos">257</span></a>                 <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ForecastModelSelect.evaluate-258"><a href="#ForecastModelSelect.evaluate-258"><span class="linenos">258</span></a>                <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">:</span>
</span><span id="ForecastModelSelect.evaluate-259"><a href="#ForecastModelSelect.evaluate-259"><span class="linenos">259</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect.evaluate-260"><a href="#ForecastModelSelect.evaluate-260"><span class="linenos">260</span></a><span class="sd">        Evaluate the underlying Forecast models out of sample.</span>
</span><span id="ForecastModelSelect.evaluate-261"><a href="#ForecastModelSelect.evaluate-261"><span class="linenos">261</span></a>
</span><span id="ForecastModelSelect.evaluate-262"><a href="#ForecastModelSelect.evaluate-262"><span class="linenos">262</span></a><span class="sd">        Parameters:</span>
</span><span id="ForecastModelSelect.evaluate-263"><a href="#ForecastModelSelect.evaluate-263"><span class="linenos">263</span></a><span class="sd">        -----------</span>
</span><span id="ForecastModelSelect.evaluate-264"><a href="#ForecastModelSelect.evaluate-264"><span class="linenos">264</span></a><span class="sd">            force : bool, optional</span>
</span><span id="ForecastModelSelect.evaluate-265"><a href="#ForecastModelSelect.evaluate-265"><span class="linenos">265</span></a><span class="sd">                If True, force the evaluation even if the models are already evaluated. Default is False.</span>
</span><span id="ForecastModelSelect.evaluate-266"><a href="#ForecastModelSelect.evaluate-266"><span class="linenos">266</span></a>
</span><span id="ForecastModelSelect.evaluate-267"><a href="#ForecastModelSelect.evaluate-267"><span class="linenos">267</span></a><span class="sd">        Returns:</span>
</span><span id="ForecastModelSelect.evaluate-268"><a href="#ForecastModelSelect.evaluate-268"><span class="linenos">268</span></a><span class="sd">        --------</span>
</span><span id="ForecastModelSelect.evaluate-269"><a href="#ForecastModelSelect.evaluate-269"><span class="linenos">269</span></a><span class="sd">            tuple</span>
</span><span id="ForecastModelSelect.evaluate-270"><a href="#ForecastModelSelect.evaluate-270"><span class="linenos">270</span></a><span class="sd">                A tuple containing the summary of out-of-sample performance per horizon and per model.</span>
</span><span id="ForecastModelSelect.evaluate-271"><a href="#ForecastModelSelect.evaluate-271"><span class="linenos">271</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect.evaluate-272"><a href="#ForecastModelSelect.evaluate-272"><span class="linenos">272</span></a>        <span class="c1">#Step 1: Loop on all models and evaluate them</span>
</span><span id="ForecastModelSelect.evaluate-273"><a href="#ForecastModelSelect.evaluate-273"><span class="linenos">273</span></a>        <span class="n">_model_evals</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ForecastModelSelect.evaluate-274"><a href="#ForecastModelSelect.evaluate-274"><span class="linenos">274</span></a>        <span class="n">_todrop_evals</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ForecastModelSelect.evaluate-275"><a href="#ForecastModelSelect.evaluate-275"><span class="linenos">275</span></a>        <span class="k">for</span> <span class="n">_fname</span><span class="p">,</span> <span class="n">_lf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ForecastModelSelect.evaluate-276"><a href="#ForecastModelSelect.evaluate-276"><span class="linenos">276</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">_lf</span><span class="o">.</span><span class="n">is_evaluated</span><span class="p">)</span> <span class="ow">and</span> <span class="n">force</span> <span class="o">==</span><span class="kc">False</span><span class="p">:</span>
</span><span id="ForecastModelSelect.evaluate-277"><a href="#ForecastModelSelect.evaluate-277"><span class="linenos">277</span></a>                <span class="n">_model_evals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_lf</span><span class="o">.</span><span class="n">eval</span><span class="p">)</span>
</span><span id="ForecastModelSelect.evaluate-278"><a href="#ForecastModelSelect.evaluate-278"><span class="linenos">278</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ForecastModelSelect.evaluate-279"><a href="#ForecastModelSelect.evaluate-279"><span class="linenos">279</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="ForecastModelSelect.evaluate-280"><a href="#ForecastModelSelect.evaluate-280"><span class="linenos">280</span></a>                    <span class="n">_eval</span> <span class="o">=</span> <span class="n">_lf</span><span class="o">.</span><span class="n">evaluate</span><span class="p">()</span>
</span><span id="ForecastModelSelect.evaluate-281"><a href="#ForecastModelSelect.evaluate-281"><span class="linenos">281</span></a>                    <span class="n">_model_evals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_eval</span><span class="p">)</span>
</span><span id="ForecastModelSelect.evaluate-282"><a href="#ForecastModelSelect.evaluate-282"><span class="linenos">282</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="ForecastModelSelect.evaluate-283"><a href="#ForecastModelSelect.evaluate-283"><span class="linenos">283</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error evaluating </span><span class="si">{</span><span class="n">_fname</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ForecastModelSelect.evaluate-284"><a href="#ForecastModelSelect.evaluate-284"><span class="linenos">284</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">model </span><span class="si">{</span><span class="n">_fname</span><span class="si">}</span><span class="s1"> cannot be evaluated. It will be removed from the list of models&#39;</span><span class="p">)</span>
</span><span id="ForecastModelSelect.evaluate-285"><a href="#ForecastModelSelect.evaluate-285"><span class="linenos">285</span></a>                    <span class="n">_todrop_evals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_fname</span><span class="p">)</span>
</span><span id="ForecastModelSelect.evaluate-286"><a href="#ForecastModelSelect.evaluate-286"><span class="linenos">286</span></a>                    <span class="k">continue</span>                
</span><span id="ForecastModelSelect.evaluate-287"><a href="#ForecastModelSelect.evaluate-287"><span class="linenos">287</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_todrop_evals</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
</span><span id="ForecastModelSelect.evaluate-288"><a href="#ForecastModelSelect.evaluate-288"><span class="linenos">288</span></a>            <span class="k">for</span> <span class="n">_fname</span> <span class="ow">in</span> <span class="n">_todrop_evals</span><span class="p">:</span>
</span><span id="ForecastModelSelect.evaluate-289"><a href="#ForecastModelSelect.evaluate-289"><span class="linenos">289</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">_fname</span><span class="p">)</span>
</span><span id="ForecastModelSelect.evaluate-290"><a href="#ForecastModelSelect.evaluate-290"><span class="linenos">290</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_eval_models</span> <span class="o">=</span> <span class="n">_model_evals</span>
</span><span id="ForecastModelSelect.evaluate-291"><a href="#ForecastModelSelect.evaluate-291"><span class="linenos">291</span></a>
</span><span id="ForecastModelSelect.evaluate-292"><a href="#ForecastModelSelect.evaluate-292"><span class="linenos">292</span></a>        <span class="c1"># Step 2: Get the OOS Summary of Performance </span>
</span><span id="ForecastModelSelect.evaluate-293"><a href="#ForecastModelSelect.evaluate-293"><span class="linenos">293</span></a>        <span class="c1">#per horizon and per model</span>
</span><span id="ForecastModelSelect.evaluate-294"><a href="#ForecastModelSelect.evaluate-294"><span class="linenos">294</span></a>        <span class="n">_sum_h</span> <span class="o">=</span> <span class="p">{};</span> <span class="n">_sum_T</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ForecastModelSelect.evaluate-295"><a href="#ForecastModelSelect.evaluate-295"><span class="linenos">295</span></a>        <span class="k">for</span> <span class="n">_lf_eval</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_models</span><span class="p">:</span>            
</span><span id="ForecastModelSelect.evaluate-296"><a href="#ForecastModelSelect.evaluate-296"><span class="linenos">296</span></a>            <span class="n">_sum_T</span><span class="p">[</span><span class="n">_lf_eval</span><span class="o">.</span><span class="n">forecaster_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">_lf_eval</span><span class="o">.</span><span class="n">summary_results</span><span class="p">()</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
</span><span id="ForecastModelSelect.evaluate-297"><a href="#ForecastModelSelect.evaluate-297"><span class="linenos">297</span></a>            <span class="n">_sum_h</span><span class="p">[</span><span class="n">_lf_eval</span><span class="o">.</span><span class="n">forecaster_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">_lf_eval</span><span class="o">.</span><span class="n">summary_horizon</span><span class="p">()</span>
</span><span id="ForecastModelSelect.evaluate-298"><a href="#ForecastModelSelect.evaluate-298"><span class="linenos">298</span></a>
</span><span id="ForecastModelSelect.evaluate-299"><a href="#ForecastModelSelect.evaluate-299"><span class="linenos">299</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">summary_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">_sum_T</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keys</span> <span class="o">=</span> <span class="n">_sum_T</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="ForecastModelSelect.evaluate-300"><a href="#ForecastModelSelect.evaluate-300"><span class="linenos">300</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">summary_horizon</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">_sum_h</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keys</span> <span class="o">=</span> <span class="n">_sum_h</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>        
</span><span id="ForecastModelSelect.evaluate-301"><a href="#ForecastModelSelect.evaluate-301"><span class="linenos">301</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary_horizon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary_results</span>
</span></pre></div>


            <div class="docstring"><p>Evaluate the underlying Forecast models out of sample.</p>

<h2 id="parameters">Parameters:</h2>

<pre><code>force : bool, optional
    If True, force the evaluation even if the models are already evaluated. Default is False.
</code></pre>

<h2 id="returns">Returns:</h2>

<pre><code>tuple
    A tuple containing the summary of out-of-sample performance per horizon and per model.
</code></pre>
</div>


                            </div>
                            <div id="ForecastModelSelect.select_best" class="classattr">
                                        <input id="ForecastModelSelect.select_best-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">select_best</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">score</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">reestimate</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>:</span></span>

                <label class="view-source-button" for="ForecastModelSelect.select_best-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ForecastModelSelect.select_best"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ForecastModelSelect.select_best-303"><a href="#ForecastModelSelect.select_best-303"><span class="linenos">303</span></a>    <span class="k">def</span> <span class="nf">select_best</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="ForecastModelSelect.select_best-304"><a href="#ForecastModelSelect.select_best-304"><span class="linenos">304</span></a>                    <span class="n">score</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ForecastModelSelect.select_best-305"><a href="#ForecastModelSelect.select_best-305"><span class="linenos">305</span></a>                    <span class="n">reestimate</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ForecastModelSelect.select_best-306"><a href="#ForecastModelSelect.select_best-306"><span class="linenos">306</span></a>                   <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="ForecastModelSelect.select_best-307"><a href="#ForecastModelSelect.select_best-307"><span class="linenos">307</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect.select_best-308"><a href="#ForecastModelSelect.select_best-308"><span class="linenos">308</span></a><span class="sd">        Select the best model based on horizon and overall performance.</span>
</span><span id="ForecastModelSelect.select_best-309"><a href="#ForecastModelSelect.select_best-309"><span class="linenos">309</span></a>
</span><span id="ForecastModelSelect.select_best-310"><a href="#ForecastModelSelect.select_best-310"><span class="linenos">310</span></a><span class="sd">        Parameters:</span>
</span><span id="ForecastModelSelect.select_best-311"><a href="#ForecastModelSelect.select_best-311"><span class="linenos">311</span></a><span class="sd">        -----------        </span>
</span><span id="ForecastModelSelect.select_best-312"><a href="#ForecastModelSelect.select_best-312"><span class="linenos">312</span></a><span class="sd">            score : str, optional</span>
</span><span id="ForecastModelSelect.select_best-313"><a href="#ForecastModelSelect.select_best-313"><span class="linenos">313</span></a><span class="sd">                The performance metric to use for model comparison. Default is None and it takes the value entered at initialization.</span>
</span><span id="ForecastModelSelect.select_best-314"><a href="#ForecastModelSelect.select_best-314"><span class="linenos">314</span></a><span class="sd">            nbest : int, optional</span>
</span><span id="ForecastModelSelect.select_best-315"><a href="#ForecastModelSelect.select_best-315"><span class="linenos">315</span></a><span class="sd">                The number of best models to select based on horizon performance. Default is None and it takes the value entered at initialization.</span>
</span><span id="ForecastModelSelect.select_best-316"><a href="#ForecastModelSelect.select_best-316"><span class="linenos">316</span></a>
</span><span id="ForecastModelSelect.select_best-317"><a href="#ForecastModelSelect.select_best-317"><span class="linenos">317</span></a><span class="sd">        Returns:</span>
</span><span id="ForecastModelSelect.select_best-318"><a href="#ForecastModelSelect.select_best-318"><span class="linenos">318</span></a><span class="sd">        --------        </span>
</span><span id="ForecastModelSelect.select_best-319"><a href="#ForecastModelSelect.select_best-319"><span class="linenos">319</span></a><span class="sd">            pd.DataFrame</span>
</span><span id="ForecastModelSelect.select_best-320"><a href="#ForecastModelSelect.select_best-320"><span class="linenos">320</span></a><span class="sd">                model_rank_perhorizon. Rank of models per horizon based on performance.</span>
</span><span id="ForecastModelSelect.select_best-321"><a href="#ForecastModelSelect.select_best-321"><span class="linenos">321</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect.select_best-322"><a href="#ForecastModelSelect.select_best-322"><span class="linenos">322</span></a>        <span class="k">if</span> <span class="n">score</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect.select_best-323"><a href="#ForecastModelSelect.select_best-323"><span class="linenos">323</span></a>            <span class="n">score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score</span>
</span><span id="ForecastModelSelect.select_best-324"><a href="#ForecastModelSelect.select_best-324"><span class="linenos">324</span></a>
</span><span id="ForecastModelSelect.select_best-325"><a href="#ForecastModelSelect.select_best-325"><span class="linenos">325</span></a>        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_rank_perhorizon</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_avg_oos_horizon</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="n">reestimate</span><span class="p">:</span>
</span><span id="ForecastModelSelect.select_best-326"><a href="#ForecastModelSelect.select_best-326"><span class="linenos">326</span></a>
</span><span id="ForecastModelSelect.select_best-327"><a href="#ForecastModelSelect.select_best-327"><span class="linenos">327</span></a>            <span class="c1"># if models are not evaluated yet, run evaluate</span>
</span><span id="ForecastModelSelect.select_best-328"><a href="#ForecastModelSelect.select_best-328"><span class="linenos">328</span></a>            <span class="n">cond1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_models</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="ForecastModelSelect.select_best-329"><a href="#ForecastModelSelect.select_best-329"><span class="linenos">329</span></a>            <span class="n">cond2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary_horizon</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="ForecastModelSelect.select_best-330"><a href="#ForecastModelSelect.select_best-330"><span class="linenos">330</span></a>            <span class="k">if</span> <span class="n">cond1</span> <span class="ow">or</span> <span class="n">cond2</span><span class="p">:</span>	
</span><span id="ForecastModelSelect.select_best-331"><a href="#ForecastModelSelect.select_best-331"><span class="linenos">331</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Run evaluate ...&#39;</span><span class="p">)</span>
</span><span id="ForecastModelSelect.select_best-332"><a href="#ForecastModelSelect.select_best-332"><span class="linenos">332</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">()</span>
</span><span id="ForecastModelSelect.select_best-333"><a href="#ForecastModelSelect.select_best-333"><span class="linenos">333</span></a>
</span><span id="ForecastModelSelect.select_best-334"><a href="#ForecastModelSelect.select_best-334"><span class="linenos">334</span></a>            <span class="n">nevals</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="p">)</span>
</span><span id="ForecastModelSelect.select_best-335"><a href="#ForecastModelSelect.select_best-335"><span class="linenos">335</span></a>            <span class="n">nbest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nbest</span>
</span><span id="ForecastModelSelect.select_best-336"><a href="#ForecastModelSelect.select_best-336"><span class="linenos">336</span></a>            <span class="k">if</span> <span class="n">nbest</span> <span class="o">&gt;</span> <span class="n">nevals</span><span class="p">:</span>
</span><span id="ForecastModelSelect.select_best-337"><a href="#ForecastModelSelect.select_best-337"><span class="linenos">337</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">nbest =</span><span class="si">{</span><span class="n">nbest</span><span class="si">}</span><span class="s1"> is higher than the number of models evaluated </span><span class="si">{</span><span class="n">nevals</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ForecastModelSelect.select_best-338"><a href="#ForecastModelSelect.select_best-338"><span class="linenos">338</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;All models will be considered. The average best models will be equal to the simple average&#39;</span><span class="p">)</span>
</span><span id="ForecastModelSelect.select_best-339"><a href="#ForecastModelSelect.select_best-339"><span class="linenos">339</span></a>                <span class="n">nbest</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">nbest</span><span class="p">,</span> <span class="n">nevals</span><span class="p">)</span>
</span><span id="ForecastModelSelect.select_best-340"><a href="#ForecastModelSelect.select_best-340"><span class="linenos">340</span></a>
</span><span id="ForecastModelSelect.select_best-341"><a href="#ForecastModelSelect.select_best-341"><span class="linenos">341</span></a>            <span class="n">best_x_overall</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ForecastModelSelect.select_best-342"><a href="#ForecastModelSelect.select_best-342"><span class="linenos">342</span></a>            <span class="n">model_rank_perhorizon</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ForecastModelSelect.select_best-343"><a href="#ForecastModelSelect.select_best-343"><span class="linenos">343</span></a>            <span class="n">avg_oos_horizon</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ForecastModelSelect.select_best-344"><a href="#ForecastModelSelect.select_best-344"><span class="linenos">344</span></a>            <span class="n">_perf_metrics</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">summary_horizon</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="ForecastModelSelect.select_best-345"><a href="#ForecastModelSelect.select_best-345"><span class="linenos">345</span></a>            <span class="k">for</span> <span class="n">_s</span> <span class="ow">in</span> <span class="n">_perf_metrics</span><span class="p">:</span>
</span><span id="ForecastModelSelect.select_best-346"><a href="#ForecastModelSelect.select_best-346"><span class="linenos">346</span></a>                <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary_horizon</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="n">_s</span><span class="p">]</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span>
</span><span id="ForecastModelSelect.select_best-347"><a href="#ForecastModelSelect.select_best-347"><span class="linenos">347</span></a>
</span><span id="ForecastModelSelect.select_best-348"><a href="#ForecastModelSelect.select_best-348"><span class="linenos">348</span></a>                <span class="c1"># Select best x models based on their average performance on all horizons </span>
</span><span id="ForecastModelSelect.select_best-349"><a href="#ForecastModelSelect.select_best-349"><span class="linenos">349</span></a>                <span class="n">overall_score</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ForecastModelSelect.select_best-350"><a href="#ForecastModelSelect.select_best-350"><span class="linenos">350</span></a>                <span class="n">best_overall</span> <span class="o">=</span> <span class="n">overall_score</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ForecastModelSelect.select_best-351"><a href="#ForecastModelSelect.select_best-351"><span class="linenos">351</span></a>                <span class="n">_s_best_x_overall</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">overall_score</span><span class="o">.</span><span class="n">index</span><span class="p">[:</span><span class="n">nbest</span><span class="p">])</span>
</span><span id="ForecastModelSelect.select_best-352"><a href="#ForecastModelSelect.select_best-352"><span class="linenos">352</span></a>
</span><span id="ForecastModelSelect.select_best-353"><a href="#ForecastModelSelect.select_best-353"><span class="linenos">353</span></a>                <span class="c1"># Summary Model average</span>
</span><span id="ForecastModelSelect.select_best-354"><a href="#ForecastModelSelect.select_best-354"><span class="linenos">354</span></a>                <span class="n">_avg_oos_horizon</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">r</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">best_overall</span><span class="p">],</span>
</span><span id="ForecastModelSelect.select_best-355"><a href="#ForecastModelSelect.select_best-355"><span class="linenos">355</span></a>                                            <span class="n">r</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
</span><span id="ForecastModelSelect.select_best-356"><a href="#ForecastModelSelect.select_best-356"><span class="linenos">356</span></a>                                            <span class="n">r</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">_s_best_x_overall</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
</span><span id="ForecastModelSelect.select_best-357"><a href="#ForecastModelSelect.select_best-357"><span class="linenos">357</span></a>                                            <span class="n">r</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">nsmallest</span><span class="p">(</span><span class="n">nbest</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
</span><span id="ForecastModelSelect.select_best-358"><a href="#ForecastModelSelect.select_best-358"><span class="linenos">358</span></a>                                            <span class="n">r</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> 
</span><span id="ForecastModelSelect.select_best-359"><a href="#ForecastModelSelect.select_best-359"><span class="linenos">359</span></a>                                            <span class="p">],</span> 
</span><span id="ForecastModelSelect.select_best-360"><a href="#ForecastModelSelect.select_best-360"><span class="linenos">360</span></a>                                            <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ForecastModelSelect.select_best-361"><a href="#ForecastModelSelect.select_best-361"><span class="linenos">361</span></a>                                            <span class="s1">&#39;Best Model (over all)&#39;</span><span class="p">,</span>
</span><span id="ForecastModelSelect.select_best-362"><a href="#ForecastModelSelect.select_best-362"><span class="linenos">362</span></a>                                            <span class="s1">&#39;Best Model (per horizon)&#39;</span><span class="p">,</span>
</span><span id="ForecastModelSelect.select_best-363"><a href="#ForecastModelSelect.select_best-363"><span class="linenos">363</span></a>                                            <span class="sa">f</span><span class="s1">&#39;Best </span><span class="si">{</span><span class="n">nbest</span><span class="si">}</span><span class="s1"> Models (over all)&#39;</span><span class="p">,</span>
</span><span id="ForecastModelSelect.select_best-364"><a href="#ForecastModelSelect.select_best-364"><span class="linenos">364</span></a>                                            <span class="sa">f</span><span class="s1">&#39;Best </span><span class="si">{</span><span class="n">nbest</span><span class="si">}</span><span class="s1"> Models (per horizon)&#39;</span><span class="p">,</span>
</span><span id="ForecastModelSelect.select_best-365"><a href="#ForecastModelSelect.select_best-365"><span class="linenos">365</span></a>                                            <span class="s1">&#39;Model Avg (all models)&#39;</span>
</span><span id="ForecastModelSelect.select_best-366"><a href="#ForecastModelSelect.select_best-366"><span class="linenos">366</span></a>                                            <span class="p">],</span> 
</span><span id="ForecastModelSelect.select_best-367"><a href="#ForecastModelSelect.select_best-367"><span class="linenos">367</span></a>                                            <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="ForecastModelSelect.select_best-368"><a href="#ForecastModelSelect.select_best-368"><span class="linenos">368</span></a>
</span><span id="ForecastModelSelect.select_best-369"><a href="#ForecastModelSelect.select_best-369"><span class="linenos">369</span></a>                <span class="n">avg_oos_horizon</span><span class="p">[</span><span class="n">_s</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">r</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">_avg_oos_horizon</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ForecastModelSelect.select_best-370"><a href="#ForecastModelSelect.select_best-370"><span class="linenos">370</span></a>
</span><span id="ForecastModelSelect.select_best-371"><a href="#ForecastModelSelect.select_best-371"><span class="linenos">371</span></a>                <span class="c1"># Compute the rank of the models per horizon</span>
</span><span id="ForecastModelSelect.select_best-372"><a href="#ForecastModelSelect.select_best-372"><span class="linenos">372</span></a>                <span class="n">_rank_perhorizon</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">nsmallest</span><span class="p">(</span><span class="n">nevals</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>\
</span><span id="ForecastModelSelect.select_best-373"><a href="#ForecastModelSelect.select_best-373"><span class="linenos">373</span></a>                    <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Best_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nevals</span><span class="p">)})</span>
</span><span id="ForecastModelSelect.select_best-374"><a href="#ForecastModelSelect.select_best-374"><span class="linenos">374</span></a>                <span class="n">model_rank_perhorizon</span><span class="p">[</span><span class="n">_s</span><span class="p">]</span> <span class="o">=</span> <span class="n">_rank_perhorizon</span>
</span><span id="ForecastModelSelect.select_best-375"><a href="#ForecastModelSelect.select_best-375"><span class="linenos">375</span></a>                <span class="n">best_x_overall</span><span class="p">[</span><span class="n">_s</span><span class="p">]</span> <span class="o">=</span> <span class="n">_s_best_x_overall</span>
</span><span id="ForecastModelSelect.select_best-376"><a href="#ForecastModelSelect.select_best-376"><span class="linenos">376</span></a>            
</span><span id="ForecastModelSelect.select_best-377"><a href="#ForecastModelSelect.select_best-377"><span class="linenos">377</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_best_x_overall</span> <span class="o">=</span> <span class="n">best_x_overall</span>
</span><span id="ForecastModelSelect.select_best-378"><a href="#ForecastModelSelect.select_best-378"><span class="linenos">378</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">model_rank_perhorizon</span> <span class="o">=</span> <span class="n">model_rank_perhorizon</span>
</span><span id="ForecastModelSelect.select_best-379"><a href="#ForecastModelSelect.select_best-379"><span class="linenos">379</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_avg_oos_horizon</span> <span class="o">=</span> <span class="n">avg_oos_horizon</span>
</span><span id="ForecastModelSelect.select_best-380"><a href="#ForecastModelSelect.select_best-380"><span class="linenos">380</span></a>
</span><span id="ForecastModelSelect.select_best-381"><a href="#ForecastModelSelect.select_best-381"><span class="linenos">381</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_rank_perhorizon</span><span class="p">[</span><span class="n">score</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_avg_oos_horizon</span><span class="p">[</span><span class="n">score</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Select the best model based on horizon and overall performance.</p>

<h2 id="parameters">Parameters:</h2>

<pre><code>score : str, optional
    The performance metric to use for model comparison. Default is None and it takes the value entered at initialization.
nbest : int, optional
    The number of best models to select based on horizon performance. Default is None and it takes the value entered at initialization.
</code></pre>

<h2 id="returns">Returns:</h2>

<pre><code>pd.DataFrame
    model_rank_perhorizon. Rank of models per horizon based on performance.
</code></pre>
</div>


                            </div>
                            <div id="ForecastModelSelect.summary_per_cutoff" class="classattr">
                                        <input id="ForecastModelSelect.summary_per_cutoff-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">summary_per_cutoff</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">score</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>:</span></span>

                <label class="view-source-button" for="ForecastModelSelect.summary_per_cutoff-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ForecastModelSelect.summary_per_cutoff"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ForecastModelSelect.summary_per_cutoff-383"><a href="#ForecastModelSelect.summary_per_cutoff-383"><span class="linenos">383</span></a>    <span class="k">def</span> <span class="nf">summary_per_cutoff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="ForecastModelSelect.summary_per_cutoff-384"><a href="#ForecastModelSelect.summary_per_cutoff-384"><span class="linenos">384</span></a>                       <span class="n">score</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ForecastModelSelect.summary_per_cutoff-385"><a href="#ForecastModelSelect.summary_per_cutoff-385"><span class="linenos">385</span></a>                      <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="ForecastModelSelect.summary_per_cutoff-386"><a href="#ForecastModelSelect.summary_per_cutoff-386"><span class="linenos">386</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect.summary_per_cutoff-387"><a href="#ForecastModelSelect.summary_per_cutoff-387"><span class="linenos">387</span></a><span class="sd">        Calculate and return the out-of-sample performance based on cutoffs.</span>
</span><span id="ForecastModelSelect.summary_per_cutoff-388"><a href="#ForecastModelSelect.summary_per_cutoff-388"><span class="linenos">388</span></a>
</span><span id="ForecastModelSelect.summary_per_cutoff-389"><a href="#ForecastModelSelect.summary_per_cutoff-389"><span class="linenos">389</span></a><span class="sd">        Parameters:</span>
</span><span id="ForecastModelSelect.summary_per_cutoff-390"><a href="#ForecastModelSelect.summary_per_cutoff-390"><span class="linenos">390</span></a><span class="sd">        -----------        </span>
</span><span id="ForecastModelSelect.summary_per_cutoff-391"><a href="#ForecastModelSelect.summary_per_cutoff-391"><span class="linenos">391</span></a><span class="sd">            score : str, optional</span>
</span><span id="ForecastModelSelect.summary_per_cutoff-392"><a href="#ForecastModelSelect.summary_per_cutoff-392"><span class="linenos">392</span></a><span class="sd">                The performance metric to use for model comparison. Should be either &#39;RMSE&#39; or &#39;MAPE&#39;. Default is None and it takes the value entered at initialization.</span>
</span><span id="ForecastModelSelect.summary_per_cutoff-393"><a href="#ForecastModelSelect.summary_per_cutoff-393"><span class="linenos">393</span></a><span class="sd">            nbest : int, optional</span>
</span><span id="ForecastModelSelect.summary_per_cutoff-394"><a href="#ForecastModelSelect.summary_per_cutoff-394"><span class="linenos">394</span></a><span class="sd">                The number of best models to select based on horizon performance. Default is None and it takes the value entered at initialization.</span>
</span><span id="ForecastModelSelect.summary_per_cutoff-395"><a href="#ForecastModelSelect.summary_per_cutoff-395"><span class="linenos">395</span></a>
</span><span id="ForecastModelSelect.summary_per_cutoff-396"><a href="#ForecastModelSelect.summary_per_cutoff-396"><span class="linenos">396</span></a><span class="sd">        Returns:</span>
</span><span id="ForecastModelSelect.summary_per_cutoff-397"><a href="#ForecastModelSelect.summary_per_cutoff-397"><span class="linenos">397</span></a><span class="sd">        --------        </span>
</span><span id="ForecastModelSelect.summary_per_cutoff-398"><a href="#ForecastModelSelect.summary_per_cutoff-398"><span class="linenos">398</span></a><span class="sd">            pd.DataFrame</span>
</span><span id="ForecastModelSelect.summary_per_cutoff-399"><a href="#ForecastModelSelect.summary_per_cutoff-399"><span class="linenos">399</span></a><span class="sd">                A DataFrame containing the out-of-sample performance per horizon and per model based on the specified score and nbest values.</span>
</span><span id="ForecastModelSelect.summary_per_cutoff-400"><a href="#ForecastModelSelect.summary_per_cutoff-400"><span class="linenos">400</span></a><span class="sd">        &quot;&quot;&quot;</span>    
</span><span id="ForecastModelSelect.summary_per_cutoff-401"><a href="#ForecastModelSelect.summary_per_cutoff-401"><span class="linenos">401</span></a>        <span class="k">if</span> <span class="n">score</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect.summary_per_cutoff-402"><a href="#ForecastModelSelect.summary_per_cutoff-402"><span class="linenos">402</span></a>            <span class="n">score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score</span>
</span><span id="ForecastModelSelect.summary_per_cutoff-403"><a href="#ForecastModelSelect.summary_per_cutoff-403"><span class="linenos">403</span></a>        
</span><span id="ForecastModelSelect.summary_per_cutoff-404"><a href="#ForecastModelSelect.summary_per_cutoff-404"><span class="linenos">404</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary_cutoff</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect.summary_per_cutoff-405"><a href="#ForecastModelSelect.summary_per_cutoff-405"><span class="linenos">405</span></a>            <span class="n">nbest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nbest</span>
</span><span id="ForecastModelSelect.summary_per_cutoff-406"><a href="#ForecastModelSelect.summary_per_cutoff-406"><span class="linenos">406</span></a>            <span class="n">nevals</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="p">)</span>
</span><span id="ForecastModelSelect.summary_per_cutoff-407"><a href="#ForecastModelSelect.summary_per_cutoff-407"><span class="linenos">407</span></a>            <span class="k">if</span> <span class="n">nbest</span> <span class="o">&gt;</span> <span class="n">nevals</span><span class="p">:</span>
</span><span id="ForecastModelSelect.summary_per_cutoff-408"><a href="#ForecastModelSelect.summary_per_cutoff-408"><span class="linenos">408</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">nbest =</span><span class="si">{</span><span class="n">nbest</span><span class="si">}</span><span class="s1"> is higher than the number of models evaluated </span><span class="si">{</span><span class="n">nevals</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ForecastModelSelect.summary_per_cutoff-409"><a href="#ForecastModelSelect.summary_per_cutoff-409"><span class="linenos">409</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The average performance of best models will be computed on </span><span class="si">{</span><span class="n">nevals</span><span class="si">}</span><span class="s1"> models instead&#39;</span><span class="p">)</span>
</span><span id="ForecastModelSelect.summary_per_cutoff-410"><a href="#ForecastModelSelect.summary_per_cutoff-410"><span class="linenos">410</span></a>                <span class="n">nbest</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">nbest</span><span class="p">,</span> <span class="n">nevals</span><span class="p">)</span>
</span><span id="ForecastModelSelect.summary_per_cutoff-411"><a href="#ForecastModelSelect.summary_per_cutoff-411"><span class="linenos">411</span></a>
</span><span id="ForecastModelSelect.summary_per_cutoff-412"><a href="#ForecastModelSelect.summary_per_cutoff-412"><span class="linenos">412</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_models</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect.summary_per_cutoff-413"><a href="#ForecastModelSelect.summary_per_cutoff-413"><span class="linenos">413</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Run evaluate ...&#39;</span><span class="p">)</span>
</span><span id="ForecastModelSelect.summary_per_cutoff-414"><a href="#ForecastModelSelect.summary_per_cutoff-414"><span class="linenos">414</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">()</span>
</span><span id="ForecastModelSelect.summary_per_cutoff-415"><a href="#ForecastModelSelect.summary_per_cutoff-415"><span class="linenos">415</span></a>
</span><span id="ForecastModelSelect.summary_per_cutoff-416"><a href="#ForecastModelSelect.summary_per_cutoff-416"><span class="linenos">416</span></a>            <span class="n">avg_oos_hist</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ForecastModelSelect.summary_per_cutoff-417"><a href="#ForecastModelSelect.summary_per_cutoff-417"><span class="linenos">417</span></a>            <span class="n">_perf_metrics</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">summary_horizon</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="ForecastModelSelect.summary_per_cutoff-418"><a href="#ForecastModelSelect.summary_per_cutoff-418"><span class="linenos">418</span></a>            <span class="k">for</span> <span class="n">_s</span> <span class="ow">in</span> <span class="n">_perf_metrics</span><span class="p">:</span>
</span><span id="ForecastModelSelect.summary_per_cutoff-419"><a href="#ForecastModelSelect.summary_per_cutoff-419"><span class="linenos">419</span></a>                <span class="n">_oos</span> <span class="o">=</span> <span class="p">{</span><span class="n">_lf_eval</span><span class="o">.</span><span class="n">forecaster_name</span><span class="p">:</span> <span class="n">_lf_eval</span><span class="o">.</span><span class="n">_oos_cutoff_perf</span><span class="p">[</span><span class="n">_s</span><span class="p">]</span> <span class="k">for</span> <span class="n">_lf_eval</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_models</span><span class="p">}</span>
</span><span id="ForecastModelSelect.summary_per_cutoff-420"><a href="#ForecastModelSelect.summary_per_cutoff-420"><span class="linenos">420</span></a>                <span class="n">_oos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">_oos</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span>  <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span> <span class="n">_oos</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="ForecastModelSelect.summary_per_cutoff-421"><a href="#ForecastModelSelect.summary_per_cutoff-421"><span class="linenos">421</span></a>
</span><span id="ForecastModelSelect.summary_per_cutoff-422"><a href="#ForecastModelSelect.summary_per_cutoff-422"><span class="linenos">422</span></a>                <span class="n">best_mod</span> <span class="o">=</span> <span class="n">_oos</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
</span><span id="ForecastModelSelect.summary_per_cutoff-423"><a href="#ForecastModelSelect.summary_per_cutoff-423"><span class="linenos">423</span></a>                <span class="n">nbest_mods</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">_oos</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">nsmallest</span><span class="p">(</span><span class="n">nbest</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</span><span id="ForecastModelSelect.summary_per_cutoff-424"><a href="#ForecastModelSelect.summary_per_cutoff-424"><span class="linenos">424</span></a>                <span class="n">_aggs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">_oos</span><span class="p">[</span><span class="n">best_mod</span><span class="p">],</span> <span class="n">_oos</span><span class="p">[</span><span class="n">nbest_mods</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">_oos</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="ForecastModelSelect.summary_per_cutoff-425"><a href="#ForecastModelSelect.summary_per_cutoff-425"><span class="linenos">425</span></a>                                  <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Best Model (over all)&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Best </span><span class="si">{</span><span class="n">nbest</span><span class="si">}</span><span class="s1"> Models (over all)&#39;</span><span class="p">,</span><span class="s1">&#39;Model Avg (all models)&#39;</span><span class="p">])</span>
</span><span id="ForecastModelSelect.summary_per_cutoff-426"><a href="#ForecastModelSelect.summary_per_cutoff-426"><span class="linenos">426</span></a>                <span class="n">avg_oos_hist</span><span class="p">[</span><span class="n">_s</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">_oos</span><span class="p">,</span> <span class="n">_aggs</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ForecastModelSelect.summary_per_cutoff-427"><a href="#ForecastModelSelect.summary_per_cutoff-427"><span class="linenos">427</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">summary_cutoff</span> <span class="o">=</span> <span class="n">avg_oos_hist</span>
</span><span id="ForecastModelSelect.summary_per_cutoff-428"><a href="#ForecastModelSelect.summary_per_cutoff-428"><span class="linenos">428</span></a>        
</span><span id="ForecastModelSelect.summary_per_cutoff-429"><a href="#ForecastModelSelect.summary_per_cutoff-429"><span class="linenos">429</span></a>        <span class="k">return</span> <span class="n">avg_oos_hist</span><span class="p">[</span><span class="n">score</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Calculate and return the out-of-sample performance based on cutoffs.</p>

<h2 id="parameters">Parameters:</h2>

<pre><code>score : str, optional
    The performance metric to use for model comparison. Should be either 'RMSE' or 'MAPE'. Default is None and it takes the value entered at initialization.
nbest : int, optional
    The number of best models to select based on horizon performance. Default is None and it takes the value entered at initialization.
</code></pre>

<h2 id="returns">Returns:</h2>

<pre><code>pd.DataFrame
    A DataFrame containing the out-of-sample performance per horizon and per model based on the specified score and nbest values.
</code></pre>
</div>


                            </div>
                            <div id="ForecastModelSelect.predict" class="classattr">
                                        <input id="ForecastModelSelect.predict-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">predict</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">X</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">fh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">sktime</span><span class="o">.</span><span class="n">forecasting</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">_fh</span><span class="o">.</span><span class="n">ForecastingHorizon</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">coverage</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span>,</span><span class="param">	<span class="n">mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">score</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">model_name</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">ret_underlying</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">Tuple</span><span class="p">[</span><span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="ForecastModelSelect.predict-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ForecastModelSelect.predict"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ForecastModelSelect.predict-443"><a href="#ForecastModelSelect.predict-443"><span class="linenos">443</span></a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="ForecastModelSelect.predict-444"><a href="#ForecastModelSelect.predict-444"><span class="linenos">444</span></a>                <span class="n">X</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
</span><span id="ForecastModelSelect.predict-445"><a href="#ForecastModelSelect.predict-445"><span class="linenos">445</span></a>                <span class="n">fh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ForecastingHorizon</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ForecastModelSelect.predict-446"><a href="#ForecastModelSelect.predict-446"><span class="linenos">446</span></a>                <span class="n">coverage</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span>
</span><span id="ForecastModelSelect.predict-447"><a href="#ForecastModelSelect.predict-447"><span class="linenos">447</span></a>                <span class="n">mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ForecastModelSelect.predict-448"><a href="#ForecastModelSelect.predict-448"><span class="linenos">448</span></a>                <span class="n">score</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ForecastModelSelect.predict-449"><a href="#ForecastModelSelect.predict-449"><span class="linenos">449</span></a>                <span class="n">model_name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ForecastModelSelect.predict-450"><a href="#ForecastModelSelect.predict-450"><span class="linenos">450</span></a>                <span class="n">ret_underlying</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ForecastModelSelect.predict-451"><a href="#ForecastModelSelect.predict-451"><span class="linenos">451</span></a>               <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
</span><span id="ForecastModelSelect.predict-452"><a href="#ForecastModelSelect.predict-452"><span class="linenos">452</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect.predict-453"><a href="#ForecastModelSelect.predict-453"><span class="linenos">453</span></a><span class="sd">        Make forecasts using the specified aggregation mode.</span>
</span><span id="ForecastModelSelect.predict-454"><a href="#ForecastModelSelect.predict-454"><span class="linenos">454</span></a>
</span><span id="ForecastModelSelect.predict-455"><a href="#ForecastModelSelect.predict-455"><span class="linenos">455</span></a><span class="sd">        Parameters:</span>
</span><span id="ForecastModelSelect.predict-456"><a href="#ForecastModelSelect.predict-456"><span class="linenos">456</span></a><span class="sd">        -----------        </span>
</span><span id="ForecastModelSelect.predict-457"><a href="#ForecastModelSelect.predict-457"><span class="linenos">457</span></a><span class="sd">            X : pd.DataFrame, optional</span>
</span><span id="ForecastModelSelect.predict-458"><a href="#ForecastModelSelect.predict-458"><span class="linenos">458</span></a><span class="sd">                The exogenous variables used for prediction. Default is None and it takes the value entered at initialization..</span>
</span><span id="ForecastModelSelect.predict-459"><a href="#ForecastModelSelect.predict-459"><span class="linenos">459</span></a><span class="sd">            fh : ForecastingHorizon, optional</span>
</span><span id="ForecastModelSelect.predict-460"><a href="#ForecastModelSelect.predict-460"><span class="linenos">460</span></a><span class="sd">                The forecasting horizon. Default is None and it takes the value entered at initialization..</span>
</span><span id="ForecastModelSelect.predict-461"><a href="#ForecastModelSelect.predict-461"><span class="linenos">461</span></a><span class="sd">            coverage : float, optional</span>
</span><span id="ForecastModelSelect.predict-462"><a href="#ForecastModelSelect.predict-462"><span class="linenos">462</span></a><span class="sd">                The prediction interval coverage. Default is 0.9.</span>
</span><span id="ForecastModelSelect.predict-463"><a href="#ForecastModelSelect.predict-463"><span class="linenos">463</span></a><span class="sd">            mode : str, optional</span>
</span><span id="ForecastModelSelect.predict-464"><a href="#ForecastModelSelect.predict-464"><span class="linenos">464</span></a><span class="sd">                The aggregation mode for predictions. Default is None and it takes the value entered at initialization.. </span>
</span><span id="ForecastModelSelect.predict-465"><a href="#ForecastModelSelect.predict-465"><span class="linenos">465</span></a><span class="sd">                Available values:</span>
</span><span id="ForecastModelSelect.predict-466"><a href="#ForecastModelSelect.predict-466"><span class="linenos">466</span></a><span class="sd">                * &#39;best&#39;: The prediction is based on the best model.</span>
</span><span id="ForecastModelSelect.predict-467"><a href="#ForecastModelSelect.predict-467"><span class="linenos">467</span></a><span class="sd">                * &#39;best_horizon&#39;: The prediction is based on the best model for each horizon.</span>
</span><span id="ForecastModelSelect.predict-468"><a href="#ForecastModelSelect.predict-468"><span class="linenos">468</span></a><span class="sd">                * &#39;average&#39;: The average of the prediction of all models.</span>
</span><span id="ForecastModelSelect.predict-469"><a href="#ForecastModelSelect.predict-469"><span class="linenos">469</span></a><span class="sd">                * &#39;inverse_score&#39;: The weighted average prediction, where weights are inversely proportional to the model performance score.</span>
</span><span id="ForecastModelSelect.predict-470"><a href="#ForecastModelSelect.predict-470"><span class="linenos">470</span></a><span class="sd">                * &#39;nbest_average&#39;: Average of the n best models. The n is given by the parameter nbest.</span>
</span><span id="ForecastModelSelect.predict-471"><a href="#ForecastModelSelect.predict-471"><span class="linenos">471</span></a><span class="sd">                * &#39;nbest_average_horizon&#39;: Average of the n best models for each horizon. The n is given by the parameter nbest.</span>
</span><span id="ForecastModelSelect.predict-472"><a href="#ForecastModelSelect.predict-472"><span class="linenos">472</span></a><span class="sd">                * &#39;model&#39;: Returns the prediction of a specific model. The model name must be provided in the model_name parameter.</span>
</span><span id="ForecastModelSelect.predict-473"><a href="#ForecastModelSelect.predict-473"><span class="linenos">473</span></a><span class="sd">            score : str, optional</span>
</span><span id="ForecastModelSelect.predict-474"><a href="#ForecastModelSelect.predict-474"><span class="linenos">474</span></a><span class="sd">                The performance metric to use for model comparison. Should be either &#39;RMSE&#39; or &#39;MAPE&#39;. Default is None and it takes the value entered at initialization..</span>
</span><span id="ForecastModelSelect.predict-475"><a href="#ForecastModelSelect.predict-475"><span class="linenos">475</span></a><span class="sd">            nbest : int, optional</span>
</span><span id="ForecastModelSelect.predict-476"><a href="#ForecastModelSelect.predict-476"><span class="linenos">476</span></a><span class="sd">                The number of best models to select based on horizon performance. Default is None and it takes the value entered at initialization..</span>
</span><span id="ForecastModelSelect.predict-477"><a href="#ForecastModelSelect.predict-477"><span class="linenos">477</span></a><span class="sd">            model_name: str, optional</span>
</span><span id="ForecastModelSelect.predict-478"><a href="#ForecastModelSelect.predict-478"><span class="linenos">478</span></a><span class="sd">                The model name to use for prediction if mode=&#39;model&#39;. Default is None.</span>
</span><span id="ForecastModelSelect.predict-479"><a href="#ForecastModelSelect.predict-479"><span class="linenos">479</span></a><span class="sd">            ret_underlying : bool, optional</span>
</span><span id="ForecastModelSelect.predict-480"><a href="#ForecastModelSelect.predict-480"><span class="linenos">480</span></a><span class="sd">                If True, return the underlying predictions and prediction intervals for each model. Default is False.</span>
</span><span id="ForecastModelSelect.predict-481"><a href="#ForecastModelSelect.predict-481"><span class="linenos">481</span></a>
</span><span id="ForecastModelSelect.predict-482"><a href="#ForecastModelSelect.predict-482"><span class="linenos">482</span></a><span class="sd">        Returns:</span>
</span><span id="ForecastModelSelect.predict-483"><a href="#ForecastModelSelect.predict-483"><span class="linenos">483</span></a><span class="sd">        --------        </span>
</span><span id="ForecastModelSelect.predict-484"><a href="#ForecastModelSelect.predict-484"><span class="linenos">484</span></a><span class="sd">            tuple</span>
</span><span id="ForecastModelSelect.predict-485"><a href="#ForecastModelSelect.predict-485"><span class="linenos">485</span></a><span class="sd">                A tuple containing the aggregated prediction and prediction intervals.</span>
</span><span id="ForecastModelSelect.predict-486"><a href="#ForecastModelSelect.predict-486"><span class="linenos">486</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect.predict-487"><a href="#ForecastModelSelect.predict-487"><span class="linenos">487</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect.predict-488"><a href="#ForecastModelSelect.predict-488"><span class="linenos">488</span></a>            <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span>
</span><span id="ForecastModelSelect.predict-489"><a href="#ForecastModelSelect.predict-489"><span class="linenos">489</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;model&#39;</span><span class="p">:</span>
</span><span id="ForecastModelSelect.predict-490"><a href="#ForecastModelSelect.predict-490"><span class="linenos">490</span></a>            <span class="k">assert</span> <span class="n">model_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="s1">&#39;Model name not in the list of models&#39;</span>
</span><span id="ForecastModelSelect.predict-491"><a href="#ForecastModelSelect.predict-491"><span class="linenos">491</span></a>            <span class="n">_lf_X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__stage_X</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="p">[</span><span class="n">model_name</span><span class="p">],</span> <span class="n">X</span><span class="p">)</span>
</span><span id="ForecastModelSelect.predict-492"><a href="#ForecastModelSelect.predict-492"><span class="linenos">492</span></a>            <span class="n">pred</span><span class="p">,</span> <span class="n">pred_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">_lf_X</span><span class="p">,</span> <span class="n">fh</span><span class="o">=</span><span class="n">fh</span><span class="p">,</span> <span class="n">coverage</span><span class="o">=</span><span class="n">coverage</span><span class="p">)</span>
</span><span id="ForecastModelSelect.predict-493"><a href="#ForecastModelSelect.predict-493"><span class="linenos">493</span></a>            <span class="k">if</span> <span class="n">ret_underlying</span><span class="p">:</span>
</span><span id="ForecastModelSelect.predict-494"><a href="#ForecastModelSelect.predict-494"><span class="linenos">494</span></a>                <span class="k">return</span> <span class="n">pred</span><span class="p">,</span> <span class="n">pred_int</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="ForecastModelSelect.predict-495"><a href="#ForecastModelSelect.predict-495"><span class="linenos">495</span></a>            <span class="k">else</span><span class="p">:</span> 
</span><span id="ForecastModelSelect.predict-496"><a href="#ForecastModelSelect.predict-496"><span class="linenos">496</span></a>                <span class="k">return</span> <span class="n">pred</span><span class="p">,</span> <span class="n">pred_int</span>
</span><span id="ForecastModelSelect.predict-497"><a href="#ForecastModelSelect.predict-497"><span class="linenos">497</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ForecastModelSelect.predict-498"><a href="#ForecastModelSelect.predict-498"><span class="linenos">498</span></a>            <span class="n">preds</span> <span class="o">=</span> <span class="p">{};</span> <span class="n">pred_ints</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ForecastModelSelect.predict-499"><a href="#ForecastModelSelect.predict-499"><span class="linenos">499</span></a>            <span class="k">for</span> <span class="n">_fname</span><span class="p">,</span> <span class="n">_lf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ForecastModelSelect.predict-500"><a href="#ForecastModelSelect.predict-500"><span class="linenos">500</span></a>                <span class="n">_lf_X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__stage_X</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="p">[</span><span class="n">_fname</span><span class="p">],</span> <span class="n">X</span><span class="p">)</span>                
</span><span id="ForecastModelSelect.predict-501"><a href="#ForecastModelSelect.predict-501"><span class="linenos">501</span></a>                <span class="n">_y_pred</span><span class="p">,</span> <span class="n">_y_pred_ints</span> <span class="o">=</span> <span class="n">_lf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">_lf_X</span><span class="p">,</span> <span class="n">fh</span><span class="o">=</span><span class="n">fh</span><span class="p">,</span> <span class="n">coverage</span><span class="o">=</span><span class="n">coverage</span><span class="p">)</span>
</span><span id="ForecastModelSelect.predict-502"><a href="#ForecastModelSelect.predict-502"><span class="linenos">502</span></a>                <span class="n">preds</span><span class="p">[</span><span class="n">_fname</span><span class="p">]</span> <span class="o">=</span> <span class="n">_y_pred</span>
</span><span id="ForecastModelSelect.predict-503"><a href="#ForecastModelSelect.predict-503"><span class="linenos">503</span></a>                <span class="n">pred_ints</span><span class="p">[</span><span class="n">_fname</span><span class="p">]</span> <span class="o">=</span><span class="n">_y_pred_ints</span>
</span><span id="ForecastModelSelect.predict-504"><a href="#ForecastModelSelect.predict-504"><span class="linenos">504</span></a>
</span><span id="ForecastModelSelect.predict-505"><a href="#ForecastModelSelect.predict-505"><span class="linenos">505</span></a>            <span class="n">preds</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">preds</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">keys</span> <span class="o">=</span> <span class="n">preds</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ForecastModelSelect.predict-506"><a href="#ForecastModelSelect.predict-506"><span class="linenos">506</span></a>            <span class="n">pred_ints</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">pred_ints</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">keys</span> <span class="o">=</span> <span class="n">pred_ints</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ForecastModelSelect.predict-507"><a href="#ForecastModelSelect.predict-507"><span class="linenos">507</span></a>
</span><span id="ForecastModelSelect.predict-508"><a href="#ForecastModelSelect.predict-508"><span class="linenos">508</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__aggregate_pred</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">preds</span><span class="o">=</span><span class="n">preds</span><span class="p">,</span> <span class="n">pred_ints</span><span class="o">=</span><span class="n">pred_ints</span><span class="p">,</span> <span class="n">score</span><span class="o">=</span><span class="n">score</span><span class="p">,</span> <span class="n">ret_underlying</span><span class="o">=</span><span class="n">ret_underlying</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Make forecasts using the specified aggregation mode.</p>

<h2 id="parameters">Parameters:</h2>

<pre><code>X : pd.DataFrame, optional
    The exogenous variables used for prediction. Default is None and it takes the value entered at initialization..
fh : ForecastingHorizon, optional
    The forecasting horizon. Default is None and it takes the value entered at initialization..
coverage : float, optional
    The prediction interval coverage. Default is 0.9.
mode : str, optional
    The aggregation mode for predictions. Default is None and it takes the value entered at initialization.. 
    Available values:
    * 'best': The prediction is based on the best model.
    * 'best_horizon': The prediction is based on the best model for each horizon.
    * 'average': The average of the prediction of all models.
    * 'inverse_score': The weighted average prediction, where weights are inversely proportional to the model performance score.
    * 'nbest_average': Average of the n best models. The n is given by the parameter nbest.
    * 'nbest_average_horizon': Average of the n best models for each horizon. The n is given by the parameter nbest.
    * 'model': Returns the prediction of a specific model. The model name must be provided in the model_name parameter.
score : str, optional
    The performance metric to use for model comparison. Should be either 'RMSE' or 'MAPE'. Default is None and it takes the value entered at initialization..
nbest : int, optional
    The number of best models to select based on horizon performance. Default is None and it takes the value entered at initialization..
model_name: str, optional
    The model name to use for prediction if mode='model'. Default is None.
ret_underlying : bool, optional
    If True, return the underlying predictions and prediction intervals for each model. Default is False.
</code></pre>

<h2 id="returns">Returns:</h2>

<pre><code>tuple
    A tuple containing the aggregated prediction and prediction intervals.
</code></pre>
</div>


                            </div>
                            <div id="ForecastModelSelect.update" class="classattr">
                                        <input id="ForecastModelSelect.update-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">update</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">new_y</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">Series</span>,</span><span class="param">	<span class="n">new_X</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">refit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">reevaluate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">fh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">sktime</span><span class="o">.</span><span class="n">forecasting</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">_fh</span><span class="o">.</span><span class="n">ForecastingHorizon</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">coverage</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span>,</span><span class="param">	<span class="n">mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">score</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">model_name</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">ret_underlying</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">Tuple</span><span class="p">[</span><span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="ForecastModelSelect.update-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ForecastModelSelect.update"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ForecastModelSelect.update-510"><a href="#ForecastModelSelect.update-510"><span class="linenos">510</span></a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="ForecastModelSelect.update-511"><a href="#ForecastModelSelect.update-511"><span class="linenos">511</span></a>               <span class="n">new_y</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
</span><span id="ForecastModelSelect.update-512"><a href="#ForecastModelSelect.update-512"><span class="linenos">512</span></a>               <span class="n">new_X</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ForecastModelSelect.update-513"><a href="#ForecastModelSelect.update-513"><span class="linenos">513</span></a>               <span class="n">refit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
</span><span id="ForecastModelSelect.update-514"><a href="#ForecastModelSelect.update-514"><span class="linenos">514</span></a>               <span class="n">reevaluate</span><span class="p">:</span><span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
</span><span id="ForecastModelSelect.update-515"><a href="#ForecastModelSelect.update-515"><span class="linenos">515</span></a>               <span class="n">fh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ForecastingHorizon</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
</span><span id="ForecastModelSelect.update-516"><a href="#ForecastModelSelect.update-516"><span class="linenos">516</span></a>               <span class="n">coverage</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span> 
</span><span id="ForecastModelSelect.update-517"><a href="#ForecastModelSelect.update-517"><span class="linenos">517</span></a>               <span class="n">mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ForecastModelSelect.update-518"><a href="#ForecastModelSelect.update-518"><span class="linenos">518</span></a>               <span class="n">score</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ForecastModelSelect.update-519"><a href="#ForecastModelSelect.update-519"><span class="linenos">519</span></a>               <span class="n">model_name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ForecastModelSelect.update-520"><a href="#ForecastModelSelect.update-520"><span class="linenos">520</span></a>               <span class="n">ret_underlying</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ForecastModelSelect.update-521"><a href="#ForecastModelSelect.update-521"><span class="linenos">521</span></a>              <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
</span><span id="ForecastModelSelect.update-522"><a href="#ForecastModelSelect.update-522"><span class="linenos">522</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect.update-523"><a href="#ForecastModelSelect.update-523"><span class="linenos">523</span></a><span class="sd">        Function to update the prediction for all the models and aggregate them based on the specific mode.</span>
</span><span id="ForecastModelSelect.update-524"><a href="#ForecastModelSelect.update-524"><span class="linenos">524</span></a>
</span><span id="ForecastModelSelect.update-525"><a href="#ForecastModelSelect.update-525"><span class="linenos">525</span></a><span class="sd">        Parameters:</span>
</span><span id="ForecastModelSelect.update-526"><a href="#ForecastModelSelect.update-526"><span class="linenos">526</span></a><span class="sd">        -----------        </span>
</span><span id="ForecastModelSelect.update-527"><a href="#ForecastModelSelect.update-527"><span class="linenos">527</span></a><span class="sd">            newdata : pd.DataFrame</span>
</span><span id="ForecastModelSelect.update-528"><a href="#ForecastModelSelect.update-528"><span class="linenos">528</span></a><span class="sd">                The new data for updating the predictions.</span>
</span><span id="ForecastModelSelect.update-529"><a href="#ForecastModelSelect.update-529"><span class="linenos">529</span></a><span class="sd">            refit : bool, optional</span>
</span><span id="ForecastModelSelect.update-530"><a href="#ForecastModelSelect.update-530"><span class="linenos">530</span></a><span class="sd">                If False, generate the prediction without fitting the model. If True, fits the underlying models again on the entire sample</span>
</span><span id="ForecastModelSelect.update-531"><a href="#ForecastModelSelect.update-531"><span class="linenos">531</span></a><span class="sd">                Default is False</span>
</span><span id="ForecastModelSelect.update-532"><a href="#ForecastModelSelect.update-532"><span class="linenos">532</span></a><span class="sd">            reevaluate: bool, optional    </span>
</span><span id="ForecastModelSelect.update-533"><a href="#ForecastModelSelect.update-533"><span class="linenos">533</span></a><span class="sd">                Reapply the cross-validateion, evaluate the models out of sample, select the best models, then aggregate the predictions according the setup.</span>
</span><span id="ForecastModelSelect.update-534"><a href="#ForecastModelSelect.update-534"><span class="linenos">534</span></a><span class="sd">                Default is False.</span>
</span><span id="ForecastModelSelect.update-535"><a href="#ForecastModelSelect.update-535"><span class="linenos">535</span></a><span class="sd">            fh : ForecastingHorizon, optional</span>
</span><span id="ForecastModelSelect.update-536"><a href="#ForecastModelSelect.update-536"><span class="linenos">536</span></a><span class="sd">                The forecasting horizon. Default is None and it takes the value entered at initialization..</span>
</span><span id="ForecastModelSelect.update-537"><a href="#ForecastModelSelect.update-537"><span class="linenos">537</span></a><span class="sd">            coverage : float, optional</span>
</span><span id="ForecastModelSelect.update-538"><a href="#ForecastModelSelect.update-538"><span class="linenos">538</span></a><span class="sd">                The prediction interval coverage. Default is 0.9.</span>
</span><span id="ForecastModelSelect.update-539"><a href="#ForecastModelSelect.update-539"><span class="linenos">539</span></a><span class="sd">            mode : str, optional</span>
</span><span id="ForecastModelSelect.update-540"><a href="#ForecastModelSelect.update-540"><span class="linenos">540</span></a><span class="sd">                The aggregation mode for predictions. Default is None and it takes the value entered at initialization..</span>
</span><span id="ForecastModelSelect.update-541"><a href="#ForecastModelSelect.update-541"><span class="linenos">541</span></a><span class="sd">                Available values:</span>
</span><span id="ForecastModelSelect.update-542"><a href="#ForecastModelSelect.update-542"><span class="linenos">542</span></a><span class="sd">                * &#39;best&#39;: The prediction is based on the best model.</span>
</span><span id="ForecastModelSelect.update-543"><a href="#ForecastModelSelect.update-543"><span class="linenos">543</span></a><span class="sd">                * &#39;best_horizon&#39;: The prediction is based on the best model for each horizon.</span>
</span><span id="ForecastModelSelect.update-544"><a href="#ForecastModelSelect.update-544"><span class="linenos">544</span></a><span class="sd">                * &#39;average&#39;: The average of the prediction of all models.</span>
</span><span id="ForecastModelSelect.update-545"><a href="#ForecastModelSelect.update-545"><span class="linenos">545</span></a><span class="sd">                * &#39;inverse_score&#39;: The weighted average prediction, where weights are inversely proportional to the model performance score.</span>
</span><span id="ForecastModelSelect.update-546"><a href="#ForecastModelSelect.update-546"><span class="linenos">546</span></a><span class="sd">                * &#39;nbest_average&#39;: Average of the n best models. The n is given by the parameter nbest.</span>
</span><span id="ForecastModelSelect.update-547"><a href="#ForecastModelSelect.update-547"><span class="linenos">547</span></a><span class="sd">                * &#39;nbest_average_horizon&#39;: Average of the n best models for each horizon. The n is given by the parameter nbest.</span>
</span><span id="ForecastModelSelect.update-548"><a href="#ForecastModelSelect.update-548"><span class="linenos">548</span></a><span class="sd">                * &#39;model&#39;: Returns the prediction of a specific model. The model name must be provided in the model_name parameter.</span>
</span><span id="ForecastModelSelect.update-549"><a href="#ForecastModelSelect.update-549"><span class="linenos">549</span></a><span class="sd">            score : str, optional</span>
</span><span id="ForecastModelSelect.update-550"><a href="#ForecastModelSelect.update-550"><span class="linenos">550</span></a><span class="sd">                The performance metric to use for model comparison. Should be either &#39;RMSE&#39; or &#39;MAPE&#39;. Default is None and it takes the value entered at initialization..</span>
</span><span id="ForecastModelSelect.update-551"><a href="#ForecastModelSelect.update-551"><span class="linenos">551</span></a><span class="sd">            nbest : int, optional</span>
</span><span id="ForecastModelSelect.update-552"><a href="#ForecastModelSelect.update-552"><span class="linenos">552</span></a><span class="sd">                The number of best models to select based on horizon performance. Default is None and it takes the value entered at initialization. and it takes the value entered at initialization..</span>
</span><span id="ForecastModelSelect.update-553"><a href="#ForecastModelSelect.update-553"><span class="linenos">553</span></a><span class="sd">            model_name: str, optional</span>
</span><span id="ForecastModelSelect.update-554"><a href="#ForecastModelSelect.update-554"><span class="linenos">554</span></a><span class="sd">                The model name to use for prediction if mode=&#39;model&#39;. Default is None.</span>
</span><span id="ForecastModelSelect.update-555"><a href="#ForecastModelSelect.update-555"><span class="linenos">555</span></a><span class="sd">            ret_underlying : bool, optional</span>
</span><span id="ForecastModelSelect.update-556"><a href="#ForecastModelSelect.update-556"><span class="linenos">556</span></a><span class="sd">                If True, return the underlying predictions and prediction intervals for each model. Default is False.</span>
</span><span id="ForecastModelSelect.update-557"><a href="#ForecastModelSelect.update-557"><span class="linenos">557</span></a>
</span><span id="ForecastModelSelect.update-558"><a href="#ForecastModelSelect.update-558"><span class="linenos">558</span></a><span class="sd">        Returns:</span>
</span><span id="ForecastModelSelect.update-559"><a href="#ForecastModelSelect.update-559"><span class="linenos">559</span></a><span class="sd">        -------</span>
</span><span id="ForecastModelSelect.update-560"><a href="#ForecastModelSelect.update-560"><span class="linenos">560</span></a><span class="sd">            tuple</span>
</span><span id="ForecastModelSelect.update-561"><a href="#ForecastModelSelect.update-561"><span class="linenos">561</span></a><span class="sd">                A tuple containing the aggregated prediction and prediction intervals.</span>
</span><span id="ForecastModelSelect.update-562"><a href="#ForecastModelSelect.update-562"><span class="linenos">562</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect.update-563"><a href="#ForecastModelSelect.update-563"><span class="linenos">563</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect.update-564"><a href="#ForecastModelSelect.update-564"><span class="linenos">564</span></a>            <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span>
</span><span id="ForecastModelSelect.update-565"><a href="#ForecastModelSelect.update-565"><span class="linenos">565</span></a>
</span><span id="ForecastModelSelect.update-566"><a href="#ForecastModelSelect.update-566"><span class="linenos">566</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;model&#39;</span><span class="p">:</span>
</span><span id="ForecastModelSelect.update-567"><a href="#ForecastModelSelect.update-567"><span class="linenos">567</span></a>            <span class="k">assert</span> <span class="n">model_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="s1">&#39;Model name not in the list of models&#39;</span>
</span><span id="ForecastModelSelect.update-568"><a href="#ForecastModelSelect.update-568"><span class="linenos">568</span></a>            <span class="n">_lf_X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__stage_X</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="p">[</span><span class="n">model_name</span><span class="p">],</span> <span class="n">new_X</span><span class="p">)</span>
</span><span id="ForecastModelSelect.update-569"><a href="#ForecastModelSelect.update-569"><span class="linenos">569</span></a>            <span class="n">pred</span><span class="p">,</span> <span class="n">pred_int</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">new_y</span><span class="o">=</span><span class="n">new_y</span><span class="p">,</span> <span class="n">new_X</span><span class="o">=</span><span class="n">_lf_X</span><span class="p">,</span> <span class="n">fh</span><span class="o">=</span><span class="n">fh</span><span class="p">,</span> <span class="n">coverage</span><span class="o">=</span><span class="n">coverage</span><span class="p">,</span> <span class="n">refit</span><span class="o">=</span><span class="n">refit</span><span class="p">)</span>
</span><span id="ForecastModelSelect.update-570"><a href="#ForecastModelSelect.update-570"><span class="linenos">570</span></a>            <span class="k">if</span> <span class="n">ret_underlying</span><span class="p">:</span>
</span><span id="ForecastModelSelect.update-571"><a href="#ForecastModelSelect.update-571"><span class="linenos">571</span></a>                <span class="k">return</span> <span class="n">pred</span><span class="p">,</span> <span class="n">pred_int</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="ForecastModelSelect.update-572"><a href="#ForecastModelSelect.update-572"><span class="linenos">572</span></a>            <span class="k">else</span><span class="p">:</span> 
</span><span id="ForecastModelSelect.update-573"><a href="#ForecastModelSelect.update-573"><span class="linenos">573</span></a>                <span class="k">return</span> <span class="n">pred</span><span class="p">,</span> <span class="n">pred_int</span>
</span><span id="ForecastModelSelect.update-574"><a href="#ForecastModelSelect.update-574"><span class="linenos">574</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ForecastModelSelect.update-575"><a href="#ForecastModelSelect.update-575"><span class="linenos">575</span></a>            <span class="k">if</span> <span class="n">reevaluate</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>            
</span><span id="ForecastModelSelect.update-576"><a href="#ForecastModelSelect.update-576"><span class="linenos">576</span></a>                <span class="n">preds</span> <span class="o">=</span> <span class="p">{};</span> <span class="n">pred_ints</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ForecastModelSelect.update-577"><a href="#ForecastModelSelect.update-577"><span class="linenos">577</span></a>                <span class="k">for</span> <span class="n">_lf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="ForecastModelSelect.update-578"><a href="#ForecastModelSelect.update-578"><span class="linenos">578</span></a>                    <span class="n">_lf_X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__stage_X</span><span class="p">(</span><span class="n">_lf</span><span class="p">,</span> <span class="n">new_X</span><span class="p">)</span>
</span><span id="ForecastModelSelect.update-579"><a href="#ForecastModelSelect.update-579"><span class="linenos">579</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="ForecastModelSelect.update-580"><a href="#ForecastModelSelect.update-580"><span class="linenos">580</span></a>                        <span class="n">_y_pred</span><span class="p">,</span> <span class="n">_y_pred_ints</span> <span class="o">=</span> <span class="n">_lf</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">new_y</span><span class="o">=</span><span class="n">new_y</span><span class="p">,</span> <span class="n">new_X</span><span class="o">=</span><span class="n">_lf_X</span><span class="p">,</span> 
</span><span id="ForecastModelSelect.update-581"><a href="#ForecastModelSelect.update-581"><span class="linenos">581</span></a>                                                           <span class="n">fh</span><span class="o">=</span><span class="n">fh</span><span class="p">,</span> <span class="n">coverage</span><span class="o">=</span><span class="n">coverage</span><span class="p">,</span> <span class="n">refit</span><span class="o">=</span><span class="n">refit</span><span class="p">)</span>
</span><span id="ForecastModelSelect.update-582"><a href="#ForecastModelSelect.update-582"><span class="linenos">582</span></a>                        <span class="n">preds</span><span class="p">[</span><span class="n">_lf</span><span class="o">.</span><span class="n">forecaster_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">_y_pred</span>
</span><span id="ForecastModelSelect.update-583"><a href="#ForecastModelSelect.update-583"><span class="linenos">583</span></a>                        <span class="n">pred_ints</span><span class="p">[</span><span class="n">_lf</span><span class="o">.</span><span class="n">forecaster_name</span><span class="p">]</span> <span class="o">=</span><span class="n">_y_pred_ints</span>
</span><span id="ForecastModelSelect.update-584"><a href="#ForecastModelSelect.update-584"><span class="linenos">584</span></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="ForecastModelSelect.update-585"><a href="#ForecastModelSelect.update-585"><span class="linenos">585</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error updating </span><span class="si">{</span><span class="n">_lf</span><span class="o">.</span><span class="n">forecaster_name</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ForecastModelSelect.update-586"><a href="#ForecastModelSelect.update-586"><span class="linenos">586</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;model </span><span class="si">{</span><span class="n">_lf</span><span class="o">.</span><span class="n">forecaster_name</span><span class="si">}</span><span class="s2"> cannot be updated. It won&#39;t be considered for forecasts&quot;</span><span class="p">)</span>
</span><span id="ForecastModelSelect.update-587"><a href="#ForecastModelSelect.update-587"><span class="linenos">587</span></a>                        <span class="k">continue</span>                   
</span><span id="ForecastModelSelect.update-588"><a href="#ForecastModelSelect.update-588"><span class="linenos">588</span></a>
</span><span id="ForecastModelSelect.update-589"><a href="#ForecastModelSelect.update-589"><span class="linenos">589</span></a>                <span class="n">preds</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">preds</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">keys</span> <span class="o">=</span> <span class="n">preds</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ForecastModelSelect.update-590"><a href="#ForecastModelSelect.update-590"><span class="linenos">590</span></a>                <span class="n">pred_ints</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">pred_ints</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">keys</span> <span class="o">=</span> <span class="n">pred_ints</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ForecastModelSelect.update-591"><a href="#ForecastModelSelect.update-591"><span class="linenos">591</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__aggregate_pred</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">preds</span><span class="o">=</span><span class="n">preds</span><span class="p">,</span> <span class="n">pred_ints</span><span class="o">=</span><span class="n">pred_ints</span><span class="p">,</span> <span class="n">score</span><span class="o">=</span><span class="n">score</span><span class="p">,</span> <span class="n">ret_underlying</span><span class="o">=</span><span class="n">ret_underlying</span><span class="p">)</span>
</span><span id="ForecastModelSelect.update-592"><a href="#ForecastModelSelect.update-592"><span class="linenos">592</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ForecastModelSelect.update-593"><a href="#ForecastModelSelect.update-593"><span class="linenos">593</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ForecastModelSelect.update-594"><a href="#ForecastModelSelect.update-594"><span class="linenos">594</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">select_best</span><span class="p">(</span><span class="n">score</span> <span class="o">=</span> <span class="n">score</span><span class="p">,</span> <span class="n">reestimate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ForecastModelSelect.update-595"><a href="#ForecastModelSelect.update-595"><span class="linenos">595</span></a>                <span class="n">preds</span> <span class="o">=</span> <span class="p">{};</span> <span class="n">pred_ints</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ForecastModelSelect.update-596"><a href="#ForecastModelSelect.update-596"><span class="linenos">596</span></a>                <span class="k">for</span> <span class="n">_lf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="ForecastModelSelect.update-597"><a href="#ForecastModelSelect.update-597"><span class="linenos">597</span></a>                    <span class="n">_lf_X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__stage_X</span><span class="p">(</span><span class="n">_lf</span><span class="p">,</span> <span class="n">new_X</span><span class="p">)</span>
</span><span id="ForecastModelSelect.update-598"><a href="#ForecastModelSelect.update-598"><span class="linenos">598</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="ForecastModelSelect.update-599"><a href="#ForecastModelSelect.update-599"><span class="linenos">599</span></a>                        <span class="n">_y_pred</span><span class="p">,</span> <span class="n">_y_pred_ints</span> <span class="o">=</span> <span class="n">_lf</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">new_y</span><span class="o">=</span><span class="n">new_y</span><span class="p">,</span> <span class="n">new_X</span><span class="o">=</span><span class="n">_lf_X</span><span class="p">,</span> <span class="n">fh</span><span class="o">=</span><span class="n">fh</span><span class="p">,</span> <span class="n">coverage</span><span class="o">=</span><span class="n">coverage</span><span class="p">,</span> <span class="n">refit</span><span class="o">=</span><span class="n">refit</span><span class="p">)</span>
</span><span id="ForecastModelSelect.update-600"><a href="#ForecastModelSelect.update-600"><span class="linenos">600</span></a>                        <span class="n">preds</span><span class="p">[</span><span class="n">_lf</span><span class="o">.</span><span class="n">forecaster_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">_y_pred</span>
</span><span id="ForecastModelSelect.update-601"><a href="#ForecastModelSelect.update-601"><span class="linenos">601</span></a>                        <span class="n">pred_ints</span><span class="p">[</span><span class="n">_lf</span><span class="o">.</span><span class="n">forecaster_name</span><span class="p">]</span> <span class="o">=</span><span class="n">_y_pred_ints</span>
</span><span id="ForecastModelSelect.update-602"><a href="#ForecastModelSelect.update-602"><span class="linenos">602</span></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="ForecastModelSelect.update-603"><a href="#ForecastModelSelect.update-603"><span class="linenos">603</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error updating </span><span class="si">{</span><span class="n">_lf</span><span class="o">.</span><span class="n">forecaster_name</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ForecastModelSelect.update-604"><a href="#ForecastModelSelect.update-604"><span class="linenos">604</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;model </span><span class="si">{</span><span class="n">_lf</span><span class="o">.</span><span class="n">forecaster_name</span><span class="si">}</span><span class="s1"> cannot be updated. It will be considered for forecasts&#39;</span><span class="p">)</span>
</span><span id="ForecastModelSelect.update-605"><a href="#ForecastModelSelect.update-605"><span class="linenos">605</span></a>                        <span class="k">continue</span>                   
</span><span id="ForecastModelSelect.update-606"><a href="#ForecastModelSelect.update-606"><span class="linenos">606</span></a>                <span class="n">preds</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">preds</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">keys</span> <span class="o">=</span> <span class="n">preds</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ForecastModelSelect.update-607"><a href="#ForecastModelSelect.update-607"><span class="linenos">607</span></a>                <span class="n">pred_ints</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">pred_ints</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">keys</span> <span class="o">=</span> <span class="n">pred_ints</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ForecastModelSelect.update-608"><a href="#ForecastModelSelect.update-608"><span class="linenos">608</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__aggregate_pred</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">preds</span><span class="o">=</span><span class="n">preds</span><span class="p">,</span> <span class="n">pred_ints</span><span class="o">=</span><span class="n">pred_ints</span><span class="p">,</span> <span class="n">score</span><span class="o">=</span><span class="n">score</span><span class="p">,</span> <span class="n">ret_underlying</span><span class="o">=</span><span class="n">ret_underlying</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Function to update the prediction for all the models and aggregate them based on the specific mode.</p>

<h2 id="parameters">Parameters:</h2>

<pre><code>newdata : pd.DataFrame
    The new data for updating the predictions.
refit : bool, optional
    If False, generate the prediction without fitting the model. If True, fits the underlying models again on the entire sample
    Default is False
reevaluate: bool, optional    
    Reapply the cross-validateion, evaluate the models out of sample, select the best models, then aggregate the predictions according the setup.
    Default is False.
fh : ForecastingHorizon, optional
    The forecasting horizon. Default is None and it takes the value entered at initialization..
coverage : float, optional
    The prediction interval coverage. Default is 0.9.
mode : str, optional
    The aggregation mode for predictions. Default is None and it takes the value entered at initialization..
    Available values:
    * 'best': The prediction is based on the best model.
    * 'best_horizon': The prediction is based on the best model for each horizon.
    * 'average': The average of the prediction of all models.
    * 'inverse_score': The weighted average prediction, where weights are inversely proportional to the model performance score.
    * 'nbest_average': Average of the n best models. The n is given by the parameter nbest.
    * 'nbest_average_horizon': Average of the n best models for each horizon. The n is given by the parameter nbest.
    * 'model': Returns the prediction of a specific model. The model name must be provided in the model_name parameter.
score : str, optional
    The performance metric to use for model comparison. Should be either 'RMSE' or 'MAPE'. Default is None and it takes the value entered at initialization..
nbest : int, optional
    The number of best models to select based on horizon performance. Default is None and it takes the value entered at initialization. and it takes the value entered at initialization..
model_name: str, optional
    The model name to use for prediction if mode='model'. Default is None.
ret_underlying : bool, optional
    If True, return the underlying predictions and prediction intervals for each model. Default is False.
</code></pre>

<h2 id="returns">Returns:</h2>

<pre><code>tuple
    A tuple containing the aggregated prediction and prediction intervals.
</code></pre>
</div>


                            </div>
                            <div id="ForecastModelSelect.save" class="classattr">
                                        <input id="ForecastModelSelect.save-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">save</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">path</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ForecastModelSelect.save-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ForecastModelSelect.save"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ForecastModelSelect.save-610"><a href="#ForecastModelSelect.save-610"><span class="linenos">610</span></a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="ForecastModelSelect.save-611"><a href="#ForecastModelSelect.save-611"><span class="linenos">611</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect.save-612"><a href="#ForecastModelSelect.save-612"><span class="linenos">612</span></a><span class="sd">        Save the model to a file.</span>
</span><span id="ForecastModelSelect.save-613"><a href="#ForecastModelSelect.save-613"><span class="linenos">613</span></a><span class="sd">        Parameters:</span>
</span><span id="ForecastModelSelect.save-614"><a href="#ForecastModelSelect.save-614"><span class="linenos">614</span></a><span class="sd">        -----------</span>
</span><span id="ForecastModelSelect.save-615"><a href="#ForecastModelSelect.save-615"><span class="linenos">615</span></a><span class="sd">            path : str</span>
</span><span id="ForecastModelSelect.save-616"><a href="#ForecastModelSelect.save-616"><span class="linenos">616</span></a><span class="sd">                The path to save the model.</span>
</span><span id="ForecastModelSelect.save-617"><a href="#ForecastModelSelect.save-617"><span class="linenos">617</span></a><span class="sd">        Returns:</span>
</span><span id="ForecastModelSelect.save-618"><a href="#ForecastModelSelect.save-618"><span class="linenos">618</span></a><span class="sd">        --------</span>
</span><span id="ForecastModelSelect.save-619"><a href="#ForecastModelSelect.save-619"><span class="linenos">619</span></a><span class="sd">            None</span>
</span><span id="ForecastModelSelect.save-620"><a href="#ForecastModelSelect.save-620"><span class="linenos">620</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect.save-621"><a href="#ForecastModelSelect.save-621"><span class="linenos">621</span></a>        <span class="kn">import</span> <span class="nn">pickle</span>
</span><span id="ForecastModelSelect.save-622"><a href="#ForecastModelSelect.save-622"><span class="linenos">622</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="ForecastModelSelect.save-623"><a href="#ForecastModelSelect.save-623"><span class="linenos">623</span></a>            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="ForecastModelSelect.save-624"><a href="#ForecastModelSelect.save-624"><span class="linenos">624</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Save the model to a file.</p>

<h2 id="parameters">Parameters:</h2>

<pre><code>path : str
    The path to save the model.
</code></pre>

<h2 id="returns">Returns:</h2>

<pre><code>None
</code></pre>
</div>


                            </div>
                            <div id="ForecastModelSelect.get_pred_errors" class="classattr">
                                        <input id="ForecastModelSelect.get_pred_errors-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_pred_errors</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">score</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">model_name</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ForecastModelSelect.get_pred_errors-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ForecastModelSelect.get_pred_errors"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ForecastModelSelect.get_pred_errors-626"><a href="#ForecastModelSelect.get_pred_errors-626"><span class="linenos">626</span></a>    <span class="k">def</span> <span class="nf">get_pred_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="ForecastModelSelect.get_pred_errors-627"><a href="#ForecastModelSelect.get_pred_errors-627"><span class="linenos">627</span></a>                        <span class="n">mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ForecastModelSelect.get_pred_errors-628"><a href="#ForecastModelSelect.get_pred_errors-628"><span class="linenos">628</span></a>                        <span class="n">score</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ForecastModelSelect.get_pred_errors-629"><a href="#ForecastModelSelect.get_pred_errors-629"><span class="linenos">629</span></a>                        <span class="n">model_name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
</span><span id="ForecastModelSelect.get_pred_errors-630"><a href="#ForecastModelSelect.get_pred_errors-630"><span class="linenos">630</span></a>                        <span class="p">):</span>
</span><span id="ForecastModelSelect.get_pred_errors-631"><a href="#ForecastModelSelect.get_pred_errors-631"><span class="linenos">631</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect.get_pred_errors-632"><a href="#ForecastModelSelect.get_pred_errors-632"><span class="linenos">632</span></a><span class="sd">        Get the prediction errors.</span>
</span><span id="ForecastModelSelect.get_pred_errors-633"><a href="#ForecastModelSelect.get_pred_errors-633"><span class="linenos">633</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect.get_pred_errors-634"><a href="#ForecastModelSelect.get_pred_errors-634"><span class="linenos">634</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect.get_pred_errors-635"><a href="#ForecastModelSelect.get_pred_errors-635"><span class="linenos">635</span></a>            <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span>
</span><span id="ForecastModelSelect.get_pred_errors-636"><a href="#ForecastModelSelect.get_pred_errors-636"><span class="linenos">636</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;model&#39;</span><span class="p">:</span>
</span><span id="ForecastModelSelect.get_pred_errors-637"><a href="#ForecastModelSelect.get_pred_errors-637"><span class="linenos">637</span></a>            <span class="k">assert</span> <span class="n">model_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="s1">&#39;Model name not in the list of models&#39;</span>
</span><span id="ForecastModelSelect.get_pred_errors-638"><a href="#ForecastModelSelect.get_pred_errors-638"><span class="linenos">638</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span><span class="o">.</span><span class="n">get_pred_errors</span><span class="p">()</span>
</span><span id="ForecastModelSelect.get_pred_errors-639"><a href="#ForecastModelSelect.get_pred_errors-639"><span class="linenos">639</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ForecastModelSelect.get_pred_errors-640"><a href="#ForecastModelSelect.get_pred_errors-640"><span class="linenos">640</span></a>            <span class="k">if</span> <span class="n">score</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect.get_pred_errors-641"><a href="#ForecastModelSelect.get_pred_errors-641"><span class="linenos">641</span></a>                <span class="n">score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score</span>
</span><span id="ForecastModelSelect.get_pred_errors-642"><a href="#ForecastModelSelect.get_pred_errors-642"><span class="linenos">642</span></a>            
</span><span id="ForecastModelSelect.get_pred_errors-643"><a href="#ForecastModelSelect.get_pred_errors-643"><span class="linenos">643</span></a>            <span class="c1"># Using ProcessPoolExecutor to execute computation-heavy tasks in parallel</span>
</span><span id="ForecastModelSelect.get_pred_errors-644"><a href="#ForecastModelSelect.get_pred_errors-644"><span class="linenos">644</span></a>            <span class="k">with</span> <span class="n">ProcessPoolExecutor</span><span class="p">()</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
</span><span id="ForecastModelSelect.get_pred_errors-645"><a href="#ForecastModelSelect.get_pred_errors-645"><span class="linenos">645</span></a>                <span class="n">results</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">fetch_errors</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</span><span id="ForecastModelSelect.get_pred_errors-646"><a href="#ForecastModelSelect.get_pred_errors-646"><span class="linenos">646</span></a>            <span class="n">errors</span> <span class="o">=</span> <span class="p">{</span><span class="n">fname</span><span class="p">:</span> <span class="n">err</span> <span class="k">for</span> <span class="n">fname</span><span class="p">,</span> <span class="n">err</span> <span class="ow">in</span> <span class="n">results</span><span class="p">}</span>
</span><span id="ForecastModelSelect.get_pred_errors-647"><a href="#ForecastModelSelect.get_pred_errors-647"><span class="linenos">647</span></a>            <span class="k">for</span> <span class="n">_fname</span><span class="p">,</span> <span class="n">_lf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ForecastModelSelect.get_pred_errors-648"><a href="#ForecastModelSelect.get_pred_errors-648"><span class="linenos">648</span></a>                <span class="n">_lf</span><span class="o">.</span><span class="n">_fitted</span><span class="o">.</span><span class="n">insample_result_df</span> <span class="o">=</span> <span class="n">errors</span><span class="p">[</span><span class="n">_fname</span><span class="p">]</span>
</span><span id="ForecastModelSelect.get_pred_errors-649"><a href="#ForecastModelSelect.get_pred_errors-649"><span class="linenos">649</span></a>
</span><span id="ForecastModelSelect.get_pred_errors-650"><a href="#ForecastModelSelect.get_pred_errors-650"><span class="linenos">650</span></a>            <span class="c1"># Convert results to dictionary            </span>
</span><span id="ForecastModelSelect.get_pred_errors-651"><a href="#ForecastModelSelect.get_pred_errors-651"><span class="linenos">651</span></a>            <span class="n">errors_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">errors</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">keys</span> <span class="o">=</span> <span class="n">errors</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="ForecastModelSelect.get_pred_errors-652"><a href="#ForecastModelSelect.get_pred_errors-652"><span class="linenos">652</span></a>            <span class="n">errors_df</span> <span class="o">=</span> <span class="n">errors_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;level_0&#39;</span><span class="p">:</span> <span class="s1">&#39;forecaster&#39;</span><span class="p">})</span>
</span><span id="ForecastModelSelect.get_pred_errors-653"><a href="#ForecastModelSelect.get_pred_errors-653"><span class="linenos">653</span></a>
</span><span id="ForecastModelSelect.get_pred_errors-654"><a href="#ForecastModelSelect.get_pred_errors-654"><span class="linenos">654</span></a>
</span><span id="ForecastModelSelect.get_pred_errors-655"><a href="#ForecastModelSelect.get_pred_errors-655"><span class="linenos">655</span></a>            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span><span class="s1">&#39;best&#39;</span><span class="p">:</span>
</span><span id="ForecastModelSelect.get_pred_errors-656"><a href="#ForecastModelSelect.get_pred_errors-656"><span class="linenos">656</span></a>                <span class="k">return</span> <span class="n">errors</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_best_x_overall</span><span class="p">[</span><span class="n">score</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ForecastModelSelect.get_pred_errors-657"><a href="#ForecastModelSelect.get_pred_errors-657"><span class="linenos">657</span></a>            
</span><span id="ForecastModelSelect.get_pred_errors-658"><a href="#ForecastModelSelect.get_pred_errors-658"><span class="linenos">658</span></a>            <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span><span class="s1">&#39;best_horizon&#39;</span><span class="p">:</span>
</span><span id="ForecastModelSelect.get_pred_errors-659"><a href="#ForecastModelSelect.get_pred_errors-659"><span class="linenos">659</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_rank_perhorizon</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect.get_pred_errors-660"><a href="#ForecastModelSelect.get_pred_errors-660"><span class="linenos">660</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">select_best</span><span class="p">()</span>
</span><span id="ForecastModelSelect.get_pred_errors-661"><a href="#ForecastModelSelect.get_pred_errors-661"><span class="linenos">661</span></a>                <span class="n">best_horizon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_rank_perhorizon</span><span class="p">[</span><span class="n">score</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Best_1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span><span id="ForecastModelSelect.get_pred_errors-662"><a href="#ForecastModelSelect.get_pred_errors-662"><span class="linenos">662</span></a>                <span class="n">error_horizon_l</span> <span class="o">=</span> <span class="p">[</span><span class="n">errors</span><span class="p">[</span><span class="n">best_mod_h</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">errors</span><span class="p">[</span><span class="n">best_mod_h</span><span class="p">][</span><span class="s1">&#39;horizon&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">h</span><span class="p">]</span> <span class="k">for</span> <span class="n">h</span><span class="p">,</span> <span class="n">best_mod_h</span> <span class="ow">in</span> <span class="n">best_horizon</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
</span><span id="ForecastModelSelect.get_pred_errors-663"><a href="#ForecastModelSelect.get_pred_errors-663"><span class="linenos">663</span></a>                <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">error_horizon_l</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ForecastModelSelect.get_pred_errors-664"><a href="#ForecastModelSelect.get_pred_errors-664"><span class="linenos">664</span></a>            
</span><span id="ForecastModelSelect.get_pred_errors-665"><a href="#ForecastModelSelect.get_pred_errors-665"><span class="linenos">665</span></a>            <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span><span class="s1">&#39;average&#39;</span><span class="p">:</span>
</span><span id="ForecastModelSelect.get_pred_errors-666"><a href="#ForecastModelSelect.get_pred_errors-666"><span class="linenos">666</span></a>                <span class="k">return</span> <span class="n">errors_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;cutoff&#39;</span><span class="p">,</span> <span class="s1">&#39;horizon&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>               
</span><span id="ForecastModelSelect.get_pred_errors-667"><a href="#ForecastModelSelect.get_pred_errors-667"><span class="linenos">667</span></a>            
</span><span id="ForecastModelSelect.get_pred_errors-668"><a href="#ForecastModelSelect.get_pred_errors-668"><span class="linenos">668</span></a>            <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span><span class="s1">&#39;inverse_score&#39;</span><span class="p">:</span>
</span><span id="ForecastModelSelect.get_pred_errors-669"><a href="#ForecastModelSelect.get_pred_errors-669"><span class="linenos">669</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary_results</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect.get_pred_errors-670"><a href="#ForecastModelSelect.get_pred_errors-670"><span class="linenos">670</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">()</span>
</span><span id="ForecastModelSelect.get_pred_errors-671"><a href="#ForecastModelSelect.get_pred_errors-671"><span class="linenos">671</span></a>                <span class="n">_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;Avg </span><span class="si">{</span><span class="n">score</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>
</span><span id="ForecastModelSelect.get_pred_errors-672"><a href="#ForecastModelSelect.get_pred_errors-672"><span class="linenos">672</span></a>                <span class="n">_score</span> <span class="o">=</span> <span class="n">_score</span><span class="o">/</span><span class="n">_score</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="ForecastModelSelect.get_pred_errors-673"><a href="#ForecastModelSelect.get_pred_errors-673"><span class="linenos">673</span></a>                <span class="n">errors_df</span><span class="p">[</span><span class="s1">&#39;_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">errors_df</span><span class="p">[</span><span class="s1">&#39;forecaster&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">_score</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>
</span><span id="ForecastModelSelect.get_pred_errors-674"><a href="#ForecastModelSelect.get_pred_errors-674"><span class="linenos">674</span></a>                <span class="n">errors_df</span><span class="p">[</span><span class="s1">&#39;weighted_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">errors_df</span><span class="p">[</span><span class="s1">&#39;_score&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">errors_df</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span>
</span><span id="ForecastModelSelect.get_pred_errors-675"><a href="#ForecastModelSelect.get_pred_errors-675"><span class="linenos">675</span></a>                <span class="k">return</span> <span class="n">errors_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;cutoff&#39;</span><span class="p">,</span> <span class="s1">&#39;horizon&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">weighted_error</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="ForecastModelSelect.get_pred_errors-676"><a href="#ForecastModelSelect.get_pred_errors-676"><span class="linenos">676</span></a>            
</span><span id="ForecastModelSelect.get_pred_errors-677"><a href="#ForecastModelSelect.get_pred_errors-677"><span class="linenos">677</span></a>            <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span><span class="s1">&#39;nbest_average&#39;</span><span class="p">:</span>
</span><span id="ForecastModelSelect.get_pred_errors-678"><a href="#ForecastModelSelect.get_pred_errors-678"><span class="linenos">678</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_best_x_overall</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect.get_pred_errors-679"><a href="#ForecastModelSelect.get_pred_errors-679"><span class="linenos">679</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">select_best</span><span class="p">()</span>
</span><span id="ForecastModelSelect.get_pred_errors-680"><a href="#ForecastModelSelect.get_pred_errors-680"><span class="linenos">680</span></a>                <span class="k">return</span> <span class="n">errors_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">errors_df</span><span class="o">.</span><span class="n">forecaster</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_best_x_overall</span><span class="p">[</span><span class="n">score</span><span class="p">])]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;cutoff&#39;</span><span class="p">,</span> <span class="s1">&#39;horizon&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="ForecastModelSelect.get_pred_errors-681"><a href="#ForecastModelSelect.get_pred_errors-681"><span class="linenos">681</span></a>            
</span><span id="ForecastModelSelect.get_pred_errors-682"><a href="#ForecastModelSelect.get_pred_errors-682"><span class="linenos">682</span></a>            <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span><span class="s1">&#39;nbest_average_horizon&#39;</span><span class="p">:</span>
</span><span id="ForecastModelSelect.get_pred_errors-683"><a href="#ForecastModelSelect.get_pred_errors-683"><span class="linenos">683</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_rank_perhorizon</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect.get_pred_errors-684"><a href="#ForecastModelSelect.get_pred_errors-684"><span class="linenos">684</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">select_best</span><span class="p">()</span>
</span><span id="ForecastModelSelect.get_pred_errors-685"><a href="#ForecastModelSelect.get_pred_errors-685"><span class="linenos">685</span></a>                <span class="n">best_horizon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_rank_perhorizon</span><span class="p">[</span><span class="n">score</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">_nbest</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
</span><span id="ForecastModelSelect.get_pred_errors-686"><a href="#ForecastModelSelect.get_pred_errors-686"><span class="linenos">686</span></a>                <span class="n">best_horizon</span> <span class="o">=</span> <span class="n">best_horizon</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span><span id="ForecastModelSelect.get_pred_errors-687"><a href="#ForecastModelSelect.get_pred_errors-687"><span class="linenos">687</span></a>                <span class="n">errors_best_horizon</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ForecastModelSelect.get_pred_errors-688"><a href="#ForecastModelSelect.get_pred_errors-688"><span class="linenos">688</span></a>                <span class="k">for</span> <span class="n">h</span><span class="p">,</span> <span class="n">best_mod_h</span> <span class="ow">in</span> <span class="n">best_horizon</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ForecastModelSelect.get_pred_errors-689"><a href="#ForecastModelSelect.get_pred_errors-689"><span class="linenos">689</span></a>                    <span class="n">errors_best_horizon</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">errors_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">errors_df</span><span class="o">.</span><span class="n">horizon</span><span class="o">==</span><span class="n">h</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">errors_df</span><span class="o">.</span><span class="n">forecaster</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">best_mod_h</span><span class="p">)]</span>\
</span><span id="ForecastModelSelect.get_pred_errors-690"><a href="#ForecastModelSelect.get_pred_errors-690"><span class="linenos">690</span></a>                        <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;cutoff&#39;</span><span class="p">,</span> <span class="s1">&#39;horizon&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">())</span>
</span><span id="ForecastModelSelect.get_pred_errors-691"><a href="#ForecastModelSelect.get_pred_errors-691"><span class="linenos">691</span></a>                <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">errors_best_horizon</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>            
</span><span id="ForecastModelSelect.get_pred_errors-692"><a href="#ForecastModelSelect.get_pred_errors-692"><span class="linenos">692</span></a>            
</span><span id="ForecastModelSelect.get_pred_errors-693"><a href="#ForecastModelSelect.get_pred_errors-693"><span class="linenos">693</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ForecastModelSelect.get_pred_errors-694"><a href="#ForecastModelSelect.get_pred_errors-694"><span class="linenos">694</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;mode can take the foloowing values: best, best_horizon, average, inverse_score, nbest_average, nbest_average_horizon, model&#39;</span><span class="p">)</span>        
</span></pre></div>


            <div class="docstring"><p>Get the prediction errors.</p>
</div>


                            </div>
                            <div id="ForecastModelSelect.plot_model_compare" class="classattr">
                                        <input id="ForecastModelSelect.plot_model_compare-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_model_compare</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">score</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;RMSE&#39;</span>,</span><span class="param">	<span class="n">view</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;horizon&#39;</span>,</span><span class="param">	<span class="n">model_subset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">xlabel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">ylabel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Out of Sample Performance&#39;</span>,</span><span class="param">	<span class="n">ax</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_axes</span><span class="o">.</span><span class="n">Axes</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">figsize</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">Figure</span><span class="p">,</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_axes</span><span class="o">.</span><span class="n">Axes</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="ForecastModelSelect.plot_model_compare-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ForecastModelSelect.plot_model_compare"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ForecastModelSelect.plot_model_compare-696"><a href="#ForecastModelSelect.plot_model_compare-696"><span class="linenos">696</span></a>    <span class="k">def</span> <span class="nf">plot_model_compare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="ForecastModelSelect.plot_model_compare-697"><a href="#ForecastModelSelect.plot_model_compare-697"><span class="linenos">697</span></a>                           <span class="n">score</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> 
</span><span id="ForecastModelSelect.plot_model_compare-698"><a href="#ForecastModelSelect.plot_model_compare-698"><span class="linenos">698</span></a>                           <span class="n">view</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;horizon&#39;</span><span class="p">,</span> 
</span><span id="ForecastModelSelect.plot_model_compare-699"><a href="#ForecastModelSelect.plot_model_compare-699"><span class="linenos">699</span></a>                           <span class="n">model_subset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ForecastModelSelect.plot_model_compare-700"><a href="#ForecastModelSelect.plot_model_compare-700"><span class="linenos">700</span></a>                           <span class="n">xlabel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
</span><span id="ForecastModelSelect.plot_model_compare-701"><a href="#ForecastModelSelect.plot_model_compare-701"><span class="linenos">701</span></a>                           <span class="n">ylabel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ForecastModelSelect.plot_model_compare-702"><a href="#ForecastModelSelect.plot_model_compare-702"><span class="linenos">702</span></a>                           <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Out of Sample Performance&#39;</span><span class="p">,</span> 
</span><span id="ForecastModelSelect.plot_model_compare-703"><a href="#ForecastModelSelect.plot_model_compare-703"><span class="linenos">703</span></a>                           <span class="n">ax</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
</span><span id="ForecastModelSelect.plot_model_compare-704"><a href="#ForecastModelSelect.plot_model_compare-704"><span class="linenos">704</span></a>                           <span class="n">figsize</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</span><span id="ForecastModelSelect.plot_model_compare-705"><a href="#ForecastModelSelect.plot_model_compare-705"><span class="linenos">705</span></a>                          <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]:</span>
</span><span id="ForecastModelSelect.plot_model_compare-706"><a href="#ForecastModelSelect.plot_model_compare-706"><span class="linenos">706</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect.plot_model_compare-707"><a href="#ForecastModelSelect.plot_model_compare-707"><span class="linenos">707</span></a><span class="sd">        Plot a comparison of models based on their out-of-sample performance.</span>
</span><span id="ForecastModelSelect.plot_model_compare-708"><a href="#ForecastModelSelect.plot_model_compare-708"><span class="linenos">708</span></a>
</span><span id="ForecastModelSelect.plot_model_compare-709"><a href="#ForecastModelSelect.plot_model_compare-709"><span class="linenos">709</span></a><span class="sd">        Parameters:</span>
</span><span id="ForecastModelSelect.plot_model_compare-710"><a href="#ForecastModelSelect.plot_model_compare-710"><span class="linenos">710</span></a><span class="sd">        -----------        </span>
</span><span id="ForecastModelSelect.plot_model_compare-711"><a href="#ForecastModelSelect.plot_model_compare-711"><span class="linenos">711</span></a><span class="sd">            score : str, optional</span>
</span><span id="ForecastModelSelect.plot_model_compare-712"><a href="#ForecastModelSelect.plot_model_compare-712"><span class="linenos">712</span></a><span class="sd">                The performance metric for comparison. Should be either &#39;RMSE&#39; or &#39;MAPE&#39;. Default is &#39;RMSE&#39;.</span>
</span><span id="ForecastModelSelect.plot_model_compare-713"><a href="#ForecastModelSelect.plot_model_compare-713"><span class="linenos">713</span></a><span class="sd">            view : str, optional</span>
</span><span id="ForecastModelSelect.plot_model_compare-714"><a href="#ForecastModelSelect.plot_model_compare-714"><span class="linenos">714</span></a><span class="sd">                The view mode for comparison, either &#39;horizon&#39; or &#39;cutoff&#39;. Default is &#39;horizon&#39;.</span>
</span><span id="ForecastModelSelect.plot_model_compare-715"><a href="#ForecastModelSelect.plot_model_compare-715"><span class="linenos">715</span></a><span class="sd">            xlabel : str, optional</span>
</span><span id="ForecastModelSelect.plot_model_compare-716"><a href="#ForecastModelSelect.plot_model_compare-716"><span class="linenos">716</span></a><span class="sd">                The label for the x-axis. Default is an empty string.</span>
</span><span id="ForecastModelSelect.plot_model_compare-717"><a href="#ForecastModelSelect.plot_model_compare-717"><span class="linenos">717</span></a><span class="sd">            ylabel : str, optional</span>
</span><span id="ForecastModelSelect.plot_model_compare-718"><a href="#ForecastModelSelect.plot_model_compare-718"><span class="linenos">718</span></a><span class="sd">                The label for the y-axis. Default is an empty string.</span>
</span><span id="ForecastModelSelect.plot_model_compare-719"><a href="#ForecastModelSelect.plot_model_compare-719"><span class="linenos">719</span></a><span class="sd">            title : str, optional</span>
</span><span id="ForecastModelSelect.plot_model_compare-720"><a href="#ForecastModelSelect.plot_model_compare-720"><span class="linenos">720</span></a><span class="sd">                The title of the plot. Default is &#39;Out of Sample Performance&#39;.</span>
</span><span id="ForecastModelSelect.plot_model_compare-721"><a href="#ForecastModelSelect.plot_model_compare-721"><span class="linenos">721</span></a><span class="sd">            ax : matplotlib.axes._subplots.AxesSubplot, optional</span>
</span><span id="ForecastModelSelect.plot_model_compare-722"><a href="#ForecastModelSelect.plot_model_compare-722"><span class="linenos">722</span></a><span class="sd">                The matplotlib axes to use for plotting. Default is None.</span>
</span><span id="ForecastModelSelect.plot_model_compare-723"><a href="#ForecastModelSelect.plot_model_compare-723"><span class="linenos">723</span></a><span class="sd">            figsize : tuple, optional</span>
</span><span id="ForecastModelSelect.plot_model_compare-724"><a href="#ForecastModelSelect.plot_model_compare-724"><span class="linenos">724</span></a><span class="sd">                The size of the figure in inches (width, height). Default is (15, 6).</span>
</span><span id="ForecastModelSelect.plot_model_compare-725"><a href="#ForecastModelSelect.plot_model_compare-725"><span class="linenos">725</span></a>
</span><span id="ForecastModelSelect.plot_model_compare-726"><a href="#ForecastModelSelect.plot_model_compare-726"><span class="linenos">726</span></a><span class="sd">        Returns:</span>
</span><span id="ForecastModelSelect.plot_model_compare-727"><a href="#ForecastModelSelect.plot_model_compare-727"><span class="linenos">727</span></a><span class="sd">        --------        </span>
</span><span id="ForecastModelSelect.plot_model_compare-728"><a href="#ForecastModelSelect.plot_model_compare-728"><span class="linenos">728</span></a><span class="sd">            matplotlib.figure.Figure or matplotlib.axes._subplots.AxesSubplot</span>
</span><span id="ForecastModelSelect.plot_model_compare-729"><a href="#ForecastModelSelect.plot_model_compare-729"><span class="linenos">729</span></a><span class="sd">                The figure and axes of the plot.</span>
</span><span id="ForecastModelSelect.plot_model_compare-730"><a href="#ForecastModelSelect.plot_model_compare-730"><span class="linenos">730</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect.plot_model_compare-731"><a href="#ForecastModelSelect.plot_model_compare-731"><span class="linenos">731</span></a>        
</span><span id="ForecastModelSelect.plot_model_compare-732"><a href="#ForecastModelSelect.plot_model_compare-732"><span class="linenos">732</span></a>        <span class="k">if</span> <span class="n">view</span> <span class="o">==</span><span class="s1">&#39;horizon&#39;</span><span class="p">:</span>
</span><span id="ForecastModelSelect.plot_model_compare-733"><a href="#ForecastModelSelect.plot_model_compare-733"><span class="linenos">733</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_avg_oos_horizon</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect.plot_model_compare-734"><a href="#ForecastModelSelect.plot_model_compare-734"><span class="linenos">734</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">select_best</span><span class="p">()</span>
</span><span id="ForecastModelSelect.plot_model_compare-735"><a href="#ForecastModelSelect.plot_model_compare-735"><span class="linenos">735</span></a>            <span class="n">toplot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_avg_oos_horizon</span><span class="p">[</span><span class="n">score</span><span class="p">]</span>
</span><span id="ForecastModelSelect.plot_model_compare-736"><a href="#ForecastModelSelect.plot_model_compare-736"><span class="linenos">736</span></a>
</span><span id="ForecastModelSelect.plot_model_compare-737"><a href="#ForecastModelSelect.plot_model_compare-737"><span class="linenos">737</span></a>        <span class="k">elif</span> <span class="n">view</span><span class="o">==</span><span class="s1">&#39;cutoff&#39;</span><span class="p">:</span>
</span><span id="ForecastModelSelect.plot_model_compare-738"><a href="#ForecastModelSelect.plot_model_compare-738"><span class="linenos">738</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary_cutoff</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect.plot_model_compare-739"><a href="#ForecastModelSelect.plot_model_compare-739"><span class="linenos">739</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">summary_per_cutoff</span><span class="p">()</span>
</span><span id="ForecastModelSelect.plot_model_compare-740"><a href="#ForecastModelSelect.plot_model_compare-740"><span class="linenos">740</span></a>            <span class="n">toplot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary_cutoff</span><span class="p">[</span><span class="n">score</span><span class="p">]</span>
</span><span id="ForecastModelSelect.plot_model_compare-741"><a href="#ForecastModelSelect.plot_model_compare-741"><span class="linenos">741</span></a>
</span><span id="ForecastModelSelect.plot_model_compare-742"><a href="#ForecastModelSelect.plot_model_compare-742"><span class="linenos">742</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ForecastModelSelect.plot_model_compare-743"><a href="#ForecastModelSelect.plot_model_compare-743"><span class="linenos">743</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;view can take only 2 values: horizon or cutoff&#39;</span><span class="p">)</span>
</span><span id="ForecastModelSelect.plot_model_compare-744"><a href="#ForecastModelSelect.plot_model_compare-744"><span class="linenos">744</span></a>
</span><span id="ForecastModelSelect.plot_model_compare-745"><a href="#ForecastModelSelect.plot_model_compare-745"><span class="linenos">745</span></a>        <span class="k">if</span> <span class="n">model_subset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect.plot_model_compare-746"><a href="#ForecastModelSelect.plot_model_compare-746"><span class="linenos">746</span></a>            <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="n">m</span> <span class="ow">in</span> <span class="n">toplot</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">model_subset</span><span class="p">]),</span> <span class="s1">&#39;Some models are not in the list of models&#39;</span>
</span><span id="ForecastModelSelect.plot_model_compare-747"><a href="#ForecastModelSelect.plot_model_compare-747"><span class="linenos">747</span></a>            <span class="n">toplot</span> <span class="o">=</span> <span class="n">toplot</span><span class="p">[</span><span class="n">model_subset</span><span class="p">]</span>
</span><span id="ForecastModelSelect.plot_model_compare-748"><a href="#ForecastModelSelect.plot_model_compare-748"><span class="linenos">748</span></a>        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect.plot_model_compare-749"><a href="#ForecastModelSelect.plot_model_compare-749"><span class="linenos">749</span></a>            <span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
</span><span id="ForecastModelSelect.plot_model_compare-750"><a href="#ForecastModelSelect.plot_model_compare-750"><span class="linenos">750</span></a>        <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect.plot_model_compare-751"><a href="#ForecastModelSelect.plot_model_compare-751"><span class="linenos">751</span></a>            <span class="n">ylabel</span> <span class="o">=</span> <span class="n">score</span>
</span><span id="ForecastModelSelect.plot_model_compare-752"><a href="#ForecastModelSelect.plot_model_compare-752"><span class="linenos">752</span></a>        <span class="k">if</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect.plot_model_compare-753"><a href="#ForecastModelSelect.plot_model_compare-753"><span class="linenos">753</span></a>            <span class="n">xlabel</span> <span class="o">=</span> <span class="n">view</span>
</span><span id="ForecastModelSelect.plot_model_compare-754"><a href="#ForecastModelSelect.plot_model_compare-754"><span class="linenos">754</span></a>        
</span><span id="ForecastModelSelect.plot_model_compare-755"><a href="#ForecastModelSelect.plot_model_compare-755"><span class="linenos">755</span></a>        <span class="n">nseries</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">toplot</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</span><span id="ForecastModelSelect.plot_model_compare-756"><a href="#ForecastModelSelect.plot_model_compare-756"><span class="linenos">756</span></a>        <span class="k">def</span> <span class="nf">expand_color_palette</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">n_colors_needed</span><span class="p">):</span>
</span><span id="ForecastModelSelect.plot_model_compare-757"><a href="#ForecastModelSelect.plot_model_compare-757"><span class="linenos">757</span></a>            <span class="n">base_array</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">n_colors</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">))</span>
</span><span id="ForecastModelSelect.plot_model_compare-758"><a href="#ForecastModelSelect.plot_model_compare-758"><span class="linenos">758</span></a>            <span class="n">color_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">base_array</span><span class="p">)</span>
</span><span id="ForecastModelSelect.plot_model_compare-759"><a href="#ForecastModelSelect.plot_model_compare-759"><span class="linenos">759</span></a>            
</span><span id="ForecastModelSelect.plot_model_compare-760"><a href="#ForecastModelSelect.plot_model_compare-760"><span class="linenos">760</span></a>            <span class="c1"># Interpolating colors</span>
</span><span id="ForecastModelSelect.plot_model_compare-761"><a href="#ForecastModelSelect.plot_model_compare-761"><span class="linenos">761</span></a>            <span class="n">new_colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">color_array</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">n_colors_needed</span><span class="p">),</span>
</span><span id="ForecastModelSelect.plot_model_compare-762"><a href="#ForecastModelSelect.plot_model_compare-762"><span class="linenos">762</span></a>                                            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">color_array</span><span class="p">)),</span> <span class="n">color_array</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span>
</span><span id="ForecastModelSelect.plot_model_compare-763"><a href="#ForecastModelSelect.plot_model_compare-763"><span class="linenos">763</span></a>                                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">color_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])])</span><span class="o">.</span><span class="n">T</span>
</span><span id="ForecastModelSelect.plot_model_compare-764"><a href="#ForecastModelSelect.plot_model_compare-764"><span class="linenos">764</span></a>            <span class="k">return</span> <span class="n">new_colors</span>
</span><span id="ForecastModelSelect.plot_model_compare-765"><a href="#ForecastModelSelect.plot_model_compare-765"><span class="linenos">765</span></a>
</span><span id="ForecastModelSelect.plot_model_compare-766"><a href="#ForecastModelSelect.plot_model_compare-766"><span class="linenos">766</span></a>        <span class="c1"># Get the initial colorblind palette</span>
</span><span id="ForecastModelSelect.plot_model_compare-767"><a href="#ForecastModelSelect.plot_model_compare-767"><span class="linenos">767</span></a>        <span class="n">initial_palette</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;colorblind&quot;</span><span class="p">)</span>
</span><span id="ForecastModelSelect.plot_model_compare-768"><a href="#ForecastModelSelect.plot_model_compare-768"><span class="linenos">768</span></a>
</span><span id="ForecastModelSelect.plot_model_compare-769"><a href="#ForecastModelSelect.plot_model_compare-769"><span class="linenos">769</span></a>        <span class="c1"># Expand the palette if more colors are needed</span>
</span><span id="ForecastModelSelect.plot_model_compare-770"><a href="#ForecastModelSelect.plot_model_compare-770"><span class="linenos">770</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">initial_palette</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">nseries</span><span class="p">:</span>
</span><span id="ForecastModelSelect.plot_model_compare-771"><a href="#ForecastModelSelect.plot_model_compare-771"><span class="linenos">771</span></a>            <span class="n">expanded_colors</span> <span class="o">=</span> <span class="n">expand_color_palette</span><span class="p">(</span><span class="s2">&quot;colorblind&quot;</span><span class="p">,</span> <span class="n">n_colors_needed</span><span class="o">=</span><span class="n">nseries</span><span class="p">)</span>
</span><span id="ForecastModelSelect.plot_model_compare-772"><a href="#ForecastModelSelect.plot_model_compare-772"><span class="linenos">772</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ForecastModelSelect.plot_model_compare-773"><a href="#ForecastModelSelect.plot_model_compare-773"><span class="linenos">773</span></a>            <span class="n">expanded_colors</span> <span class="o">=</span> <span class="n">initial_palette</span>
</span><span id="ForecastModelSelect.plot_model_compare-774"><a href="#ForecastModelSelect.plot_model_compare-774"><span class="linenos">774</span></a>
</span><span id="ForecastModelSelect.plot_model_compare-775"><a href="#ForecastModelSelect.plot_model_compare-775"><span class="linenos">775</span></a>        <span class="n">toplot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span> <span class="n">expanded_colors</span><span class="p">)</span>
</span><span id="ForecastModelSelect.plot_model_compare-776"><a href="#ForecastModelSelect.plot_model_compare-776"><span class="linenos">776</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span> <span class="o">=</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>
</span><span id="ForecastModelSelect.plot_model_compare-777"><a href="#ForecastModelSelect.plot_model_compare-777"><span class="linenos">777</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;xx-large&quot;</span><span class="p">)</span>
</span><span id="ForecastModelSelect.plot_model_compare-778"><a href="#ForecastModelSelect.plot_model_compare-778"><span class="linenos">778</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="ForecastModelSelect.plot_model_compare-779"><a href="#ForecastModelSelect.plot_model_compare-779"><span class="linenos">779</span></a>        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect.plot_model_compare-780"><a href="#ForecastModelSelect.plot_model_compare-780"><span class="linenos">780</span></a>            <span class="k">return</span> <span class="n">f</span><span class="p">,</span> <span class="n">ax</span>
</span><span id="ForecastModelSelect.plot_model_compare-781"><a href="#ForecastModelSelect.plot_model_compare-781"><span class="linenos">781</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ForecastModelSelect.plot_model_compare-782"><a href="#ForecastModelSelect.plot_model_compare-782"><span class="linenos">782</span></a>            <span class="k">return</span> <span class="n">ax</span>
</span></pre></div>


            <div class="docstring"><p>Plot a comparison of models based on their out-of-sample performance.</p>

<h2 id="parameters">Parameters:</h2>

<pre><code>score : str, optional
    The performance metric for comparison. Should be either 'RMSE' or 'MAPE'. Default is 'RMSE'.
view : str, optional
    The view mode for comparison, either 'horizon' or 'cutoff'. Default is 'horizon'.
xlabel : str, optional
    The label for the x-axis. Default is an empty string.
ylabel : str, optional
    The label for the y-axis. Default is an empty string.
title : str, optional
    The title of the plot. Default is 'Out of Sample Performance'.
ax : matplotlib.axes._subplots.AxesSubplot, optional
    The matplotlib axes to use for plotting. Default is None.
figsize : tuple, optional
    The size of the figure in inches (width, height). Default is (15, 6).
</code></pre>

<h2 id="returns">Returns:</h2>

<pre><code>matplotlib.figure.Figure or matplotlib.axes._subplots.AxesSubplot
    The figure and axes of the plot.
</code></pre>
</div>


                            </div>
                            <div id="ForecastModelSelect.plot_prediction" class="classattr">
                                        <input id="ForecastModelSelect.plot_prediction-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_prediction</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">y_pred</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">Series</span>,</span><span class="param">	<span class="n">models_preds</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">y_pred_interval</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">interval_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;CI&#39;</span>,</span><span class="param">	<span class="n">aggregation_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Model Agg&#39;</span>,</span><span class="param">	<span class="n">xlabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>,</span><span class="param">	<span class="n">ylabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>,</span><span class="param">	<span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Prediction&#39;</span>,</span><span class="param">	<span class="n">ax</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_axes</span><span class="o">.</span><span class="n">Axes</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">figsize</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">Figure</span><span class="p">,</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_axes</span><span class="o">.</span><span class="n">Axes</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="ForecastModelSelect.plot_prediction-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ForecastModelSelect.plot_prediction"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ForecastModelSelect.plot_prediction-784"><a href="#ForecastModelSelect.plot_prediction-784"><span class="linenos">784</span></a>    <span class="k">def</span> <span class="nf">plot_prediction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="ForecastModelSelect.plot_prediction-785"><a href="#ForecastModelSelect.plot_prediction-785"><span class="linenos">785</span></a>                        <span class="n">y_pred</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> 
</span><span id="ForecastModelSelect.plot_prediction-786"><a href="#ForecastModelSelect.plot_prediction-786"><span class="linenos">786</span></a>                        <span class="n">models_preds</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
</span><span id="ForecastModelSelect.plot_prediction-787"><a href="#ForecastModelSelect.plot_prediction-787"><span class="linenos">787</span></a>                        <span class="n">y_pred_interval</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
</span><span id="ForecastModelSelect.plot_prediction-788"><a href="#ForecastModelSelect.plot_prediction-788"><span class="linenos">788</span></a>                        <span class="n">interval_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;CI&#39;</span><span class="p">,</span> 
</span><span id="ForecastModelSelect.plot_prediction-789"><a href="#ForecastModelSelect.plot_prediction-789"><span class="linenos">789</span></a>                        <span class="n">aggregation_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Model Agg&#39;</span><span class="p">,</span> 
</span><span id="ForecastModelSelect.plot_prediction-790"><a href="#ForecastModelSelect.plot_prediction-790"><span class="linenos">790</span></a>                        <span class="n">xlabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> 
</span><span id="ForecastModelSelect.plot_prediction-791"><a href="#ForecastModelSelect.plot_prediction-791"><span class="linenos">791</span></a>                        <span class="n">ylabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> 
</span><span id="ForecastModelSelect.plot_prediction-792"><a href="#ForecastModelSelect.plot_prediction-792"><span class="linenos">792</span></a>                        <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Prediction&#39;</span><span class="p">,</span> 
</span><span id="ForecastModelSelect.plot_prediction-793"><a href="#ForecastModelSelect.plot_prediction-793"><span class="linenos">793</span></a>                        <span class="n">ax</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
</span><span id="ForecastModelSelect.plot_prediction-794"><a href="#ForecastModelSelect.plot_prediction-794"><span class="linenos">794</span></a>                        <span class="n">figsize</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</span><span id="ForecastModelSelect.plot_prediction-795"><a href="#ForecastModelSelect.plot_prediction-795"><span class="linenos">795</span></a>
</span><span id="ForecastModelSelect.plot_prediction-796"><a href="#ForecastModelSelect.plot_prediction-796"><span class="linenos">796</span></a>                       <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]:</span>
</span><span id="ForecastModelSelect.plot_prediction-797"><a href="#ForecastModelSelect.plot_prediction-797"><span class="linenos">797</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect.plot_prediction-798"><a href="#ForecastModelSelect.plot_prediction-798"><span class="linenos">798</span></a><span class="sd">        Plot forecast predictions and aggregated prediction.</span>
</span><span id="ForecastModelSelect.plot_prediction-799"><a href="#ForecastModelSelect.plot_prediction-799"><span class="linenos">799</span></a>
</span><span id="ForecastModelSelect.plot_prediction-800"><a href="#ForecastModelSelect.plot_prediction-800"><span class="linenos">800</span></a><span class="sd">        Parameters:</span>
</span><span id="ForecastModelSelect.plot_prediction-801"><a href="#ForecastModelSelect.plot_prediction-801"><span class="linenos">801</span></a><span class="sd">        -----------        </span>
</span><span id="ForecastModelSelect.plot_prediction-802"><a href="#ForecastModelSelect.plot_prediction-802"><span class="linenos">802</span></a><span class="sd">            y_pred : pd.Series</span>
</span><span id="ForecastModelSelect.plot_prediction-803"><a href="#ForecastModelSelect.plot_prediction-803"><span class="linenos">803</span></a><span class="sd">                The aggregated prediction.</span>
</span><span id="ForecastModelSelect.plot_prediction-804"><a href="#ForecastModelSelect.plot_prediction-804"><span class="linenos">804</span></a><span class="sd">            models_preds : pd.DataFrame, optional</span>
</span><span id="ForecastModelSelect.plot_prediction-805"><a href="#ForecastModelSelect.plot_prediction-805"><span class="linenos">805</span></a><span class="sd">                The DataFrame containing predictions from different models. Default is None.</span>
</span><span id="ForecastModelSelect.plot_prediction-806"><a href="#ForecastModelSelect.plot_prediction-806"><span class="linenos">806</span></a><span class="sd">            y_pred_interval : tuple, optional</span>
</span><span id="ForecastModelSelect.plot_prediction-807"><a href="#ForecastModelSelect.plot_prediction-807"><span class="linenos">807</span></a><span class="sd">                Prediction interval for the aggregated prediction. Default is None.</span>
</span><span id="ForecastModelSelect.plot_prediction-808"><a href="#ForecastModelSelect.plot_prediction-808"><span class="linenos">808</span></a><span class="sd">            interval_label : str, optional</span>
</span><span id="ForecastModelSelect.plot_prediction-809"><a href="#ForecastModelSelect.plot_prediction-809"><span class="linenos">809</span></a><span class="sd">                Label for the prediction interval. Default is &#39;prediction interval&#39;.</span>
</span><span id="ForecastModelSelect.plot_prediction-810"><a href="#ForecastModelSelect.plot_prediction-810"><span class="linenos">810</span></a><span class="sd">            aggregation_label : str, optional</span>
</span><span id="ForecastModelSelect.plot_prediction-811"><a href="#ForecastModelSelect.plot_prediction-811"><span class="linenos">811</span></a><span class="sd">                Label for the aggregated prediction. Default is &#39;Model Agg&#39;.</span>
</span><span id="ForecastModelSelect.plot_prediction-812"><a href="#ForecastModelSelect.plot_prediction-812"><span class="linenos">812</span></a><span class="sd">            xlabel : str, optional</span>
</span><span id="ForecastModelSelect.plot_prediction-813"><a href="#ForecastModelSelect.plot_prediction-813"><span class="linenos">813</span></a><span class="sd">                Label for the x-axis. Default is an empty string.</span>
</span><span id="ForecastModelSelect.plot_prediction-814"><a href="#ForecastModelSelect.plot_prediction-814"><span class="linenos">814</span></a><span class="sd">            ylabel : str, optional</span>
</span><span id="ForecastModelSelect.plot_prediction-815"><a href="#ForecastModelSelect.plot_prediction-815"><span class="linenos">815</span></a><span class="sd">                Label for the y-axis. Default is an empty string.</span>
</span><span id="ForecastModelSelect.plot_prediction-816"><a href="#ForecastModelSelect.plot_prediction-816"><span class="linenos">816</span></a><span class="sd">            title : str, optional</span>
</span><span id="ForecastModelSelect.plot_prediction-817"><a href="#ForecastModelSelect.plot_prediction-817"><span class="linenos">817</span></a><span class="sd">                Title of the plot. Default is &#39;Prediction&#39;.</span>
</span><span id="ForecastModelSelect.plot_prediction-818"><a href="#ForecastModelSelect.plot_prediction-818"><span class="linenos">818</span></a><span class="sd">            ax : matplotlib.axes._subplots.AxesSubplot, optional</span>
</span><span id="ForecastModelSelect.plot_prediction-819"><a href="#ForecastModelSelect.plot_prediction-819"><span class="linenos">819</span></a><span class="sd">                Matplotlib axes to use for plotting. Default is None.</span>
</span><span id="ForecastModelSelect.plot_prediction-820"><a href="#ForecastModelSelect.plot_prediction-820"><span class="linenos">820</span></a><span class="sd">            figsize : tuple, optional</span>
</span><span id="ForecastModelSelect.plot_prediction-821"><a href="#ForecastModelSelect.plot_prediction-821"><span class="linenos">821</span></a><span class="sd">                Size of the figure in inches (width, height). Default is (15, 6).</span>
</span><span id="ForecastModelSelect.plot_prediction-822"><a href="#ForecastModelSelect.plot_prediction-822"><span class="linenos">822</span></a>
</span><span id="ForecastModelSelect.plot_prediction-823"><a href="#ForecastModelSelect.plot_prediction-823"><span class="linenos">823</span></a><span class="sd">        Returns:</span>
</span><span id="ForecastModelSelect.plot_prediction-824"><a href="#ForecastModelSelect.plot_prediction-824"><span class="linenos">824</span></a><span class="sd">        --------        </span>
</span><span id="ForecastModelSelect.plot_prediction-825"><a href="#ForecastModelSelect.plot_prediction-825"><span class="linenos">825</span></a><span class="sd">            matplotlib.figure.Figure or matplotlib.axes._subplots.AxesSubplot</span>
</span><span id="ForecastModelSelect.plot_prediction-826"><a href="#ForecastModelSelect.plot_prediction-826"><span class="linenos">826</span></a><span class="sd">                The figure and axes of the plot.</span>
</span><span id="ForecastModelSelect.plot_prediction-827"><a href="#ForecastModelSelect.plot_prediction-827"><span class="linenos">827</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect.plot_prediction-828"><a href="#ForecastModelSelect.plot_prediction-828"><span class="linenos">828</span></a>
</span><span id="ForecastModelSelect.plot_prediction-829"><a href="#ForecastModelSelect.plot_prediction-829"><span class="linenos">829</span></a>        <span class="n">y</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_y</span>
</span><span id="ForecastModelSelect.plot_prediction-830"><a href="#ForecastModelSelect.plot_prediction-830"><span class="linenos">830</span></a>        <span class="n">y_train</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">y</span><span class="o">.</span><span class="n">index</span><span class="o">&lt;</span><span class="n">y_pred</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="ForecastModelSelect.plot_prediction-831"><a href="#ForecastModelSelect.plot_prediction-831"><span class="linenos">831</span></a>        <span class="n">zoom_y_train</span> <span class="o">=</span> <span class="n">y_train</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">y_pred</span><span class="p">):]</span>
</span><span id="ForecastModelSelect.plot_prediction-832"><a href="#ForecastModelSelect.plot_prediction-832"><span class="linenos">832</span></a>    
</span><span id="ForecastModelSelect.plot_prediction-833"><a href="#ForecastModelSelect.plot_prediction-833"><span class="linenos">833</span></a>        <span class="k">if</span> <span class="n">models_preds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect.plot_prediction-834"><a href="#ForecastModelSelect.plot_prediction-834"><span class="linenos">834</span></a>            <span class="n">model_names</span> <span class="o">=</span> <span class="n">models_preds</span><span class="o">.</span><span class="n">columns</span>
</span><span id="ForecastModelSelect.plot_prediction-835"><a href="#ForecastModelSelect.plot_prediction-835"><span class="linenos">835</span></a>            <span class="n">models_preds</span> <span class="o">=</span> <span class="p">[</span><span class="n">models_preds</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">model_names</span><span class="p">]</span>
</span><span id="ForecastModelSelect.plot_prediction-836"><a href="#ForecastModelSelect.plot_prediction-836"><span class="linenos">836</span></a>            <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">model_names</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">aggregation_label</span><span class="p">]</span>
</span><span id="ForecastModelSelect.plot_prediction-837"><a href="#ForecastModelSelect.plot_prediction-837"><span class="linenos">837</span></a>
</span><span id="ForecastModelSelect.plot_prediction-838"><a href="#ForecastModelSelect.plot_prediction-838"><span class="linenos">838</span></a>            <span class="n">plt_res</span> <span class="o">=</span> <span class="n">plot_series</span><span class="p">(</span><span class="n">zoom_y_train</span><span class="p">,</span> <span class="o">*</span><span class="n">models_preds</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span>
</span><span id="ForecastModelSelect.plot_prediction-839"><a href="#ForecastModelSelect.plot_prediction-839"><span class="linenos">839</span></a>                               <span class="n">labels</span> <span class="o">=</span><span class="n">labels</span><span class="p">,</span>
</span><span id="ForecastModelSelect.plot_prediction-840"><a href="#ForecastModelSelect.plot_prediction-840"><span class="linenos">840</span></a>                               <span class="n">xlabel</span> <span class="o">=</span><span class="n">xlabel</span><span class="p">,</span>
</span><span id="ForecastModelSelect.plot_prediction-841"><a href="#ForecastModelSelect.plot_prediction-841"><span class="linenos">841</span></a>                               <span class="n">ylabel</span> <span class="o">=</span><span class="n">ylabel</span><span class="p">,</span>
</span><span id="ForecastModelSelect.plot_prediction-842"><a href="#ForecastModelSelect.plot_prediction-842"><span class="linenos">842</span></a>                               <span class="n">title</span> <span class="o">=</span><span class="n">title</span><span class="p">,</span>
</span><span id="ForecastModelSelect.plot_prediction-843"><a href="#ForecastModelSelect.plot_prediction-843"><span class="linenos">843</span></a>                               <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> 
</span><span id="ForecastModelSelect.plot_prediction-844"><a href="#ForecastModelSelect.plot_prediction-844"><span class="linenos">844</span></a>                               <span class="n">figsize</span> <span class="o">=</span><span class="n">figsize</span><span class="p">,</span>
</span><span id="ForecastModelSelect.plot_prediction-845"><a href="#ForecastModelSelect.plot_prediction-845"><span class="linenos">845</span></a>                               <span class="n">pred_interval</span> <span class="o">=</span> <span class="n">y_pred_interval</span><span class="p">,</span>
</span><span id="ForecastModelSelect.plot_prediction-846"><a href="#ForecastModelSelect.plot_prediction-846"><span class="linenos">846</span></a>                               <span class="n">interval_label</span> <span class="o">=</span><span class="n">interval_label</span><span class="p">)</span>
</span><span id="ForecastModelSelect.plot_prediction-847"><a href="#ForecastModelSelect.plot_prediction-847"><span class="linenos">847</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ForecastModelSelect.plot_prediction-848"><a href="#ForecastModelSelect.plot_prediction-848"><span class="linenos">848</span></a>            <span class="n">plt_res</span> <span class="o">=</span> <span class="n">plot_series</span><span class="p">(</span><span class="n">zoom_y_train</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span>
</span><span id="ForecastModelSelect.plot_prediction-849"><a href="#ForecastModelSelect.plot_prediction-849"><span class="linenos">849</span></a>                               <span class="n">labels</span> <span class="o">=</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">aggregation_label</span><span class="p">],</span>
</span><span id="ForecastModelSelect.plot_prediction-850"><a href="#ForecastModelSelect.plot_prediction-850"><span class="linenos">850</span></a>                               <span class="n">xlabel</span> <span class="o">=</span><span class="n">xlabel</span><span class="p">,</span>
</span><span id="ForecastModelSelect.plot_prediction-851"><a href="#ForecastModelSelect.plot_prediction-851"><span class="linenos">851</span></a>                               <span class="n">ylabel</span> <span class="o">=</span><span class="n">ylabel</span><span class="p">,</span>
</span><span id="ForecastModelSelect.plot_prediction-852"><a href="#ForecastModelSelect.plot_prediction-852"><span class="linenos">852</span></a>                               <span class="n">title</span> <span class="o">=</span><span class="n">title</span><span class="p">,</span>
</span><span id="ForecastModelSelect.plot_prediction-853"><a href="#ForecastModelSelect.plot_prediction-853"><span class="linenos">853</span></a>                               <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> 
</span><span id="ForecastModelSelect.plot_prediction-854"><a href="#ForecastModelSelect.plot_prediction-854"><span class="linenos">854</span></a>                               <span class="n">figsize</span> <span class="o">=</span><span class="n">figsize</span><span class="p">,</span>
</span><span id="ForecastModelSelect.plot_prediction-855"><a href="#ForecastModelSelect.plot_prediction-855"><span class="linenos">855</span></a>                               <span class="n">pred_interval</span> <span class="o">=</span> <span class="n">y_pred_interval</span><span class="p">,</span>
</span><span id="ForecastModelSelect.plot_prediction-856"><a href="#ForecastModelSelect.plot_prediction-856"><span class="linenos">856</span></a>                              <span class="n">interval_label</span> <span class="o">=</span><span class="n">interval_label</span><span class="p">)</span>
</span><span id="ForecastModelSelect.plot_prediction-857"><a href="#ForecastModelSelect.plot_prediction-857"><span class="linenos">857</span></a>        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ForecastModelSelect.plot_prediction-858"><a href="#ForecastModelSelect.plot_prediction-858"><span class="linenos">858</span></a>            <span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt_res</span>
</span><span id="ForecastModelSelect.plot_prediction-859"><a href="#ForecastModelSelect.plot_prediction-859"><span class="linenos">859</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="ForecastModelSelect.plot_prediction-860"><a href="#ForecastModelSelect.plot_prediction-860"><span class="linenos">860</span></a>            <span class="k">return</span> <span class="n">f</span><span class="p">,</span> <span class="n">ax</span>
</span><span id="ForecastModelSelect.plot_prediction-861"><a href="#ForecastModelSelect.plot_prediction-861"><span class="linenos">861</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ForecastModelSelect.plot_prediction-862"><a href="#ForecastModelSelect.plot_prediction-862"><span class="linenos">862</span></a>            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt_res</span>
</span><span id="ForecastModelSelect.plot_prediction-863"><a href="#ForecastModelSelect.plot_prediction-863"><span class="linenos">863</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="ForecastModelSelect.plot_prediction-864"><a href="#ForecastModelSelect.plot_prediction-864"><span class="linenos">864</span></a>            <span class="k">return</span> <span class="n">ax</span>
</span></pre></div>


            <div class="docstring"><p>Plot forecast predictions and aggregated prediction.</p>

<h2 id="parameters">Parameters:</h2>

<pre><code>y_pred : pd.Series
    The aggregated prediction.
models_preds : pd.DataFrame, optional
    The DataFrame containing predictions from different models. Default is None.
y_pred_interval : tuple, optional
    Prediction interval for the aggregated prediction. Default is None.
interval_label : str, optional
    Label for the prediction interval. Default is 'prediction interval'.
aggregation_label : str, optional
    Label for the aggregated prediction. Default is 'Model Agg'.
xlabel : str, optional
    Label for the x-axis. Default is an empty string.
ylabel : str, optional
    Label for the y-axis. Default is an empty string.
title : str, optional
    Title of the plot. Default is 'Prediction'.
ax : matplotlib.axes._subplots.AxesSubplot, optional
    Matplotlib axes to use for plotting. Default is None.
figsize : tuple, optional
    Size of the figure in inches (width, height). Default is (15, 6).
</code></pre>

<h2 id="returns">Returns:</h2>

<pre><code>matplotlib.figure.Figure or matplotlib.axes._subplots.AxesSubplot
    The figure and axes of the plot.
</code></pre>
</div>


                            </div>
                            <div id="ForecastModelSelect.plot_train_test" class="classattr">
                                        <input id="ForecastModelSelect.plot_train_test-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_train_test</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ForecastModelSelect.plot_train_test-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ForecastModelSelect.plot_train_test"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ForecastModelSelect.plot_train_test-866"><a href="#ForecastModelSelect.plot_train_test-866"><span class="linenos">866</span></a>    <span class="k">def</span> <span class="nf">plot_train_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
</span><span id="ForecastModelSelect.plot_train_test-867"><a href="#ForecastModelSelect.plot_train_test-867"><span class="linenos">867</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect.plot_train_test-868"><a href="#ForecastModelSelect.plot_train_test-868"><span class="linenos">868</span></a><span class="sd">        Plot the training and test windows for each model.</span>
</span><span id="ForecastModelSelect.plot_train_test-869"><a href="#ForecastModelSelect.plot_train_test-869"><span class="linenos">869</span></a>
</span><span id="ForecastModelSelect.plot_train_test-870"><a href="#ForecastModelSelect.plot_train_test-870"><span class="linenos">870</span></a><span class="sd">        Parameters:</span>
</span><span id="ForecastModelSelect.plot_train_test-871"><a href="#ForecastModelSelect.plot_train_test-871"><span class="linenos">871</span></a><span class="sd">        -----------        </span>
</span><span id="ForecastModelSelect.plot_train_test-872"><a href="#ForecastModelSelect.plot_train_test-872"><span class="linenos">872</span></a><span class="sd">            kwargs</span>
</span><span id="ForecastModelSelect.plot_train_test-873"><a href="#ForecastModelSelect.plot_train_test-873"><span class="linenos">873</span></a><span class="sd">                Additional keyword arguments to be passed to the plot function.</span>
</span><span id="ForecastModelSelect.plot_train_test-874"><a href="#ForecastModelSelect.plot_train_test-874"><span class="linenos">874</span></a>
</span><span id="ForecastModelSelect.plot_train_test-875"><a href="#ForecastModelSelect.plot_train_test-875"><span class="linenos">875</span></a><span class="sd">        Returns:</span>
</span><span id="ForecastModelSelect.plot_train_test-876"><a href="#ForecastModelSelect.plot_train_test-876"><span class="linenos">876</span></a><span class="sd">        --------        </span>
</span><span id="ForecastModelSelect.plot_train_test-877"><a href="#ForecastModelSelect.plot_train_test-877"><span class="linenos">877</span></a><span class="sd">            fig : plt.Figure</span>
</span><span id="ForecastModelSelect.plot_train_test-878"><a href="#ForecastModelSelect.plot_train_test-878"><span class="linenos">878</span></a><span class="sd">                If ax was None, a new figure is created and returned</span>
</span><span id="ForecastModelSelect.plot_train_test-879"><a href="#ForecastModelSelect.plot_train_test-879"><span class="linenos">879</span></a><span class="sd">                If ax was not None, the same ax is returned with plot added</span>
</span><span id="ForecastModelSelect.plot_train_test-880"><a href="#ForecastModelSelect.plot_train_test-880"><span class="linenos">880</span></a><span class="sd">            ax : plt.Axis             </span>
</span><span id="ForecastModelSelect.plot_train_test-881"><a href="#ForecastModelSelect.plot_train_test-881"><span class="linenos">881</span></a><span class="sd">                Axes containing the plot             </span>
</span><span id="ForecastModelSelect.plot_train_test-882"><a href="#ForecastModelSelect.plot_train_test-882"><span class="linenos">882</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect.plot_train_test-883"><a href="#ForecastModelSelect.plot_train_test-883"><span class="linenos">883</span></a>        <span class="n">_lf</span>  <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ForecastModelSelect.plot_train_test-884"><a href="#ForecastModelSelect.plot_train_test-884"><span class="linenos">884</span></a>        <span class="k">return</span> <span class="n">_lf</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">plot_train_test</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Plot the training and test windows for each model.</p>

<h2 id="parameters">Parameters:</h2>

<pre><code>kwargs
    Additional keyword arguments to be passed to the plot function.
</code></pre>

<h2 id="returns">Returns:</h2>

<pre><code>fig : plt.Figure
    If ax was None, a new figure is created and returned
    If ax was not None, the same ax is returned with plot added
ax : plt.Axis             
    Axes containing the plot
</code></pre>
</div>


                            </div>
                            <div id="ForecastModelSelect.plot_cv_procedure" class="classattr">
                                        <input id="ForecastModelSelect.plot_cv_procedure-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_cv_procedure</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ForecastModelSelect.plot_cv_procedure-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ForecastModelSelect.plot_cv_procedure"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ForecastModelSelect.plot_cv_procedure-886"><a href="#ForecastModelSelect.plot_cv_procedure-886"><span class="linenos">886</span></a>    <span class="k">def</span> <span class="nf">plot_cv_procedure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
</span><span id="ForecastModelSelect.plot_cv_procedure-887"><a href="#ForecastModelSelect.plot_cv_procedure-887"><span class="linenos">887</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect.plot_cv_procedure-888"><a href="#ForecastModelSelect.plot_cv_procedure-888"><span class="linenos">888</span></a><span class="sd">        Plot the cross-validation procedure for each model.</span>
</span><span id="ForecastModelSelect.plot_cv_procedure-889"><a href="#ForecastModelSelect.plot_cv_procedure-889"><span class="linenos">889</span></a>
</span><span id="ForecastModelSelect.plot_cv_procedure-890"><a href="#ForecastModelSelect.plot_cv_procedure-890"><span class="linenos">890</span></a><span class="sd">        Parameters:</span>
</span><span id="ForecastModelSelect.plot_cv_procedure-891"><a href="#ForecastModelSelect.plot_cv_procedure-891"><span class="linenos">891</span></a><span class="sd">        -----------        </span>
</span><span id="ForecastModelSelect.plot_cv_procedure-892"><a href="#ForecastModelSelect.plot_cv_procedure-892"><span class="linenos">892</span></a><span class="sd">            kwargs</span>
</span><span id="ForecastModelSelect.plot_cv_procedure-893"><a href="#ForecastModelSelect.plot_cv_procedure-893"><span class="linenos">893</span></a><span class="sd">                Additional keyword arguments to be passed to the plot function.</span>
</span><span id="ForecastModelSelect.plot_cv_procedure-894"><a href="#ForecastModelSelect.plot_cv_procedure-894"><span class="linenos">894</span></a>
</span><span id="ForecastModelSelect.plot_cv_procedure-895"><a href="#ForecastModelSelect.plot_cv_procedure-895"><span class="linenos">895</span></a><span class="sd">        Returns:</span>
</span><span id="ForecastModelSelect.plot_cv_procedure-896"><a href="#ForecastModelSelect.plot_cv_procedure-896"><span class="linenos">896</span></a><span class="sd">        --------</span>
</span><span id="ForecastModelSelect.plot_cv_procedure-897"><a href="#ForecastModelSelect.plot_cv_procedure-897"><span class="linenos">897</span></a><span class="sd">            fig : plt.Figure</span>
</span><span id="ForecastModelSelect.plot_cv_procedure-898"><a href="#ForecastModelSelect.plot_cv_procedure-898"><span class="linenos">898</span></a><span class="sd">                If ax was None, a new figure is created and returned</span>
</span><span id="ForecastModelSelect.plot_cv_procedure-899"><a href="#ForecastModelSelect.plot_cv_procedure-899"><span class="linenos">899</span></a><span class="sd">                If ax was not None, the same ax is returned with plot added</span>
</span><span id="ForecastModelSelect.plot_cv_procedure-900"><a href="#ForecastModelSelect.plot_cv_procedure-900"><span class="linenos">900</span></a><span class="sd">            ax : plt.Axis             </span>
</span><span id="ForecastModelSelect.plot_cv_procedure-901"><a href="#ForecastModelSelect.plot_cv_procedure-901"><span class="linenos">901</span></a><span class="sd">                Axes containing the plot             </span>
</span><span id="ForecastModelSelect.plot_cv_procedure-902"><a href="#ForecastModelSelect.plot_cv_procedure-902"><span class="linenos">902</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ForecastModelSelect.plot_cv_procedure-903"><a href="#ForecastModelSelect.plot_cv_procedure-903"><span class="linenos">903</span></a>        <span class="n">_lf</span>  <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LF_d</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ForecastModelSelect.plot_cv_procedure-904"><a href="#ForecastModelSelect.plot_cv_procedure-904"><span class="linenos">904</span></a>        <span class="k">return</span> <span class="n">_lf</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">plot_cv_procedure</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Plot the cross-validation procedure for each model.</p>

<h2 id="parameters">Parameters:</h2>

<pre><code>kwargs
    Additional keyword arguments to be passed to the plot function.
</code></pre>

<h2 id="returns">Returns:</h2>

<pre><code>fig : plt.Figure
    If ax was None, a new figure is created and returned
    If ax was not None, the same ax is returned with plot added
ax : plt.Axis             
    Axes containing the plot
</code></pre>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>